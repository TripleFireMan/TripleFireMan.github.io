{"posts":[{"title":"CAReplicatorLayeræ¢ç©¶","text":"æ¦‚è¿° è¿™ä¸ªlayerå¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ è¿™ä¸ªlayerå¦‚ä½•ç”¨ï¼Ÿ ä½•ç§åœºæ™¯é€‚åˆè¿™ä¸ªlayerå‘æŒ¥ï¼Ÿ å¸¦ç€è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬ä¸Šè·¯ï¼Œå¼€å§‹ç ”ç©¶å®ƒã€‚ è‹¹æœå®˜æ–¹demo â€‹ è¿™ä¸ªæ˜¯æˆ‘æœåˆ°çš„è‹¹æœå¯¹CAReplicatorLayerè®²è¿°åŠŸèƒ½æ—¶ï¼Œä½¿ç”¨åˆ°çš„demoï¼Œæœ‰æ²¡æœ‰åŠç‚¸å¤©çš„æ„Ÿè§‰ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œæˆ‘è¦å‘Šè¯‰ä½ çš„æ˜¯ï¼Œå®ç°è¿™æ ·ä¸€ä¸ªåŠŸèƒ½ä½¿ç”¨çš„ä»£ç ä¸è¶…è¿‡300è¡Œã€‚ å¹²ä»€ä¹ˆç”¨ï¼Ÿâ€‹ è¯´å®è¯ï¼Œå…¶å®è¿™ä¸ªlayerå¾ˆåé—¨ï¼ŒåŸºæœ¬ä¸Šå¾ˆå°‘æœ‰äººä¼šç”¨åˆ°å®ƒï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å¤åˆ¶ä»»æ„æ•°é‡çš„å®ƒçš„sublayerçš„ï¼Œsublayeræ˜¯å®ƒå¤åˆ¶çš„æºå¤´ï¼Œå¦‚æœæ²¡æœ‰sublayeré‚£ä¹ˆæ˜¯å¤åˆ¶ä¸äº†çš„ã€‚å¤åˆ¶çš„æ–¹å¼ï¼Œå¯èƒ½æ˜¯å‡ ä½•å˜æ¢ã€æ—¶é—´æ§åˆ¶ã€é¢œè‰²å˜æ¢ã€‚ â€‹ ä½¿ç”¨CAReplicatorLayerå¯¹è±¡å¯ä»¥é€šè¿‡ä¸€ä¸ªå›¾ç‰‡æºæ„å»ºå¤æ‚çš„å¸ƒå±€ï¼Œè€Œä»…ä»…æ˜¯é€šè¿‡åæ ‡è½¬æ¢ã€é¢œè‰²è½¬æ¢ã€æ—¶é—´è½¬æ¢ã€‚ å¦‚ä½•ä½¿ç”¨ åŸºç¡€ä½¿ç”¨ å¤šè¯´æ— ç›Šï¼Œçœ‹ä»£ç å§ 123456789101112131415161718192021222324252627282930313233343536373839404142434445- (CAReplicatorLayer *)xReplicatorLayer{ // åˆ›å»ºåŸå§‹å›¾å±‚ï¼Œç™½è‰²çš„å¤§å° 50ï¼Œ50 CALayer *redLayer = [CALayer layer]; redLayer.backgroundColor = [[UIColor whiteColor]CGColor]; redLayer.frame = CGRectMake(0, 0, 50, 50); // åˆ›å»ºå¤åˆ¶å›¾å±‚ï¼Œå¹¶è®¾ç½®å¤åˆ¶5ä¸ªï¼Œå¤åˆ¶è½¬æ¢ä¸ºæŒ‰æ¨ªåæ ‡åç§»60ï¼Œé¢œè‰²ä¸ºä»ç™½å˜ä¸ºçº¢ CAReplicatorLayer *replicatorLayer = [CAReplicatorLayer layer]; replicatorLayer.instanceCount = 5; replicatorLayer.instanceTransform = CATransform3DMakeTranslation(60, 0, 0); CGFloat step = - 1 / 5.f; replicatorLayer.instanceGreenOffset = step; replicatorLayer.instanceBlueOffset = step; [replicatorLayer addSublayer:redLayer]; return replicatorLayer;}- (CAReplicatorLayer *)ReplicatorLayer{ // è·å–ç»è¿‡Xè½´å˜æ¢çš„layer CAReplicatorLayer *redLayer = [self xReplicatorLayer]; // åšçºµåæ ‡å˜æ¢ï¼Œå¤åˆ¶6æ¬¡ï¼Œå˜æ¢æ–¹å¼ä¸ºå‘ä¸Šåç§»60ï¼Œé¢œè‰²ä»çº¢å˜ç° CAReplicatorLayer *replicatorLayer = [CAReplicatorLayer layer]; replicatorLayer.instanceCount = 6; replicatorLayer.instanceTransform = CATransform3DMakeTranslation(0, 60, 0); CGFloat step = -1 / 6.f; replicatorLayer.instanceRedOffset = step; [replicatorLayer addSublayer:redLayer]; return replicatorLayer;}- (void)viewDidLoad { [super viewDidLoad]; self.view.backgroundColor = [UIColor blackColor]; CAReplicatorLayer *replicatorLayer = [self ReplicatorLayer]; replicatorLayer.frame = CGRectMake(10, 100, 50, 50); [self.view.layer addSublayer:replicatorLayer]; } å®ç°æ•ˆæœï¼Œå¦‚ä¸‹å›¾ é™¤äº†åšæ¨ªçºµåæ ‡å˜æ¢ä»¥å¤–ï¼Œè¿˜å¯ä»¥åšæ—‹è½¬ï¼Œä»£ç å¦‚ä¸‹ 1234567891011121314151617- (CAReplicatorLayer *)rotateReplicatorLayer{ CAReplicatorLayer *layer = [CAReplicatorLayer layer]; layer.frame = CGRectMake(screen_width() / 2, screen_height() / 2, w_16, h_16); CALayer *content = [CALayer layer]; content.opacity = 1; content.frame = layer.bounds; content.contents = (id)[[UIImage imageNamed:@&quot;brightBlob.png&quot;]CGImage]; layer.instanceCount = 36; layer.instanceColor = [[UIColor redColor]CGColor]; CATransform3D transform = CATransform3DMakeTranslation(16, 0, 0); layer.instanceTransform = CATransform3DRotate(transform, -M_PI * 10 / 180, 0, 0, 1); [layer addSublayer:content]; return layer;} æ•ˆæœå›¾å¦‚ä¸‹ è¿›é˜¶ä½¿ç”¨ ä½¿ç”¨è¯¥ç±»å¯ä»¥å®ç°ç²’å­å‘å°„å™¨çš„æ•ˆæœï¼Œç»“åˆåŠ¨ç”»çš„ä½¿ç”¨ï¼ŒåŠ ä¸Šæ—‹è½¬ã€ä½ç§»å˜æ¢ï¼Œå¯ä»¥å®ç°ç±»ä¼¼æ¸¸æˆä¸­çš„ç²’å­å‘å°„å™¨çš„æ•ˆæœã€‚æ­¤å¤„éœ€è¦å®šä¹‰ä¸€ä¸ªCYEmitterLayerç±»ï¼Œè¯¥ç±»è¦ç»§æ‰¿è‡ªCAReplicatorLayerã€‚å¾ˆæ˜¾ç„¶ï¼Œæˆ‘è¦å¯¹CAReplicatorLayerè¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚è®©å®ƒå…·å¤‡å¼€å§‹å‘å°„ç²’å­å’Œåœæ­¢å‘å°„ç²’å­çš„åŠŸèƒ½ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172#import &lt;QuartzCore/QuartzCore.h&gt;@interface CYEmitterLayer : CAReplicatorLayer{}@property (nonatomic, strong) CALayer *imageLayer; //ä½œä¸ºåŸå§‹å±‚ï¼Œä¾›CAReplicatorLayer å¤åˆ¶@property (nonatomic, assign) CGFloat rotator; //æ—‹è½¬å› å­ï¼Œå®ç°æ—‹è½¬åŠŸèƒ½@property (nonatomic, assign) CGFloat length; //å‘å°„é•¿åº¦@property (nonatomic, assign) CGFloat count; //ä¸€æ¬¡å‘å°„çš„ä¸ªæ•°@property (nonatomic, assign) CGFloat angle; //å‘å°„è§’åº¦@property (nonatomic, assign) CGFloat cycleTime; //å¾ªç¯æ—¶é—´@property (nonatomic, assign) CGFloat xAdjust; //xè½´è°ƒæ•´@property (nonatomic, assign) CGFloat yAdjust; //yè½´è°ƒæ•´- (void)start;- (void)stop;@end #import &quot;CYEmitterLayer.h&quot;#import &lt;UIKit/UIKit.h&gt;@implementation CYEmitterLayer- (id)init{ self = [super init]; if (self) { self.count = 1; self.imageLayer = [CALayer layer]; self.imageLayer.contents = (id)[UIImage imageNamed:@&quot;brightBlob&quot;].CGImage; self.instanceColor = [[UIColor whiteColor]CGColor]; [self addSublayer:self.imageLayer]; } return self;}- (void)start{ // é…ç½®å‘å°„ä¿¡æ¯ self.imageLayer.frame = self.bounds; self.imageLayer.opacity = 1.0f; self.instanceCount = self.count; self.instanceDelay = self.cycleTime / self.count; // æ ¡å‡†ç²’å­ä¸ä¸Šä¸ªç²’å­ä¹‹é—´çš„è§’åº¦ä»¥åŠä½ç½® CATransform3D transform = CATransform3DMakeRotation(self.rotator, 0, 0, 1); self.instanceTransform = CATransform3DTranslate(transform, self.xAdjust, self.yAdjust, 0); // æ ¡å‡†å‘å°„æºå‘å°„è§’åº¦ self.transform = CATransform3DMakeRotation(self.angle, 0, 0, 1); // æ‰§è¡ŒåŠ¨ç”»ï¼Œå®ç°å‘å°„æ•ˆæœ [self animation];}- (void)animation{ CGPoint newPoint = CGPointMake(0, self.length); CABasicAnimation *basic = [CABasicAnimation animation]; basic.keyPath = @&quot;position&quot;; basic.toValue = [NSValue valueWithCGPoint:newPoint]; basic.duration = self.cycleTime; basic.repeatCount = MAXFLOAT; [self.imageLayer addAnimation:basic forKey:@&quot;position&quot;];}- (void)stop{ self.imageLayer.opacity = 0; [self.imageLayer removeAllAnimations]; self.instanceCount = 0;}@end è¿™é‡Œæ˜¯å¤´æ–‡ä»¶çš„å®šä¹‰ï¼Œæˆ‘ä»¬æ‰©å±•äº†åŠ¨ç”»æ‰§è¡Œæ—¶é—´ã€å‘å°„ä¸ªæ•°ã€å‘å°„è§’åº¦ã€ç²’å­æ—‹è½¬è§’åº¦ç­‰åŸºæœ¬å±æ€§ï¼Œé€šè¿‡å¯¹è¿™äº›åŸºæœ¬å±æ€§çš„åˆç†èµ‹å€¼ï¼Œå°±å¯ä»¥å®ç°å‘å°„ç²’å­çš„åŠŸèƒ½äº†ã€‚æˆ‘è¿™é‡Œåªå†™äº†ä¿©ä¸ªç®€å•çš„ç”¨æ³•ï¼Œå…·ä½“æ€ä¹ˆå®ç°æ›´ç‰›é€¼ï¼Œæ›´åŠçš„æ•ˆæœå°±é çœ‹å®˜è„‘æ´å¤§å¼€äº†ã€‚ æ•ˆæœå›¾å¦‚ä¸‹ â€‹ ä½•æ—¶ä½¿ç”¨ï¼Ÿâ€‹ æˆ‘ä¸ªäººè®¤ä¸ºï¼Œè¿™ä¸ªç±»ä¹‹æ‰€ä»¥æ²¡æœ‰åœ¨æˆ‘ä»¬å¼€å‘ä¸­ç»å¸¸å‡ºç°ï¼Œç¡®å®æ˜¯æœ‰é“ç†çš„ï¼Œåé¢çš„ç²’å­å‘å°„å™¨ï¼Œå®é™…ä¸Šè‹¹æœåœ¨ios5çš„æ—¶å€™å·²ç»å¼•å…¥äº†CAEmitterLayeræ¥åšè¿™ä¸ªåŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªç±»çš„åœºæ™¯ä¹Ÿå°±å‰©ä¸‹é™æ€çš„å±•ç¤ºå¤šä¸ªå›¾å±‚çš„æ—¶å€™ä½¿ç”¨äº†ï¼Œæ­¤å¤–è¦è¯´çš„æ˜¯ï¼Œç”±äºlayerä¸èƒ½åƒUIViewé‚£æ ·çš„å“åº”è§¦æ‘¸äº‹ä»¶ï¼Œå¸¦æœ‰äº¤äº’çš„åœºæ™¯æ˜¯ä¸é€‚åˆå®ƒçš„ï¼Œå¥½äº†ï¼Œä¸‹é¢é™„ä¸Šæˆ‘åœ¨githubä¸Šçš„demoåœ°å€ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸‹è½½ä¸‹æ¥è§‚çœ‹ä¸‹ã€‚ â€‹ å¦å¤–ï¼Œå¼€åœºçš„è‹¹æœå®˜æ–¹demoæ˜¯ç”¨æ¥é•‡åœºçš„ #35 å‚è€ƒèµ„æ–™ å®˜æ–¹èµ„æ–™","link":"/2017/05/06/CAReplicatorLayer%E6%8E%A2%E7%A9%B6/"},{"title":"CoreGraphicsAndAnimation(1)","text":"ç»˜å›¾æˆå“å±•ç¤º UIBezierPathè¯´åˆ°ç»˜å›¾ï¼Œé‚£ä¹ˆæœ‰ä¸€ä¸ªä¸å¾—ä¸è®²çš„å¯¹è±¡ï¼Œé‚£å°±æ˜¯UIBezierPathã€‚å…ˆæ¥çœ‹å‡ ä¸ªUIBezierPathé‡Œé¢æ¯”è¾ƒé‡è¦çš„APIã€‚æˆ‘éƒ½å·²ç»åšäº†æ³¨é‡Šï¼ŒåŠŸèƒ½è¿˜æ˜¯æ¯”è¾ƒå¼ºå¤§çš„ã€‚ 123456789101112131415161718192021+ (instancetype)bezierPath;//åˆ›å»ºè´å¡å°”æ›²çº¿+ (instancetype)bezierPathWithRect:(CGRect)rect;//è·å–çŸ©å½¢çš„è´å¡å°”æ›²çº¿+ (instancetype)bezierPathWithOvalInRect:(CGRect)rect;//è·å–çŸ©å½¢æ¡†å†…æ¤­åœ†çš„è´å¡å°”æ›²çº¿+ (instancetype)bezierPathWithRoundedRect:(CGRect)rect cornerRadius:(CGFloat)cornerRadius; //åœ†è§’è´å¡å°”æ›²çº¿+ (instancetype)bezierPathWithRoundedRect:(CGRect)rect byRoundingCorners:(UIRectCorner)corners cornerRadii:(CGSize)cornerRadii;//çŸ©å½¢æ¡†å†…ï¼ŒæŒ‡å®šåœ†è§’ã€åŠå¾„çš„è´å¡å°”æ›²çº¿+ (instancetype)bezierPathWithArcCenter:(CGPoint)center radius:(CGFloat)radius startAngle:(CGFloat)startAngle endAngle:(CGFloat)endAngle clockwise:(BOOL)clockwise;//æŒ‡å®šåœ†å¿ƒã€åŠå¾„ã€èµ·å§‹è§’åº¦ã€æ—¶é’Ÿæ–¹å‘çš„è´å¡å°”æ›²çº¿+ (instancetype)bezierPathWithCGPath:(CGPathRef)CGPath;//æ ¹æ®CGPathåˆ›å»ºè´å¡å°”æ›²çº¿- (instancetype)init NS_DESIGNATED_INITIALIZER;- (void)moveToPoint:(CGPoint)point;//ç§»åŠ¨åˆ°æŸä¸ªç‚¹- (void)addLineToPoint:(CGPoint)point;//ä»å½“å‰ç‚¹ï¼Œæ·»åŠ çº¿æ®µåˆ°ç›®æ ‡ç‚¹- (void)addCurveToPoint:(CGPoint)endPoint controlPoint1:(CGPoint)controlPoint1 controlPoint2:(CGPoint)controlPoint2;//è´å¡å°”ä¸‰æ¬¡æ–¹ç¨‹ï¼Œä»å½“å‰ç‚¹ï¼Œåˆ°ç›®æ ‡ç‚¹ï¼Œå—æ§åˆ¶ç‚¹1ã€æ§åˆ¶ç‚¹2æ§åˆ¶- (void)addQuadCurveToPoint:(CGPoint)endPoint controlPoint:(CGPoint)controlPoint;//è´å¡å°”äºŒæ¬¡æ–¹ç¨‹ï¼Œä»å½“å‰ç‚¹åˆ°ç›®æ ‡ç‚¹ï¼Œå—æ§åˆ¶ç‚¹1æ§åˆ¶- (void)addArcWithCenter:(CGPoint)center radius:(CGFloat)radius startAngle:(CGFloat)startAngle endAngle:(CGFloat)endAngle clockwise:(BOOL)clockwise NS_AVAILABLE_IOS(4_0);//æ·»åŠ æ¤­åœ†è·¯å¾„ï¼Œå‚æ•°åŒ…æ‹¬åœ†å¿ƒï¼ŒåŠå¾„ã€å¼€å§‹è§’åº¦ï¼Œç»“æŸè§’åº¦ï¼Œæ—¶é’Ÿæ–¹å‘- (void)closePath;//å…³é—­è·¯å¾„ï¼Œå½“å‰å¤§å¤šæ˜¯å­è·¯å¾„ï¼Œæ”¶åˆ°è¯¥æ¶ˆæ¯ä¹‹åï¼Œéƒ½ä¼šå°†é¦–ä½ç‚¹è¿æ¥èµ·æ¥ã€‚- (void)fill;//å¡«å……å°é—­è·¯å¾„ï¼Œæ ¹æ®å½“å‰contextè®¾ç½®çš„é¢œè‰²ç­‰å‚æ•°- (void)stroke;//åˆ’çº¿ï¼Œæ ¹æ®å½“å‰contextè®¾ç½®çš„çº¿å®½å•Šï¼Œé¢œè‰²å•Šç­‰å‚æ•°- (void)addClip;//åˆ‡è¾¹ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ä¹‹åï¼Œåªæœ‰å°é—­è·¯å¾„å†…å¯ä»¥ç»§ç»­æ“ä½œï¼Œå°é—­è·¯å¾„å¤–æ— æ³•æ“ä½œã€‚@end æ¢¯åº¦æ¢¯åº¦çš„å®ç°åœ¨iosé‡Œé¢æœ‰ä¿©ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡CAGradientLayerå»ç»˜åˆ¶ï¼Œä¸€ç§æ˜¯é€šè¿‡CGGradientRefä½¿ç”¨DrawRect:æ–¹æ³•å»ç»˜åˆ¶ï¼Œæˆ‘è¿™é‡Œé‡‡ç”¨çš„æ˜¯ç¬¬äºŒç§æ–¹å¼ã€‚ å®ç°æ–¹å¼ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªCYShapeViewçš„åŸºç±»ï¼Œè¯¥ç±»å¯ä»¥è®¾ç½®ä¸€äº›å±æ€§å€¼ï¼Œå¦‚å¤–è¾¹ç•Œè‰²ï¼Œé‡Œè¾¹ç•Œè‰²ï¼Œåˆ’çº¿è‰²ï¼Œçº¿å®½ç­‰ã€‚æ–¹ä¾¿å­ç±»ç»§æ‰¿å®ƒã€‚é€šè¿‡è®¾ç½®çš„è¿™äº›å±æ€§ï¼Œå¯ä»¥è·å–åˆ°éœ€è¦çš„æ¢¯åº¦RefæŒ‡é’ˆã€‚ ä¸‹é¢æ˜¯å…·ä½“çš„ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667@interface CYShapedView : UIView@property (nonatomic, strong) UIColor *innerColor;@property (nonatomic, strong) UIColor *outerColor;@property (nonatomic, strong) UIColor *strokeColor;@property (nonatomic, assign) CGFloat lineThickness;- (CGGradientRef)gradientWithColor:(UIColor *)c1 toColor:(UIColor *)c2 count:(CGFloat)colorNumb;@end @implementation CYShapedView- (id)initWithFrame:(CGRect)frame{ self = [super initWithFrame:frame]; if (self) { self.innerColor = [UIColor redColor]; self.outerColor = [UIColor yellowColor]; self.strokeColor = [UIColor blackColor]; self.lineThickness = 3.f; self.backgroundColor = [UIColor clearColor]; } return self;}- (void)setLineThickness:(CGFloat)lineThickness{ CGFloat totalWidth = self.bounds.size.width; CGFloat totalHeight = self.bounds.size.height; CGFloat halfWidth = totalWidth / 2.f; CGFloat halfHeight = totalHeight / 2.f; CGFloat smallest = MIN(halfWidth, halfHeight); CGFloat factor = smallest / 100.f; factor = (factor &gt; 1) ? 1 : factor; _lineThickness = factor * lineThickness;}- (CGGradientRef)gradientWithColor:(UIColor *)c1 toColor:(UIColor *)c2 count:(CGFloat)colorNumb{ // è·å–é¢œè‰²ç»„æˆ const CGFloat *colorComponents1 = CGColorGetComponents(c1.CGColor); CGFloat r1 = colorComponents1[0]; CGFloat g1 = colorComponents1[1]; CGFloat b1 = colorComponents1[2]; const CGFloat *colorComponents2 = CGColorGetComponents(c2.CGColor); CGFloat r2 = colorComponents2[0]; CGFloat g2 = colorComponents2[1]; CGFloat b2 = colorComponents2[2]; CGFloat gradientColorComponents[] = { r1,g1,b1,1, r2,g2,b2,1, r1,g1,b1,1, }; // ä½¿ç”¨RGBè‰²ç”Ÿæˆé¢œè‰²ç©ºé—´ CGColorSpaceRef rgb = CGColorSpaceCreateDeviceRGB(); // æ ¹æ®RGBè‰²å’Œæ¢¯åº¦è‰²æ•°ç»„ï¼Œä»¥åŠæ¢¯åº¦è‰²ä¸ªæ•°ï¼Œåˆ›å»ºæ¢¯åº¦å¼•ç”¨ CGGradientRef gradientRef = CGGradientCreateWithColorComponents(rgb, gradientColorComponents, NULL, colorNumb); CGColorSpaceRelease(rgb); return gradientRef;}@end ä½¿ç”¨æ¢¯åº¦åŠUIBezierPathç»˜åˆ¶ä¸€ä¸ªå¶å­å®ç°æ€è·¯ï¼Œåˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ªCYShapedViewçš„å­ç±»ï¼Œå¹¶å°†å®ƒå‘½åä¸ºCYPetalã€‚æˆ‘ä»¬ä¸»è¦åšçš„å·¥ä½œæ˜¯åœ¨è¯¥ç±»çš„DrawRect:æ–¹æ³•é‡Œé¢ ç»˜åˆ¶ä¸€ä¸ªå¶å­ï¼Œé¦–å…ˆè¦ç»˜åˆ¶çš„ç‚¹æœ‰èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œä¸­é—´éœ€è¦ç”¨æ›²çº¿è¿æ¥èµ·æ¥ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯æ‰¾åˆ°è¿™äº›ç‚¹ã€‚ 1234561. èµ·ç‚¹ï¼ˆstartPointï¼‰ï¼šCGPointMake(self.view.bounds.size.width / 2, 3)2. ç»ˆç‚¹ï¼ˆendPointï¼‰ï¼šCGPointMake(self.view.bounds.size.width/ 2,self.view.bounds.size.height);3. å·¦å¶å­æ§åˆ¶ç‚¹ï¼ˆleftCtlï¼‰ï¼šCGPointMake(-self.view.bounds.size.width / 2,self.view.bounds.size.height/ 3)4. å³å¶å­æ§åˆ¶ç‚¹ï¼ˆrightCtlï¼‰ï¼šCGPointMake(self.view.bounds.size.width *1.5,self.view.bounds.size.height/ 3)5. ä¸­é—´æ§åˆ¶ç‚¹ï¼ˆmidPointï¼‰ï¼šCGPointMake(self.view.bounds.size.width / 2,self.view.bounds.size.height * 0.8)6. è¾¹ç•Œç‚¹ï¼ˆcornerï¼‰ï¼šè¯¥ç‚¹ç”¨æ¥è®¾ç½®æ¢¯åº¦çš„ç»ˆç‚¹CGPointMake(self.view.bounds.size.width, 0) ä¸‹é¢æ¥å½¢è±¡çš„å±•ç¤ºä¸‹è¿™äº›ç‚¹çš„ä½ç½® 1234567891011121314/*---------------------------------------------------------------------------*/// -----------------------------------------// | . -&gt; start poin .|corner// . left ctl | | . right ctl// | |// | |// | |// | |// | mid point |// | . |// | |// | . -&gt; end pint |// -----------------------------------------/*----------------------------------------------------------------------------*/ ä»¥ä¸‹æ˜¯å…·ä½“çš„å®ç°ä»£ç ï¼Œå…¶å®æ‰¾åˆ°ç‚¹ä¹‹åï¼Œå†ç”¨ä»£ç å®ç°å°±å¾ˆå®¹æ˜“äº†ã€‚ 1234567891011121314151617181920212223242526- (void)drawRect:(CGRect)rect { CGFloat fullWidth = self.bounds.size.width; CGFloat fullHeight = self.bounds.size.height; CGFloat halfWidth = fullWidth / 2.f; CGFloat halfHeight = fullHeight / 2.f; CGPoint startPoint = CGPointMake(halfWidth, 3.f); CGPoint midPoint = CGPointMake(halfWidth, halfHeight * 1.6f); CGPoint endPoint = CGPointMake(halfWidth, fullHeight); CGPoint leftCtl = CGPointMake(-halfWidth, halfHeight / 3.f); CGPoint rightCtl = CGPointMake(fullWidth * 1.5f, halfHeight / 3.f); CGPoint corner = CGPointMake(fullWidth, 0); UIBezierPath *path = [UIBezierPath bezierPath]; [path moveToPoint:startPoint]; [path addCurveToPoint:endPoint controlPoint1:leftCtl controlPoint2:midPoint]; [path addCurveToPoint:startPoint controlPoint1:midPoint controlPoint2:rightCtl]; [path addClip]; CGGradientRef gradient = [self gradientWithColor:self.innerColor toColor:self.outerColor count:3]; CGContextRef context = UIGraphicsGetCurrentContext(); CGContextDrawLinearGradient(context, gradient, CGPointZero, corner, 0); path.lineWidth = self.lineThickness; [self.strokeColor setStroke]; [path stroke];} è´´ä¸ªå›¾æ„Ÿå—ä¸‹æœ€åç»˜åˆ¶å‡ºæ¥çš„å¶å­ ç»˜åˆ¶ç¬‘è„¸å®ç°æ€è·¯ï¼ŒåŒç»˜åˆ¶å¶å­ä¸€æ ·ï¼Œæˆ‘ä»¬å…ˆææ¸…æ¥šéœ€è¦çš„ç»˜åˆ¶å‚æ•°ã€‚é¦–å…ˆæˆ‘ä»¬è¦ç»˜åˆ¶ä¸€ä¸ªåœ†ï¼Œç”¨æ¥æ˜¾ç¤ºè„¸ã€‚å…¶æ¬¡éœ€è¦ç»˜åˆ¶ä¸€æ¡æ›²çº¿ï¼Œç”¨æ¥æ˜¾ç¤ºå˜´å·´ã€‚æœ€åè¿˜è¦ç»˜åˆ¶ä¿©ä¸ªæ¤­åœ†ç”¨æ¥æ˜¾ç¤ºçœ¼ç›ã€‚é‚£ä¹ˆæ€»ç»“èµ·æ¥å°±æ˜¯ã€‚ ç»˜åˆ¶åœ†ï¼Œå¹¶åšåœ†å¿ƒå‘å¤–å‘æ•£çš„æ¢¯åº¦å¤„ç† ç»˜åˆ¶æ›²çº¿ï¼Œä¿©ä¸ªå˜´è§’å—ä¸­å¿ƒç‚¹æ§åˆ¶çš„è´å¡å°”æ›²çº¿ã€‚ ç»˜åˆ¶æ¤­åœ†ï¼Œæ‰¾åˆ°åˆé€‚çš„ä½ç½®è°ƒç”¨è´å¡å°”çš„çŸ©å½¢æ¡†ç»˜åˆ¶æ¤­åœ†è·¯å¾„å³å¯ã€‚ å®ç°çš„ä»£ç ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051- (void)drawRect:(CGRect)rect { // åŸºç¡€ç‚¹ CGFloat fullWidth = self.bounds.size.width; CGFloat fullHeight = self.bounds.size.height; CGFloat halfWidth = fullWidth / 2.f; CGFloat halfHeight = fullHeight / 2.f; CGFloat radius = MIN(halfWidth, halfHeight); CGPoint center = CGPointMake(halfWidth, halfHeight); // bezierPath åˆ‡åœ† UIBezierPath *bezier = [UIBezierPath bezierPath]; [bezier addArcWithCenter:center radius:radius startAngle:0 endAngle:M_PI * 2 clockwise:YES]; [bezier addClip]; // å¡«å……æ¢¯åº¦ï¼Œä»ä¸­å¿ƒå‘æ•£ CGGradientRef gradient = [self gradientWithColor:self.innerColor toColor:self.outerColor count:2]; CGContextRef graphics = UIGraphicsGetCurrentContext(); CGContextDrawRadialGradient(graphics, gradient, center, 0, center, radius, 0); // åˆ’çº¿ bezier.lineWidth = self.lineThickness * 1.7; [self.strokeColor setStroke]; [bezier stroke]; // å‡†å¤‡ç”»å˜´å·´ [bezier removeAllPoints]; bezier.lineWidth = self.lineThickness; [bezier moveToPoint:CGPointMake(halfWidth * 0.5, halfHeight * 1.3)]; [bezier addQuadCurveToPoint:CGPointMake(halfWidth * 1.5, halfHeight * 1.3) controlPoint:CGPointMake(halfWidth, fullHeight * 0.91)]; [bezier stroke]; // å‡†å¤‡ç”»å·¦çœ¼ bezier = [UIBezierPath bezierPathWithOvalInRect:CGRectMake(fullWidth / 3 - halfWidth * .1, fullHeight / 3.f, halfWidth * .2, halfHeight * .3)]; bezier.lineWidth = self.lineThickness; [bezier fill]; [bezier stroke]; // ç”»å³çœ¼ bezier = [UIBezierPath bezierPathWithOvalInRect:CGRectMake(fullWidth / 3 * 2 - halfWidth * .1, fullHeight / 3.f, halfWidth * .2, halfHeight * .3)]; bezier.lineWidth = self.lineThickness; [bezier fill]; [bezier stroke];} æŒ‰ç…§æƒ¯ä¾‹ï¼Œè´´ä¸‹å®ç°çš„æ•ˆæœå›¾ åŠ¨èµ·æ¥ç°åœ¨æˆ‘ä»¬å¸Œæœ›èƒ½ç”¨ä¹‹å‰ç»˜åˆ¶çš„ä¿©ä¸ªå›¾å½¢ï¼Œé›†åˆåŠ¨ç”»ï¼Œåšå‡ºä¸€ä¸ªç±»ä¼¼å¤ªé˜³çš„åŠ¨ç”»ç‰¹æ•ˆã€‚ è¿˜æ˜¯è°ˆè°ˆå®ç°çš„æ€è·¯ï¼šå…ˆç”¨ä¹‹å‰çš„CYSmileç»˜åˆ¶ä¸€ä¸ªå¤ªé˜³ï¼Œä¹‹åé‡‡ç”¨CYPetalç»˜åˆ¶ä¸€ç»„é˜³å…‰ï¼Œé˜³å…‰çš„ç»˜åˆ¶æœ‰æŠ€å·§ï¼Œéœ€è¦ç»˜åˆ¶ç›¸åŒframeçš„å…‰èŠ’è§†å›¾15ä¸ªï¼Œä¹‹åé‡‡ç”¨transformçš„æ–¹å¼ï¼Œè®¾ç½®ä½ç½®åç§»ã€‚æ­¤å¤–ç”±äºè¦å®ç°åŠ¨ç”»æ•ˆæœï¼Œéœ€è¦å¯¹å…‰èŠ’çš„é”šç‚¹ä½ç½®è¿›è¡Œè®¾ç½®ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªviewè®¾ç½®çš„æ—¶å€™ï¼Œå¤ªé˜³å’Œå…‰èŠ’çš„ä½ç½®è®¾ç½®ã€‚ 12345678910111213141516171819202122----------------------------------------------------------------------| || || || ------------------------------- || | ------- | || | | | | || | | å…‰ | | || | | èŠ’ | | || | | åŒº | | || | | | | || | | | | || | ------- | || | | || | å¤ªé˜³åŒº | || | | || ------------------------------- || || || || |------------------------------------------------------------------------ å…·ä½“çš„è¯è¿˜æ˜¯çœ‹ä¸‹ä»£ç å§ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071- (void)createSunshine{ // è®¾ç½®å¤§å° CGFloat fullWidth = self.bounds.size.width; CGFloat fullHeight = self.bounds.size.height; CGFloat halfWidth = fullWidth / 2.f; CGFloat halfHeigt = fullHeight / 2.f; // è®¾ç½®å¤ªé˜³å’Œå…‰èŠ’çš„ä½ç½® CGRect sunRect = CGRectMake(halfWidth - fullWidth / 4, halfHeigt - fullHeight / 4, halfWidth, halfHeigt); CGRect sunshineRect = CGRectMake(halfWidth - fullWidth / 40, halfHeigt - fullHeight / 8, fullWidth / 20, fullHeight / 4); // åˆ›å»ºå…‰èŠ’æ‰€åœ¨çš„viewï¼Œå¹¶å°†æœ¬ç±»çš„shineLayeræŒ‡å‘å®ƒçš„layerï¼Œæ–¹ä¾¿åé¢æ·»åŠ åŠ¨ç”» UIView *shineView = [[UIView alloc]initWithFrame:self.bounds]; self.shineLayer = shineView.layer; [self addSubview:shineView]; // å°†å…‰èŠ’éƒ½æ·»åŠ åˆ°å…‰èŠ’viewä¸Šï¼Œå¹¶è¿›è¡Œç›¸åº”çš„transformè½¬æ¢å’Œé”šç‚¹è®¾ç½® for (CGFloat i = M_PI / 10; i &lt; M_PI * 2; i += M_PI / 7.5) { CYPetal *petal = [[CYPetal alloc]initWithFrame:sunshineRect]; petal.innerColor = [UIColor yellowColor]; petal.outerColor = [UIColor colorWithRed:1 green:0.8 blue:.2 alpha:1]; petal.lineThickness = 40.f; petal.strokeColor = [UIColor whiteColor]; [shineView addSubview:petal]; petal.layer.anchorPoint = CGPointMake(.5, 2); petal.transform = CGAffineTransformMakeRotation(i); } // æ·»åŠ åŠ¨ç”»ï¼Œè®©å…‰èŠ’åŠ¨èµ·æ¥ [self addRotationAnimation]; // æ·»åŠ å¤ªé˜³ CYSmile *smile = [[CYSmile alloc]initWithFrame:sunRect]; smile.innerColor = [UIColor yellowColor]; smile.outerColor = [UIColor colorWithRed:1 green:.8 blue:.2 alpha:1]; [self addSubview:smile]; }- (void)addRotationAnimation{ CABasicAnimation *basicAnimation = [CABasicAnimation animationWithKeyPath:@&quot;transform.rotation&quot;]; // è®¾ç½®æ—‹è½¬åŠ¨ç”» basicAnimation.duration = 10; basicAnimation.fromValue = @0; basicAnimation.speed = self.speed; basicAnimation.toValue = @(M_PI * 2); basicAnimation.repeatCount = CGFLOAT_MAX; [self.shineLayer addAnimation:basicAnimation forKey:@&quot;rotation&quot;]; // è®¾ç½®é€æ˜åº¦åŠ¨ç”» basicAnimation.keyPath = @&quot;opacity&quot;; basicAnimation.duration = .5f; basicAnimation.autoreverses = YES; basicAnimation.fromValue = @0.7; basicAnimation.toValue = @1.0; [self.shineLayer addAnimation:basicAnimation forKey:@&quot;fade&quot;]; // è®¾ç½®å¤§å°åŠ¨ç”» basicAnimation.keyPath = @&quot;transform.scale&quot;; basicAnimation.fromValue = @0.9; basicAnimation.toValue = @1.1; [self.shineLayer addAnimation:basicAnimation forKey:@&quot;scale&quot;]; } æœ€åçš„æ•ˆæœå›¾å¦‚ä¸‹ ç»„åˆç»˜åˆ¶èŠ±æœµèŠ±æœµåŒ…æ‹¬çš„å…ƒç´ ä¸»è¦æœ‰ç¬‘è„¸ã€èŠ±ç“£ã€èŒã€å¶å­ã€‚è¿™äº›å…ƒç´ ï¼ˆé™¤äº†èŒï¼‰éƒ½å¯ä»¥ä½¿ç”¨ä¹‹å‰çš„ç»„ä»¶æ¥ç»˜åˆ¶å‡ºæ¥ã€‚ èŒåæ ‡è·¯å¾„å¤§æ¦‚å¦‚ä¸‹,å¹¶ä¸ä¸€å®šæ˜¯è¿™æ ·ï¼Œæ‰‹å·¥ç»˜åˆ¶æ•¬è¯·è°…è§£ 12345678910111213141516171819202122/* ------------------------------------------------------------------------ | . start point corner .| | . . | | . . | | . . | | . . | | . . | | . . | | . . | |. left ctrl . ..mid point | | . . | | . . | | . . | | . . | | . . | | . . | | . . | | . . | | . end point right ctrl . | ------------------------------------------------------------------------ */ èŒçš„ç»˜åˆ¶å’Œä¹‹å‰èŠ±ç“£çš„ç»˜åˆ¶å·®ä¸å¤šï¼Œéƒ½æ˜¯è¦é€‰æ‹©ä¸€ä¸ªèµ·ç‚¹å’Œä¸€ä¸ªç»ˆç‚¹ï¼Œç„¶åç»˜åˆ¶æ ¹æ®ä¿©ä¸ªé”šç‚¹ï¼Œç»˜åˆ¶å‡ºç›¸åº”çš„å›¾å½¢ï¼Œå…·ä½“ç»˜åˆ¶å°±ä¸ç»†è¯´äº†ï¼Œè¿˜æ˜¯é™„ä¸Šä»£ç æ„Ÿå—ä¸‹å§ 12345678910111213141516171819202122232425262728293031- (void)drawRect:(CGRect)rect{ CGFloat fullWidth = self.bounds.size.width; CGFloat fullHeight = self.bounds.size.height; CGFloat halfWidth = fullWidth / 2; CGFloat halfHeight = fullHeight / 2; CGPoint startPoint = CGPointMake(halfWidth * .9, 0); CGPoint midPoint = CGPointMake(halfWidth, halfHeight); CGPoint endPoint = CGPointMake(halfWidth * .9, fullHeight); CGPoint corner = CGPointMake(fullWidth, 0); CGPoint leftCtl = CGPointMake(0, halfHeight); CGPoint rightCtl = CGPointMake(fullWidth, fullHeight); UIBezierPath *path = [UIBezierPath bezierPath]; [path moveToPoint:startPoint]; [path addCurveToPoint:endPoint controlPoint1:leftCtl controlPoint2:rightCtl]; [path addCurveToPoint:startPoint controlPoint1:rightCtl controlPoint2:midPoint]; [path closePath]; [path addClip]; CGContextRef ref = UIGraphicsGetCurrentContext(); CGGradientRef gradient = [self gradientWithColor:self.innerColor toColor:self.outerColor count:3]; CGContextDrawLinearGradient(ref, gradient, CGPointZero, corner, 0); path.lineWidth = self.lineThickness; [self.strokeColor setStroke]; [path stroke]; } ç»„åˆèŠ±æœµç»„åˆèŠ±æœµï¼Œä¸»è¦å°±æ˜¯åœ¨äºè®¡ç®—ç¬‘è„¸ã€èŒã€èŠ±ç“£ã€å¶å­ç­‰çš„åæ ‡ä½ç½®ã€‚ç„¶åè¿˜æœ‰å°±æ˜¯è®¾ç½®å®ƒä»¬çš„é¢œè‰²ã€‚æ­¤å¤–è¦æ³¨æ„è®¾ç½®èŠ±æœµçš„frameçš„æ—¶å€™ï¼Œè¦ä¿æŒå®½é«˜æ¯”ä¸º7 : 10ï¼Œè¿™æ ·æ‰èƒ½ç”Ÿæˆæ¯”è¾ƒå¥½çš„æ•ˆæœã€‚ ä¸‹é¢é™„ä¸ŠèŠ±æœµçš„ä½ç½®è®¾ç½®ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859- (id)initWithFrame:(CGRect)frame{ self = [super initWithFrame:frame]; if (self) { [self p_createFlower]; } return self;}- (void)p_createFlower{ // è´´å›¾çš„æ—¶å€™æ³¨æ„è¦ç”±ä¸‹è€Œä¸Šï¼Œç”±å†…è€Œå¤–çš„è´´ã€‚ CGFloat fullwidth = self.bounds.size.width; CGFloat fullHeight = self.bounds.size.height; CGFloat halfWidth = self.bounds.size.width/2.f; CGFloat halfHeight = self.bounds.size.height/2.f; // ä½ç½®çš„è®¡ç®—æ˜¯æœ€éº»çƒ¦ CGRect smileRect = CGRectMake(halfWidth/2, halfHeight/4*.9, halfWidth, halfHeight); CGRect petalRect = CGRectMake(halfWidth-fullwidth/10, fullHeight/5, fullwidth/5, fullwidth/2); CGRect leafRect = CGRectMake(halfWidth-fullwidth/12, fullHeight*.84, fullwidth/5, fullwidth/2); CGRect stemRect = CGRectMake(halfWidth-fullwidth/8, halfHeight*1.3, fullwidth/4, halfHeight*.8); // è´´èŒ CYStem *stem = [[CYStem alloc]initWithFrame:stemRect]; stem.outerColor = [UIColor colorWithRed:0 green:0.5 blue:0 alpha:1]; stem.innerColor = [UIColor colorWithRed:.3 green:1 blue:.2 alpha:1]; [self addSubview:stem]; // è´´èŠ±ç“£ for (CGFloat i = M_PI / 10; i &lt; M_PI * 2; i += M_PI / 7.5) { CYPetal *petal = [[CYPetal alloc]initWithFrame:petalRect]; petal.outerColor = [UIColor purpleColor]; petal.innerColor = [UIColor colorWithRed:1 green:0 blue:1 alpha:1]; [self addSubview:petal]; petal.layer.anchorPoint = CGPointMake(.5, 1); petal.transform = CGAffineTransformMakeRotation(i); } // è´´å¶å­ for (CGFloat i = -M_PI/5; i &lt;= M_PI/5; i += M_PI * 2/5) { CYPetal *leaf = [[CYPetal alloc]initWithFrame:leafRect]; leaf.outerColor = [UIColor colorWithRed:0 green:.5 blue:0 alpha:1 ]; leaf.innerColor = [UIColor colorWithRed:.3 green:1 blue:.2 alpha:1]; [self addSubview:leaf]; leaf.layer.anchorPoint = CGPointMake(.5, 1); leaf.transform = CGAffineTransformMakeRotation(i); } // è´´ç¬‘è„¸ CYSmile *smile = [[CYSmile alloc]initWithFrame:smileRect]; smile.innerColor = [UIColor yellowColor]; smile.outerColor = [UIColor colorWithRed:1 green:.4 blue:0 alpha:1]; [self addSubview:smile]; } å‚è€ƒèµ„æ–™","link":"/2017/05/12/CoreGraphicsAndAnimation/"},{"title":"CoreGraphicsAndAnimations(2)","text":"ç»˜å›¾ï¼ˆ2ï¼‰å›¾å±‚åˆå¹¶åŠFlowerç”Ÿé•¿åŠ¨ç”»å›¾å±‚åˆå¹¶å›¾å±‚çš„åˆå¹¶è¯´èµ·æ¥å¾ˆé«˜å¤§ä¸Šï¼Œå…¶å®å®é™…ä¸Šåœ¨IOSé‡Œé¢å®ç°éå¸¸çš„ç®€å•ï¼Œå®ç°åŸç†å°±æ˜¯ï¼Œå…ˆè·å–å½“å‰çš„å›¾ç‰‡ç»˜å›¾ä¸Šä¸‹æ–‡ï¼Œå°†å½“å‰viewçš„layeræ¸²æŸ“åˆ°å½“å‰çš„ç»˜å›¾ä¸Šä¸‹æ–‡ï¼Œä¹‹åä»å½“å‰çš„ä¸Šä¸‹æ–‡ä¸­è·å–å›¾ç‰‡ï¼Œæœ€åç»“æŸå½“å‰ä¸Šä¸‹æ–‡ã€‚è¿”å›è·å–åˆ°çš„å›¾ç‰‡ å¯èƒ½çœ‹ä»£ç æ›´ç›´è§‚äº›ã€‚ æ³¨ï¼šè¿™æ˜¯ä¸€ä¸ªviewçš„categoryæ–¹æ³• 12345678910- (UIImage *)cy_compositedView{ UIGraphicsBeginImageContext(self.bounds.size); [self.layer renderInContext:UIGraphicsGetCurrentContext()]; UIImage *compositedImage = UIGraphicsGetImageFromCurrentImageContext(); UIGraphicsEndImageContext(); return compositedImage; } Flower ç”Ÿé•¿åŠ¨ç”»flowerçš„ç”Ÿé•¿ä¸»è¦æ³¨æ„çš„åœ°æ–¹å°±ä¿©ç‚¹ï¼Œä¸€ä¸ªæ˜¯èŠ±çš„ä½ç½®å®‰æ’ï¼Œä¸€ä¸ªæ˜¯èŠ±çš„ç”Ÿé•¿åŠ¨ç”»ã€‚ä½ç½®çš„è¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹èµ·æ¥å¤§çš„èŠ±å’Œä½ç½®é ä¸‹çš„èŠ±ï¼Œå°½é‡èƒ½å¾€å‰æ”¾ã€‚è¿™æ ·ä¼šæœ‰ä¸€äº›å±‚æ¬¡æ„Ÿã€‚ç”Ÿé•¿åŠ¨ç”»çš„è¯å°±æ˜¯å¸Œæœ›é”šç‚¹èƒ½åœ¨æ ¹éƒ¨ï¼Œè¿™æ ·ä¼šæœ‰ä¸€ç§é•¿èµ·æ¥çš„æ„Ÿè§‰ã€‚ è¿˜æœ‰éœ€è¦æ³¨æ„çš„å°±æ˜¯ï¼Œæˆ‘ä»¬è¿™é‡Œåªä½¿ç”¨äº†ä¸€ä¸ªFlowerç±»ï¼Œç„¶åç”¨è¿™ä¸ªç±»å»ç”Ÿæˆäº†ğŸŒºçš„å›¾ç‰‡ã€‚ç„¶åé‡‡ç”¨åˆå§‹åŒ–UIImageViewè´´å›¾ç‰‡çš„æ–¹å¼åˆ›å»º60æœµğŸŒºï¼Œè¿™æ ·èƒ½å¤§å¤§çš„èŠ‚çœå†…å­˜ç©ºé—´ã€‚ ä»£ç å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647- (void)addFlowers{ CGFloat height = self.view.bounds.size.height; CGFloat width = self.view.bounds.size.width; // èŠ±çš„é«˜åº¦ CGFloat flowerHeight = height / 6; // èŠ±çš„èµ·å§‹ä½ç½® CGFloat flowerY = height * 0.3; // åˆ›å»ºèŠ± CYFlower *flower = [[CYFlower alloc]initWithFrame:CGRectMake(0, 0, flowerHeight * .7, flowerHeight)]; // ç”ŸæˆèŠ±å›¾ç‰‡ UIImage *floweimg = [flower cy_compositedView]; // è´´èŠ± for (int i = 0; i &lt; 60; i ++) { int size = height / 12.f; CGFloat flowersize =( arc4random() % (int) size) + size; UIImageView *flowerImgView = [[UIImageView alloc]initWithFrame:CGRectMake(arc4random()%(int)width * 0.9, arc4random() % (int)flowerY + 2 * flowerY, flowersize * .7, flowersize)]; flowerImgView.image = floweimg; // z positionè®¾ç½®ï¼Œè¿™æ ·ä¼šæœ‰å±‚æ¬¡æ„Ÿ flowerImgView.layer.zPosition = flowerImgView.frame.origin.y + flowersize; [self.view addSubview:flowerImgView]; // èŠ±ç”Ÿé•¿ [self growFlowers:flowerImgView duration:arc4random() % 100 / 25 + 4]; } }- (void)growFlowers:(UIImageView *)flowers duration:(CGFloat)duration{ // èŠ±é”šç‚¹è®¾ç½® flowers.layer.anchorPoint = CGPointMake(.5, 1); // æ·»åŠ åŠ¨ç”» CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@&quot;transform.scale&quot;]; animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut]; animation.duration = duration; animation.fromValue = [NSValue valueWithCGSize:CGSizeMake(0, 0)]; animation.toValue = [NSValue valueWithCGSize:CGSizeMake(1, 1)]; [flowers.layer addAnimation:animation forKey:@&quot;grow&quot;];} ä¸‹é¢é™„ä¸Šç”Ÿé•¿åŠ¨ç”» åˆ©ç”¨æ¢¯åº¦layerå®ç°å¤ªé˜³å‡èµ·çš„åŠ¨ç”»iosé‡Œé¢æœ‰ä¸€ä¸ªlayerå«CAGradientLayerï¼Œè¿™ä¸ªlayeræ”¯æŒçº¿æ€§çš„æ¢¯åº¦ï¼Œæœ€ä¸ºå…³é”®çš„æ˜¯ï¼Œå®ƒæœ‰ä¸€ä¸ªcolorså±æ€§æ”¯æŒåŠ¨ç”»æ•ˆæœã€‚æˆ‘ä»¬åªéœ€è¦ç»™è¿™ä¸ªcolorsæ•°ç»„é‡Œé¢å¡«å……é¢œè‰²å¯¹è±¡å°±å¯ä»¥äº†ï¼Œå¦å¤–æˆ‘ä»¬è¿˜å¸Œæœ›èƒ½å¤Ÿä»èµ·ç‚¹åˆ°ç»“æŸç‚¹æœ‰ä¸ªè¿‡åº¦ã€‚é‚£ä¹ˆéœ€è¦å¯¹startPointå±æ€§åšåŠ¨ç”»ã€‚ æœ€åï¼Œä¸å¸Œæœ›è§†å›¾ç”Ÿæˆçš„æ—¶å€™å°±å¼€å§‹åŠ¨ç”»ï¼Œè€Œæ˜¯åœ¨è§†å›¾è´´åˆ°çˆ¶è§†å›¾ä¸Šçš„æ—¶å€™æ‰å¼€å§‹åŠ¨ç”»ï¼Œé‚£ä¹ˆlayerçš„åŠ¨ç”»å°±è¦åŠ åœ¨-(void)didMoveToSuperViewæ–¹æ³•ä¸Šã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041+ (Class)layerClass{ return [CAGradientLayer class];}- (void)didMoveToSuperview{ self.backgroundColor = [UIColor blackColor]; CGColorRef blackcolor = [[UIColor blackColor]CGColor]; UIColor *color1 = [UIColor colorWithRed:0.01 green:0.2 blue:0.8 alpha:1]; UIColor *color2 = [UIColor colorWithRed:1 green:0.5 blue:0 alpha:1]; UIColor *color3 = [UIColor colorWithRed:.35 green:.74 blue:.11 alpha:1]; NSArray *colors = [NSArray arrayWithObjects:(id)[color1 CGColor], [color2 CGColor], [color3 CGColor], nil]; NSNumber *location1 = [NSNumber numberWithFloat:.0]; NSNumber *location2 = [NSNumber numberWithFloat:.4]; NSNumber *location3 = [NSNumber numberWithFloat:.9]; CAGradientLayer *layer = (CAGradientLayer *)[self layer]; layer.colors = colors; layer.locations = @[location1,location2,location3]; layer.startPoint = CGPointMake(.5, 0); layer.endPoint = CGPointMake(.5, 1); CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@&quot;startPoint&quot;]; animation.duration = 6.f; animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseOut]; animation.fromValue = [NSValue valueWithCGPoint:CGPointMake(.5, 1)]; [layer addAnimation:animation forKey:@&quot;start&quot;]; animation.keyPath = @&quot;colors&quot;; animation.duration = 6.f; animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseOut]; animation.fromValue = [NSArray arrayWithObjects:(__bridge id)blackcolor, blackcolor, blackcolor, nil]; [layer addAnimation:animation forKey:@&quot;color&quot;];}@end è€è§„çŸ©é™„ä¸Šä¸€å¼ å®ç°çš„æ•ˆæœå›¾ äº‘å½©é£˜åŠ¨æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸Œæœ›å®ç°çš„æ˜¯å¼€ç¯‡çš„æ—¶å€™ï¼Œå±•ç¤ºçš„äº‘æœµä»å±å¹•å·¦ä¾§é£˜ç§»åˆ°å±å¹•å³ä¾§çš„åŠ¨ç”»ï¼Œè¿™é‡Œæœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ äº‘æœµè½¨è¿¹ äº‘æœµæŠ•å½± äº‘æœµæŠ•å½±å’Œäº‘æœµè¦ä¸€èµ·åŠ¨ã€‚ å®ç°æ–¹å¼çš„è¯ï¼Œè¿™é‡Œé‡‡ç”¨UIBezierPathç»˜åˆ¶è½¨è¿¹ï¼Œç„¶åå†…éƒ¨é‡‡ç”¨æ¢¯åº¦è¿›è¡Œå¡«å……ã€‚äº‘æœµçš„æŠ•å½±é‡‡ç”¨äº‘æœµä¸€åŠçš„é«˜åº¦ç»˜åˆ¶ï¼Œç„¶åå°†å…¶è®¾ç½®ä¸ºäº‘æœµçš„ShadowPathï¼Œç„¶ååˆ©ç”¨shadowoffsetå±æ€§å°†äº‘æœµæŠ•å°„åˆ°è¶³å¤Ÿè¿œçš„è·ç¦»ï¼Œå½¢æˆä¸€ç§æŠ•å½±çš„æ•ˆæœã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162- (void)drawRect:(CGRect)rect{ CGFloat height = self.bounds.size.height; UIBezierPath *path = [self createCloudPathWithHeight:height]; [path addClip]; CGGradientRef gradientRef = [self gradientWithColor:self.innerColor toColor:self.outerColor count:2]; CGContextRef context = UIGraphicsGetCurrentContext(); CGPoint startPoint = CGPointMake(0, 0); CGPoint endPoint = CGPointMake(0, height); CGContextDrawLinearGradient(context, gradientRef, startPoint, endPoint, 0); path.lineWidth = self.lineThickness; [self.strokeColor setStroke]; [path stroke]; UIBezierPath *shadowPath = [self createCloudPathWithHeight:height / 2]; self.layer.shadowPath = shadowPath.CGPath; if (!self.distance) { self.distance = height * 1.8; } self.layer.shadowOffset = CGSizeMake(0, self.distance); self.layer.shadowOpacity = 0.4f; self.alpha = 0.9f; }- (UIBezierPath *)createCloudPathWithHeight:(CGFloat)height{ CGFloat width = self.bounds.size.width; CGFloat points[] = { 0.4,0.2, 0.5,0.1,0.6,0.2, 0.8,0.2,0.8,0.4, 0.9,0.5,0.8,0.6, 0.8,0.8,0.6,0.8, 0.5,0.9,0.4,0.8, 0.2,0.8,0.2,0.6, 0.1,0.5,0.2,0.4, 0.2,0.2,0.4,0.2, }; CGPoint cPoint; CGPoint point; UIBezierPath *path = [UIBezierPath bezierPath]; [path moveToPoint:CGPointMake(points[0] * width, points[1] * height)]; for (int i = 2; i &lt; sizeof(points) / sizeof(CGFloat); i += 4) { cPoint = CGPointMake(points[i] * width, points[i + 1] * height); point = CGPointMake(points[i + 2] * width, points[i + 3] * height); [path addQuadCurveToPoint:point controlPoint:cPoint]; } [path closePath]; return path;} å®ç°çš„æ•ˆæœå›¾å¦‚ä¸‹ æµ·é¸¥è¿›è¡Œåˆ°ç°åœ¨ï¼Œè·Ÿæˆå“å›¾ä¸­ç›¸å·®çš„ä¹Ÿå°±å‰©ä¸‹æœ€åä¸€æ­¥äº†ï¼Œé‚£å°±æ˜¯æµ·é¸¥çš„ç»˜åˆ¶ï¼Œæµ·é¸¥è¿™é‡ŒåŒæ ·è¿˜æ˜¯é‡‡ç”¨Bezieræ›²çº¿ç»˜åˆ¶ï¼Œä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬è¦é‡‡ç”¨onscreenæ¸²æŸ“çš„æ–¹å¼ï¼Œç»˜åˆ¶å‡ºå¤šå¼ æµ·é¸¥çš„imageï¼Œæœ€åå°†imageç»„åˆæˆä¸€ä¸ªæ•°ç»„ï¼Œç„¶åç”¨UIImageViewçš„imagesæ•°ç»„è¿›è¡Œå±•ç¤ºã€‚ ä»¥ä¸‹æ˜¯å…·ä½“ç»˜åˆ¶ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344- (void)didMoveToSuperview{ if (!self.animationImages) { self.animationImages = [self arrayofImages]; }}- (NSArray *)arrayofImages{ NSMutableArray *arr = [NSMutableArray arrayWithCapacity:COUNT]; for (CGFloat i = LOWWING; i &lt; HEIGING; i+=STEP) { [arr addObject:[self animationFrame:i]]; } for (CGFloat i = HEIGING; i &gt; LOWWING; i -= STEP) { [arr addObject:[self animationFrame:i]]; } return arr;}- (UIImage *)animationFrame:(CGFloat)frame{ CGFloat width = self.bounds.size.width; CGFloat height = self.bounds.size.height; UIGraphicsBeginImageContextWithOptions(CGSizeMake(width, height), NO, 0); UIBezierPath *path = [UIBezierPath bezierPath]; [path moveToPoint:CGPointMake(0, frame)]; [path addQuadCurveToPoint:CGPointMake(.5, 0.6 - frame / 3) controlPoint:CGPointMake(.25, .25)]; [path addQuadCurveToPoint:CGPointMake(1, frame) controlPoint:CGPointMake(.75, .25)]; [path applyTransform:CGAffineTransformMakeScale(width, height)]; path.lineWidth = height / 30; [path stroke]; UIImage *imge = UIGraphicsGetImageFromCurrentImageContext(); UIGraphicsEndImageContext(); return imge;} æ•ˆæœå›¾ å°ç»“é€šè¿‡å­¦ä¹ ç»˜åˆ¶å›¾å½¢ä»¥åŠç»™layeråšåŠ¨ç”»ï¼ŒåŸºæœ¬æŒæ¡äº†ä¸€äº›å¸¸ç”¨çš„ç»˜åˆ¶å‡½æ•°å’ŒåŠ¨ç”»å®ç°æ–¹æ³•ã€‚å‘ç°CoreGraphicsç¡®å®æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å›¾å½¢ç»˜åˆ¶åº“ï¼Œåªè¦ä½ è„‘æ´å¤§å¼€å°±èƒ½ç»˜åˆ¶ä½ æƒ³åˆ°çš„ä»»æ„å›¾å½¢ï¼Œæ­¤å¤–å›¾å±‚åˆå¹¶èƒ½å¤Ÿå¤§å¤§èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå¦‚æœæ˜¯é™æ€çš„å¤šä¸ªå›¾å±‚çš„viewã€‚å¯ä»¥è€ƒè™‘åšå›¾å±‚æ¸²æŸ“ï¼Œæ¸²æŸ“æˆå›¾ç‰‡ã€‚ é™„å½•æœ€åé™„ä¸Šæœ¬é¡¹ç›®åœ¨gitä¸Šçš„demoï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸‹è½½ä¸‹æ¥çœ‹çœ‹ï¼Œæ¬¢è¿starã€‚","link":"/2017/05/19/CoreGraphicsAndAnimations-2/"},{"title":"","text":"èƒŒæ™¯ä»‹ç» Djangoæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„Webåº”ç”¨æ¡†æ¶ï¼Œç”±Pythonå†™æˆã€‚é‡‡ç”¨äº†MTVçš„æ¡†æ¶æ¨¡å¼ï¼Œå³æ¨¡å‹Mï¼Œè§†å›¾Vå’Œæ¨¡ç‰ˆTã€‚å®ƒæœ€åˆæ˜¯è¢«å¼€å‘æ¥ç”¨äºç®¡ç†åŠ³ä¼¦æ–¯å‡ºç‰ˆé›†å›¢æ——ä¸‹çš„ä¸€äº›ä»¥æ–°é—»å†…å®¹ä¸ºä¸»çš„ç½‘ç«™çš„ï¼Œå³æ˜¯CMSï¼ˆå†…å®¹ç®¡ç†ç³»ç»Ÿï¼‰è½¯ä»¶ã€‚å¹¶äº2005å¹´7æœˆåœ¨BSDè®¸å¯è¯ä¸‹å‘å¸ƒã€‚è¿™å¥—æ¡†æ¶æ˜¯ä»¥æ¯”åˆ©æ—¶çš„å‰æ™®èµ›çˆµå£«å‰ä»–æ‰‹Django Reinhardtæ¥å‘½åçš„ã€‚2019å¹´12æœˆ2æ—¥ï¼ŒDjango 3. 0å‘å¸ƒ ã€‚ç›®å‰çš„djangoç‰ˆæœ¬æ˜¯4.2.3 å®˜ç½‘åœ°å€MTV æ¨¡å‹Django çš„ MTV æ¨¡å¼æœ¬è´¨ä¸Šå’Œ MVC æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿæ˜¯ä¸ºäº†å„ç»„ä»¶é—´ä¿æŒæ¾è€¦åˆå…³ç³»ï¼Œåªæ˜¯å®šä¹‰ä¸Šæœ‰äº›è®¸ä¸åŒï¼ŒDjango çš„ MTV åˆ†åˆ«æ˜¯æŒ‡ï¼šâ— M è¡¨ç¤ºæ¨¡å‹ï¼ˆModelï¼‰ï¼šç¼–å†™ç¨‹åºåº”æœ‰çš„åŠŸèƒ½ï¼Œè´Ÿè´£ä¸šåŠ¡å¯¹è±¡ä¸æ•°æ®åº“çš„æ˜ å°„(ORM)ã€‚â— T è¡¨ç¤ºæ¨¡æ¿ (Template)ï¼šè´Ÿè´£å¦‚ä½•æŠŠé¡µé¢(html)å±•ç¤ºç»™ç”¨æˆ·ã€‚â— V è¡¨ç¤ºè§†å›¾ï¼ˆViewï¼‰ï¼šè´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶åœ¨é€‚å½“æ—¶å€™è°ƒç”¨ Modelå’Œ Templateã€‚é™¤äº†ä»¥ä¸Šä¸‰å±‚ä¹‹å¤–ï¼Œè¿˜éœ€è¦ä¸€ä¸ª URL åˆ†å‘å™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªä¸ª URL çš„é¡µé¢è¯·æ±‚åˆ†å‘ç»™ä¸åŒçš„ View å¤„ç†ï¼ŒView å†è°ƒç”¨ç›¸åº”çš„ Model å’Œ Templateï¼ŒMTV çš„å“åº”æ¨¡å¼å¦‚ä¸‹æ‰€ç¤ºï¼šç®€æ˜“å›¾ï¼š ç”¨æˆ·æ“ä½œæµç¨‹å›¾ï¼š è§£æï¼šç”¨æˆ·é€šè¿‡æµè§ˆå™¨å‘æˆ‘ä»¬çš„æœåŠ¡å™¨å‘èµ·ä¸€ä¸ªè¯·æ±‚(request)ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå»è®¿é—®è§†å›¾å‡½æ•°ï¼š â— a.å¦‚æœä¸æ¶‰åŠåˆ°æ•°æ®è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™è§†å›¾å‡½æ•°ç›´æ¥è¿”å›ä¸€ä¸ªæ¨¡æ¿ä¹Ÿå°±æ˜¯ä¸€ä¸ªç½‘é¡µç»™ç”¨æˆ·ã€‚â— b.å¦‚æœæ¶‰åŠåˆ°æ•°æ®è°ƒç”¨ï¼Œé‚£ä¹ˆè§†å›¾å‡½æ•°è°ƒç”¨æ¨¡å‹ï¼Œæ¨¡å‹å»æ•°æ®åº“æŸ¥æ‰¾æ•°æ®ï¼Œç„¶åé€çº§è¿”å›ã€‚è§†å›¾å‡½æ•°æŠŠè¿”å›çš„æ•°æ®å¡«å……åˆ°æ¨¡æ¿ä¸­ç©ºæ ¼ï¼Œæœ€åè¿”å›ç½‘é¡µç»™ç”¨æˆ·ã€‚Django çš„è®¾è®¡æ€æƒ³ â€¢ DRYï¼ˆDonâ€™t repeat yourselfï¼‰ï¼šä¸é‡å¤é€ è½®å­â€¢ MVTâ€¢ å¿«é€Ÿå¼€å‘â€¢ çµæ´»æ˜“äºæ‰©å±•â€¢ æ¾è€¦åˆâ€¢ æ˜¾å¼ä¼˜äºéšå¼ djangoé€‚åˆåšä»€ä¹ˆ â— å†…å®¹ç®¡ç†ç³»ç»Ÿâ€¢ åšå®¢â€¢ CMSâ€¢ Wikiâ— ä¼ä¸šå†…éƒ¨ç³»ç»Ÿâ€¢ ä¼šè®®å®¤é¢„å®šâ€¢ æ‹›è˜ç®¡ç†â€¢ ERP &amp; CRMâ€¢ æŠ¥è¡¨ç³»ç»Ÿâ— è¿ç»´ç®¡ç†ç³»ç»Ÿâ€¢ CMDBâ€¢ å‘å¸ƒç®¡ç†â€¢ ä½œä¸šç®¡ç†â€¢ è„šæœ¬ç®¡ç†â€¢ å˜æ›´ç®¡ç†â€¢ æ•…éšœç®¡ç†æœ‰å“ªäº›äº§å“åœ¨ä½¿ç”¨django æœ¬è¯¾ç¨‹çš„å¤§çº² Django å¼€å‘ç¯å¢ƒå‡†å¤‡ Python å¼€å‘ç¯å¢ƒå‡†å¤‡ â€“ PyCharm ä»‹ç»â€¢ PyCharm IDEï¼Œå‡ºè‡ª JetBrains å…¬å¸ï¼ŒIDEA ç³»åˆ—äº§å“ä¸º JetBrains äº§å‡ºçš„äº§å“â€¢ æœ€å¥½ç”¨çš„å…è´¹ Python IDEâ€¢ PyCharm æœ‰ Community ç‰ˆæœ¬ï¼Œæœ‰ Enterprise ç‰ˆæœ¬â€¢ PyCharm ç¤¾åŒºç‰ˆä¸æ”¯æŒ Django å¼€å‘ï¼Œ ä½†å¯ä»¥å®‰è£… Django ç±»åº“ï¼Œèƒ½å¤Ÿå®ç° Django ä»£ç çš„è‡ªåŠ¨æç¤ºå®‰è£… PyCharm ä¸‹è½½åœ°å€æ–°å»ºä¸€ä¸ªdjangoé¡¹ç›® é€‰æ‹©ä¸€ä¸ªç›®å½•ï¼Œå¹¶åœ¨å‘½ä»¤è¡Œè¾“å…¥ä»¥ä¸‹å†…å®¹ django startproject recruitmentcd recruitmentpython3 manage.py startapp jobpython3 manage.py runserver 0.0.0.0:8000 ä¿®æ”¹allow hostALLOWED_HOSTS = [â€˜0.0.0.0â€™] åˆ›å»ºä¸€ä¸ªè¶…çº§ç®¡ç†ç®¡ï¼Œå¹¶æŒ‰ç…§æç¤ºè¾“å…¥ç”¨æˆ·åã€å¯†ç python3 createsuperuser djangoé¡¹ç›®çš„ç›®å½•ç»“æ„ ç™»å½•djangoåå° Django çš„è‡ªå®šä¹‰æ¨¡æ¿ â€¢ Django æ¨¡æ¿åŒ…å«äº†è¾“å‡ºçš„ HTML é¡µé¢çš„é™æ€éƒ¨åˆ†çš„å†…å®¹â€¢ æ¨¡æ¿é‡Œé¢çš„åŠ¨æ€å†…å®¹åœ¨è¿è¡Œæ—¶è¢«æ›¿æ¢â€¢ åœ¨ views é‡Œé¢æŒ‡å®šæ¯ä¸ª URL ä½¿ç”¨å“ªä¸ªæ¨¡æ¿æ¥æ¸²æŸ“é¡µé¢â€¢ æ¨¡ç‰ˆç»§æ‰¿ä¸å—ï¼ˆTemplate Inheritance &amp; Blockï¼‰ â€¢ æ¨¡æ¿ç»§æ‰¿å…è®¸å®šä¹‰ä¸€ä¸ªéª¨æ¶æ¨¡æ¿ï¼Œéª¨æ¶åŒ…å«ç«™ç‚¹ä¸Šçš„å…¬å…±å…ƒç´ ï¼ˆå¦‚å¤´éƒ¨å¯¼èˆªï¼Œå°¾éƒ¨é“¾æ¥ï¼‰â€¢ éª¨æ¶æ¨¡æ¿é‡Œé¢å¯ä»¥å®šä¹‰ Block å—ï¼Œæ¯ä¸€ä¸ª Block å—éƒ½å¯ä»¥åœ¨ç»§æ‰¿çš„é¡µé¢ä¸Šé‡æ–°å®šä¹‰/è¦†ç›–â€¢ ä¸€ä¸ªé¡µé¢å¯ä»¥ç»§æ‰¿è‡ªå¦ä¸€ä¸ªé¡µé¢â€¢ å®šä¹‰ä¸€ä¸ªåŒ¿åè®¿é—®é¡µé¢çš„åŸºç¡€é¡µé¢ï¼ŒåŸºç¡€é¡µé¢ä¸­å®šä¹‰é¡µå¤´â€¢ æ·»åŠ é¡µé¢ job/templates/base.html æ·»åŠ  URL è·¯å¾„æ˜ å°„ â€¢ è®©æ·»åŠ çš„é¡µé¢ï¼Œèƒ½å¤Ÿé€šè¿‡ URL è®¿é—®åˆ°â€¢ /joblist/ çš„è·¯å¾„è®¿é—®åˆ° views é‡Œé¢å®šä¹‰çš„ joblist è§†å›¾â€¢ è¿™ä¸ªè§†å›¾æ—¶ä¸€ä¸ª Method Viewï¼Œæ–¹æ³•è¡¨ç¤ºä¸€ä¸ªè§†å›¾ åˆ—è¡¨å±•ç¤º â— æ¨¡æ¿æ·»åŠ å®šä¹‰ï¼ŒView é¡µé¢æ·»åŠ å®Œï¼ŒURL ä¸­ä¹Ÿå®šä¹‰è·¯ç”±ä¹‹åï¼Œå†è®¿é—®é¡µé¢ï¼šâ— http://127.0.0.1:8000/joblist/ é…ç½®æ—¥å¿—è®°å½• â— Django é‡Œé¢ä½¿ç”¨ dictConfig æ ¼å¼æ¥é…ç½®æ—¥å¿—â— Dictionary å¯¹è±¡ï¼Œè‡³å°‘åŒ…å«å¦‚ä¸‹å†…å®¹: â—‹ version, ç›®å‰å”¯ä¸€æœ‰æ•ˆçš„å€¼æ˜¯ 1 â—‹ Handler, logger æ˜¯å¯é€‰å†…å®¹ï¼Œé€šå¸¸éœ€è¦è‡ªå·±å®šä¹‰ â—‹ Filter, formatter æ˜¯å¯é€‰å†…å®¹ï¼Œå¯ä»¥ä¸ç”¨å®šä¹‰â— å®šä¹‰æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼Œ åˆ†åˆ«å®šä¹‰ å…¨å±€æ—¥å¿—è®°é”™ï¼Œ é”™è¯¯æ—¥å¿—å¤„ç†ï¼Œ è‡ªå®šä¹‰çš„ æ—¥å¿—å¤„ç†å™¨ å‘é€é€šçŸ¥ï¼šé’‰é’‰ç¾¤æ¶ˆæ¯é›†æˆ â€¢ å®‰è£…é’‰é’‰èŠå¤©æœºå™¨äººï¼š pip install DingtalkChatbotâ€¢ æµ‹è¯•ç¾¤æ¶ˆæ¯â€¢ python ./manage.py shell â€“settings=settings.localâ€¢ from interview import dingtalkâ€¢ dingtalk.send(â€œç§‹å­£æ‹›è˜é¢è¯•å¯åŠ¨é€šçŸ¥, è‡ª 2020/09/01 å¼€å§‹ç§‹å­£æ‹›è˜â€)â€¢ å®šä¹‰ é€šçŸ¥é¢è¯•å®˜çš„æ–¹æ³•def notify_interviewer(modeladmin, request, queryset)â€¢ æ³¨å†Œåˆ° modeladminä¸­actions = (export_model_as_csv, notify_interviewer, ) djangoçš„ä¸­é—´ä»¶ â— ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶ Middleware ?â— æ³¨å…¥åœ¨ Django è¯·æ±‚/å“åº” å¤„ç†æµç¨‹ä¸­çš„é’©å­æ¡†æ¶ï¼Œèƒ½å¯¹ request/response ä½œå¤„ç†â— å¹¿æ³›çš„ä½¿ç”¨åœºæ™¯ â—‹ ç™»å½•è®¤è¯ï¼Œå®‰å…¨æ‹¦æˆª â—‹ æ—¥å¿—è®°å½•ï¼Œæ€§èƒ½ä¸ŠæŠ¥ â—‹ ç¼“å­˜å¤„ç†ï¼Œç›‘æ§å‘Šè­¦â€¦.â— è‡ªå®šä¹‰ä¸­é—´ä»¶çš„ 2 ç§æ–¹æ³•â— ä½¿ç”¨å‡½æ•°å®ç°â— ä½¿ç”¨ç±»å®ç°ç¤ºä¾‹åˆ›å»ºä¸€ä¸ªè¯·æ±‚æ—¥å¿—ï¼Œæ€§èƒ½æ—¥å¿—è®°å½•ä¸­é—´ä»¶ è¾“å‡ºåˆ° Response Header é‡Œé¢çš„ X-Page-Ducration-ms Sentry é›†æˆ è§£å†³çš„é—®é¢˜ï¼š åº”ç”¨çš„é”™è¯¯ï¼Œå¼‚å¸¸ç›‘æ§ç»Ÿè®¡ï¼ŒæŠ¥è­¦é€šçŸ¥ï¼›æ€§èƒ½ç›‘æ§ç»Ÿè®¡ï¼Œå¯¹é—®é¢˜è¿›è¡Œè·Ÿè¸ªSentry æ¶æ„ä¹‹ç¾â€¢ å¼€æ”¾çš„æ¶æ„ï¼šå¯ä¸ AD åŸŸè´¦å·é›†æˆï¼Œä¸ Google/Stackoverflow ç­‰è´¦å·é›†æˆâ€¢ æœ‰å®Œå–„çš„æ’ä»¶æ”¯æŒï¼šWebhook/Gitlab/Jira/Slack/PushOver/â€¦.â€¢ æ”¯æŒä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€é¢„å‘ã€çº¿ä¸Šï¼‰ï¼›å¯ä»¥é…ç½®çµæ´»çš„å‘Šè­¦â€¢ è·¨å¹³å°ï¼Œè·¨ç«¯çš„æ”¯æŒï¼šPython/Java/JavaScript/Ruby/Go/â€¦, Android/iOS/Web/â€¦â€¢ API ç®€å•ã€æ˜“ç”¨ï¼Œè‡ªåŠ¨é›†æˆï¼›å®‰è£…ç®€å•ï¼šæ¶æ„ä¾èµ–å¤šï¼Œä½†ä½¿ç”¨ Docker å¯ä»¥ä¸€ä¸ªå‘½ä»¤å®‰è£…â€¢ è‡ªåŠ¨å¯¹é”™è¯¯ï¼Œå¼‚å¸¸è¿›è¡Œç»Ÿè®¡èšåˆï¼ŒæŒ‰ç…§ä¸Šä¸‹æ–‡çš„Tagè¿›è¡Œèšåˆâ€¢ å¯ä»¥å¯¹æ€§èƒ½è¿›è¡Œç»Ÿè®¡åˆ†æï¼Œå¯æŠ½æ ·;å¯è§†åŒ–çš„è¶‹åŠ¿åˆ†æâ€¢ å¤šç§Ÿæˆ·ï¼Œæ”¯æŒåŒå› ç´ è®¤è¯ï¼Œæ•æ„Ÿå†…å®¹è‡ªåŠ¨è„±æ• ä¸¤ç§æ–¹æ³•å®‰è£… Sentry ï¼š ä½¿ç”¨ Docker å®˜æ–¹æœåŠ¡ï¼ˆé‡å¤§éœ€è¦ä»˜è´¹ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼‰ï¼› è‡ªå·±æ­å»º æœåŠ¡ï¼ˆä»æºç å®‰è£…ï¼Œæˆ–è€…ä½¿ç”¨docker æ­å»ºæœåŠ¡ï¼‰ï¼› ä½¿ç”¨ Docker æ¥å®‰è£… sentry, ä½¿ç”¨ release ç‰ˆæœ¬ https://github.com/getsentry/onpremise/releases ./install.sh docker-compose up -d Django é…ç½®é›†æˆ sentry ï¼Œ è‡ªåŠ¨ä¸ŠæŠ¥æœªæ•è·å¼‚å¸¸ï¼Œ é”™è¯¯æ—¥å¿— é›†æˆæ•ˆæœ å‘Šè­¦è¶‹åŠ¿å¯è§†åŒ–: Prometheus &amp; Grafana Prometheus æ•°æ®ç±»å‹â€¢ Counterï¼šè®¡æ•°å™¨ï¼Œæ€»æ˜¯å¢é•¿çš„æ•´æ•°å€¼ï¼›è¯·æ±‚æ•°ï¼Œè®¢å•é‡ï¼Œé”™è¯¯æ•°ç­‰ï¼›â€¢ Gaugeï¼šå¯ä»¥ä¸Šä¸‹æ³¢åŠ¨çš„è®¡é‡å€¼ï¼Œæ¯”å¦‚æ¸©åº¦ï¼Œå†…å­˜ä½¿ç”¨é‡ï¼Œå¤„ç†ä¸­çš„è¯·æ±‚ï¼›â€¢ Summaryï¼šæä¾›è§‚æµ‹æ ·æœ¬çš„æ‘˜è¦ï¼ŒåŒ…å«æ ·æœ¬æ•°é‡ï¼Œæ ·æœ¬å€¼çš„å’Œï¼›æ»‘åŠ¨çª—å£è®¡ç®—:è¯·æ±‚è€—æ—¶ï¼Œå“åº”æ•°æ®å¤§å°â€¢ Histogramï¼šæŠŠè§‚æµ‹å€¼æ”¾åˆ°é…ç½®å¥½çš„æ¡¶ä¸­åšç»Ÿè®¡ï¼Œè¯·æ±‚è€—æ—¶ï¼Œå“åº”æ•°æ®å¤§å°ç­‰ï¼› Django ä¸­ä½¿ç”¨ç¼“å­˜ â— Django ç¼“å­˜çš„å­˜å‚¨æ–¹å¼ Memcached ç¼“å­˜ Redis ç¼“å­˜ ï¼ˆéœ€è¦å®‰è£… django-redis åŒ…ï¼‰ æ•°æ®åº“ç¼“å­˜ æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ æœ¬åœ°å†…å­˜ç¼“å­˜ ä¼ªç¼“å­˜( Dummy Cacheï¼Œ ç”¨äºå¼€å‘ã€æµ‹è¯•) â€¢ è‡ªå®šä¹‰ç¼“å­˜ Celery é›†æˆï¼šCelery çš„ä½¿ç”¨ â— ä»€ä¹ˆæ˜¯ Celery?â— ä¸€ä¸ªåˆ†å¸ƒå¼çš„ä»»åŠ¡é˜Ÿåˆ— â—‹ ç®€å•ï¼š å‡ è¡Œä»£ç å¯ä»¥åˆ›å»ºä¸€ä¸ªç®€å•çš„ Celery ä»»åŠ¡ â—‹ é«˜å¯ç”¨ï¼šå·¥ä½œæœºä¼šè‡ªåŠ¨é‡è¯• â—‹ å¿«é€Ÿï¼šå¯ä»¥æ‰§è¡Œä¸€åˆ†é’Ÿä¸Šç™¾ä¸‡çš„ä»»åŠ¡ â—‹ çµæ´»ï¼šæ¯ä¸€å—éƒ½å¯ä»¥æ‰©å±• Celery ä¸­çš„æ ¸å¿ƒæ¦‚å¿µ â€¢ Task: ä¸€ä¸ªéœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä»»åŠ¡é€šå¸¸å¼‚æ­¥æ‰§è¡Œâ€¢ Period Task: éœ€è¦å®šæ—¶æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå®šæ—¶ä¸€å®šé—´éš”æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ crontab è¡¨è¾¾å¼è®¾å®šæ‰§è¡Œå‘¨æœŸå’Œæ—¶é—´ç‚¹â€¢ Message Broker: æ¶ˆæ¯ä»£ç†ï¼Œä¸´æ—¶å­˜å‚¨ï¼Œä¼ è¾“ä»»åŠ¡åˆ°å·¥ä½œèŠ‚ç‚¹çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚å¯ä»¥ç”¨ Redis,RabbitMQ, Amazon SQS ä½œä¸ºæ¶ˆæ¯ä»£ç†ã€‚æ¶ˆæ¯ä»£ç†å¯ä»¥æœ‰å¤šä¸ªï¼Œä»¥ä¿éšœç³»ç»Ÿçš„é«˜å¯ç”¨ã€‚â€¢ Workerï¼šå·¥ä½œèŠ‚ç‚¹ï¼Œæ‰§è¡Œä»»åŠ¡çš„è¿›ç¨‹ï¼Œworkerå¯ä»¥æœ‰å¤šä¸ªï¼Œä¿éšœç³»ç»Ÿçš„é«˜å¯ç”¨å’Œæ‰©å±•æ€§ã€‚ Celery ä½¿ç”¨åœºæ™¯ å¤§é‡éœ€è¦ä½¿ç”¨å¼‚æ­¥ä»»åŠ¡çš„åœºæ™¯â€¢ å‘é€ç”µå­é‚®ä»¶ï¼Œå‘é€ IM æ¶ˆæ¯é€šçŸ¥â€¢ çˆ¬å–ç½‘é¡µï¼Œ æ•°æ®åˆ†æâ€¢ å›¾åƒã€è§†é¢‘å¤„ç†â€¢ ç”ŸæˆæŠ¥å‘Šï¼Œæ·±åº¦å­¦ä¹  Flower: ä¸€ä¸ªå®æ—¶çš„ Celery ä»»åŠ¡ç›‘æ§ç³»ç»Ÿ Djangoä¹‹ç¾ï¼šSignalsä¿¡å·åŠå…¶ä½¿ç”¨åœºæ™¯ ä»€ä¹ˆæ˜¯ Signals?â€¢ Django çš„ä¿¡å·â€¢ Django æ¡†æ¶å†…ç½®çš„ä¿¡å·å‘é€å™¨ï¼Œè¿™ä¸ªä¿¡å·å‘é€å™¨åœ¨æ¡†æ¶é‡Œé¢â€¢ æœ‰åŠ¨ä½œå‘ç”Ÿçš„æ—¶å€™ï¼Œå¸®åŠ©è§£è€¦çš„åº”ç”¨æ¥æ”¶åˆ°æ¶ˆæ¯é€šçŸ¥â€¢ å½“åŠ¨ä½œå‘ç”Ÿæ—¶ï¼Œå…è®¸ç‰¹å®šçš„ä¿¡å·å‘é€è€…å‘é€æ¶ˆæ¯åˆ°ä¸€ç³»åˆ—çš„æ¶ˆæ¯æ¥æ”¶è€…â€¢ Signals æ˜¯åŒæ­¥è°ƒç”¨ ä¿¡å·çš„åº”ç”¨åœºæ™¯â€¢ ç³»ç»Ÿè§£è€¦ï¼›ä»£ç å¤ç”¨ï¼šå®ç°ç»Ÿä¸€å¤„ç†é€»è¾‘çš„æ¡†æ¶ä¸­é—´ä»¶ï¼› -&gt; å¯ç»´æŠ¤æ€§æå‡â€¢ è®°å½•æ“ä½œæ—¥å¿—ï¼Œå¢åŠ /æ¸…é™¤ç¼“å­˜ï¼Œæ•°æ®å˜åŒ–æ¥å…¥å®¡æ‰¹æµç¨‹ï¼›è¯„è®ºé€šçŸ¥ï¼›â€¢ å…³è”ä¸šåŠ¡å˜åŒ–é€šçŸ¥ï¼Œâ€¢ ä¾‹ï¼šé€šè®¯å½•å˜åŒ–çš„å¼‚æ­¥äº‹ä»¶å¤„ç†ï¼Œæ¯”å¦‚å‘˜å·¥å…¥èŒæ—¶å‘é€æ¶ˆæ¯é€šçŸ¥å›¢é˜Ÿæ–°äººå…¥èŒï¼Œå‘˜å·¥ç¦»èŒæ—¶å¼‚æ­¥æ¸…ç†å‘˜å·¥çš„æƒé™ç­‰ç­‰ï¼› ç”Ÿäº§ç¯å¢ƒä¸­çš„å®‰å…¨ï¼šåº”ç”¨å®‰å…¨ è®¿é—®é™æµ â€“ é˜²æ¶æ„æ”»å‡»â€¢ Rest Framework API é™æµâ€¢ åº”ç”¨é™æµ: å¯¹é¡µé¢çš„è®¿é—®é¢‘æ¬¡è¿›è¡Œé™æµ å¯ä»¥å¯¹åŒ¿åç”¨æˆ·ï¼Œå…·åç”¨æˆ·è¿›è¡Œé™æµå¯ä»¥è®¾ç½®å³°å€¼æµé‡ï¼ˆå¦‚æ¯åˆ†é’Ÿ60æ¬¡è¯·æ±‚ï¼‰ä¹Ÿå¯ä»¥è®¾ç½®è¿ç»­ä¸€æ®µæ—¶é—´çš„æµé‡é™åˆ¶ï¼ˆæ¯”å¦‚æ¯å¤©3000æ¬¡ï¼‰ äº‘ç¯å¢ƒä¸­çš„éƒ¨ç½²ï¼šå®¹å™¨çš„åŸºç¡€ç”¨æ³• â€“ Docker å®¹å™¨ä»‹ç» â— Docker: â—‹ ç å¤´å·¥äººï¼Œè½»é‡çº§çš„ï¼Œå¯ç§»æ¤ï¼Œè‡ªåŒ…å«çš„å®¹å™¨ï¼Œæ¥è‡ªåŠ¨åŒ–ã€ç‰ˆæœ¬åŒ–åº”ç”¨çš„å‘å¸ƒã€‚ â—‹ Dockerä¸Šè·‘çš„å®¹å™¨æ˜¯ä¸€ä¸ªä¸ªçš„é›†è£…ç®±ï¼›â— Dockerçš„åŸºç¡€æ˜¯LXC â—‹ LXCç”¨äºåº”ç”¨ç¨‹åºçš„éš”ç¦»ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåˆ†é…ç‹¬ç«‹çš„å‘½åç©ºé—´ï¼Œéš”ç¦»çš„CPU, å†…å­˜ï¼Œç£ç›˜ï¼Œç½‘ç»œèµ„æº â—‹ æ¯ä¸ªåº”ç”¨å†…éƒ¨å¯ä»¥å•è·‘ä¸€å¥—å®¹å™¨ç³»ç»Ÿï¼ŒåŠŸ èƒ½ä¸Šç›¸å½“äºä¼ ç»Ÿçš„è™šæ‹Ÿæœºï¼Œä½†æœ¬è´¨ä¸Šæ˜¯å†…æ ¸å±‚é¢å¯¹èµ„æºçš„éš”ç¦»â— Docker å®¹å™¨çš„åˆ†å±‚å’Œç‰ˆæœ¬ç®¡ç† â—‹ DockeræŠŠåº”ç”¨å’Œç³»ç»Ÿæ‰“åŒ…åˆ°ä¸€èµ·ï¼ˆimageé•œåƒï¼‰ï¼Œè¿›è¡Œç‰ˆæœ¬åŒ–ç®¡ç†ã€‚ â—‹ åº”ç”¨ä¹‹äºDockerï¼Œå¦‚åŒä»£ç ä¹‹äºGit/SVNï¼Œä¸€ä¸ªå‘½ä»¤å¯ä»¥æŠŠåº”ç”¨éƒ¨ç½²åˆ°dockerä¸Šã€‚å®¹å™¨çš„åŸºç¡€ç”¨æ³• æŒç»­é›†æˆï¼šCICDçš„å·¥ä½œæµç¨‹","link":"/2023/08/28/Django%E5%BC%80%E5%8F%91%E5%88%86%E4%BA%AB/"},{"title":"Fastlaneå¤šè®¾å¤‡ç®¡ç†è¯ä¹¦","text":"","link":"/2023/08/28/Fastlane%E5%A4%9A%E8%AE%BE%E5%A4%87%E7%AE%A1%E7%90%86%E8%AF%81%E4%B9%A6/"},{"title":"Hexoä½¿ç”¨æ‰‹å†Œ","text":"Hexoæ‰‹å†Œ 1.å¯åŠ¨æœ¬åœ°è°ƒè¯•æœåŠ¡å™¨1hexo server 2.æ–°å»ºæ–‡ç« 1hexo new 'æ–‡ç« æ ‡é¢˜' 3. é™æ€æ–‡ä»¶ç”Ÿæˆ1hexo generate 4. æ–‡ç« å‘å¸ƒ1hexo deploy 5.å›¾ç‰‡æ”¾ç½®å°†ç”¨çš„å›¾ç‰‡æ”¾ç½®åˆ° â€œæ–‡ç« æ ‡é¢˜â€/ æ–‡ä»¶å¤¹ä¸‹é¢ ä½¿ç”¨çš„æ—¶å€™ 1![](æ–‡ç« æ ‡é¢˜/å›¾ç‰‡.jpg)","link":"/2019/09/19/Hexo%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/"},{"title":"Pythonå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰","text":"ä»Šå¤©å¼€ä¸€ä¸ªä¸“é¢˜ï¼Œæ¥è®°å½•ä¸‹å­¦ä¹ pythonçš„ä¸€äº›ç¬”è®° 1ã€ æ‰“å°è¾“å‡º123#encoding:utf-8print('hello world')print('ä½ å¥½ï¼Œä¸–ç•Œ') 2ã€å˜é‡å£°æ˜123456789101112#å£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²monday='æ˜ŸæœŸä¸€'#å£°æ˜ä¸€ä¸ªintç±»å‹çš„æ•°å­—one=1#å£°æ˜ä¸€ä¸ªæµ®ç‚¹ç±»å‹çš„æ•°å­—pi=3.14#å£°æ˜ä¸€ä¸ªæ•°ç»„arr=['1','2',2222]#å£°æ˜ä¸€ä¸ªå­—æ®µdic={'name':'æˆç„±','age':22}#å£°æ˜ä¸€ä¸ªboolç±»å‹çš„boolvalue=False 3ã€å¸¸ç”¨å­—ç¬¦ä¸²æ“ä½œå‡½æ•° æ±‚å­—ç¬¦ä¸²é•¿åº¦ 1stringlength=len(monday) å­—ç¬¦ä¸²æ‹¼æ¥ 123string1='ä½ å¥½'string2='æˆç„±'string3=string1+string2 æ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å‡º 1234567891011121314151617Pythonè½¬æ¢è¯´æ˜ç¬¦è½¬æ¢è¯´æ˜ç¬¦ è¯´æ˜%dï¼Œ%i è½¬æ¢ä¸ºå¸¦ç¬¦å·çš„åè¿›åˆ¶å½¢å¼çš„æ•´æ•°%o è½¬æ¢ä¸ºå¸¦ç¬¦å·çš„å…«è¿›åˆ¶å½¢å¼çš„æ•´æ•°%xï¼Œ%X è½¬æ¢ä¸ºå¸¦ç¬¦å·çš„åå…­è¿›åˆ¶å½¢å¼çš„æ•´æ•°%e è½¬åŒ–ä¸ºç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼ˆe å°å†™ï¼‰%E è½¬åŒ–ä¸ºç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼ˆE å¤§å†™ï¼‰%fï¼Œ%F è½¬åŒ–ä¸ºåè¿›åˆ¶å½¢å¼çš„æµ®ç‚¹æ•°%g æ™ºèƒ½é€‰æ‹©ä½¿ç”¨ %f æˆ– %e æ ¼å¼%G æ™ºèƒ½é€‰æ‹©ä½¿ç”¨ %F æˆ– %E æ ¼å¼%c æ ¼å¼åŒ–å­—ç¬¦åŠå…¶ ASCII ç %r ä½¿ç”¨ repr() å°†å˜é‡æˆ–è¡¨è¾¾å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²%s ä½¿ç”¨ str() å°†å˜é‡æˆ–è¡¨è¾¾å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¦‚print(monday+'%d'%one)è¾“å‡ºï¼šæ˜ŸæœŸä¸€1 4ã€æ•°æ®ç±»å‹è½¬æ¢ int(x) ï¼š xä¸ºæ•°å­—æˆ–å­—ç¬¦ä¸²å‹çš„æ•°å­— float(x)ï¼šxä¸ºæ•°å­—ä¸ºå­—ç¬¦ä¸²å‹çš„æ•°å­— complex(xï¼Œy)ï¼šè½¬æ¢ä¸ºå¤æ•°ï¼Œxï¼Œyä¸ºæ•°å­—ï¼Œæµ®ç‚¹æ•°ï¼Œboolæ•° str(x)ï¼šè½¬ä¸ºå­—ç¬¦ä¸² bin(x)ï¼šè½¬ä¸ºäºŒè¿›åˆ¶æ•° oct(x)ï¼šè½¬ä¸º8è¿›åˆ¶æ•° hex(x)ï¼šè½¬ä¸º16è¿›åˆ¶æ•° chr(x)ï¼šå°†10è¿›åˆ¶æ•°è½¬ä¸ºASCIIç  ord(x)ï¼šå°†ASCIIå­—ç¬¦è½¬ä¸º10è¿›åˆ¶æ•° 5ã€æ¡ä»¶æ§åˆ¶è¯­å¥12345678910111213141516171819isBoy=True#å•å±‚åˆ¤æ–­if isBoy: print('ç”·å­©')#åŒé‡åˆ¤æ–­if isBoy: print('ç”·å­©')else: print('å¥³å­©') #å¤šé‡åˆ¤æ–­if 1: print(2)elif 2: print(32)else: print(3) 6ã€å¾ªç¯æ§åˆ¶è¯­å¥ forå¾ªç¯ 1234567891011121314for i in range(10): print(i)#è¾“å‡º0123456789 å¸¦æ­¥é•¿å¾ªç¯æ‰“å° 12345678for i in range(0,10, 2): print(i)#è¾“å‡º02468 å¾ªç¯ä¸€ä¸ªæ•°ç»„ 123456for var in arr: print(var)#è¾“å‡º122222 while å¾ªç¯ 123456789i = 0while i &lt; 3: print(i) i+=1#è¾“å‡º 012 7ã€æˆå‘˜è¿ç®—ç¬¦ inï¼Œnot in12345678910if 2 in range(10): print('2åœ¨é›†åˆä¸­')else: print('2ä¸åœ¨é›†åˆä¸­') animals=['çŒ«','ç‹—','çŒª']if 'æ¡Œå­' not in animals: print('æ¡Œå­ä¸å±äºåŠ¨ç‰©')else: print('æ¡Œå­å±äºåŠ¨ç‰©') 8ã€èº«ä»½è¿ç®—ç¬¦ is ï¼Œis not1234567891011121314151617181920i = 1j = 1if i is j: print('i å°±æ˜¯ j')else: print('i ä¸æ˜¯ j')#è¾“å‡ºï¼ši å°±æ˜¯ jname1='æˆç„±'nickname='chengyan'if name1 is not nickname: print('æˆç„±ä¸æ˜¯chengyan')else: print('æˆç„±å°±æ˜¯chengyan') #è¾“å‡ºæˆç„±ä¸æ˜¯chengyan å°ç»“ï¼šæœ¬ç¯‡å°±å…ˆå­¦ä¹ åˆ°è¿™é‡Œï¼Œå›é¡¾ä¸‹ï¼Œæœ¬ç¯‡ä¸»è¦å­¦ä¹ äº†pythonå¦‚ä½•æ‰“å°è¾“å‡ºã€å­—ç¬¦ä¸²çš„å¸¸è§æ“ä½œã€å˜é‡çš„å£°æ˜ã€æ¡ä»¶æ§åˆ¶è¯­å¥ã€æ•°æ®ç±»å‹è½¬æ¢ã€æ ¼å¼åŒ–è¾“å‡ºå­—ç¬¦ä¸²ã€èº«ä»½å˜é‡ç¬¦å’Œæˆå‘˜å˜é‡ç¬¦ï¼Œä¸‹ä¸€èŠ‚å­¦ä¹ åˆ—è¡¨ä¸å…ƒç»„ã€å­—å…¸ï¼Œsee u tomorrowï¼","link":"/2019/10/16/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/"},{"title":"Hexoå‡çº§3.9.0å®è·µ","text":"ä¸€ã€è¯‰æ±‚hexoä½¿ç”¨äº†å¥½å‡ å¹´äº†ï¼Œä½¿ç”¨çš„ç‰ˆæœ¬ä¸€ç›´æ˜¯3.2.0, node ç‰ˆæœ¬ä¹Ÿæ˜¯4.5.9ç‰ˆæœ¬ï¼Œå½“å‰å¾ˆå¤šçš„node_modelsè¦å»çš„ç‰ˆæœ¬éƒ½æ˜¯6.0ä»¥ä¸Šäº†ï¼Œæ‰€ä»¥ä»Šå¤©å¯¹hexoå’Œnodeè¿›è¡Œä¸€æ¬¡å‡çº§ï¼Œå…¨éƒ¨éƒ½å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚ hexo-&gt;3.9.0 node-&gt;10.16.3 å…·ä½“å¸¦æ¥çš„å¥½å¤„æ˜¯é¡µé¢æ‰“å¼€é€Ÿåº¦åŠ å¿«ã€ä½¿ç”¨æœ€æ–°çš„æ’ä»¶ï¼Œå‡çº§å®Œæˆä¹‹åï¼Œå¯ä»¥æ”¯æŒæ–‡ç« å­—æ•°ç»Ÿè®¡å’Œé˜…è¯»æ—¶é—´ç»Ÿè®¡ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ä»¥å‰ä¸€ç›´å¯¹å†™çš„æ–‡ç« çš„ä»£ç åŒºï¼Œä¸æ˜¯å¾ˆæ»¡æ„ã€‚æ­¤æ¬¡ä¹Ÿä¸€å¹¶è§£å†³ã€‚ äºŒã€å‡çº§æ–¹æ¡ˆ nodeå‡çº§æ–¹æ¡ˆ hexoå‡çº§æ–¹æ¡ˆ hexoæ–‡å­—å­—æ•°ä¸hexoé˜…è¯»æ—¶é—´æ”¹é€  è¿™é‡Œè¦å¤šè¯´å‡ å¥ï¼Œç”±äºæœ‰ä¸¤ä¸ªæ–¹æ¡ˆå®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä¸€ç§æ˜¯é€šè¿‡npm install hexo-wordcount --saveè¿™ç§æ–¹å¼ï¼Œè¯¯å¯¼æ–‡ç« ï¼Œæµªè´¹äº†å¾ˆå¤šæ—¶é—´åœ¨è¿™é‡Œã€‚è€Œæ­£æ˜¯çš„æ–¹å¼åº”è¯¥æ˜¯ $ npm install hexo-symbols-count-time --save æœ€ç»ˆæ€»ç®—æ˜¯æ‰¾åˆ°æ­£ç¡®çš„å§¿åŠ¿ï¼Œæ–‡ç« ä¹Ÿå®ç°äº†å­—æ•°ä¸é˜…è¯»æ—¶é—´çš„ç»Ÿè®¡ ä¸‰ã€æ„å¤–äº§ç‰©åœ¨å‡çº§è¿‡ç¨‹ä¸­ï¼Œæ„å¤–æå‡ºæ¥ä¸€äº›å…¶ä»–å°çš„ä¸œè¥¿ï¼Œå¦‚ä»£ç æ”¯æŒæš—é»‘æ¨¡å¼ï¼ˆè¿™ä¸ªåŠŸèƒ½ä»¥å‰ä¹Ÿæœ‰ï¼Œæ²¡æœ‰æ‰¾åˆ°åœ°æ–¹è¿›è¡Œè®¾ç½®ï¼‰ã€å°¾éƒ¨è´´äº†ä¸€ä¸ªå¾®ä¿¡çš„äºŒç»´ç ï¼ˆå¸Œæœ›èƒ½è·Ÿç½‘å‹æ›´å¤šçš„äº¤æµï¼‰ã€å¦å¤–è¿˜æ„å¤–å‘ç°ä¸€ä¸ªèµèµçš„åŠŸèƒ½ï¼Œä¹Ÿæ‰“å¼€äº†ï¼ˆå¦‚æœæœ‰ç½‘å‹æ„¿æ„çš„è¯ï¼ï¼‰ã€‚ å››ã€è¿˜æ²¡å®ç°ï¼Œå¯ä»¥ç»§ç»­ä¼˜åŒ–çš„ç‚¹ç›®å‰æˆ‘ä½¿ç”¨çš„Hexoï¼ŒNextä¸»é¢˜æ€»å¾—æ¥è¯´ï¼Œå·²ç»æ¯”è¾ƒæ»¡æ„äº†ï¼Œä½†æ˜¯ç¾ä¸­ä¸è¶³çš„æ˜¯ï¼Œå¤šè¯´ä¸‹çº¿ä¹‹åï¼Œæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæ‰€ä»¥è¯„è®ºè¿™å—è¿˜æ˜¯ä¸€ä¸ªå¾…ä¼˜åŒ–çš„ç‚¹ã€‚ äº”ã€å…¶ä»–ä¸€äº›æœ‰ç”¨çš„é“¾æ¥ Hexoä¸»é¢˜ç½‘ç«™","link":"/2019/10/17/Hexo%E5%8D%87%E7%BA%A73-9-0%E5%AE%9E%E8%B7%B5/"},{"title":"Pythonå­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰","text":"ä»Šå¤©æ¥ç»§ç»­å­¦ä¹ ä¸‹pythoä¸­çš„å‡½æ•° å­¦ä¹ ç›®æ ‡ å¦‚ä½•å®šä¹‰å‡½æ•°åŠå¸¦ä¸åŒå‚æ•°çš„å‡½æ•° å‡½æ•°æ¨¡å— globalã€nonlocalã€lambda å¦‚ä½•å®šä¹‰å‡½æ•° æ— å…¥å‚çš„å‡½æ•° 12def sayHello(): print(hello) å¸¦è¿”å›å€¼çš„å‡½æ•° 1234def sayHello(): hello = 'hello' print(hello) return hello å¸¦å‚æ•°å‡½æ•° 12def saySomething(something): print(something) æœ‰é»˜è®¤å€¼å‡½æ•° 12def sayDefault(something='helloworld'): print(something) å¯å˜å‚æ•°* ,** 123456def sayMore(*morething): for a in morething: print(a)def sayMoreDic(**moreDic): for dic in moreDic: print(dic) *ä¿®é¥°çš„å‚æ•°ï¼Œå…¶å®æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œ**ä¿®é¥°çš„å‚æ•°æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œä¼ å…¥æ–¹å¼å¦‚ä¸‹ 12sayMore(1,2,3)sayMoreDic(name='chengyan',age=10) ä¼ å­—å…¸ã€åˆ—è¡¨å’Œå…ƒç»„ ä¼ å­—å…¸å’Œåˆ—è¡¨è¿›å…¥å‡½æ•°ï¼Œåœ¨å‡½æ•°å†…ä¿®æ”¹ï¼Œä¹Ÿä¼šåŒæ­¥ä¿®æ”¹å¤–é¢çš„å€¼ ä¼ æ•°å­—ã€å­—ç¬¦ä¸²ã€å…ƒç»„è¿›å…¥å‡½æ•°ï¼Œåœ¨å‡½æ•°å†…ä¿®æ”¹ï¼Œå¹¶ä¸ä¼šåŒæ­¥ä¿®æ”¹å¤–é¢çš„å€¼ å‡½æ•°æ¨¡å— å®šä¹‰ åœ¨pythoné‡Œé¢ï¼Œæ–°å»ºä¸åŒçš„.pyæ–‡ä»¶ï¼Œå°±ç›¸å½“äºæ˜¯åˆ›å»ºäº†å‡½æ•°æ¨¡å—ã€‚ å¼•ç”¨ é€šè¿‡å…³é”®å­—import xx æ¥å¼•ç”¨ç›¸åŒç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè¿™ä¹ˆå¼•ç”¨åˆ°çš„å‡½æ•°å¦‚æœæƒ³è°ƒç”¨ï¼Œéœ€è¦è¿™ä¹ˆå†™ 123import xxxx.sayHello() from xx import xxx å…¶ä¸­â€œxxâ€æ˜¯æ¨¡å—åç§°ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶åï¼Œâ€xxxâ€æ˜¯æˆ‘ä»¬è¦å¼•ç”¨çš„å‡½æ•°åç§°ï¼Œè¿™ä¹ˆå†™æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œæ˜¯å¯ä»¥åœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œç•¥å»â€.â€ä¾‹å¦‚ 12from xx import sayHellosayHello() è¿˜æœ‰ä¸€ç§å†™æ³•æ˜¯from xx import *,è¿™ç§å†™æ³•çš„è¯ï¼Œä¼šå¼•å…¥æ‰€æœ‰çš„å‡½æ•° æ¨¡å—æœç´¢è·¯å¾„ 123import syssys.path[0] = 'å‡½æ•°æ¨¡å—æ‰€åœ¨è·¯å¾„'#é€šè¿‡sys.pathå‡½æ•°æ¥æŒ‡å®šæ¨¡å—æœç´¢è·¯å¾„ï¼Œç”¨æ¥è§£å†³ä»£ç æ–‡ä»¶ä¸åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„é—®é¢˜ globalã€nonlocalã€lambdaå…³é”®å­— global å…³é”®å­—ç”¨æ¥åœ¨å±€éƒ¨ä½œç”¨åŸŸå†…ï¼Œå£°æ˜å˜é‡ä¸ºå…¨å±€å˜é‡ï¼Œä»è€Œå¯ä»¥ä¿®æ”¹å…¨å±€å˜é‡ nonlocal å…³é”®å­—ç”¨æ¥ä¿®æ”¹é—­åŒ…ä¸­çš„å˜é‡ï¼Œå°†é—­åŒ…å˜é‡ä¿®æ”¹ä¸ºå±€éƒ¨å˜é‡ï¼Œä»è€Œå¯ä»¥ä¿®æ”¹é—­åŒ…å˜é‡ lambda å…³é”®å­—æ˜¯ç”¨æ¥ç”³æ˜åŒ¿åå‡½æ•°çš„ï¼ŒèŒƒä¾‹å¦‚ä¸‹ 12sum1 = lambda x,y: x+yprint(sum1(2,7)) ä»Šå¤©ä¸»è¦æ˜¯å­¦ä¹ äº†ä¸‹å‡½æ•°çš„å£°æ˜ã€è°ƒç”¨ã€å¼•ç”¨ä»¥åŠå‡ ä¸ªå…³äºå‡½æ•°çš„å…³é”®å­—ï¼Œä¸‹ä¸€èŠ‚å­¦ä¹ åŸºç¡€éƒ¨åˆ†çš„æœ€åä¸€èŠ‚ç±»","link":"/2019/10/30/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/"},{"title":"Pythonå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰","text":"ä»Šå¤©æ¥å­¦ä¹ ä¸‹Pythonä¸­çš„æ•°ç»„ã€å…ƒç»„å’Œå­—å…¸ ä¸€ã€æ•°ç»„ æ•°ç»„çš„å£°æ˜ï¼Œpythonçš„æ•°ç»„å¯ä»¥å­˜æ”¾ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œæ•°ç»„çš„å£°æ˜å¦‚ä¸‹ 12#æ•°ç»„çš„å£°æ˜list = [1, 2, 'chengyan',['chengyan',1]] æ•°ç»„å…ƒç´ çš„è·å–ï¼Œæ”¯æŒæ ¹æ®ä¸‹æ ‡è¿›è¡Œè·å– 123#æ ¹æ®ä¸‹æ ‡è·å–print(list[0])#å°†ä¼šæ‰“å°1 åˆ—è¡¨å¸¸ç”¨çš„æ–¹æ³•** æ–¹æ³•åç§° æ–¹æ³•åŠŸèƒ½æè¿°\u0010\u0010 append åœ¨åˆ—è¡¨å°¾éƒ¨æ‹¼æ¥å…ƒç´  clear åˆ—è¡¨æ¸…ç©ºï¼ˆpython3.3ä¹‹åæ”¯æŒï¼‰ copy å¤åˆ¶ç”Ÿæˆå¦ä¸€ä¸ªåˆ—è¡¨ï¼ˆ3.3åæ”¯æŒï¼‰ count ç»Ÿè®¡æŒ‡å®šå…ƒç´ ä¸ªæ•° extend åˆå¹¶ä¸¤ä¸ªåˆ—è¡¨ index è·å–æŒ‡å®šå…ƒç´ çš„ä¸‹æ ‡ insert åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´  pop åˆ é™¤æŒ‡å®šä¸‹æ ‡å…ƒç´  remove åˆ é™¤æŸä¸ªå…ƒç´ ï¼Œå…ƒç´ éœ€è¦åœ¨åˆ—è¡¨ä¸­ï¼Œå¦åˆ™ä¼šæŠ¥é”™ reverse åè½¬åˆ—è¡¨ sort å¯¹åˆ—è¡¨è¿›è¡Œæ’åº äºŒã€å…ƒç»„å…ƒç»„ä¸åˆ—è¡¨çš„åŒºåˆ«åœ¨äºï¼š1. å…ƒç»„ä¸èƒ½å¯¹å…¶å…ƒç´ è¿›è¡Œå˜åŠ¨ï¼Œè€Œåˆ—è¡¨å¯ä»¥ã€‚2. å…ƒç»„ç”¨ï¼ˆï¼‰æ‹¬èµ·æ¥ï¼Œè€Œåˆ—è¡¨ç”¨[]æ‹¬èµ·æ¥ å…ƒç»„çš„å£°æ˜ ç®€å•ç‰ˆ 1234#å£°æ˜ä¸€ä¸ªç©ºå…ƒç»„tuple=()#ç®€å•å£°æ˜ä¸€ä¸ªå…ƒç»„tuple1=('name','age') è¿›é˜¶ç‰ˆ 1234#çœç•¥ï¼ˆï¼‰çš„å…ƒç»„name,age='chengyan',18person=(name,age)print(person) å…ƒç»„çš„åŸºæœ¬æ“ä½œ æ–¹æ³•åç§° æ–¹æ³•åŠŸèƒ½æè¿° count ç»Ÿè®¡æŒ‡å®šå…ƒç´ çš„ä¸ªæ•° index è¿”å›æŒ‡å®šå…ƒç´ çš„ä¸‹æ ‡ å‡½æ•°åç§° å‡½æ•°åŠŸèƒ½æè¿° len ç»Ÿè®¡å…ƒç»„å…ƒç´ ä¸ªæ•° max è¿”å›å…ƒç»„ä¸­æœ€å¤§å€¼çš„å…ƒç´  min è¿”å›å…ƒç»„ä¸­æœ€å°å€¼çš„å…ƒç´  tuple å°†åˆ—è¡¨è½¬æ¢ä¸ºå…ƒç»„ type è¿”å›å¯¹è±¡ç±»å‹ del åˆ é™¤æ•´ä¸ªå…ƒç»„å¯¹è±¡ sum å¯¹å…ƒç»„æ‰€æœ‰å…ƒç´ æ±‚å’Œ ä¸‰ã€å­—å…¸ åˆ›å»ºå­—å…¸ 1dic={'name':'chengyan','age':18} å­—å…¸çš„å¸¸ç”¨æ–¹æ³• æ–¹æ³•åç§° æ–¹æ³•åŠŸèƒ½æè¿° clear å­—å…¸æ¸…ç©º copy å¤åˆ¶ç”Ÿæˆå¦ä¸€ä¸ªå­—å…¸ fromkeys ä½¿ç”¨ç»™å®šçš„keyå»ºç«‹æ–°çš„å­—å…¸ï¼Œå€¼é»˜è®¤ä¸ºNone get è¿”å›keyå¯¹åº”çš„å€¼ items ä»¥å…ƒç»„æ•°ç»„çš„æ–¹å¼è¿”å›å­—å…¸ä¸­çš„å…ƒç´  keys ä»¥åˆ—è¡¨çš„å½¢å¼è¿”å›å­—å…¸ä¸­çš„keys pop åˆ é™¤æŒ‡å®šé”®çš„å€¼ï¼Œå¹¶è¿”å›è¯¥å€¼ popitem éšæœºè¿”å›å…ƒç´ ï¼Œå¹¶åˆ é™¤å…ƒç´ ï¼Œä»¥å…ƒç»„çš„å½¢å¼ setdefault å½“å­—å…¸ä¸­çš„é”®ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè®¾ç½®å€¼ï¼Œå¦‚å­˜åœ¨æ—¶ï¼Œè¿”å›å¯¹åº”çš„å€¼ update åˆ©ç”¨ä¸€ä¸ªå­—å…¸å»æ›´æ–°å¦å¤–ä¸€ä¸ªå­—å…¸ values è¿”å›å­—å…¸ä¸­çš„å€¼ ä¸€äº›ç¤ºä¾‹ 12345678910111213141516171819202122232425262728dic={'name':'chengyan'}#æ–°å¢å…ƒç´ dic['age']=18#å¦‚æœæ²¡æœ‰ï¼Œè®¾ç½®é»˜è®¤å€¼ï¼Œæœ‰ï¼Œä¸åšæ“ä½œdic.setdefault('name','wangqi')#æŸ¥è¯¢name = dic['name']name = dic.get('name')#ä¿®æ”¹dic['name']='wangqi'dic.update('name','wangqi')#åˆ é™¤dic.pop('name')del(dic['name'])#éšæœºåˆ é™¤ä¸€ä¸ªå¹¶è¿”å›è¯¥å…ƒç»„dic.popitem()#éå†for tuple in dic: print(tuple)for key in dic: print(key)for key in dic: print(dic[key])#fromkeysæ–¹å¼åˆ›å»ºå­—å…¸dic1={}.fromkeys['name','age','class','school'] å››ã€å°ç»“è¿™ä¸€èŠ‚ï¼ŒåŸºæœ¬äº†è§£äº†å…ƒç»„ã€åˆ—è¡¨ã€å­—å…¸çš„åˆ›å»ºã€ä»¥åŠä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ã€‚ä¸‹èŠ‚å­¦ä¹ ä¸‹å‡½æ•°ï¼Œsee u","link":"/2019/10/17/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/"},{"title":"Pythonç»“åˆcocoapodè‡ªåŠ¨å‘å¸ƒç‰ˆæœ¬å®è·µ","text":"ä¸€ã€é—®é¢˜ioså¼€å‘äººå‘˜å¯èƒ½å¯¹cocoapodæ¯”è¾ƒç†Ÿæ‚‰ï¼Œåœ¨ç»´æŠ¤ä¸ªäººçš„cocoapodç‰ˆæœ¬çš„æ—¶å€™ï¼Œä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆå°±æ˜¯æœ¬åœ°ä»£ç åº“ä¿®æ”¹äº†æ–‡ä»¶ï¼Œä¸€èˆ¬éœ€è¦åšå¦‚ä¸‹ä¸‰æ­¥æ“ä½œ ä»£ç åŠŸèƒ½å¼€å‘å®Œæ¯•ï¼Œæäº¤ä»£ç åˆ°gitæœåŠ¡å™¨ ä¿®æ”¹.podspecæ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å· ç»™å¯¹åº”çš„æäº¤æ‰“ä¸Štagï¼Œä»¥ä¾¿podå‘å¸ƒæ—¶éœ€è¦ ä½¿ç”¨pod trunk push å‘½ä»¤ï¼Œå‘å¸ƒåˆ°cocoapod æ­¥éª¤æ¯”è¾ƒå¤šï¼Œä¿®æ”¹ç‰ˆæœ¬å’Œæ‰“tagï¼Œæœ‰æ—¶å€™å®¹æ˜“é—æ¼ï¼Œå¦‚æœå‘å¸ƒå¤±è´¥çš„è¯ï¼Œè¿˜éœ€è¦é‡æ–°å†ä¿®æ”¹ç‰ˆæœ¬ï¼Œæ‰“tagã€‚å¾ˆæµªè´¹æ—¶é—´ï¼ŒåŸºäºæ­¤ï¼Œç»“åˆæˆ‘æœ€è¿‘ç ”ç©¶çš„pythonï¼Œå†™äº†ä¸€ä¸ªè„šæœ¬ã€‚æ¥å®ç°ä¸€é”®æäº¤ä»£ç ã€å‘å¸ƒpodåº“çš„åŠŸèƒ½ äºŒã€è„šæœ¬12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#encoding:utf-8#!usr/bin/pythonimport osf = open(&quot;CYKit.podspec&quot;, &quot;r+&quot;)print (&quot;æ–‡ä»¶åä¸º: &quot;, f.name) shouldModifire = '' content = ''for line in f.readlines(): #ä¾æ¬¡è¯»å–æ¯è¡Œ content = content + line line = line.strip() #å»æ‰æ¯è¡Œå¤´å°¾ç©ºç™½ if 's.version = &quot;0' in line: shouldModifire = line #æŸ¥æ‰¾åˆ°éœ€è¦ä¿®æ”¹çš„è¡Œprint('shouldModifire%s'%shouldModifire)items = shouldModifire.split('=')print(items)versions = items[1].split('.')versions_last_length = len(versions[2])versions_last = int(versions[2][:versions_last_length-1])versions_last_int = (versions_last) + 1newVersion = str(versions[0])+'.'+ str(versions[1]) + '.' + str(versions_last_int) + '&quot;'shouldReplaceItem = items[0] + '=' + newVersion#æ›¿æ¢ç›¸åº”çš„ç‰ˆæœ¬å·ï¼Œå¹¶å†™å…¥æ–‡ä»¶replaceed = content.replace(shouldModifire,shouldReplaceItem)print('ä¿®æ”¹ç‰ˆæœ¬å·:' + shouldModifire + '=&gt;' + shouldReplaceItem)#å†™å…¥æ–‡ä»¶f.seek(0)f.truncate() f.write(replaceed)f.flush()#å…³é—­æ–‡ä»¶f.close()#ä»£ç æäº¤os.system('git add .')os.system('git commit -a -m &quot;ã€è„šæœ¬ã€‘ä¿®æ”¹ç›¸åº”ç‰ˆæœ¬å·&quot;')os.system('git push origin master')os.system('git tag -a ' + newVersion + ' -m ' + 'tagç‰ˆæœ¬å·')os.system('git push --tags')#æäº¤åˆ°cocoapodsos.system('pod trunk push --allow-warnings') ä¸‰ã€é‡åˆ°çš„é—®é¢˜æ€»ä½“æ¥è¯´å¼€å‘è¿˜ç®—é¡ºåˆ©ï¼Œå”¯ä¸€å¡å£³çš„åœ°æ–¹å°±æ˜¯ï¼Œè¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œä¿®æ”¹é‡Œé¢çš„ç‰ˆæœ¬å·ï¼Œè¿™é‡Œä½¿ç”¨äº†æš´åŠ›çš„å†™æ–‡ä»¶æ–¹å¼ã€‚ å¥½äº†ï¼Œåˆå¯ä»¥å¼€å¿ƒçš„æ’¸ä»£ç äº†ï¼Œsee u","link":"/2019/10/18/Python%E7%BB%93%E5%90%88cocoapod%E8%87%AA%E5%8A%A8%E5%8F%91%E5%B8%83%E7%89%88%E6%9C%AC%E5%AE%9E%E8%B7%B5/"},{"title":"ReactNativeå­¦ä¹ ä¸€-RNçš„æŠ€æœ¯æ ˆ","text":"åŸºç¡€çŸ¥è¯†ä¸‹é¢è¿™å¼ å›¾æ˜¯æå®¢æ—¶é—´è®²å¸ˆï¼šè’‹å®ä¼Ÿæ€»ç»“çš„RNéœ€è¦çš„åŸºç¡€çŸ¥è¯† ä»ä¸Šåˆ°ä¸‹ï¼Œåˆ†ä¸ºï¼š å¼€å‘è¯­è¨€ï¼Œæ¡†æ¶ï¼Œå·¥å…·ç­‰åŸºç¡€ RNçš„çŸ¥è¯†ï¼Œä¸»è¦æ˜¯ç»„ä»¶çš„å­¦ä¹  å®è·µ Reactæ¡†æ¶åŸºäºç»„ä»¶Reactæ˜¯åœ¨ 2013 å¹´æ­£å¼å¼€å§‹å¼€æºçš„ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œä¸šå†…çš„å¤§å¤šæ•° Web æ¡†æ¶éƒ½æ˜¯ MVC æ¡†æ¶ã€‚ MVC æ¡†æ¶è§£å†³äº†ä»£ç å¤§æ‚çƒ©çš„é—®é¢˜ï¼Œå®ƒæŠŠä»£ç åˆ†æˆäº†èŒè´£åˆ†æ˜çš„ä¸‰å±‚ï¼ŒM æŒ‡çš„æ˜¯æ•°æ®æ¨¡å‹ Modalï¼ŒV æŒ‡çš„è§†å›¾æ¨¡æ¿ Viewï¼ŒC æŒ‡çš„æ˜¯æ§åˆ¶å™¨ Controllerã€‚MVC å¼ºè°ƒçš„æ˜¯æ•°æ®ã€è§†å›¾å’Œé€»è¾‘ä¹‹é—´æ¾è€¦åˆï¼Œå…¶æ–‡ä»¶ç»“æ„ä¹Ÿæ˜¯æŒ‰è¿™ä¸‰ç±»åˆ†é—¨åˆ«ç±»åœ°ç»„ç»‡èµ·æ¥çš„ã€‚ å£°æ˜å¼å£°æ˜å¼ç¼–ç¨‹æ˜¯ä¸€ä¸ªå¤§çš„æ¦‚å¿µï¼Œé™¤äº†æˆ‘ä»¬å‰é¢æåˆ°äº† HTML æ‰€å±çš„é¢†åŸŸä¸“å±è¯­è¨€ï¼ˆDSLï¼‰ä¹‹å¤–ï¼Œè¿˜æœ‰å‡½æ•°å¼ç¼–ç¨‹ç­‰å­ç¼–ç¨‹èŒƒå¼ã€‚ç†Ÿæ‚‰ React çš„åŒå­¦å¯èƒ½å°±çŸ¥é“äº†ï¼ŒReact å€Ÿé‰´äº†å¤§é‡çš„å‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³ã€‚æ ¸å¿ƒåŸºç¡€ç¯‡ä¸­çš„å‡½æ•°ç»„ä»¶ã€hookï¼Œè¿˜æœ‰æˆ‘ä»¬åé¢è¦è®²çš„çŠ¶æ€ç®¡ç†å·¥å…· Redux å’Œæ–°æ¶æ„åŸç†ï¼Œéƒ½å¤§é‡ä½¿ç”¨äº†å‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³ æ ¸å¿ƒç»„ä»¶çš„æ ·å¼ Image Pressable TextInput List ä»¥ä¸Šé¢å››ä¸ªç»„ä»¶ä¸ºä¾‹ï¼Œå­¦ä¹ ç»„ä»¶çš„æ ·å¼ é¡¹ç›®å®è·µå®è·µæ‰èƒ½å°†æ‰€å­¦çš„çŸ¥è¯†å½»åº•å¤¯å®æˆä¸ºè‡ªå·±çš„æŠ€èƒ½ã€‚","link":"/2022/07/26/ReactNative%E5%AD%A6%E4%B9%A0%E4%B8%80-RN%E7%9A%84%E6%8A%80%E6%9C%AF%E6%A0%88/"},{"title":"ReactNativeå­¦ä¹ ä¸‰:æ ·å¼Style","text":"å‰è¨€ç»„ä»¶åªæ˜¯é¡µé¢çš„æ¶å­ï¼Œå¦‚æœä¸ä½¿ç”¨æ ·å¼ï¼Œå°±ä¼šå¹³é“ºåœ¨é¡µé¢ä¸Šï¼Œæ²¡æœ‰ä»€ä¹ˆä½“éªŒå¯è¨€ã€‚ React Nativeçš„ç»„ä»¶æ ·å¼æœ‰å“ªäº›?React Nativeçš„Flexå¸ƒå±€æœ‰å“ªäº›ç‰¹ç‚¹?React Naticeçš„æ ·å¼ä»£ç æ€ä¹ˆç®¡ç†? ä¸€ã€ç»„ä»¶æ ·å¼1.1 é€šç”¨æ ·å¼å¤§éƒ¨åˆ†çš„Reactç»„ä»¶éƒ½æœ‰æ ·å¼å±æ€§ï¼Œstyleï¼Œä¾‹å¦‚æ”¹å˜æ–‡å­— 1234// æ–‡å­—é¢œè‰²&lt;Text style={{color:'red'}}&gt;// åœ†è§’è¾¹æ¡†&lt;Text style={{borderColor:'gray',borderWidth:1,borderRadius:5}}&gt; ä¸‹å›¾æ˜¯å¸¸è§çš„é€šç”¨æ ·å¼å’Œç»„ä»¶æ ·å¼çš„ä¸€äº›ç»§æ‰¿å…³ç³» 1.2 ç§æœ‰æ ·å¼Viewçš„æ ·å¼ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯é€šç”¨æ ·å¼ï¼Œå¦‚Layoutã€Transformã€Shadowã€backgroundColorã€opacityã€‚åƒTextã€Imageã€é™¤äº†ç»§æ‰¿è‡ªViewçš„é€šç”¨æ ·å¼ä»¥å¤–ï¼Œè¿˜æœ‰å¦‚fontã€colorã€lineHeightç­‰ç­‰è¿™äº›æ ·å¼ï¼Œéƒ½å¯ä»¥è®¤ä¸ºæ˜¯ç§æœ‰æ ·å¼ äºŒã€Flexå¼¹æ€§å¸ƒå±€ è·¨å¹³å° ç¬¬ä¸€å±‚å«ä¹‰æ˜¯ Flex å¸ƒå±€å¹¶ä¸æ˜¯ React Native æ‰€ç‹¬æœ‰çš„ï¼Œåœ¨ Webã€Androidã€iOS å¹³å°ä¹Ÿéƒ½åœ¨ç”¨ è·¨å¹³å°çš„ç¬¬äºŒå±‚å«ä¹‰æ˜¯ï¼ŒReact Native çš„å¸ƒå±€å¼•æ“ Yoga æ˜¯ Androidã€iOS é€šç”¨çš„ é«˜æ€§èƒ½ ä½¿ç”¨ Yoga å®ç°çš„ FlexLayout å¸ƒå±€å¼•æ“æ¯”è‹¹æœå®˜æ–¹æä¾›äº† UIStackViews å’Œ Auto layout å¸ƒå±€å¼•æ“ï¼Œè€—æ—¶å‡å°‘äº†å°†è¿‘ä¸€ä¸ªé‡çº§ æ˜“ä¸Šæ‰‹ ä»ä¸Šå¾€ä¸‹çš„å¸ƒå±€æ ·å¼ï¼Œçˆ¶å®¹å™¨viewé»˜è®¤æ˜¯{display:&quot;flex&quot;,flexDirection:'column'}ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š12345&lt;View&gt;&lt;View style={{height: 50, backgroundColor: 'powderblue'}} /&gt;&lt;View style={{height: 50, backgroundColor: 'skyblue'}} /&gt;&lt;View style={{height: 50, backgroundColor: 'steelblue'}} /&gt;&lt;/View&gt; å·¦å›¾å³æ–‡å¸ƒå±€ã€‚123456789&lt;View style={{flexDirection: 'row'}}&gt; &lt;Image style={{width: 100, height: 100}} source={{ uri: 'https://placeimg.com/640/480/cats', }} /&gt; &lt;Text style={{flex: 1,fontSize: 18}}&gt;æˆ‘æ˜¯æ–‡å­—&lt;/Text&gt;&lt;/View&gt; æ–‡å­—å±…ä¸­å¸ƒå±€ 12345678910111213141516171819&lt;View style={{ alignItems: 'center', justifyContent: 'center', // é«˜åº¦ç¡®å®š height: 60, borderWidth: 1, }}&gt; &lt;Text style={{ fontSize: 18, // æ–‡å­—é»˜è®¤å†…è¾¹è·ï¼Œä¼šå¯¼è‡´å‚ç›´å±…ä¸­åä¸‹ includeFontPadding: false, // æ–‡å­—é»˜è®¤åŸºäºåŸºçº¿å¯¹é½ï¼Œä¼šå¯¼è‡´å‚ç›´å±…ä¸­åä¸‹ textAlignVertical: 'center', }}&gt; æˆ‘æ˜¯æ–‡å­—1 &lt;/Text&gt;&lt;/View&gt; ä¸‰ã€StyleSheet3.1 ä½¿ç”¨Stylesheetçš„å¥½å¤„ã€‚ å…ƒç´ ç»“æ„å’Œæ ·å¼åˆ†ç¦»ã€å¯ç»´æŠ¤æ€§å¥½ æ ·å¼å¯¹è±¡å¯ä»¥å¤ç”¨ï¼Œå‡å°‘é‡å¤ä»£ç  æ ·å¼ä»£ç åªåˆ›å»ºä¸€æ¬¡ï¼Œå‡å°‘æ€§èƒ½çš„æŸè€—3.2 æ²¡æœ‰ä½¿ç”¨stylesheetçš„æ ·å¼12345678910111213141516171819202122232425262728293031323334353637// å„ç§å†…è”ï¼Œå¯¼è‡´ JSX ç»“æ„ä¸æ¸…æ¥šã€‚&lt;View // æ™®é€šå±æ€§ hitSlop={ top: 10, bottom: 10, left: 0, right: 0 } // äº‹ä»¶å±æ€§ onLayout={() =&gt; { // äº‹ä»¶é€»è¾‘ }} // æ ·å¼å±æ€§ style={{ alignItems: 'center', justifyContent: 'center', height: 60, borderWidth: 1, }}&gt; &lt;Text style={{ fontSize: 18, includeFontPadding: false, textAlignVertical: 'center', }}&gt; æˆ‘æ˜¯æ–‡å­—1 &lt;/Text&gt; &lt;Text style={{ fontSize: 18, includeFontPadding: false, textAlignVertical: 'center', }}&gt; æˆ‘æ˜¯æ–‡å­—2 &lt;/Text&gt;&lt;/View&gt; 3.3 ä½¿ç”¨StyleSheetçš„æ ·å¼ä»£ç 123456789101112131415161718192021222324// JSX ç»“æ„&lt;View hitSlop={hitSlop} onLayout={handleLayout} style={styles.container}&gt; &lt;Text style={styles.texts}&gt;æˆ‘æ˜¯æ–‡å­—1&lt;/Text&gt; &lt;Text style={styles.texts}&gt;æˆ‘æ˜¯æ–‡å­—2&lt;/Text&gt;&lt;/View&gt;// æ ·å¼è¡¨const styles = StyleSheet.create({ container: { alignItems: 'center', justifyContent: 'center', height: 60, borderWidth: 1, }, texts: { fontSize: 18, includeFontPadding: false, textAlignVertical: 'center', }});","link":"/2022/07/29/ReactNative%E5%AD%A6%E4%B9%A0%E4%B8%89-%E6%A0%B7%E5%BC%8FStyle/"},{"title":"ReactNativeå­¦ä¹ äºŒ-Component","text":"æ­å»ºé™æ€é¡µé¢çš„åŸåˆ™å•ä¸€è´£ä»»åŸåˆ™æ¯ä¸ªç»„ä»¶éƒ½åº”è¯¥åªæœ‰ä¸€ä¸ªå•ä¸€çš„åŠŸèƒ½ï¼Œå¹¶ä¸”è¿™ä¸ªç»„ä»¶å’Œå…¶ä»–ç»„ä»¶æ²¡æœ‰ç›¸äº’ä¾èµ– åˆ†æä¸€æ®µä»£ç æ¥å­¦ä¹ ä¸€ä¸ªç»„ä»¶çš„åŸºæœ¬æ„æˆ 12345678export default function Product({product = {name: 'è‹¹æœ', price: '1å…ƒ'} }) { return ( &lt;View style={{flexDirection: 'row', marginTop: 5}}&gt; &lt;Text style={{flex: 1}}&gt;{product.name}&lt;/Text&gt; &lt;Text style={{width: 50}}&gt;{product.price}&lt;/Text&gt; &lt;/View&gt; );} ç¬¬ä¸€æ­¥ï¼Œå¯¼å‡ºç»„ä»¶ã€‚è¿˜è®°å¾—å•ä¸€è´£ä»»åŸåˆ™å—ï¼Ÿä¸€ä¸ªç»„ä»¶çš„è´£ä»»è¦å•ä¸€ï¼Œä¸€ä¸ªæ–‡ä»¶çš„è´£ä»»ä¹Ÿè¦å•ä¸€ã€‚å› æ­¤é€šå¸¸ä¸€ä¸ªæ–‡ä»¶ä¸­åªæœ‰ä¸€ä¸ªç»„ä»¶ï¼Œç”¨export defaultå°±å¯ä»¥å°†å®ƒå¯¼å‡ºï¼Œè®©å…¶ä»–æ–‡ä»¶importå¼•å…¥ä½¿ç”¨ã€‚ ç¬¬äºŒæ­¥ï¼Œå®šä¹‰å‡½æ•°ã€‚ç»„ä»¶æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ã€‚ç»„ä»¶åå­—çš„é¦–å­—æ¯ä¸€å®šæ˜¯å¤§å†™çš„ï¼Œç¤ºä¾‹ä¸­çš„Productæ˜¯ç»„ä»¶ï¼Œå› æ­¤å®ƒçš„ Pæ˜¯å¤§å†™çš„ï¼ˆå½“ç„¶ï¼Œè¿˜æœ‰ç±»ç»„ä»¶ï¼Œä½†ç”¨å¾—ä¼šè¶Šæ¥è¶Šå°‘ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸æ¢è®¨ï¼Œä½ å¯ä»¥è‡ªå·±é¢å¤–æœäº›èµ„æ–™ï¼‰ã€‚ ç¬¬ä¸‰æ­¥ï¼Œæ¥æ”¶å…¥å‚ã€‚ç»„ä»¶èƒ½ä»å…¶çˆ¶ç»„ä»¶ä¸­æ¥å‚æ•°ï¼Œè€Œä¸”ç»„ä»¶æ˜¯å‡½æ•°ï¼Œå› æ­¤è¯¥å‚æ•°å°±æ˜¯å‡½æ•°çš„å…¥å‚ï¼Œé€šå¸¸å‘½åä¸ºå±æ€§ propsã€‚props æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç›´æ¥å¯¹å®ƒè¿›è¡Œè§£æ„ï¼Œç›´æ¥è·å–å¯¹è±¡ä¸­çš„å€¼ã€‚ç¤ºä¾‹ä»£ç ä¸­ç”¨çš„å°±æ˜¯ç”¨è§£æ„çš„æ–¹å¼æ¥è·å–å‚æ•°çš„ï¼Œå®ƒç›´æ¥è·å–äº†productå‚æ•°ï¼Œè¿™é‡Œçš„product æ˜¯æ•°æ®å› æ­¤pæ˜¯å°å†™çš„ã€‚ ç¬¬å››æ­¥ï¼Œè¿”å› JSXã€‚ç»„ä»¶çš„è¿”å›å€¼å°±æ˜¯ JSXï¼Œæˆ‘ä»¬å‰é¢ä¹Ÿæåˆ°è¿‡ï¼Œå®ƒæ˜¯ç”¨æ¥æè¿° UI é¡µé¢çš„ï¼ŒJSX æœ€ç»ˆç”Ÿæˆçš„æ˜¯è§†å›¾å…ƒç´ ã€æ–‡å­—å…ƒç´ ã€‚è¿™é‡Œæˆ‘ä»¬åˆå§‹åŒ–äº†ä¸€ä¸ªå…ƒç´ ï¼Œå’Œä¸¤ä¸ªå…ƒç´ ã€‚ ç»„ä»¶çš„æ–‡ä»¶ç»“æ„123456789101112131415161718192021222324252627282930313233343536// index.jsAppRegistry.registerComponent('appName', () =&gt; App);// App.jsconst PRODUCTS = [ {category: 'æ°´æœ', price: 'ï¿¥1', name: 'PingGuo'},];export default function App() { return ( &lt;SafeAreaView style={{marginHorizontal: 30}}&gt; &lt;ProductTable products={PRODUCTS} /&gt; &lt;/SafeAreaView&gt; );}// ProductTable.jsimport Category from './Category';import Product from './Product';export default function ProductTable({products}){ // ... &lt;Category category={products[i].category} // ... &lt;Product product={products[i]} // ... }// Category.jsexport default function Category({category}){}// ProductTable.jsexport default function Product({product}) {} index.js æ–‡ä»¶ï¼šå®ƒæ˜¯æ ¹æ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­registerComponentæ–¹æ³•ï¼Œä¼šè°ƒç”¨æ ¹ç»„ä»¶ Appï¼Œç„¶åå¼€å§‹é€çº§è°ƒç”¨ï¼Œæ¸²æŸ“åº”ç”¨ï¼› App ç»„ä»¶ï¼šåœ¨ App ç»„ä»¶ä¸­ï¼Œç”¨äºè¡¨ç¤ºå•†å“ä¿¡æ¯çš„æ•°æ®å˜é‡ PRODUCTSï¼Œåœ¨è¢«è°ƒç”¨æ—¶ä¼šé€šè¿‡ ProductTable ç»„ä»¶çš„ products å±æ€§ä¼ é€’ä¸‹å»ï¼› ProductTable ç»„ä»¶ï¼šå®ƒè¢« App ç»„ä»¶è°ƒç”¨åï¼Œå®ƒçš„è°ƒç”¨å…¥å‚å°±æ˜¯ productsã€‚products æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹å°±æ˜¯ Productç»„ä»¶çš„å…¥å‚productã€‚æ¯ä¸€é¡¹ä¸­çš„åˆ†ç±»ï¼Œå°±æ˜¯Category ç»„ä»¶çš„å…¥å‚ categoryã€‚è¿˜æ˜¯ä¸€æ ·ï¼Œç»„ä»¶é¦–å­—æ¯æ˜¯å¤§å†™çš„ï¼Œå±æ€§ã€å…¥å‚çš„é¦–å­—æ¯æ˜¯å°å†™çš„ï¼› Category ç»„ä»¶ï¼šå®ƒä¼šè¢« ProductTable ç»„ä»¶è°ƒç”¨ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ¥æ”¶çš„å…¥å‚categoryæ˜¯â€œæ°´æœâ€ï¼Œç¬¬äºŒæ¬¡æ˜¯â€œè”¬èœâ€ï¼› Product ç»„ä»¶ï¼šå®ƒä¼šè¢« ProductTable ç»„ä»¶è°ƒç”¨ 6 æ¬¡ï¼Œç”Ÿæˆ 6 ä¸ªä¸åŒçš„å•†å“å…ƒç´ ï¼Œå±•ç¤ºåœ¨æ‰‹æœºå±å¹•ä¸Šã€‚ ç®€è€Œè¨€ä¹‹ï¼Œç»„ä»¶é—´çš„æ•°æ®æ˜¯å•å‘æµåŠ¨çš„ï¼Œæ˜¯é€å±‚å¾€ä¸‹ä¼ é€’","link":"/2022/07/27/ReactNative%E5%AD%A6%E4%B9%A0%E4%BA%8C-Component/"},{"title":"ReactNativeå­¦ä¹ å››:State","text":"å¦‚ä½•è®©é¡µé¢åŠ¨èµ·æ¥ï¼Ÿå¦‚å›¾æ˜¯ä¸€ä¸ªç®€å•çš„è´­ç‰©è½¦é¡µé¢çš„UIï¼Œåˆ†åˆ«ç”¨æ¥å±•ç¤ºå•†å“çš„åç§°ã€ä»·æ ¼å’Œæ•°é‡ã€‚ é€‰æ‹©çŠ¶æ€è¿™ä¸ªé¡µé¢éœ€è¦ä¸€ä¸ªæ ‡ç¤ºé¡µé¢è¯·æ±‚æ­£å¸¸orå¤±è´¥çš„çŠ¶æ€ï¼Œè¿™é‡Œä½¿ç”¨æšä¸¾å€¼ 123456const RequestStatus = { IDLE = 'IDLE', PENDING = 'PENDING', SUCCESS = 'SUCCESS', ERROR = 'ERROR'} æ­¤å¤–è¿˜éœ€è¦ä¸€ä¸ªåˆ—è¡¨å¯¹è±¡ç”¨æ¥å±•ç¤ºæ•°æ®,é‡‡ç”¨ 1const [products, setProduct] = useState([]); å³ä¸€ä¸ªæšä¸¾å’Œä¸€ä¸ªæ•°ç»„æ¥å±•ç¤ºé¡µé¢ã€‚ çŠ¶æ€æ›´æ–°åŸºç¡€æ•°æ®ç±»å‹çš„çŠ¶æ€æ›´æ–°è¿˜æ˜¯çœ‹ä¸‹é¢çš„ä»£ç ï¼Œä»¥æ›´æ–°æ•°é‡ä¸ºä¾‹ï¼Œé¦–å…ˆæ³¨å†Œäº†çŠ¶æ€ â€œcountâ€,ç„¶ååœ¨ç»„ä»¶çš„è¿”å›å‡½æ•°é‡Œé¢ï¼Œé€šè¿‡æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼Œè°ƒç”¨setCount(count+1)ï¼Œæ¥è¾¾åˆ°æ›´æ–°countå€¼çš„æ•ˆæœã€‚ 12345678910export default function count(){ const [count ,setCount] = useState(0); return { &lt;View&gt; &lt;Text&gt;{count}&lt;/Text&gt; &lt;Button title=&quot;+&quot; onPress={()=&gt;setCount(count + 1)}&gt;&lt;/Button&gt; &lt;Button title=&quot;-&quot; onPress={()=&gt;setCount((count-1)&gt;0? count-1 : 0)}&gt; &lt;/View&gt; };} å¼•ç”¨æ•°æ®ç±»å‹çš„çŠ¶æ€æ›´æ–°å¼•ç”¨æ•°æ®ç±»å‹çš„æ›´æ–°ï¼Œ éœ€è¦å…ˆææ„åŸæ•°æ®å¯¹è±¡ï¼Œç„¶åå†é‡æ–°èµ‹å€¼ï¼Œæ‰å¯è¾¾åˆ°æ›´æ–°çš„æ•ˆæœï¼Œå¯¹è±¡ææ„çš„å†™æ³•...countObjects 12345setCountObject({...countObject, num: countObject.num+1});const newCountArray = [...newCountArray]newCountArray[0]++;setCountArray(newCountArray) åŠ è½½å›¾ç‰‡ ä½¿ç”¨æ–¹æ³• åº•å±‚scheme ä½¿ç”¨å»ºè®® ä½¿ç”¨åœºæ™¯ é™æ€å›¾ç‰‡èµ„æº require(â€˜./dianxinâ€™) file// è·Ÿéšbundleå‹ç¼©åŒ…ä¸‹å‘ å…³é”®å›¾ç‰‡ ç½‘ç»œå›¾ç‰‡ {uri:â€™https://cdn.dianxin.com/..,.png'} http æˆ– https è‡ªç ”å›¾ç‰‡ç®¡ç†å·¥å…· å¤§éƒ¨åˆ†åœºæ™¯ å®¿ä¸»åº”ç”¨å›¾ç‰‡ uri:â€™dainxinâ€™ file://æˆ– asset:// ä¸å»ºè®® å¤ç”¨åœºæ™¯ Base64å›¾ç‰‡ â€˜uriâ€™:â€™data:image/jpeg,base64â€¦..â€™ data:mime/type;base64 è‡ªç ”å›¾ç‰‡ç®¡ç†å·¥å…· å°å›¾æˆ–è€…å…³é”®å›¾","link":"/2022/07/29/ReactNative%E5%AD%A6%E4%B9%A0%E5%9B%9B-State/"},{"title":"ReactNativeæ–°æ¶æ„åˆ†äº«","text":"RNçš„å‰ä¸–ä»Šç”Ÿ123React Nativeæ˜¯2013å¹´åœ¨facebookçš„å†…éƒ¨é»‘å®¢é©¬æ‹‰æ¾ä¸­è¯ç”Ÿçš„ã€‚åˆ°ä»Šå¹´2022å¹´æ–°æ¶æ„ï¼Œå·²ç»æ•´æ•´10å¹´ã€‚ ### RNé€‚ç”¨ä»€ä¹ˆåœºæ™¯ * ä¸šåŠ¡æ›´æ–°è¿­ä»£è¾ƒå¿«çš„å›¢é˜Ÿä¸å‡ºæµ·å›¢é˜Ÿã€‚ * æ—¢è¦æ”¯æŒåŠ¨æ€æ›´æ–°ï¼Œåˆè¦æ”¯æŒå¤æ‚ä¸šåŠ¡çš„åœºæ™¯ã€‚ ä¸ºä»€ä¹ˆè¦å­¦ä¹  React Native ï¼Ÿ React Native æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„è·¨ç«¯æ¡†æ¶ï¼Œå¼€å‘è€…è®¤å¯åº¦å¾ˆé«˜ 2. React Native æ˜¯ä¸€ä¸ªè·¨é¢†åŸŸçš„èåˆæŠ€æœ¯ï¼Œå®ƒæ˜¯ä½ ç°æœ‰æŠ€æœ¯çš„è‡ªç„¶å»¶ä¼¸ã€‚3. æ›´ä¸ºé‡è¦çš„æ˜¯ï¼Œä»Šå¹´RNå°†ä¼šå‘å¸ƒæ–°æ¶æ„ã€‚æ–°æ¶æ„å°†å¸¦æ¥ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢çš„ä¼˜åŠ¿ React Native æ–°æ¶æ„çš„å¯åŠ¨æ€§èƒ½ä¼šæœ‰ 2 å€å·¦å³çš„æå‡ã€‚ React Native æ–°æ¶æ„çš„é€šä¿¡æ€§èƒ½ä¼šæœ‰ 3 å€å·¦å³çš„æå‡ã€‚ React Native æ–°æ¶æ„çš„æ¸²æŸ“æµæ°´æœ‰äº†å¾ˆå¤§çš„å˜åŒ–ï¼Œè¿™ä¼šå¸¦æ¥æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ RNçš„æŠ€æœ¯æ ˆä¸‹å›¾æ˜¯RNä¼šæ¶‰åŠåˆ°çš„çŸ¥è¯†å›¾è°± åºå· å†…å®¹ 1 å¼€å‘è¯­è¨€ã€React æ¡†æ¶ã€å¼€å‘å¿…å¤‡å·¥å…·è¿™äº›é¢„å¤‡çŸ¥è¯† 2 React Native æœ¬èº«çš„çŸ¥è¯†ï¼Œ ç»„ä»¶ç­‰ 3 å·¥ä½œæµä¸­çš„å®æ“çŸ¥è¯† å¦‚ä½•æ­å»ºä¸€ä¸ªRNé¡µé¢RNæ˜¯åŸºäºç»„ä»¶æ¥æ„å»ºåº”ç”¨çš„ï¼Œæ‰€ä»¥æ„æˆé¡µé¢çš„æœ€å°å…ƒç´ æ˜¯å³æ˜¯ç»„ä»¶. åŸºæœ¬åŸåˆ™UIç¨¿æ‹†åˆ†åŸåˆ™:å•ä¸€è´£ä»»åŸåˆ™ æ­å»ºå…ƒç´  é€šè¿‡å®¿ä¸»ç»„ä»¶æ¥æ‰¿è½½UIç¨¿ä¸Šé¢çš„å…ƒç´ ï¼Œè¿™äº›å®¿ä¸»ç»„ä»¶åŒ…æ‹¬æ–‡æœ¬ã€å›¾ç‰‡ã€æŒ‰é’®ã€åˆ—è¡¨ç­‰ç­‰å‘¢ä¸ªï¼Œè¿™äº›ç»„ä»¶éƒ½æ˜¯ç›´æ¥ç”±iOS/AndriodåŸç”Ÿå¹³å°ç”Ÿæˆçš„ æ•´ä½“æ€è·¯æ˜¯ï¼Œä»ä¸Šå¾€ä¸‹æ‹†å‡ºç»„ä»¶ï¼Œä»ä¸‹å¾€ä¸ŠæŠŠæ‹†å‡ºæ¥çš„ç»„ä»¶è¿›è¡Œé€ä¸€å®ç°å’Œæ‹¼è£… RNçš„æ ·å¼ é€šç”¨æ ·å¼ viewç»„ä»¶æ ·å¼ å…¶ä»–æ ·å¼ 1234// æ–‡å­—é¢œè‰²&lt;Text style={{color:'red'}}&gt;// åœ†è§’è¾¹æ¡† &lt;Text style={{borderColor:'green', borderWidth: 1, borderRadius: 5}}&gt; å¦‚ä½•å¸ƒå±€ï¼Ÿï¼ŸFlexï¼šè·¨å¹³å°ã€é«˜æ€§èƒ½ã€æ˜“ä¸Šæ‰‹ å†…è”æ ·å¼å’Œæ ·å¼è¡¨ï¼Œ stylessheetçš„ä¸‰ä¸ªå¥½å¤„ å…ƒç´ ç»“æ„å’Œæ ·å¼åˆ†ç¦»ï¼Œå¯ç»´æŠ¤æ€§æ›´å¥½ï¼› æ ·å¼å¯¹è±¡å¯ä»¥å¤ç”¨ï¼Œèƒ½å‡å°‘é‡å¤ä»£ç ï¼› æ ·å¼å¯¹è±¡åªåˆ›å»ºä¸€æ¬¡ï¼Œä¹Ÿå‡å°‘æ€§èƒ½çš„æŸè€—ã€‚ åŠ¨æ€é¡µé¢RNçš„é¡µé¢ï¼Œç”¨å®¿ä¸»ç»„ä»¶æ­å»ºå®Œæˆä¹‹åï¼Œè¿˜æ˜¯ä¸€ä¸ªé™æ€çš„é¡µé¢ï¼Œå¦‚æœè¦è®©é¡µé¢å±•ç¤ºä¸åŒçš„å†…å®¹ï¼Œè¿˜éœ€è¦ä½¿ç”¨UseState()æ¥è¿›è¡Œé¡µé¢çš„åˆ·æ–°,ä¸‹é¢çš„ä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„æ§åˆ¶æ•°é‡çš„ç»„ä»¶ 12345678910export default function Count() { const [count, setCount] = useState(0); return ( &lt;View&gt; &lt;Text&gt;{count}&lt;/Text&gt; &lt;Button title=&quot;+&quot; onPress={() =&gt; setCount(count + 1)} /&gt; &lt;Button title=&quot;-&quot; onPress={() =&gt; setCount(count - 1 &gt;=0? count - 1: 0)} /&gt; &lt;/View&gt;)}; å›¾ç‰‡çš„åŠ è½½ é™æ€å›¾ç‰‡åŠ è½½ 123// æ–¹æ¡ˆä¸€ï¼šæ­£ç¡®const dianxinIcon = require('./dianxin.jpg')&lt;Image source={dianxinIcon}/&gt; ç½‘ç»œå›¾ç‰‡åŠ è½½ 123// å»ºè®®&lt;Image source={{uri: 'https://reactjs.org/logo-og.png'}} style={{width: 400, height: 400}} /&gt; base64å›¾ç‰‡åŠ è½½ 12345&lt;Image source={{ uri: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAzCAYAAAA6oTAqAAAAEXRFWHRTb2Z0d2FyZQBwbmdjcnVzaEB1SfMAAABQSURBVGje7dSxCQBACARB+2/ab8BEeQNhFi6WSYzYLYudDQYGBgYGBgYGBgYGBgYGBgZmcvDqYGBgmhivGQYGBgYGBgYGBgYGBgYGBgbmQw+P/eMrC5UTVAAAAABJRU5ErkJggg==' }}/&gt; å®¿ä¸»åº”ç”¨å›¾ç‰‡ 123// Android drawable æ–‡ä»¶ç›®å½•// iOS asset æ–‡ä»¶ç›®å½•&lt;Image source={{ uri: 'app_icon' }} /&gt;","link":"/2022/08/22/ReactNative%E6%96%B0%E6%9E%B6%E6%9E%84%E5%88%86%E4%BA%AB/"},{"title":"SDWebImageå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰","text":"ç®€ä»‹SDWebImageæ˜¯ioså¼€å‘ä¸­ï¼Œæœ€å¸¸è§çš„å›¾ç‰‡åŠ è½½æ¡†æ¶ï¼Œå®ƒä¸»è¦å®ç°äº†å›¾ç‰‡å¼‚æ­¥åŠ è½½ã€å›¾ç‰‡ç¼“å­˜ï¼Œå¹¶æä¾›äº†UIImageViewã€UIButtonã€MKAnnotationviewçš„ç±»ç›®ï¼Œä½¿ç”¨ä½“éªŒå¾ˆå‹å¥½ï¼Œä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œæˆä¸ºå¹¿å¤§ioså¼€å‘è€…åŠ è½½ç½‘ç»œå›¾ç‰‡çš„é€‰æ‹©ï¼Œä»Šå¤©æˆ‘ä¸»è¦æ˜¯æ¥é€šè¿‡åˆ†æå…¶æºç æ¥ç ”ç©¶ä¸‹ï¼ŒSDWebimageåˆ°åº•æ˜¯å¦‚ä½•è¿›è¡Œè®¾è®¡çš„ï¼Œæ¶æ„çš„? ç‰¹æ€§ æä¾›UIimageviewã€UIbuttonã€MKAnnotationviewçš„ç±»ç›®åŠ è½½ç½‘ç»œå›¾ç‰‡åŠç¼“å­˜ç®¡ç† å¼‚æ­¥çš„å›¾ç‰‡ä¸‹è½½ å¼‚æ­¥çš„å›¾ç‰‡å†…å­˜+ç£ç›˜å›¾ç‰‡ç¼“å­˜ï¼Œå¹¶æ”¯æŒè‡ªåŠ¨çš„ç¼“å­˜è¿‡æœŸå¤„ç† å›¾ç‰‡çš„åå°è§£å‹ ç¡®ä¿åŒä¸€ä¸ªurlä¸ä¼šä¸‹è½½å¤šæ¬¡ï¼ˆæ˜¯ä¼˜ç‚¹ä¹Ÿæ˜¯ç¼ºç‚¹ï¼‰ é”™è¯¯çš„urlä¸ä¼šä¸åœçš„ä¸‹è½½ æ°¸è¿œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ æ€§èƒ½æå‡ é‡‡ç”¨GCDå’ŒARC æ”¯æŒçš„å›¾ç‰‡æ ¼å¼ æ”¯æŒJPEG,PNG,GIF æ”¯æŒWEBP ä½¿ç”¨è¦æ±‚ ios 7.0 + tvos 9.0 + watchos 2.0 + osx 10.8 + xcode 7.3 + å¸¸è§é—®é¢˜ å¦‚æœUITableViewCellä½¿ç”¨äº†åŠ¨æ€çš„å›¾ç‰‡å¤§å°ï¼Œå›¾ç‰‡å±•ç¤ºå¯èƒ½ä¼šæœ‰é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´SDWebImageæ˜¯æ ¹æ®placeholderçš„å¤§å°æ¥è®¾ç½®UIImageViewçš„å¤§å°çš„ï¼Œå¦‚æœè¦å±•ç¤ºçš„å›¾ç‰‡å¤§å°å’Œplaceholderçš„å›¾ç‰‡å¤§å°ä¸ä¸€è‡´å°±ä¼šæœ‰ä¸€äº›é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆç‚¹å‡»è¿™é‡Œ æ‰‹åŠ¨å»åˆ·æ–°å›¾ç‰‡ï¼ŒSDWebImageä½¿ç”¨äº†æš´åŠ›çš„å›¾ç‰‡ç¼“å­˜æ–¹å¼ï¼Œä¸ä¼šå…³æ³¨HTTP çš„headeré‡Œé¢ç¼“å­˜çš„ç­–ç•¥ï¼Œç›´æ¥æ ¹æ®å›¾ç‰‡çš„URLåœ°å€è¿›è¡Œç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªURLä¼šå¯¹åº”ä¸€å¼ å›¾ç‰‡ï¼Œå¦‚æœå›¾ç‰‡åœ°å€ä¸å‘ç”Ÿå˜åŒ–çš„è¯ï¼Œå›¾ç‰‡æ°¸è¿œä¸ä¼šé‡æ–°ä¸‹è½½ï¼Œå› æ­¤åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä½ éœ€è¦æ‰‹åŠ¨å»åˆ·æ–°å›¾ç‰‡ã€‚ æ¶æ„å›¾ æ­£æ–‡ä¸Šæ–‡æ˜¯SDWebImageViewå®˜æ–¹çš„ä¸€äº›æ–‡æ¡£ï¼Œæˆ‘è¿™é‡Œç»™ç®€è¦çš„ç¿»è¯‘äº†ä¸‹ï¼Œå¯ä»¥çœ‹çš„å‡ºæ¥ï¼ŒSDWebImageè™½ç„¶åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯ä¾ç„¶è¿˜æ˜¯æœ‰ä¸€äº›ä½¿ç”¨ä¸­å­˜åœ¨çš„é—®é¢˜ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä¼šé€šè¿‡é€ä¸ªåˆ†æä»£ç çš„æ–¹å¼ï¼Œå°†SDWebImageViewä»ä¸‹è½½ã€ç¼“å­˜ã€ç®¡ç†ç­‰ç­‰ä¸€å±‚ä¸€å±‚å‰¥å¼€å®ƒç¥ç§˜çš„é¢çº±ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘å°½é‡é¿å…è¿‡å¤šçš„çº ç»“äºä¸€äº›ç»†èŠ‚ï¼Œä½†æ˜¯åŒæ ·çš„ï¼Œæœ‰äº›æ—¶å€™ä¸ºäº†è¯´æ˜ä¸€äº›é—®é¢˜ï¼Œéš¾å…ä¹Ÿä¼šè´´ä¸€äº›ä»£ç ã€‚ ä¸‹è½½SDWebimageviewçš„ä¸‹è½½æ˜¯é€šè¿‡NSURLSessionçš„æ–¹å¼ï¼Œå¹¶é€šè¿‡ç»§æ‰¿NSOperationæ¥å¼‚æ­¥çš„è¿›è¡Œä¸‹è½½ã€‚ä¸‹è½½è¿‡ç¨‹ä¸­æ˜¯é€šè¿‡å‘é€é€šçŸ¥çš„æ–¹å¼è¿›è¡Œæ¶ˆæ¯é€šä¿¡ã€‚ 1234NSString *const SDWebImageDownloadStartNotification = @&quot;SDWebImageDownloadStartNotification&quot;;NSString *const SDWebImageDownloadReceiveResponseNotification = @&quot;SDWebImageDownloadReceiveResponseNotification&quot;;NSString *const SDWebImageDownloadStopNotification = @&quot;SDWebImageDownloadStopNotification&quot;;NSString *const SDWebImageDownloadFinishNotification = @&quot;SDWebImageDownloadFinishNotification&quot;; SDWebImageDownloaderOperationä»»åŠ¡çš„åˆ›å»ºåŠå–æ¶ˆ SDWebImageDownloaderOperationé€šè¿‡ç¡®è®¤ä¸‹é¢çš„è¿™ä¿©ä¸ªåè®®å®é™…ä¸Šæ‰§è¡Œä¸‹è½½å›¾ç‰‡çš„å·¥ä½œï¼Œæ¥ä¸‹æ¥å°±ç ”ç©¶ä¸‹å…¶å†…éƒ¨æ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚ 123456789101112131415161718192021222324@protocol SDWebImageDownloaderOperationInterface&lt;NSObject&gt;//é€šè¿‡è¯¥æ–¹æ³•è¿›è¡ŒOpearationçš„åˆ›å»º- (nonnull instancetype)initWithRequest:(nullable NSURLRequest *)request inSession:(nullable NSURLSession *)session options:(SDWebImageDownloaderOptions)options;//æ·»åŠ ä¸‹è½½è¿‡ç¨‹ä¸­éœ€è¦çš„å›è°ƒï¼Œä¸»è¦åŒ…æ‹¬ä¸‹è½½è¿›åº¦ã€ä¸‹è½½å®Œæˆçš„å›è°ƒ- (nullable id)addHandlersForProgress:(nullable SDWebImageDownloaderProgressBlock)progressBlock completed:(nullable SDWebImageDownloaderCompletedBlock)completedBlock;//æ˜¯å¦æ”¯æŒè§£å‹å›¾ç‰‡- (BOOL)shouldDecompressImages;//è®¾ç½®æ˜¯å¦æ”¯æŒè§£å‹å›¾ç‰‡- (void)setShouldDecompressImages:(BOOL)value;//URLé‰´å®š- (nullable NSURLCredential *)credential;//è®¾ç½®URLé‰´å®š- (void)setCredential:(nullable NSURLCredential *)value;@end@protocol SDWebImageOperation &lt;NSObject&gt;- (void)cancel;@end SDWebImageDownloaderOperationä»»åŠ¡çš„åˆå§‹åŒ–ä»¥åŠä»»åŠ¡çš„æ‰§è¡Œå¿½ç•¥æ‰é‚£äº›ç»†èŠ‚ï¼Œè¿™é‡Œåªå…³æ³¨å…³é”®çš„å‡ ä¸ªåœ°æ–¹ï¼ŒSDWebImageDownloaderOperationï¼Œä»¥ä¸‹ç®€ç§°â€˜ä¸‹è½½æ“ä½œå¯¹è±¡â€™ï¼Œé€šè¿‡æŒæœ‰Requestï¼Œæ³¨å…¥sessionï¼Œä»¥åŠoptionsï¼Œåˆ›å»ºå¥½ä¸‹è½½æ“ä½œå¯¹è±¡ã€‚ä¹‹åé€šè¿‡å¤–éƒ¨è°ƒç”¨startæ–¹æ³•ï¼Œå¼€å¯ä¸‹è½½ä»»åŠ¡ã€‚å¹¶é€šè¿‡è®¾ç½®sessionä»»åŠ¡çš„ä»£ç†ï¼Œæ¥ç›‘å¬ä¸‹è½½è¿‡ç¨‹ï¼ŒåŒæ—¶å‘å‡ºç›¸åº”çš„é€šçŸ¥è¿›è¡Œå¯¹è±¡é—´çš„æ¶ˆæ¯é€šä¿¡ã€‚ åˆå§‹åŒ–1234567891011121314151617- (nonnull instancetype)initWithRequest:(nullable NSURLRequest *)request inSession:(nullable NSURLSession *)session options:(SDWebImageDownloaderOptions)options { if ((self = [super init])) { _request = [request copy]; _shouldDecompressImages = YES; _options = options; _callbackBlocks = [NSMutableArray new]; _executing = NO; _finished = NO; _expectedSize = 0; _unownedSession = session; responseFromCached = YES; // Initially wrong until `- URLSession:dataTask:willCacheResponse:completionHandler: is called or not called _barrierQueue = dispatch_queue_create(&quot;com.hackemist.SDWebImageDownloaderOperationBarrierQueue&quot;, DISPATCH_QUEUE_CONCURRENT); } return self;} æ‰§è¡Œä»»åŠ¡12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576- (void)start { @synchronized (self) { if (self.isCancelled) { self.finished = YES; [self reset]; return; }#if SD_UIKIT Class UIApplicationClass = NSClassFromString(@&quot;UIApplication&quot;); BOOL hasApplication = UIApplicationClass &amp;&amp; [UIApplicationClass respondsToSelector:@selector(sharedApplication)]; //å¯¹åå°ä¸‹è½½ä»»åŠ¡çš„æ”¯æŒï¼Œappå¯ä»¥å¼€å¯åå°ä¸‹è½½ä»»åŠ¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªåå°ä¸‹è½½çš„IDï¼Œå¹¶è®¾ç½®ä¸€ä¸ªè¿‡æœŸçš„callbackï¼Œæ­¤å¤„æ³¨æ„å½“ä»»åŠ¡å¤±æ•ˆçš„æ—¶å€™ï¼Œéœ€è¦å°†ä»»åŠ¡ç»ˆæ­¢ï¼Œå¹¶è®¾ç½®taskidä¸ºæ— æ•ˆ if (hasApplication &amp;&amp; [self shouldContinueWhenAppEntersBackground]) { __weak __typeof__ (self) wself = self; UIApplication * app = [UIApplicationClass performSelector:@selector(sharedApplication)]; self.backgroundTaskId = [app beginBackgroundTaskWithExpirationHandler:^{ __strong __typeof (wself) sself = wself; if (sself) { [sself cancel]; [app endBackgroundTask:sself.backgroundTaskId]; sself.backgroundTaskId = UIBackgroundTaskInvalid; } }]; }#endif //é»˜è®¤æ˜¯æœ‰æ³¨å…¥sessionï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œéœ€è¦å†…éƒ¨åˆ›å»ºä¸€ä¸ªsession NSURLSession *session = self.unownedSession; if (!self.unownedSession) { NSURLSessionConfiguration *sessionConfig = [NSURLSessionConfiguration defaultSessionConfiguration]; sessionConfig.timeoutIntervalForRequest = 15; /** * Create the session for this task * We send nil as delegate queue so that the session creates a serial operation queue for performing all delegate * method calls and completion handler calls. */ self.ownedSession = [NSURLSession sessionWithConfiguration:sessionConfig delegate:self delegateQueue:nil]; session = self.ownedSession; } //æ­¤å¤„æ ¹æ®å½“å‰çš„sessionå’Œrequeståˆ›å»ºdatatask self.dataTask = [session dataTaskWithRequest:self.request]; self.executing = YES; } //datataskå¼€å§‹å·¥ä½œ [self.dataTask resume]; if (self.dataTask) { //é€šçŸ¥æ‰€æœ‰ç›‘å¬å›è°ƒï¼Œä»»åŠ¡å¼€å§‹æ‰§è¡Œäº†ã€‚ä¿©ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯callbackæ–¹å¼ï¼Œä¸€ç§æ˜¯é€šçŸ¥ for (SDWebImageDownloaderProgressBlock progressBlock in [self callbacksForKey:kProgressCallbackKey]) { progressBlock(0, NSURLResponseUnknownLength, self.request.URL); } dispatch_async(dispatch_get_main_queue(), ^{ [[NSNotificationCenter defaultCenter] postNotificationName:SDWebImageDownloadStartNotification object:self]; }); } else { //å¯¹å¼‚å¸¸æƒ…å†µçš„å¤„ç†ï¼Œå¦‚æœdatataskä¸ºnilï¼Œè¿›è¡Œé”™è¯¯çš„å›è°ƒ [self callCompletionBlocksWithError:[NSError errorWithDomain:NSURLErrorDomain code:0 userInfo:@{NSLocalizedDescriptionKey : @&quot;Connection can't be initialized&quot;}]]; }#if SD_UIKIT Class UIApplicationClass = NSClassFromString(@&quot;UIApplication&quot;); if(!UIApplicationClass || ![UIApplicationClass respondsToSelector:@selector(sharedApplication)]) { return; } if (self.backgroundTaskId != UIBackgroundTaskInvalid) { UIApplication * app = [UIApplication performSelector:@selector(sharedApplication)]; [app endBackgroundTask:self.backgroundTaskId]; self.backgroundTaskId = UIBackgroundTaskInvalid; }#endif} æ¥ä¸‹æ¥å°±æ˜¯NSURLSessionä»»åŠ¡çš„å¼€å¯ã€æ‰§è¡Œä¸­ã€ç»“æŸæˆ–è€…é”™è¯¯å›è°ƒè¿™é‡Œå°±ä¸å»è´´ä»£ç äº†ï¼Œè¦ä¸ç„¶è¿™ç¯‡åšæ–‡å¾ˆå¤§ç¯‡å¹…éƒ½è¢«ä»£ç å æ®äº†ï¼Œå…¶å®ä»»åŠ¡æ‰§è¡Œå¼€å§‹ä¹‹åï¼Œä¸»è¦å°±æ˜¯å„ç§å¼‚å¸¸çš„å¤„ç†ï¼Œå› ä¸ºæ­£å¸¸çš„å¤„ç†å…¶å®æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä¹‹åå°±ä¼šå›è°ƒåˆ°å¤–é¢å»ï¼Œè®©å¤–é¢è°ƒç”¨â€˜ä¸‹è½½æ“ä½œå¯¹è±¡â€™å»å†³å®šåˆ°åº•è¯¥å¦‚ä½•å¤„ç†ã€‚ï¼ˆè¡¥å……ï¼šç»è¿‡åé¢å¯¹SDWebImageDownloaderçš„æ·±å…¥ç ”ç©¶ï¼Œå‘ç°SDWebImageDownloaderOperationåˆ›å»ºå¥½ä¹‹åï¼Œç›´æ¥æ‰”åˆ°SDWebImageDownloaderçš„é˜Ÿåˆ—é‡Œé¢å»äº†ï¼Œæ­¤å¤–sessionç”±äºæ˜¯æ³¨å…¥çš„ï¼Œä»£ç†è®¾ç½®çš„æ˜¯SDWebImageDownloaderï¼Œå›è°ƒè‡ªç„¶ä¹Ÿç”±SDWebImageDownloaderæ¥æ”¶ï¼Œç„¶ååˆ†å‘ç»™å„è‡ªå¯¹åº”çš„SDWebImageDownloaderOperationï¼‰ SDWebImageDownloaderå¯¹ä¸‹è½½ä»»åŠ¡çš„å°è£…SDWebImageDownloaderæ˜¯å¯¹SDWebImageDownloaderOperationçš„è¿›ä¸€æ­¥ç®¡ç†å’Œå°è£…ï¼Œé€šè¿‡ä¸‹è½½é˜Ÿåˆ—å¯¹SDWebImageDownloaderOperationçš„ä»»åŠ¡å¹¶å‘æ•°(é»˜è®¤å¹¶å‘æ•°ä¸º6ä¸ª)ï¼Œæ‰§è¡Œé¡ºåºï¼ˆé»˜è®¤æ˜¯FIFOï¼‰è¿›è¡Œç®¡ç†ã€‚è¿™é‡Œæˆ‘ç®€å•æ¢³ç†ä¸‹ä»»åŠ¡çš„ä¸‹è½½æµç¨‹ clientï¼ˆæ­¤å¤„æŒ‡çš„æ˜¯ä½¿ç”¨SDWebImageDownloaderçš„å®¢æˆ·ï¼Œå¯ä»¥æ˜¯ç”¨æˆ·è‡ªå·±çš„ç±»ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–SDWebImageç±»ï¼‰é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªSDWebImageDownloaderï¼Œåˆ›å»ºå¥½ä¹‹åï¼Œå°±å‡†å¤‡å¥½äº†ä¸‹è½½éœ€è¦çš„downloadQueueï¼Œä¸‹è½½ç›¸å…³çš„ä¸€äº›é…ç½®ï¼ˆè¯¸å¦‚æ‰§è¡Œé¡ºåºã€å¹¶å‘æ•°ã€è¶…æ—¶ç­‰ç­‰ï¼‰ã€‚ clientä¹‹åè°ƒç”¨SDWebImageDownloaderçš„downloadImageWithURL:options:progress:completed:è¿›è¡Œå®é™…çš„ä¸‹è½½æ“ä½œã€‚åœ¨è¿™é‡Œæˆ‘æœ‰ä¸€ä¸ªç–‘æƒ‘äº†å¥½ä¹…çš„é—®é¢˜ï¼Œå°±æ˜¯sessionçš„å›è°ƒé—®é¢˜ï¼Œå› ä¸ºSDWebImageDownloaderOperationé‡Œé¢æœ‰sessionï¼Œè€ŒSDWebImageDownloaderä¹Ÿæœ‰sessionï¼Œé‚£ä¹ˆä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå²‚ä¸æ˜¯ä¿©å¤„éƒ½ä¼šæ”¶åˆ°å›è°ƒï¼Ÿè¿™éš¾é“æ˜¯SDWebImageçš„BUGï¼Ÿå‘µå‘µï¼Œå…¶å®å¹¶ä¸æ˜¯ï¼Œç›´åˆ°æˆ‘çœ‹åˆ°ä¸‹é¢è¿™æ®µä»£ç ã€‚123456789101112131415161718NSURLSession *session = self.unownedSession;if (!self.unownedSession) { NSURLSessionConfiguration *sessionConfig = [NSURLSessionConfiguration defaultSessionConfiguration]; sessionConfig.timeoutIntervalForRequest = 15; /** * Create the session for this task * We send nil as delegate queue so that the session creates a serial operation queue for performing all delegate * method calls and completion handler calls. */ //æ³¨æ„è¿™é‡Œï¼Œåªæœ‰ownedSessionæ‰ä¼šè®¾ç½®ä»£ç†ä¸ºè‡ªå·±ï¼Œä¹Ÿå°±æ˜¯è¯´æ³¨å…¥çš„sessionä¸ä¼šè®¾ç½®ä»£ç†ã€‚ self.ownedSession = [NSURLSession sessionWithConfiguration:sessionConfig delegate:self delegateQueue:nil]; session = self.ownedSession;}self.dataTask = [session dataTaskWithRequest:self.request]; çœ‹äº†ä¸Šé¢çš„ä»£ç è‡ªç„¶å°±æ˜ç™½äº†ï¼Œå½“ä½¿ç”¨SDWebImageDownloaderçš„æ—¶å€™ï¼Œsessionçš„å›è°ƒåªæœ‰SDWebImageDownloaderèƒ½æ¥æ”¶åˆ°ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆSDWebImageDownloaderéœ€è¦åœ¨æ¥æ”¶åˆ°å›è°ƒä¹‹åè¦è¿›è¡Œè½¬å‘çš„ç¼˜æ•…ã€‚ SDWebImageDownloaderçš„åˆå§‹åŒ–1234567891011121314151617181920212223242526272829303132- (nonnull instancetype)initWithSessionConfiguration:(nullable NSURLSessionConfiguration *)sessionConfiguration { if ((self = [super init])) { _operationClass = [SDWebImageDownloaderOperation class]; _shouldDecompressImages = YES; //è®¾ç½®ä»»åŠ¡çš„æ‰§è¡Œé¡ºåº _executionOrder = SDWebImageDownloaderFIFOExecutionOrder; //åˆ›å»ºæ‰§è¡Œä»»åŠ¡çš„æ“ä½œé˜Ÿåˆ—ï¼Œå¹¶å¯¹æ“ä½œé˜Ÿåˆ—è¿›è¡Œé…ç½® _downloadQueue = [NSOperationQueue new]; _downloadQueue.maxConcurrentOperationCount = 6; _downloadQueue.name = @&quot;com.hackemist.SDWebImageDownloader&quot;; _URLOperations = [NSMutableDictionary new];#ifdef SD_WEBP _HTTPHeaders = [@{@&quot;Accept&quot;: @&quot;image/webp,image/*;q=0.8&quot;} mutableCopy];#else _HTTPHeaders = [@{@&quot;Accept&quot;: @&quot;image/*;q=0.8&quot;} mutableCopy];#endif _barrierQueue = dispatch_queue_create(&quot;com.hackemist.SDWebImageDownloaderBarrierQueue&quot;, DISPATCH_QUEUE_CONCURRENT); _downloadTimeout = 15.0; sessionConfiguration.timeoutIntervalForRequest = _downloadTimeout; /** * Create the session for this task * We send nil as delegate queue so that the session creates a serial operation queue for performing all delegate * method calls and completion handler calls. */ self.session = [NSURLSession sessionWithConfiguration:sessionConfiguration delegate:self delegateQueue:nil]; } return self;} SDWebImageDownloaderæ‰§è¡Œä¸‹è½½æ“ä½œè¿™é‡Œè¯·åŸè°…æˆ‘è´´ä¸Šå¤§æ®µçš„ä»£ç ï¼Œå› ä¸ºè¿™æ®µä»£ç å®åœ¨æ˜¯å¤ªæ¼‚äº®äº†ã€‚é€šè¿‡ä¿©ä¸ªå‡½æ•°çš„è®¾è®¡å°†SDWebImageDownloaderOperationçš„åˆå§‹åŒ–å’ŒSDWebImageDownloadTokenåˆå§‹åŒ–åˆ†å‰²å¼€ã€‚å¹¶åœ¨åˆå§‹åŒ–operationå®Œæˆä¹‹åå°†ä»»åŠ¡æ‰”åˆ°é˜Ÿåˆ—ä¸­å»æ‰§è¡Œï¼Œè¿˜æŒæœ‰äº†operationçš„å¼•ç”¨ï¼Œç»™SDWebImageDownloaderæœ‰æœºä¼šä¿å­˜åˆ°å­—å…¸ä¸­ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748- (nullable SDWebImageDownloadToken *)downloadImageWithURL:(nullable NSURL *)url options:(SDWebImageDownloaderOptions)options progress:(nullable SDWebImageDownloaderProgressBlock)progressBlock completed:(nullable SDWebImageDownloaderCompletedBlock)completedBlock { __weak SDWebImageDownloader *wself = self; return [self addProgressCallback:progressBlock completedBlock:completedBlock forURL:url createCallback:^SDWebImageDownloaderOperation *{ __strong __typeof (wself) sself = wself; NSTimeInterval timeoutInterval = sself.downloadTimeout; if (timeoutInterval == 0.0) { timeoutInterval = 15.0; } // In order to prevent from potential duplicate caching (NSURLCache + SDImageCache) we disable the cache for image requests if told otherwise NSMutableURLRequest *request = [[NSMutableURLRequest alloc] initWithURL:url cachePolicy:(options &amp; SDWebImageDownloaderUseNSURLCache ? NSURLRequestUseProtocolCachePolicy : NSURLRequestReloadIgnoringLocalCacheData) timeoutInterval:timeoutInterval]; request.HTTPShouldHandleCookies = (options &amp; SDWebImageDownloaderHandleCookies); request.HTTPShouldUsePipelining = YES; if (sself.headersFilter) { request.allHTTPHeaderFields = sself.headersFilter(url, [sself.HTTPHeaders copy]); } else { request.allHTTPHeaderFields = sself.HTTPHeaders; } SDWebImageDownloaderOperation *operation = [[sself.operationClass alloc] initWithRequest:request inSession:sself.session options:options]; operation.shouldDecompressImages = sself.shouldDecompressImages; if (sself.urlCredential) { operation.credential = sself.urlCredential; } else if (sself.username &amp;&amp; sself.password) { operation.credential = [NSURLCredential credentialWithUser:sself.username password:sself.password persistence:NSURLCredentialPersistenceForSession]; } if (options &amp; SDWebImageDownloaderHighPriority) { operation.queuePriority = NSOperationQueuePriorityHigh; } else if (options &amp; SDWebImageDownloaderLowPriority) { operation.queuePriority = NSOperationQueuePriorityLow; } [sself.downloadQueue addOperation:operation]; if (sself.executionOrder == SDWebImageDownloaderLIFOExecutionOrder) { // Emulate LIFO execution order by systematically adding new operations as last operation's dependency [sself.lastAddedOperation addDependency:operation]; sself.lastAddedOperation = operation; } return operation; }];} è¿™é‡Œæœ‰å¯¹SDWebImageDownloaderOperationè¿›è¡Œä¿å­˜å¤„ç†ï¼Œç¡®ä¿åŒä¸€ä¸ªURLåªä¼šåˆ›å»ºä¸€æ¬¡ï¼Œé¿å…å†…å­˜çš„é¢å¤–æ¶ˆè€—ã€‚æ·»åŠ å¯¹tokençš„åˆå§‹åŒ–å’Œç®¡ç†ï¼ŒæŠŠoperationçš„åˆå§‹åŒ–å’Œtokençš„åˆå§‹åŒ–è¿›è¡Œä¸šåŠ¡ä¸Šä¸€äº›å°åˆ†ç¦»ï¼Œä»£ç å±‚æ¬¡ç«‹é©¬æ¸…æ™°èµ·æ¥äº†ï¼Œèµï¼ 1234567891011121314151617181920212223242526272829303132333435363738- (nullable SDWebImageDownloadToken *)addProgressCallback:(SDWebImageDownloaderProgressBlock)progressBlock completedBlock:(SDWebImageDownloaderCompletedBlock)completedBlock forURL:(nullable NSURL *)url createCallback:(SDWebImageDownloaderOperation *(^)())createCallback { // The URL will be used as the key to the callbacks dictionary so it cannot be nil. If it is nil immediately call the completed block with no image or data. if (url == nil) { if (completedBlock != nil) { completedBlock(nil, nil, nil, NO); } return nil; } __block SDWebImageDownloadToken *token = nil; dispatch_barrier_sync(self.barrierQueue, ^{ SDWebImageDownloaderOperation *operation = self.URLOperations[url]; if (!operation) { operation = createCallback(); self.URLOperations[url] = operation; __weak SDWebImageDownloaderOperation *woperation = operation; operation.completionBlock = ^{ SDWebImageDownloaderOperation *soperation = woperation; if (!soperation) return; if (self.URLOperations[url] == soperation) { [self.URLOperations removeObjectForKey:url]; }; }; } id downloadOperationCancelToken = [operation addHandlersForProgress:progressBlock completed:completedBlock]; token = [SDWebImageDownloadToken new]; token.url = url; token.downloadOperationCancelToken = downloadOperationCancelToken; }); return token;} å°ç»“ å¥½äº†ï¼ŒSDWebImageViewçš„ä¸‹è½½ç¯èŠ‚å°±åˆ°è¿™é‡Œï¼Œçœ‹æ¥é‚£å¥è¯ç¡®å®æ²¡è¯´é”™ï¼Œæºç é¢å‰ï¼Œæ²¡æœ‰ç¥ç§˜ï¼Œå“ˆå“ˆï¼ä¸‹ä¸€å°èŠ‚ä¸»è¦ç ”ç©¶ä¸‹SDWebImageViewæ˜¯å¦‚ä½•å¯¹å›¾ç‰‡è¿›è¡Œç¼“å­˜æ“ä½œçš„ã€‚ å‚è€ƒèµ„æ–™[1]. SDWebimageåœ¨githubä¸Šçš„åœ°å€[2]. è‹±æ–‡ç‰ˆçš„ä½¿ç”¨è¯´æ˜[3]. ä½¿ç”¨SDWebimageçš„appåˆ—è¡¨","link":"/2016/12/30/SDWebImage%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"title":"SDWebImageå­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰","text":"ä¸Šä¸€å°èŠ‚ç ”ç©¶äº†SDWebImageViewé‡Œé¢çš„ç¼“å­˜å®ç°åŸç†ï¼Œåœ¨è¿™ä¸€å°èŠ‚æˆ‘ä»¬ç»§ç»­ç ”ç©¶SDWebImageå¯¹ç¼“å­˜å’Œä¸‹è½½æ•´ä½“åŠŸèƒ½çš„å°è£…ã€‚ä¹Ÿå°±æ˜¯-SDWebImageManagerç®¡ç†ç±»ã€‚ ç»„è£…SDWebImageManagerä½¿ç”¨äº†ç»„è£…çš„è®¾è®¡æ¨¡å¼ï¼Œé€šè¿‡å†…éƒ¨åŒ…å«SDWebImageCacheå’ŒSDWebImageDownloaderçš„æˆå‘˜å˜é‡æ¥å®ç°ä¸‹è½½å’Œç¼“å­˜çš„åŠŸèƒ½ã€‚ 123@interface SDWebImageManager : NSObject@property (strong, nonatomic, readonly, nullable) SDImageCache *imageCache;@property (strong, nonatomic, readonly, nullable) SDWebImageDownloader *imageDownloader; æ¥å…¥ï¼Œä¸‹è½½å’Œç¼“å­˜å¯¹è±¡å¯ä»¥ç”±åˆå§‹åŒ–çš„æ—¶å€™å¤–éƒ¨ä¼ å…¥ï¼Œä½†æ˜¯å®˜æ–¹å»ºè®®çš„è¿˜æ˜¯åœ¨SDWebImageManageråˆå§‹åŒ–çš„æ—¶å€™è¿›è¡Œåˆå§‹åŒ–ã€‚ 123456789101112131415161718192021222324+ (nonnull instancetype)sharedManager { static dispatch_once_t once; static id instance; dispatch_once(&amp;once, ^{ instance = [self new]; }); return instance;}- (nonnull instancetype)init { SDImageCache *cache = [SDImageCache sharedImageCache]; SDWebImageDownloader *downloader = [SDWebImageDownloader sharedDownloader]; return [self initWithCache:cache downloader:downloader];}- (nonnull instancetype)initWithCache:(nonnull SDImageCache *)cache downloader:(nonnull SDWebImageDownloader *)downloader { if ((self = [super init])) { _imageCache = cache; _imageDownloader = downloader; _failedURLs = [NSMutableSet new]; _runningOperations = [NSMutableArray new]; } return self;} ä»£ç†SDWebImageManagerä½¿ç”¨äº†ä»£ç†çš„è®¾è®¡æ¨¡å¼ï¼Œç»™ä½¿ç”¨è€…æä¾›ä¸€ä¸ªå¯ä»¥è¿‡æ»¤ä¸‹è½½URLå’Œå¯¹ä¸‹è½½åçš„å›¾ç‰‡è¿›è¡Œè½¬ç çš„ä¸€ä¸ªå¤–éƒ¨æ¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728@protocol SDWebImageManagerDelegate &lt;NSObject&gt;@optional/** * æ§åˆ¶å›¾ç‰‡æ˜¯å¦å…è®¸è¢«ä¸‹è½½ï¼Œå½“è¿™ä¸ªå›¾ç‰‡åœ¨ç¼“å­˜ä¸­æ²¡æ‰¾åˆ°æ—¶å€™ * * @param imageManager å›¾ç‰‡ç®¡ç†å™¨ * @param imageURL è¦ä¸‹è½½çš„å›¾ç‰‡URL * * @return è¿”å›NOï¼Œå½“ç¼“å­˜æ²¡æœ‰å‘½ä¸­çš„æ—¶å€™ï¼Œé˜»æ­¢å›¾ç‰‡ä¸‹è½½ã€‚å¦‚æœæ²¡å®ç°ï¼Œé»˜è®¤æ˜¯YES * */- (BOOL)imageManager:(nonnull SDWebImageManager *)imageManager shouldDownloadImageForURL:(nullable NSURL *)imageURL;/** * å…è®¸è½¬å˜å›¾ç‰‡ï¼Œå½“å›¾ç‰‡è¢«ä»ç½‘ä¸Šä¸‹è½½ä¸‹æ¥ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ç¼“å­˜åˆ°ç£ç›˜å’Œå†…å­˜ä¸­ä¹‹å‰ã€‚ * NOTE: è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨å…¨å±€çš„é˜Ÿåˆ—ä¸­è°ƒç”¨çš„ã€‚ä»¥é˜²å¯¹ä¸»çº¿ç¨‹é€ æˆé˜»å¡ * * @param imageManager The current `SDWebImageManager` * @param image The image to transform * @param imageURL The url of the image to transform * * @return The transformed image object. */- (nullable UIImage *)imageManager:(nonnull SDWebImageManager *)imageManager transformDownloadedImage:(nullable UIImage *)image withURL:(nullable NSURL *)imageURL;@end æ ¸å¿ƒAPIå¤–éƒ¨å”¤èµ·ä¸‹è½½æ“ä½œ SDWebImageManageræä¾›äº†ä¸€ä¸ªå¤–éƒ¨ä¼ å…¥URLå’ŒSDWebImageOptionsï¼Œè€Œåå¯ä»¥è·å–ä¸‹è½½è¿‡ç¨‹å›è°ƒï¼Œä»¥åŠä¸‹è½½å®Œæˆå›è°ƒçš„ä¸€ä¸ªæ ¸å¿ƒAPIï¼Œè¯¥æ ¸å¿ƒAPIä¼šè¿”å›ä¸€ä¸ªç¡®è®¤SDWebImageOperationåè®®çš„å¯¹è±¡ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155- (id &lt;SDWebImageOperation&gt;)loadImageWithURL:(nullable NSURL *)url options:(SDWebImageOptions)options progress:(nullable SDWebImageDownloaderProgressBlock)progressBlock completed:(nullable SDInternalCompletionBlock)completedBlock { // å¦‚æœå®Œæˆå›è°ƒæ²¡æœ‰è®¾ç½®ï¼Œç”¨æ–­è¨€ç›´æ¥æ‰“æ–­ NSAssert(completedBlock != nil, @&quot;If you mean to prefetch the image, use -[SDWebImagePrefetcher prefetchURLs] instead&quot;); // å¦‚æœæ˜¯è¯¯ä¼ äº†NSStringç±»å‹åˆ°NSURlï¼Œåšå®¹é”™å¤„ç† if ([url isKindOfClass:NSString.class]) { url = [NSURL URLWithString:(NSString *)url]; } // å®¹é”™ if (![url isKindOfClass:NSURL.class]) { url = nil; } // æ“ä½œå¯¹è±¡ __block SDWebImageCombinedOperation *operation = [SDWebImageCombinedOperation new]; __weak SDWebImageCombinedOperation *weakOperation = operation; // éªŒè¯æ˜¯å¦æ˜¯é”™è¯¯çš„URL BOOL isFailedUrl = NO; if (url) { @synchronized (self.failedURLs) { isFailedUrl = [self.failedURLs containsObject:url]; } } // å½“ç¡®è®¤æ˜¯é”™è¯¯çš„URLå–æ¶ˆæ“ä½œ if (url.absoluteString.length == 0 || (!(options &amp; SDWebImageRetryFailed) &amp;&amp; isFailedUrl)) { [self callCompletionBlockForOperation:operation completion:completedBlock error:[NSError errorWithDomain:NSURLErrorDomain code:NSURLErrorFileDoesNotExist userInfo:nil] url:url]; return operation; } // å¦‚æœå¾€ä¸‹èµ°äº†ï¼Œè¯æ˜æ˜¯æ­£ç¡®çš„URLï¼ŒæŠŠè¯·æ±‚æ“ä½œä¿å­˜åˆ°æ•°ç»„ä¸­ @synchronized (self.runningOperations) { [self.runningOperations addObject:operation]; } // è·å–ç¼“å­˜çš„key NSString *key = [self cacheKeyForURL:url]; // ä½¿ç”¨å†…éƒ¨åˆ›å»ºçš„å›¾ç‰‡ç¼“å­˜ç±»ï¼Œåˆ›å»ºç¼“å­˜æ“ä½œ operation.cacheOperation = [self.imageCache queryCacheOperationForKey:key done:^(UIImage *cachedImage, NSData *cachedData, SDImageCacheType cacheType) { // æ“ä½œè¢«å–æ¶ˆï¼Œå°†operationä»å†…éƒ¨çš„æ•°ç»„ä¸­ç§»é™¤ï¼Œblockç»ˆæ­¢ if (operation.isCancelled) { [self safelyRemoveOperationFromRunning:operation]; return; } // å¤„ç†ä¸å­˜åœ¨ç¼“å­˜å›¾ç‰‡æˆ–æœ‰ç¼“å­˜ä½†æ˜¯éœ€è¦é‡æ–°åˆ·æ–°çš„æƒ…å†µ if ((!cachedImage || options &amp; SDWebImageRefreshCached) &amp;&amp; (![self.delegate respondsToSelector:@selector(imageManager:shouldDownloadImageForURL:)] || [self.delegate imageManager:self shouldDownloadImageForURL:url])) { if (cachedImage &amp;&amp; options &amp; SDWebImageRefreshCached) { // å¦‚æœå›¾ç‰‡åœ¨ç¼“å­˜ä¸­ï¼Œä½†æ˜¯é€‰é¡¹è¦æ±‚é‡æ–°ä¸‹ï¼Œé‚£ä¹ˆç›´æ¥è°ƒç”¨é‡æ–°ä¸‹ [self callCompletionBlockForOperation:weakOperation completion:completedBlock image:cachedImage data:cachedData error:nil cacheType:cacheType finished:YES url:url]; } // å¦‚æœæ²¡æœ‰ç¼“å­˜å›¾ç‰‡ï¼Œé‚£å°±è¸è¸å®å®ä¸‹è½½å§ï¼Œå…ˆè®¾ç½®ä¸‹è½½é€‰é¡¹ SDWebImageDownloaderOptions downloaderOptions = 0; if (options &amp; SDWebImageLowPriority) downloaderOptions |= SDWebImageDownloaderLowPriority; if (options &amp; SDWebImageProgressiveDownload) downloaderOptions |= SDWebImageDownloaderProgressiveDownload; if (options &amp; SDWebImageRefreshCached) downloaderOptions |= SDWebImageDownloaderUseNSURLCache; if (options &amp; SDWebImageContinueInBackground) downloaderOptions |= SDWebImageDownloaderContinueInBackground; if (options &amp; SDWebImageHandleCookies) downloaderOptions |= SDWebImageDownloaderHandleCookies; if (options &amp; SDWebImageAllowInvalidSSLCertificates) downloaderOptions |= SDWebImageDownloaderAllowInvalidSSLCertificates; if (options &amp; SDWebImageHighPriority) downloaderOptions |= SDWebImageDownloaderHighPriority; if (options &amp; SDWebImageScaleDownLargeImages) downloaderOptions |= SDWebImageDownloaderScaleDownLargeImages; // å¦‚æœæœ‰ç¼“å­˜å›¾ç‰‡ä¸”æ˜¯è¦æ±‚å¼ºåˆ¶åˆ·æ–°çš„æƒ…å†µï¼Œé‚£å°±å¼ºåˆ¶åˆ·æ–° if (cachedImage &amp;&amp; options &amp; SDWebImageRefreshCached) { // force progressive off if image already cached but forced refreshing downloaderOptions &amp;= ~SDWebImageDownloaderProgressiveDownload; // ignore image read from NSURLCache if image if cached but force refreshing downloaderOptions |= SDWebImageDownloaderIgnoreCachedResponse; } // ä¸‹è½½å¼•æ“æ‰§è¡Œä¸‹è½½æ“ä½œ SDWebImageDownloadToken *subOperationToken = [self.imageDownloader downloadImageWithURL:url options:downloaderOptions progress:progressBlock completed:^(UIImage *downloadedImage, NSData *downloadedData, NSError *error, BOOL finished) { __strong __typeof(weakOperation) strongOperation = weakOperation; if (!strongOperation || strongOperation.isCancelled) { // Do nothing if the operation was cancelled // See #699 for more details // if we would call the completedBlock, there could be a race condition between this block and another completedBlock for the same object, so if this one is called second, we will overwrite the new data } else if (error) { // ä¸‹è½½é”™è¯¯äº†ï¼Œè¿›è¡Œé”™è¯¯å›è°ƒï¼Œå¹¶å°†é”™è¯¯çš„urlå­˜åˆ°é”™è¯¯urlæ•°ç»„ä¸­ [self callCompletionBlockForOperation:strongOperation completion:completedBlock error:error url:url]; if ( error.code != NSURLErrorNotConnectedToInternet &amp;&amp; error.code != NSURLErrorCancelled &amp;&amp; error.code != NSURLErrorTimedOut &amp;&amp; error.code != NSURLErrorInternationalRoamingOff &amp;&amp; error.code != NSURLErrorDataNotAllowed &amp;&amp; error.code != NSURLErrorCannotFindHost &amp;&amp; error.code != NSURLErrorCannotConnectToHost) { @synchronized (self.failedURLs) { [self.failedURLs addObject:url]; } } } else { // å¦‚æœé€‰é¡¹æ˜¯ä¸‹è½½é”™è¯¯ç»§ç»­ä¸‹ï¼Œå°†é”™è¯¯urlä»é”™è¯¯æ•°ç»„ä¸­ç§»é™¤ if ((options &amp; SDWebImageRetryFailed)) { @synchronized (self.failedURLs) { [self.failedURLs removeObject:url]; } } // è·å–ç¼“å­˜è®¾ç½® BOOL cacheOnDisk = !(options &amp; SDWebImageCacheMemoryOnly); if (options &amp; SDWebImageRefreshCached &amp;&amp; cachedImage &amp;&amp; !downloadedImage) { // Image refresh hit the NSURLCache cache, do not call the completion block } else if (downloadedImage &amp;&amp; (!downloadedImage.images || (options &amp; SDWebImageTransformAnimatedImage)) &amp;&amp; [self.delegate respondsToSelector:@selector(imageManager:transformDownloadedImage:withURL:)]) { dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^{ UIImage *transformedImage = [self.delegate imageManager:self transformDownloadedImage:downloadedImage withURL:url]; if (transformedImage &amp;&amp; finished) { BOOL imageWasTransformed = ![transformedImage isEqual:downloadedImage]; // pass nil if the image was transformed, so we can recalculate the data from the image [self.imageCache storeImage:transformedImage imageData:(imageWasTransformed ? nil : downloadedData) forKey:key toDisk:cacheOnDisk completion:nil]; } [self callCompletionBlockForOperation:strongOperation completion:completedBlock image:transformedImage data:downloadedData error:nil cacheType:SDImageCacheTypeNone finished:finished url:url]; }); } else { if (downloadedImage &amp;&amp; finished) { [self.imageCache storeImage:downloadedImage imageData:downloadedData forKey:key toDisk:cacheOnDisk completion:nil]; } [self callCompletionBlockForOperation:strongOperation completion:completedBlock image:downloadedImage data:downloadedData error:nil cacheType:SDImageCacheTypeNone finished:finished url:url]; } } if (finished) { [self safelyRemoveOperationFromRunning:strongOperation]; } }]; operation.cancelBlock = ^{ [self.imageDownloader cancel:subOperationToken]; __strong __typeof(weakOperation) strongOperation = weakOperation; [self safelyRemoveOperationFromRunning:strongOperation]; }; } else if (cachedImage) { __strong __typeof(weakOperation) strongOperation = weakOperation; [self callCompletionBlockForOperation:strongOperation completion:completedBlock image:cachedImage data:cachedData error:nil cacheType:cacheType finished:YES url:url]; [self safelyRemoveOperationFromRunning:operation]; } else { // Image not in cache and download disallowed by delegate __strong __typeof(weakOperation) strongOperation = weakOperation; [self callCompletionBlockForOperation:strongOperation completion:completedBlock image:nil data:nil error:nil cacheType:SDImageCacheTypeNone finished:YES url:url]; [self safelyRemoveOperationFromRunning:operation]; } }]; return operation;} å–æ¶ˆæ‰€æœ‰è¯·æ±‚å°†æ­£åœ¨è¿è¡Œçš„æ“ä½œå…¨éƒ¨æ‰§è¡Œå–æ¶ˆæ“ä½œï¼Œå¹¶å°†æ“ä½œä»æ‰§è¡Œæ•°ç»„ä¸­ç§»é™¤ 12345678- (void)cancelAll { // æ³¨æ„è¦åŠ é” @synchronized (self.runningOperations) { NSArray&lt;SDWebImageCombinedOperation *&gt; *copiedOperations = [self.runningOperations copy]; [copiedOperations makeObjectsPerformSelector:@selector(cancel)]; [self.runningOperations removeObjectsInArray:copiedOperations]; }} æ£€æµ‹æ˜¯å¦åœ¨è¿è¡Œè¾…åŠ©æ–¹æ³•ï¼Œæ£€æµ‹æ˜¯å¦æœ‰è¯·æ±‚åœ¨è¿è¡Œä¸­ 1234567- (BOOL)isRunning { BOOL isRunning = NO; @synchronized (self.runningOperations) { isRunning = (self.runningOperations.count &gt; 0); } return isRunning;} ç¼“å­˜æŸURLå¯¹åº”çš„å›¾ç‰‡åˆ°ç¼“å­˜ä½¿ç”¨å†…éƒ¨çš„ImageCacheå°†å›¾ç‰‡è¿›è¡Œç¼“å­˜åˆ°ç£ç›˜ 123456- (void)saveImageToCache:(nullable UIImage *)image forURL:(nullable NSURL *)url { if (image &amp;&amp; url) { NSString *key = [self cacheKeyForURL:url]; [self.imageCache storeImage:image forKey:key toDisk:YES completion:nil]; }} å¼‚æ­¥æ£€æµ‹å†…å­˜ä¸­/ç£ç›˜ä¸­æ˜¯å¦æœ‰å›¾ç‰‡ æ£€æµ‹å†…å­˜ä¸­æ˜¯å¦æœ‰ç¼“å­˜1234567891011121314151617181920212223- (void)cachedImageExistsForURL:(nullable NSURL *)url completion:(nullable SDWebImageCheckCacheCompletionBlock)completionBlock { NSString *key = [self cacheKeyForURL:url]; BOOL isInMemoryCache = ([self.imageCache imageFromMemoryCacheForKey:key] != nil); if (isInMemoryCache) { // making sure we call the completion block on the main queue dispatch_async(dispatch_get_main_queue(), ^{ if (completionBlock) { completionBlock(YES); } }); return; } [self.imageCache diskImageExistsWithKey:key completion:^(BOOL isInDiskCache) { // the completion block of checkDiskCacheForImageWithKey:completion: is always called on the main queue, no need to further dispatch if (completionBlock) { completionBlock(isInDiskCache); } }];} æ£€æµ‹ç£ç›˜ä¸­æ˜¯å¦æœ‰å›¾ç‰‡1234567891011- (void)diskImageExistsForURL:(nullable NSURL *)url completion:(nullable SDWebImageCheckCacheCompletionBlock)completionBlock { NSString *key = [self cacheKeyForURL:url]; [self.imageCache diskImageExistsWithKey:key completion:^(BOOL isInDiskCache) { // the completion block of checkDiskCacheForImageWithKey:completion: is always called on the main queue, no need to further dispatch if (completionBlock) { completionBlock(isInDiskCache); } }];} è·å–æŸä¸ªURLå¯¹åº”çš„ç¼“å­˜keyè¾…åŠ©æ–¹æ³•ï¼Œè·å–urlå¯¹åº”çš„å›¾ç‰‡key,å…è®¸ç”¨æˆ·å¯¹URLè¿›è¡Œç­›é€‰1234567891011- (nullable NSString *)cacheKeyForURL:(nullable NSURL *)url { if (!url) { return @&quot;&quot;; } if (self.cacheKeyFilter) { return self.cacheKeyFilter(url); } else { return url.absoluteString; }} å°ç»“SDWebImageManager ç›¸å¯¹è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œå› ä¸ºå†…éƒ¨å·²ç»æœ‰ä¸‹è½½å’Œç¼“å­˜ç±»çš„å®ç°äº†ï¼Œä¸‹è½½å›¾ç‰‡æ—¶ï¼Œå…ˆåˆ¤æ–­ç¼“å­˜çš„æƒ…å†µï¼Œå¦‚æœç¼“å­˜ä¸­æœ‰ï¼Œè¿›è¡Œç¼“å­˜è·å–çš„å›è°ƒï¼Œå¦‚æœæ²¡æœ‰æˆ–è€…å¼ºåˆ¶è¦æ±‚åˆ·æ–°çš„è¯ï¼Œå°±ä¼šæ‰§è¡Œä¸‹è½½æ“ä½œã€‚æœŸé—´æŠŠæ“ä½œè¦è¿›è¡Œä¿å­˜åˆ°è¿è¡Œæ•°ç»„ä¸­ï¼Œè¿™æ ·çš„è¯ï¼Œå¦‚æœæœ‰å–æ¶ˆï¼Œä¹Ÿå¯ä»¥æ‹¿åˆ°å¯¹è±¡è¿›è¡Œå–æ¶ˆæ“ä½œã€‚ ä¸‹ä¸€å°èŠ‚ï¼Œç ”ç©¶ä¸‹ï¼Œä¸‰æ–¹åº“å¦‚æœè¿›è¡Œè¿›ä¸€æ­¥çš„å°è£…ï¼Œç„¶åå¯ä»¥ä¾›ç”¨æˆ·æ–¹ä¾¿çš„ä½¿ç”¨ï¼Ÿè€Œä¸ç”¨å…³æ³¨å†…éƒ¨çš„å®ç°ç»†èŠ‚ï¼","link":"/2017/01/16/SDWebImage%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/"},{"title":"SDWebImageå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰","text":"ç¼“å­˜è¿™ä¸€å°èŠ‚ä¸»è¦ç ”ç©¶ä¸‹SDWebImageçš„cacheåŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Œé¦–å…ˆæ‰¾åˆ°åœ¨SDWebImageä¸­å……å½“ç¼“å­˜åŠŸèƒ½çš„ç±»ï¼Œè¿™ä¸€æ­¥å¾ˆç®€å•ï¼Œç›´æ¥å®šä½åˆ°SDImageCacheç±»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¥ä¸‹æ¥ä¸»è¦å°±ç ”ç©¶è¿™ä¸ªç±»äº†ã€‚ SDImageCacheConfig ç¼“å­˜é…ç½®SDWebImageæä¾›äº†ä¸€ä¸ªä¸“é—¨çš„ç±»SDImageCacheConfigï¼Œæ¥è¿›è¡ŒCacheçš„ä¸€äº›é…ç½®å·¥ä½œï¼Œä¸»è¦é…ç½®çš„ä¿¡æ¯åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ æ˜¯å¦å…è®¸è§£å‹åŸå›¾ æ˜¯å¦æ”¯æŒiCloudï¼Œé»˜è®¤ä¸æ”¯æŒ æ˜¯å¦å…è®¸å°†å›¾ç‰‡ç¼“å­˜åˆ°å†…å­˜ï¼Œé»˜è®¤æ”¯æŒ æœ€å¤§ç¼“å­˜å‘¨æœŸï¼ˆé»˜è®¤æ˜¯ä¸€å‘¨ï¼‰ æœ€å¤§ç¼“å­˜å¤§å°ï¼ˆé»˜è®¤ä¸è®¾ç½®ï¼‰ SDImageCache ç¼“å­˜ç±»SDImageCacheæ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œä½œä¸ºæ‰§è¡Œå›¾ç‰‡ç¼“å­˜çš„å·¥å…·ç±»ï¼Œæ•´ä¸ªAppåªéœ€è¦æœ‰ä¸€ä¸ªå…¨å±€çš„å®ä¾‹å°±å¯ä»¥äº†ï¼Œè¿™æ²¡æ¯›ç—…ã€‚ SDImageCacheæ–‡ä»¶ç³»ç»Ÿåœ¨å¼€å§‹ç¼“å­˜æ“ä½œä¹‹å‰ï¼Œé™¤äº†é…ç½®é¡¹éœ€è¦é…ç½®å¤–ï¼Œæˆ‘ä¸ªäººæ„Ÿè§‰è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦æå‰å‡†å¤‡å¥½çš„å°±æ˜¯ç¼“å­˜çš„æ–‡ä»¶ç³»ç»Ÿã€‚ é»˜è®¤çš„æ–‡ä»¶å­˜å‚¨è·¯å¾„SDImageCacheçš„é»˜è®¤æ–‡ä»¶å­˜å‚¨è·¯å¾„æ˜¯ç”±å•ä¾‹å»æ§åˆ¶çš„ï¼Œåœ¨å•ä¾‹åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼ å…¥äº†é»˜è®¤çš„æ–‡ä»¶å¤¹åç§°defaultï¼Œè¿™æ ·çš„è¯ï¼Œé»˜è®¤çš„æ–‡ä»¶è·¯å¾„å°±æ˜¯../cache/default/com.hackemist.SDWebImageCache. default/ æ–‡ä»¶å¤¹ã€‚ ç”¨æˆ·è‡ªå·±å®šä¹‰çš„æ–‡ä»¶è·¯å¾„SDImageCacheè¿˜æ”¯æŒç”¨æˆ·è‡ªå·±å®šä¹‰çš„å‘½åç©ºé—´ï¼Œæ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨åˆ›å»ºçš„æ—¶å€™ä¼ å…¥namespaceï¼Œå³å¯ï¼Œè¿™æ ·çš„è¯ï¼Œå‡å¦‚ç”¨æˆ·ä¼ å…¥äº†YoukuImagesï¼Œé‚£ä¹ˆ ç¼“å­˜çš„æ–‡ä»¶è·¯å¾„å°±æ˜¯../cache/YoukuImages/com.hackemist.SDWebImageCache.YoukuImages/ æ–‡ä»¶å¤¹äº†ã€‚ è¾…åŠ©çš„æ–‡ä»¶è·¯å¾„æ–¹æ³•è¿™ä¸ªå¹¶ä¸æ˜¯å¾ˆå¤æ‚ï¼Œä¹‹æ‰€ä»¥è¦æä¸€å˜´ï¼Œä¸»è¦æ˜¯æ¯”è¾ƒèµèµSDWebImageçš„å‡½æ•°å‘½åï¼Œä»£ç å¦‚ä¸‹ 1234- (nullable NSString *)makeDiskCachePath:(nonnull NSString*)fullNamespace { NSArray&lt;NSString *&gt; *paths = NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES); return [paths[0] stringByAppendingPathComponent:fullNamespace];} å›¾ç‰‡å­˜å‚¨è·¯å¾„å›¾ç‰‡çš„å­˜å‚¨è·¯å¾„é‡‡ç”¨äº†å¯¹URLè¿›è¡ŒMD5åŠ å¯†çš„æ–¹å¼ï¼Œè¿›è¡Œå¤„ç†ï¼Œé€šè¿‡è¿™ç§æ–¹å¼é˜²æ­¢æ–‡ä»¶è¢«ç›—é“¾ç»™æœåŠ¡ç«¯å¢åŠ æµé‡æŸè€—ã€‚MD5ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„åŠ å¯†æ–¹å¼ï¼Œä¸‹é¢é™„ä¸Šä»£ç ï¼Œæ–¹ä¾¿è‡ªå·±ä»¥åæŸ¥çœ‹ã€‚æ³¨æ„ï¼Œè¿™é‡Œç¨å¾®å’Œåˆ«çš„MD5åŠ å¯†çš„ä¸åŒçš„å°±æ˜¯ï¼Œä¼šæŠŠæ–‡ä»¶æ‰©å±•åå¸¦ä¸Šï¼Œæ¯”å¦‚.png,.jpgä¹‹ç±»çš„ã€‚è¿™ä¸ªæ–¹æ³•ï¼Œå…¶å®æ˜¯æä¾›äº†ä¸€ä¸ªURLåˆ°æ–‡ä»¶åçš„æ˜ å°„ 12345678910111213- (nullable NSString *)cachedFileNameForKey:(nullable NSString *)key { const char *str = key.UTF8String; if (str == NULL) { str = &quot;&quot;; } unsigned char r[CC_MD5_DIGEST_LENGTH]; CC_MD5(str, (CC_LONG)strlen(str), r); NSString *filename = [NSString stringWithFormat:@&quot;%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%@&quot;, r[0], r[1], r[2], r[3], r[4], r[5], r[6], r[7], r[8], r[9], r[10], r[11], r[12], r[13], r[14], r[15], [key.pathExtension isEqualToString:@&quot;&quot;] ? @&quot;&quot; : [NSString stringWithFormat:@&quot;.%@&quot;, key.pathExtension]]; return filename;} å¦å¤–æä¾›ä¿©ä¸ªå‡½æ•°ï¼Œæ–¹ä¾¿è·å–æ–‡ä»¶é»˜è®¤å­˜å‚¨è·¯å¾„ä¸‹æŒ‡å®škeyå›¾ç‰‡çš„æ–¹æ³• 12345// è·å–æŒ‡å®šè·¯å¾„ä¸‹åç§°ä¸ºkeyçš„å›¾ç‰‡è·¯å¾„- (nullable NSString *)cachePathForKey:(nullable NSString *)key inPath:(nonnull NSString *)path { NSString *filename = [self cachedFileNameForKey:key]; return [path stringByAppendingPathComponent:filename];} 1234// è·å–é»˜è®¤è·¯å¾„ä¸‹keyçš„å›¾ç‰‡è·¯å¾„ï¼Œä¸€èˆ¬æƒ…å†µéƒ½æ˜¯ç›´æ¥ä½¿ç”¨è¯¥æ–¹æ³•å°±è·å–åˆ°å›¾ç‰‡çš„è·¯å¾„äº†- (nullable NSString *)defaultCachePathForKey:(nullable NSString *)key { return [self cachePathForKey:key inPath:self.diskCachePath];} SDImageCacheçš„åˆå§‹åŒ–è‡ªä»Xcode8ä¹‹åï¼Œç¼–è¯‘å™¨å¥½åƒåšäº†ä¸€äº›ä¼˜åŒ–ï¼Œinitæ–¹æ³•éœ€è¦å»è°ƒç”¨å…¶ä»–çš„NS_DESIGNATED_INITIALIZERæ ‡è®°çš„åˆå§‹åŒ–æ–¹æ³•ï¼ŒSDImageCacheæ˜¾ç„¶ä¹Ÿæ˜¯å“åº”äº†è¿™æ ·çš„å·å¬ï¼Œæ‰€ä»¥æä¾›äº†ä¿©ä¸ªè‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•initWithNamespace:å’ŒinitWithNamespace:diskCacheDirectory:ï¼Œåˆ†åˆ«æ”¯æŒæŒ‰ç…§å‘½åç©ºé—´åŠå­˜å‚¨è·¯å¾„çš„è‡ªå®šä¹‰åˆå§‹åŒ–ã€‚ä½†æ˜¯å•ä¾‹çš„åˆå§‹åŒ–ä¼šè°ƒç”¨é»˜è®¤çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œä½¿ç”¨å•ä¾‹çš„æ—¶å€™ï¼Œä¼šåœ¨Appçš„Cacheæ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»ºä½ ä¸€ä¸ªdefaultçš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨è¯¥Defaultæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºcom.hackmisk.SDWebImageCache.defaultçš„ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä½¿ç”¨è¯¥æ–‡ä»¶å¤¹æ¥å­˜å‚¨å›¾ç‰‡ã€‚ä¸‹é¢æ˜¯åˆå§‹åŒ–çš„ä¸€äº›ä»£ç ï¼Œå¹¶ä¸æ˜¯å¾ˆå¤æ‚ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273+ (nonnull instancetype)sharedImageCache { static dispatch_once_t once; static id instance; dispatch_once(&amp;once, ^{ instance = [self new]; }); return instance;}- (instancetype)init { return [self initWithNamespace:@&quot;default&quot;];}- (nonnull instancetype)initWithNamespace:(nonnull NSString *)ns { NSString *path = [self makeDiskCachePath:ns]; return [self initWithNamespace:ns diskCacheDirectory:path];}- (nonnull instancetype)initWithNamespace:(nonnull NSString *)ns diskCacheDirectory:(nonnull NSString *)directory { if ((self = [super init])) { NSString *fullNamespace = [@&quot;com.hackemist.SDWebImageCache.&quot; stringByAppendingString:ns]; // Create IO serial queue _ioQueue = dispatch_queue_create(&quot;com.hackemist.SDWebImageCache&quot;, DISPATCH_QUEUE_SERIAL); //ç›®å‰è¿™é‡Œä½¿ç”¨çš„éƒ½æ˜¯é»˜è®¤é…ç½® _config = [[SDImageCacheConfig alloc] init]; // Init the memory cache // åˆ›å»ºå†…å­˜ç¼“å­˜ _memCache = [[AutoPurgeCache alloc] init]; _memCache.name = fullNamespace; // Init the disk cache if (directory != nil) { // å•ä¾‹å½¢å¼åˆ›å»ºçš„æ—¶å€™ï¼Œè¿™é‡Œè‚¯å®šæ˜¯èƒ½æ‰§è¡Œåˆ°çš„ï¼Œä¹‹åå°±ä¼šåˆ›å»ºcom.hackmisk.SDWebImageCache.defaultçš„ç¼“å­˜è·¯å¾„ _diskCachePath = [directory stringByAppendingPathComponent:fullNamespace]; } else { NSString *path = [self makeDiskCachePath:ns]; _diskCachePath = path; } // æ­¤å¤„éœ€è¦ç¨å¾®æ³¨æ„ä¸€ä¸‹ï¼Œå› ä¸ºioé˜Ÿåˆ—ä¸»è¦æ˜¯å¯¹å›¾ç‰‡è¿›è¡Œå¢åˆ è¯»å†™ç­‰æ“ä½œï¼Œéœ€è¦ä¿è¯fileManageråˆ›å»ºåœ¨ioé˜Ÿåˆ—ä¸Šã€‚ dispatch_sync(_ioQueue, ^{ _fileManager = [NSFileManager new]; });#if SD_UIKIT // Subscribe to app events [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(clearMemory) name:UIApplicationDidReceiveMemoryWarningNotification object:nil]; [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(deleteOldFiles) name:UIApplicationWillTerminateNotification object:nil]; [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(backgroundDeleteOldFiles) name:UIApplicationDidEnterBackgroundNotification object:nil];#endif } return self;}//è¾…åŠ©æ–¹æ³•ï¼Œä¾¿æ·å¼åˆ›å»ºç¼“å­˜è·¯å¾„- (nullable NSString *)makeDiskCachePath:(nonnull NSString*)fullNamespace { NSArray&lt;NSString *&gt; *paths = NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES); return [paths[0] stringByAppendingPathComponent:fullNamespace];} SDImageCacheçš„ç¼“å­˜æ“ä½œå­˜è¿™é‡ŒåŒæ ·æä¾›äº†ä¸‰ä¸ªæ–¹æ³•æ–¹ä¾¿ä½¿ç”¨è€…æ ¹æ®ä¸åŒçš„éœ€æ±‚è¿›è¡Œå›¾ç‰‡å­˜å‚¨åŠŸèƒ½çš„é€‰æ‹©ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485// ä½¿ç”¨é»˜è®¤çš„å­˜å‚¨è·¯å¾„ï¼Œå¹¶é»˜è®¤å­˜å‚¨åˆ°ç£ç›˜- (void)storeImage:(nullable UIImage *)image forKey:(nullable NSString *)key completion:(nullable SDWebImageNoParamsBlock)completionBlock { [self storeImage:image imageData:nil forKey:key toDisk:YES completion:completionBlock];}// è¯¥æ–¹æ³•å¯ä¾›ç”¨æˆ·é€‰æ‹©æ˜¯å¦èƒ½å¤Ÿä¿å­˜åˆ°ç£ç›˜- (void)storeImage:(nullable UIImage *)image forKey:(nullable NSString *)key toDisk:(BOOL)toDisk completion:(nullable SDWebImageNoParamsBlock)completionBlock { [self storeImage:image imageData:nil forKey:key toDisk:toDisk completion:completionBlock];}// æ­¤å¤„æä¾›äº†å›¾ç‰‡çš„NSdataæ•°æ®ï¼Œå¯ä¾›ç”¨æˆ·ç›´æ¥å­˜å‚¨ã€‚- (void)storeImage:(nullable UIImage *)image imageData:(nullable NSData *)imageData forKey:(nullable NSString *)key toDisk:(BOOL)toDisk completion:(nullable SDWebImageNoParamsBlock)completionBlock { // åšä¸‹å¼‚å¸¸æ ¡éªŒï¼Œå¦‚æœå›¾ç‰‡æˆ–è€…keyä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å› if (!image || !key) { if (completionBlock) { completionBlock(); } return; } // æ£€éªŒä¸‹é…ç½®ç±»æ˜¯å¦å…è®¸å°†å›¾ç‰‡ä¿å­˜åˆ°å†…å­˜ï¼Œå¦‚æœå…è®¸å°±è¿›è¡Œä¿å­˜å¤„ç† if (self.config.shouldCacheImagesInMemory) { NSUInteger cost = SDCacheCostForImage(image); [self.memCache setObject:image forKey:key cost:cost]; } // æ˜¯å¦éœ€è¦ä¿å­˜åˆ°ç£ç›˜ if (toDisk) { // ä¿å­˜éœ€è¦åœ¨IOé˜Ÿåˆ—ä¸­è¿›è¡Œï¼Œå…ˆæ£€éªŒå›¾ç‰‡NSdataæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœåªæœ‰UIImageå¯¹è±¡ï¼Œéœ€è¦å…ˆè½¬æ¢æˆDataç±»å‹ dispatch_async(self.ioQueue, ^{ NSData *data = imageData; if (!data &amp;&amp; image) { SDImageFormat imageFormatFromData = [NSData sd_imageFormatForImageData:data]; data = [image sd_imageDataAsFormat:imageFormatFromData]; } [self storeImageDataToDisk:data forKey:key]; if (completionBlock) { dispatch_async(dispatch_get_main_queue(), ^{ completionBlock(); }); } }); } else { if (completionBlock) { completionBlock(); } }}// ä¿å­˜æ•°æ®åˆ°ç£ç›˜ï¼Œæ³¨æ„ä¿å­˜æ“ä½œè¦åœ¨IOé˜Ÿåˆ—ä¸Šè¿›è¡Œã€‚å¹¶æ ¹æ®æ˜¯å¦è¦ä¿å­˜åˆ°iCloudå¯¹URLè¿›è¡Œè®¾ç½®- (void)storeImageDataToDisk:(nullable NSData *)imageData forKey:(nullable NSString *)key { if (!imageData || !key) { return; } // æ£€æŸ¥ä¸‹æ˜¯å¦æ˜¯åœ¨IOé˜Ÿåˆ—ä¸Šï¼Œå› ä¸ºè¯»å†™æ“ä½œè¦åœ¨å•ç‹¬çš„å¼‚æ­¥é˜Ÿåˆ—è¿›è¡Œ [self checkIfQueueIsIOQueue]; // æ£€æŸ¥æ˜¯å¦åœ¨å½“å‰çš„ç›®å½•ä¸‹å­˜åœ¨æ–‡ä»¶å¤¹ï¼Œå¦‚ä¸å­˜åœ¨ï¼Œå…ˆåˆ›å»ºä¹‹ if (![_fileManager fileExistsAtPath:_diskCachePath]) { [_fileManager createDirectoryAtPath:_diskCachePath withIntermediateDirectories:YES attributes:nil error:NULL]; } // è·å–ç¼“å­˜å›¾ç‰‡åœ°å€æ–‡ä»¶å¤¹è·¯å¾„ NSString *cachePathForKey = [self defaultCachePathForKey:key]; // è½¬å˜ä¸ºæ–‡ä»¶URL NSURL *fileURL = [NSURL fileURLWithPath:cachePathForKey]; // ä¿å­˜æ“ä½œ [_fileManager createFileAtPath:cachePathForKey contents:imageData attributes:nil]; // é˜»æ­¢å›¾ç‰‡ä¿å­˜åˆ°iCloud if (self.config.shouldDisableiCloud) { [fileURL setResourceValue:@YES forKey:NSURLIsExcludedFromBackupKey error:nil]; }} å–&amp;æŸ¥SDWebImageCacheæä¾›äº†æŸ¥è¯¢å†…å­˜å›¾ç‰‡ã€ç£ç›˜å›¾ç‰‡çš„åŠŸèƒ½ï¼Œè¿˜æä¾›äº†æŸ¥è¯¢é»˜è®¤è·¯å¾„å’Œè‡ªå®šä¹‰è·¯å¾„ä¸‹æŸä¸ªkeyå¯¹åº”çš„å›¾ç‰‡ã€‚ æ£€æµ‹å›¾ç‰‡æ˜¯å¦åœ¨ç£ç›˜ä¸­æœ‰ç¼“å­˜ 1234567891011121314151617 - (void)diskImageExistsWithKey:(nullable NSString *)key completion:(nullable SDWebImageCheckCacheCompletionBlock)completionBlock { dispatch_async(_ioQueue, ^{ BOOL exists = [_fileManager fileExistsAtPath:[self defaultCachePathForKey:key]]; // fallback because of https://github.com/rs/SDWebImage/pull/976 that added the extension to the disk file name // checking the key with and without the extension if (!exists) { exists = [_fileManager fileExistsAtPath:[self defaultCachePathForKey:key].stringByDeletingPathExtension]; } if (completionBlock) { dispatch_async(dispatch_get_main_queue(), ^{ completionBlock(exists); }); } });} è·å–å†…å­˜/ç£ç›˜ä¸Šç¼“å­˜çš„å›¾ç‰‡ 123456789101112131415161718192021 - (nullable UIImage *)imageFromMemoryCacheForKey:(nullable NSString *)key { return [self.memCache objectForKey:key];} - (nullable UIImage *)imageFromDiskCacheForKey:(nullable NSString *)key { UIImage *diskImage = [self diskImageForKey:key]; if (diskImage &amp;&amp; self.config.shouldCacheImagesInMemory) { NSUInteger cost = SDCacheCostForImage(diskImage); [self.memCache setObject:diskImage forKey:key cost:cost]; } - (nullable UIImage *)imageFromCacheForKey:(nullable NSString *)key { // First check the in-memory cache... UIImage *image = [self imageFromMemoryCacheForKey:key]; if (image) { return image; } // Second check the disk cache... image = [self imageFromDiskCacheForKey:key]; return diskImage;} è¾…åŠ©æ–¹æ³•ï¼Œè·å–æ‰€æœ‰è·¯å¾„ä¸‹æ˜¯å¦æœ‰è¯¥keyç¼“å­˜çš„å›¾ç‰‡ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546 - (nullable NSData *)diskImageDataBySearchingAllPathsForKey:(nullable NSString *)key { NSString *defaultPath = [self defaultCachePathForKey:key]; NSData *data = [NSData dataWithContentsOfFile:defaultPath]; if (data) { return data; } // fallback because of https://github.com/rs/SDWebImage/pull/976 that added the extension to the disk file name // checking the key with and without the extension data = [NSData dataWithContentsOfFile:defaultPath.stringByDeletingPathExtension]; if (data) { return data; } NSArray&lt;NSString *&gt; *customPaths = [self.customPaths copy]; for (NSString *path in customPaths) { NSString *filePath = [self cachePathForKey:key inPath:path]; NSData *imageData = [NSData dataWithContentsOfFile:filePath]; if (imageData) { return imageData; } // fallback because of https://github.com/rs/SDWebImage/pull/976 that added the extension to the disk file name // checking the key with and without the extension imageData = [NSData dataWithContentsOfFile:filePath.stringByDeletingPathExtension]; if (imageData) { return imageData; } } return nil;} - (nullable UIImage *)diskImageForKey:(nullable NSString *)key { NSData *data = [self diskImageDataBySearchingAllPathsForKey:key]; if (data) { UIImage *image = [UIImage sd_imageWithData:data]; image = [self scaledImageForKey:key image:image]; if (self.config.shouldDecompressImages) { image = [UIImage decodedImageWithImage:image]; } return image; } else { return nil; }} æä¾›ä¾›å¤–éƒ¨è°ƒç”¨çš„ï¼Œä¸”è¿”å›ä¸€ä¸ªOperationå¯¹è±¡çš„æŸ¥è¯¢æŸKeyçš„å›¾ç‰‡ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546 - (nullable NSOperation *)queryCacheOperationForKey:(nullable NSString *)key done:(nullable SDCacheQueryCompletedBlock)doneBlock { if (!key) { if (doneBlock) { doneBlock(nil, nil, SDImageCacheTypeNone); } return nil; } // First check the in-memory cache... UIImage *image = [self imageFromMemoryCacheForKey:key]; if (image) { NSData *diskData = nil; if ([image isGIF]) { diskData = [self diskImageDataBySearchingAllPathsForKey:key]; } if (doneBlock) { doneBlock(image, diskData, SDImageCacheTypeMemory); } return nil; } NSOperation *operation = [NSOperation new]; dispatch_async(self.ioQueue, ^{ if (operation.isCancelled) { // do not call the completion if cancelled return; } @autoreleasepool { NSData *diskData = [self diskImageDataBySearchingAllPathsForKey:key]; UIImage *diskImage = [self diskImageForKey:key]; if (diskImage &amp;&amp; self.config.shouldCacheImagesInMemory) { NSUInteger cost = SDCacheCostForImage(diskImage); [self.memCache setObject:diskImage forKey:key cost:cost]; } if (doneBlock) { dispatch_async(dispatch_get_main_queue(), ^{ doneBlock(diskImage, diskData, SDImageCacheTypeDisk); }); } } }); return operation;} åˆ åŒæ ·ï¼Œåˆ é™¤ä¹ŸåŒ…æ‹¬åˆ é™¤å†…å­˜ä¸­çš„å›¾ç‰‡å’Œåˆ é™¤ç£ç›˜ä¸­çš„å›¾ç‰‡ï¼Œä¿©ç§ï¼Œæ¯”è¾ƒç®€å•ï¼Œä¸‹é¢æ˜¯æºç ï¼Œå¯ä»¥å‚è€ƒä¸‹ 12345678910111213141516171819 - (void)clearMemory { [self.memCache removeAllObjects]; } - (void)clearDiskOnCompletion:(nullable SDWebImageNoParamsBlock)completion { dispatch_async(self.ioQueue, ^{ [_fileManager removeItemAtPath:self.diskCachePath error:nil]; [_fileManager createDirectoryAtPath:self.diskCachePath withIntermediateDirectories:YES attributes:nil error:NULL]; if (completion) { dispatch_async(dispatch_get_main_queue(), ^{ completion(); }); } });} åˆ é™¤è¿™å—ï¼Œå”¯ä¸€éœ€è¦ç‰¹åˆ«æ³¨æ„çš„å°±æ˜¯åˆ é™¤è¿‡æœŸçš„æ–‡ä»¶ï¼Œä»¥åŠå¯¹æ–‡ä»¶å¤§å°çš„å­˜å‚¨ä¸Šé™åšæ ¡éªŒï¼Œå¦‚æœè¶…è¿‡æœ€å¤§ä¸Šé™ï¼Œå°†æœ€è€çš„æ–‡ä»¶åˆ é™¤æ‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182 - (void)deleteOldFiles { [self deleteOldFilesWithCompletionBlock:nil];}- (void)deleteOldFilesWithCompletionBlock:(nullable SDWebImageNoParamsBlock)completionBlock { dispatch_async(self.ioQueue, ^{ NSURL *diskCacheURL = [NSURL fileURLWithPath:self.diskCachePath isDirectory:YES]; NSArray&lt;NSString *&gt; *resourceKeys = @[NSURLIsDirectoryKey, NSURLContentModificationDateKey, NSURLTotalFileAllocatedSizeKey]; // This enumerator prefetches useful properties for our cache files. NSDirectoryEnumerator *fileEnumerator = [_fileManager enumeratorAtURL:diskCacheURL includingPropertiesForKeys:resourceKeys options:NSDirectoryEnumerationSkipsHiddenFiles errorHandler:NULL]; NSDate *expirationDate = [NSDate dateWithTimeIntervalSinceNow:-self.config.maxCacheAge]; NSMutableDictionary&lt;NSURL *, NSDictionary&lt;NSString *, id&gt; *&gt; *cacheFiles = [NSMutableDictionary dictionary]; NSUInteger currentCacheSize = 0; // Enumerate all of the files in the cache directory. This loop has two purposes: // // 1. Removing files that are older than the expiration date. // 2. Storing file attributes for the size-based cleanup pass. NSMutableArray&lt;NSURL *&gt; *urlsToDelete = [[NSMutableArray alloc] init]; for (NSURL *fileURL in fileEnumerator) { NSError *error; NSDictionary&lt;NSString *, id&gt; *resourceValues = [fileURL resourceValuesForKeys:resourceKeys error:&amp;error]; // Skip directories and errors. if (error || !resourceValues || [resourceValues[NSURLIsDirectoryKey] boolValue]) { continue; } // Remove files that are older than the expiration date; NSDate *modificationDate = resourceValues[NSURLContentModificationDateKey]; if ([[modificationDate laterDate:expirationDate] isEqualToDate:expirationDate]) { [urlsToDelete addObject:fileURL]; continue; } // Store a reference to this file and account for its total size. NSNumber *totalAllocatedSize = resourceValues[NSURLTotalFileAllocatedSizeKey]; currentCacheSize += totalAllocatedSize.unsignedIntegerValue; cacheFiles[fileURL] = resourceValues; } for (NSURL *fileURL in urlsToDelete) { [_fileManager removeItemAtURL:fileURL error:nil]; } // If our remaining disk cache exceeds a configured maximum size, perform a second // size-based cleanup pass. We delete the oldest files first. if (self.config.maxCacheSize &gt; 0 &amp;&amp; currentCacheSize &gt; self.config.maxCacheSize) { // Target half of our maximum cache size for this cleanup pass. const NSUInteger desiredCacheSize = self.config.maxCacheSize / 2; // Sort the remaining cache files by their last modification time (oldest first). NSArray&lt;NSURL *&gt; *sortedFiles = [cacheFiles keysSortedByValueWithOptions:NSSortConcurrent usingComparator:^NSComparisonResult(id obj1, id obj2) { return [obj1[NSURLContentModificationDateKey] compare:obj2[NSURLContentModificationDateKey]]; }]; // Delete files until we fall below our desired cache size. for (NSURL *fileURL in sortedFiles) { if ([_fileManager removeItemAtURL:fileURL error:nil]) { NSDictionary&lt;NSString *, id&gt; *resourceValues = cacheFiles[fileURL]; NSNumber *totalAllocatedSize = resourceValues[NSURLTotalFileAllocatedSizeKey]; currentCacheSize -= totalAllocatedSize.unsignedIntegerValue; if (currentCacheSize &lt; desiredCacheSize) { break; } } } } if (completionBlock) { dispatch_async(dispatch_get_main_queue(), ^{ completionBlock(); }); } });} å¯¹åå°åˆ é™¤çš„æ”¯æŒï¼Œå½“APPåœ¨åˆ é™¤çš„æ—¶å€™ï¼Œåˆ‡æ¢åˆ°åå°ï¼Œéœ€è¦æ”¯æŒåå°åˆ é™¤æ–‡ä»¶ 12345678910111213141516171819 - (void)backgroundDeleteOldFiles { Class UIApplicationClass = NSClassFromString(@&quot;UIApplication&quot;); if(!UIApplicationClass || ![UIApplicationClass respondsToSelector:@selector(sharedApplication)]) { return; } UIApplication *application = [UIApplication performSelector:@selector(sharedApplication)]; __block UIBackgroundTaskIdentifier bgTask = [application beginBackgroundTaskWithExpirationHandler:^{ // Clean up any unfinished task business by marking where you // stopped or ending the task outright. [application endBackgroundTask:bgTask]; bgTask = UIBackgroundTaskInvalid; }]; // Start the long-running task and return immediately. [self deleteOldFilesWithCompletionBlock:^{ [application endBackgroundTask:bgTask]; bgTask = UIBackgroundTaskInvalid; }];} ç¼“å­˜çš„ä¿¡æ¯é™¤äº†æ”¯æŒå­˜ã€æŸ¥ã€å–ã€åˆ ï¼Œä¹‹å¤–ï¼ŒSDWebImageCacheè¿˜æä¾›äº†æ–¹ä¾¿æŸ¥çœ‹ç¼“å­˜çš„æ–‡ä»¶æ•°ã€ç¼“å­˜çš„æ€»å¤§å°ã€ä»¥åŠå®æ—¶è®¡ç®—æ–‡ä»¶å¤§å°çš„blockå¼‚æ­¥å›è°ƒï¼Œä»£ç å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748 - (NSUInteger)getSize { __block NSUInteger size = 0; dispatch_sync(self.ioQueue, ^{ NSDirectoryEnumerator *fileEnumerator = [_fileManager enumeratorAtPath:self.diskCachePath]; for (NSString *fileName in fileEnumerator) { NSString *filePath = [self.diskCachePath stringByAppendingPathComponent:fileName]; NSDictionary&lt;NSString *, id&gt; *attrs = [[NSFileManager defaultManager] attributesOfItemAtPath:filePath error:nil]; size += [attrs fileSize]; } }); return size;}- (NSUInteger)getDiskCount { __block NSUInteger count = 0; dispatch_sync(self.ioQueue, ^{ NSDirectoryEnumerator *fileEnumerator = [_fileManager enumeratorAtPath:self.diskCachePath]; count = fileEnumerator.allObjects.count; }); return count;}- (void)calculateSizeWithCompletionBlock:(nullable SDWebImageCalculateSizeBlock)completionBlock { NSURL *diskCacheURL = [NSURL fileURLWithPath:self.diskCachePath isDirectory:YES]; dispatch_async(self.ioQueue, ^{ NSUInteger fileCount = 0; NSUInteger totalSize = 0; NSDirectoryEnumerator *fileEnumerator = [_fileManager enumeratorAtURL:diskCacheURL includingPropertiesForKeys:@[NSFileSize] options:NSDirectoryEnumerationSkipsHiddenFiles errorHandler:NULL]; for (NSURL *fileURL in fileEnumerator) { NSNumber *fileSize; [fileURL getResourceValue:&amp;fileSize forKey:NSURLFileSizeKey error:NULL]; totalSize += fileSize.unsignedIntegerValue; fileCount += 1; } if (completionBlock) { dispatch_async(dispatch_get_main_queue(), ^{ completionBlock(fileCount, totalSize); }); } });} å°ç»“é€šè¿‡è¿™ä¸€å°èŠ‚å¯¹æºç çš„åˆ†æï¼Œæˆ‘ä»¬å¤§æ¦‚çŸ¥é“äº†SDWebImageçš„ç¼“å­˜å·¥ä½œåŸç†ã€‚ä¹Ÿå¯¹æ–‡ä»¶æ“ä½œæœ‰äº†ä¸€ä¸ªæ›´æ·±åˆ»çš„ç†è§£ï¼Œä¸‹ä¸€å°èŠ‚å°†ç ”ç©¶ä¸‹SDWebImageManageræ˜¯å¦‚æœå¯¹ä¸‹è½½å’Œç¼“å­˜è¿›è¡Œç»¼åˆç®¡ç†çš„ã€‚","link":"/2017/01/06/SDWebImage%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/"},{"title":"Treeå‘½ä»¤åŠç®€å•ä½¿ç”¨","text":"æˆ‘ç”¨çš„æ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼ŒCentOS7ï¼Œé»˜è®¤æ²¡æœ‰treeè¿™ä¸ªå‘½ä»¤ï¼Œéœ€è¦å®‰è£…ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥å®‰è£…ï¼š 1sudo yum install tree æ€ä¹ˆæ ·ä½¿ç”¨treeè¿™ä¸ªå‘½ä»¤å…¶å®æœ‰ä¸ªéå¸¸ç®€å•çš„åŠæ³•ï¼Œå°±æ˜¯ç›´æ¥æŸ¥çœ‹å…³äºtreeçš„å¸®åŠ©ï¼Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹å…³äºtreeå‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ 1tree --help æœ€ç®€å•çš„ä½¿ç”¨åŠæ³•æ˜¯ç›´æ¥è¾“å…¥treeå‘½ä»¤ï¼Œå°±ä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬ä»¥æ ‘å½¢çš„å½¢å¼åˆ—å‡ºå½“å‰ç›®å½•çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œä¸åŠ ä»»ä½•å‚æ•°ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ—è¡¨å½“å‰ç›®å½•ä¸‹é¢æ‰€æœ‰æ·±åº¦çº§åˆ«çš„æ–‡ä»¶å’Œç›®å½•ã€‚ å‡ ä¸ªæ¯”è¾ƒå¸¸è§„çš„ç”¨æ³• æ˜¾ç¤ºç›®å½•ç»“æ„1tree åŒ…å«éšè—æ–‡ä»¶ 1tree -a æ§åˆ¶æ·±åº¦ï¼ˆå‡è®¾ä¸º2ï¼‰ 1tree -L 2 æ›´å¤šçš„é€‰é¡¹ é€‰é¡¹ è¯´æ˜ -a æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…å«éšè—æ–‡ä»¶ã€‚ -d åªæ˜¾ç¤ºç›®å½•ã€‚ -l è·Ÿè¸ªç¬¦å·é“¾æ¥ï¼Œå¦‚æœé“¾æ¥çš„æ˜¯ä¸€ä¸ªç›®å½•ï¼Œåˆ™å½“æˆç›®å½•å¤„ç†ã€‚ -f æ˜¾ç¤ºå®Œæ•´è·¯å¾„ã€‚ -x åªæ˜¾ç¤ºæœ¬æ–‡ä»¶ç³»ç»Ÿã€‚ -L level æ§åˆ¶æ˜¾ç¤ºçš„ç›®å½•æ·±åº¦ã€‚ -R åœ¨ä¸‹çº§ç›®å½•ä¸­ï¼Œå†æ¬¡æ‰§è¡Œ tree å‘½ä»¤å¹¶ä¸”åŠ ä¸Š â€˜-o 00Tree.htmlâ€™é€‰é¡¹ï¼Œé…åˆ-L,-Hä½¿ç”¨ã€‚ -P pattern åªæ˜¾ç¤ºåŒ¹é…äº† pattern çš„æ–‡ä»¶ï¼ˆä¸æ˜¯ç›®å½•ï¼‰ï¼Œæ”¯æŒç®€å•çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ -I pattern ä¸-Pç›¸åï¼Œåªæ˜¾ç¤ºæ²¡æœ‰åŒ¹é… patternçš„æ–‡ä»¶ã€‚ â€“ignore-case å½“ä½¿ç”¨äº†-Pæˆ–-Ié€‰é¡¹æ—¶ï¼Œå¿½ç•¥å¤§å°å†™ã€‚ â€“matchdirs å½“ä½¿ç”¨äº†-Pé€‰é¡¹æ—¶ï¼Œæ–‡ä»¶ååŒ…å«å®Œæ•´è·¯å¾„ã€‚ â€“prune ä¸æ˜¾ç¤ºç©ºç›®å½•ï¼Œå¦‚æœç»è¿‡-Pæˆ–-Iåæ²¡æœ‰ç›®å½•ä¸‹æ²¡æœ‰éœ€è¦æ˜¾ç¤ºçš„ï¼Œä¹Ÿå½“ä½œç©ºç›®å½•ã€‚ â€“noreport ä¸æ˜¾ç¤ºæœ€åçš„ç»Ÿè®¡ä¿¡æ¯ã€‚ â€“charset charset æŒ‡å®šå­—ç¬¦é›†ã€‚ â€“filelimit # è¿‡æ»¤æ‰æ–‡ä»¶ä¸ªæ•°è¶…è¿‡ # çš„ç›®å½•ã€‚ â€“timefmt fmt æŒ‰ç…§æŒ‡å®šçš„æ ¼å¼æ‰“å°æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ã€‚ -o filename å°†ç»“æœè¾“å‡ºåˆ°æ–‡ä»¶ã€‚ -q ç”¨é—®å·ä»£æ›¿ä¸å¯æ‰“å°çš„å­—ç¬¦ã€‚ -N ç”¨å…«è¿›åˆ¶ä»£æ›¿ä¸å¯æ‰“å°çš„å­—ç¬¦ã€‚ -Q ç”¨å¼•å·å°†æ–‡ä»¶åæ‹¬èµ·æ¥ã€‚ -p æ˜¾ç¤ºæ–‡ä»¶çš„ç±»å‹å’Œæƒé™ã€‚ -u æ˜¾ç¤ºæ–‡ä»¶æ‰€å±çš„ç”¨æˆ·åæˆ–è€…UIDã€‚ -g æ˜¾ç¤ºæ–‡ä»¶æ‰€å±çš„ç»„æˆ–è€…GIDã€‚ -s æ˜¾ç¤ºæ–‡ä»¶çš„å¤§å°ï¼Œå•ä½ï¼šå­—èŠ‚ -h æ˜¾ç¤ºæ–‡ä»¶çš„å¤§å°ï¼Œä½¿ç”¨æ›´äººæ€§åŒ–çš„æ˜¾ç¤ºã€‚ â€“si æ˜¾ç¤ºæ–‡ä»¶çš„å¤§å°ï¼Œç±»ä¼¼ -h ä½†æ˜¯ä½¿ç”¨å›½é™…å…¬åˆ¶å•ä½(1k=1000)ã€‚ â€“du å¯¹äºç›®å½•ï¼Œæ˜¾ç¤ºå…¶ä¸‹æ‰€æœ‰æ–‡ä»¶çš„ç´¯è®¡å¤§å°ã€‚ -D æ˜¾ç¤ºæ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ã€‚ -F ç±»ä¼¼ ls -Fï¼Œå¯¹ä¸åŒçš„æ–‡ä»¶ç±»ï¼Œåœ¨æœ«å°¾åŠ ä¸Šä¸åŒçš„å­—ç¬¦ã€‚ â€“inodes æ˜¾ç¤ºæ–‡ä»¶çš„ç´¢å¼•èŠ‚ç‚¹ã€‚ â€“device æ˜¾ç¤ºæ–‡ä»¶æ‰€å±çš„è®¾å¤‡å·ã€‚ -v æ˜¾ç¤ºçš„æ–‡ä»¶åˆ—è¡¨æŒ‰ç…§versionæ’åºã€‚ -t æ˜¾ç¤ºçš„æ–‡ä»¶åˆ—è¡¨æŒ‰ç…§æœ€åä¿®æ”¹æ—¶é—´æ’åºã€‚ -c æ˜¾ç¤ºçš„æ–‡ä»¶åˆ—è¡¨æŒ‰ç…§æœ€åçš„çŠ¶æ€æ”¹å˜æ—¶é—´æ’åºã€‚ -U ä¸è¿›è¡Œæ’åºå¤„ç†ã€‚ -r åå‘è¾“å‡ºåˆ—è¡¨ã€‚ â€“dirsfirst ä¼˜å…ˆæ˜¾ç¤ºç›®å½•ï¼ˆåŒä¸€çº§åˆ«ï¼‰ â€“sort[=name] æŒ‡å®šæ’åºæ–¹å¼ï¼Œname(default), ctime, mtime, size, version. -i è¾“å‡ºä¸­ä¸è¦è¿›è¡Œç¼©è¿›ã€‚ -A ä½¿ç”¨ASCIIçš„æ¨ªçº¿å­—ç¬¦è¡¨ç¤ºç¼©è¿›ã€‚ -S ä½¿ç”¨CP437çš„æ¨ªçº¿å­—ç¬¦è¡¨ç¤ºç¼©è¿›ã€‚ -n å…³é—­é¢œè‰²æ˜¾ç¤ºã€‚ -C æ‰“å¼€é¢œè‰²æ˜¾ç¤ºã€‚ -X ä½¿èƒ½XMLæ ¼å¼è¾“å‡ºã€‚ -J ä½¿èƒ½JSONæ ¼å¼è¾“å‡ºã€‚ -H baseHREF ä½¿èƒ½HTMLæ ¼å¼è¾“å‡ºï¼Œå¹¶åŒ…å«åŸºæœ¬httpé“¾æ¥åœ°å€ã€‚ -T title åœ¨HTMLæ ¼å¼è¾“å‡ºä¸­ï¼Œè®¾ç½®æ ‡é¢˜å’ŒH1æ ‡ç­¾å¤´ â€“nolinks åœ¨HTMLæ ¼å¼è¾“å‡ºä¸­ï¼Œä¸è¾“å‡ºè¶…é“¾æ¥ã€‚","link":"/2022/08/09/Tree%E5%91%BD%E4%BB%A4%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"},{"title":"hexoæœ¬åœ°å›¾ç‰‡æ”¾ç½®é—®é¢˜","text":"(è½¬) åŸ æ–‡ åœ° å€ èµ·å› åœ¨ hexo ä¸­ä½¿ç”¨æœ¬åœ°å›¾ç‰‡æ˜¯ä»¶éå¸¸è®©äººçº ç»“çš„äº‹æƒ…ï¼Œåœ¨ markdown é‡Œçš„å›¾ç‰‡åœ°å€ä¼¼ä¹æ°¸è¿œæ— æ³•å’Œæœ€åç”Ÿæˆçš„ç½‘é¡µä¿æŒä¸€è‡´ã€‚ è¿™äº›é—®é¢˜ä½¿å¾—æˆ‘ä¸€åº¦ä¸æ„¿æ„ä½¿ç”¨æœ¬åœ°å›¾ç‰‡è€Œé€‰æ‹©ç”¨å›¾åºŠï¼Œä½†è¢«ç§»åŠ¨è¿è¥å•†æ— è€»çš„æ¨ªæ¡å¹¿å‘Šé€¼å¾—æ‰“ç®—ä¸Š httpsï¼Œå›¾åºŠåªæ”¯æŒ http å°±æˆäº†é—®é¢˜ã€‚ hexo ä¸‹æ’å…¥å›¾ç‰‡ç°åœ¨å¤§æ¦‚æœ‰å‡ ä¸ªæ–¹æ¡ˆ æ”¾åœ¨æ ¹ç›®å½• æ—©æœŸå¤§éƒ¨åˆ†çš„æ–¹æ¡ˆæ˜¯æŠŠå›¾ç‰‡æ”¾åœ¨ source/img ä¸‹ï¼Œç„¶ååœ¨ markdown é‡Œå†™ ![img](/source/img/img.png) ã€‚æ˜¾ç„¶è¿™æ ·åœ¨æœ¬åœ°çš„ç¼–è¾‘å™¨é‡Œå®Œå…¨ä¸èƒ½æ­£ç¡®è¯†åˆ«å›¾ç‰‡çš„ä½ç½®ã€‚ asset-image åœ¨ hexo 2.x æ—¶å‡ºç°çš„æ’ä»¶ï¼Œåæ¥è¢«å¸çº³è¿› hexo 3 core ï¼Œç”¨æ³•çš„ä»‹ç»è§ èµ„æºæ–‡ä»¶å¤¹ | Hexo ã€‚æ¯”è¾ƒå°´å°¬çš„æ˜¯ï¼Œè¿™ç§æ–¹æ³•ç›´æ¥æ”¾å¼ƒäº† markdown åŸæ¥çš„è¯­æ³•ï¼Œä½¿ç”¨ç±»ä¼¼ ``çš„è¯­æ³•ï¼Œã€‚markdown æœ¬æ¥æœ‰æ’å…¥å›¾ç‰‡çš„è¯­æ³•ä¸å¥½å¥½æ”¯æŒï¼Œä¸“é—¨ç”¨ä¸€ä¸ªæ–°çš„è¯­æ³•æ¥æ’å…¥æœ¬åœ°å›¾ç‰‡ï¼Œè®©æˆ‘è¿™ç§å¼ºè¿«ç—‡ä¸å¤ªèƒ½æ¥å—ã€‚ è§£å†³æ–¹æ¡ˆCodeFalling/hexo-asset-image é¦–å…ˆç¡®è®¤ _config.yml ä¸­æœ‰ post_asset_folder:true ã€‚ åœ¨ hexo ç›®å½•ï¼Œæ‰§è¡Œ 12npm install https://github.com/CodeFalling/hexo-asset-image --save å‡è®¾åœ¨ 12345MacGesture2-Publishâ”œâ”€â”€ apppicker.jpgâ”œâ”€â”€ logo.jpgâ””â”€â”€ rules.jpgMacGesture2-Publish.md è¿™æ ·çš„ç›®å½•ç»“æ„ï¼ˆç›®å½•åå’Œæ–‡ç« åä¸€è‡´ï¼‰ï¼Œåªè¦ä½¿ç”¨ ![logo](MacGesture2-Publish/logo.jpg) å°±å¯ä»¥æ’å…¥å›¾ç‰‡ã€‚ ç”Ÿæˆçš„ç»“æ„ä¸º 12345public/2015/10/18/MacGesture2-Publishâ”œâ”€â”€ apppicker.jpgâ”œâ”€â”€ index.htmlâ”œâ”€â”€ logo.jpgâ””â”€â”€ rules.jpg åŒæ—¶ï¼Œç”Ÿæˆçš„ html æ˜¯ 12&lt;img src=&quot;/2015/10/18/MacGesture2-Publish/logo.jpg&quot; alt=&quot;logo&quot;&gt; è€Œä¸æ˜¯æ„šè ¢çš„ 12&lt;img src=&quot;MacGesture2-Publish/logo.jpg&quot; alt=&quot;logo&quot;&gt; å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™ä¸ªæ’ä»¶å¯¹äº CodeFalling/hexo-renderer-org åŒæ ·æœ‰æ•ˆ","link":"/2017/05/06/hexo%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87%E6%94%BE%E7%BD%AE%E9%97%AE%E9%A2%98/"},{"title":"iOSå¼€å‘ä¸­é‡åˆ°çš„åŒæ­¥æœºåˆ¶","text":"â€‹ ä»Šå¤©ä¸»è¦æ˜¯æ¥è®¨è®ºä¸‹ï¼Œçº¿ç¨‹åŒæ­¥æœºåˆ¶çš„é—®é¢˜ã€‚è¯´åˆ°çº¿ç¨‹åŒæ­¥ï¼Œä¸€èˆ¬äººå¯èƒ½ä¼šæƒ³åˆ°â€œNSLockâ€ã€â€œ@synchronizedâ€ã€â€œGCDä¿¡å·é‡â€ç­‰ç­‰ï¼Œå¥½å§ï¼Œå…¶å®è¿™æ˜¯æˆ‘æƒ³åˆ°çš„ï¼Œç„¶è€Œæˆ‘è¦è¯´çš„æ˜¯ï¼Œå¦‚æœåœ¨é¢è¯•ä¸­åªç­”åˆ°è¿™ä¹ˆå‡ ä¸ªå¯æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚æ‰€ä»¥æˆ‘æŸ¥æ‰¾äº†ä¸‹èµ„æ–™ï¼Œè¿™æ‰å‘ç°åŸæ¥iosä¸­çº¿ç¨‹åŒæ­¥çš„æ–¹æ³•å¯è¶³è¶³æœ‰å°†è¿‘10ç§ï¼Œä¸”å¬æˆ‘å¨“å¨“é“æ¥ã€‚ å„ä¸ªé”è¿›è¡Œ1000000æ­¤çš„åŠ é”è§£é”çš„ç©ºæ“ä½œæ—¶é—´å¦‚ä¸‹ 123456789OSSpinLock: 46.15 msdispatch_semaphore: 56.50 mspthread_mutex: 178.28 msNSCondition: 193.38 msNSLock: 175.02 mspthread_mutex(recursive): 172.56 msNSRecursiveLock: 157.44 msNSConditionLock: 490.04 ms@synchronized: 371.17 ms NSLockâ€‹ æåˆ°NSLockï¼Œé¦–å…ˆè¦æå¦å¤–ä¸€ä¸ªåè¯å«NSLockingï¼Œè¿™æ˜¯ä¸€ä¸ªåè®®ï¼Œä¸»è¦å°±å®šä¹‰äº†ä¿©ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªå« lock,ä¸€ä¸ªå«unLockã€‚NSLockå…¶å®å°±æ˜¯ç¡®è®¤äº†NSLockingåè®®çš„ä¸€ä¸ªNSObjectå¯¹è±¡ï¼Œé‚£ä¹ˆNSLockå¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨ä½ è®¤ä¸ºå¯èƒ½ä¼šå‘ç”Ÿå¤šçº¿ç¨‹è®¿é—®çš„åœ°æ–¹è¿›è¡Œlock æ“ä½œï¼Œåœ¨æ‰§è¡Œå®Œç›¸åº”ä»£ç ä¹‹åï¼Œæ‰§è¡Œunlockæ“ä½œã€‚ä¸¾ä¸ªç®€å•ä¾‹å­ 1234567891011121314151617181920212223242526272829303132-(void)testLock{// å…ˆç®€å•æè¿°ä¸‹ä½¿ç”¨åœºæ™¯ï¼Œç°åœ¨æœ‰ä¸€ä¸ªçº¿ç¨‹1ï¼Œæœ‰ä¸€ä¸ªçº¿ç¨‹2ï¼Œéƒ½è¦è®¿é—®å­—ç¬¦ä¸²nameï¼Œä¸”çº¿ç¨‹1è®¿é—®å­—ç¬¦ä¸²è¦è€—æ—¶3ç§’ï¼Œçº¿ç¨‹2æ­¤æ—¶éœ€è¦ç­‰å¾…ã€‚ __block NSString *name = @&quot;æˆç„±&quot;; NSOperationQueue *queue = [[NSOperationQueue alloc]init]; queue.maxConcurrentOperationCount = 3; NSLock *lock = [NSLock new]; [queue addOperationWithBlock:^{ NSLog(@&quot;1 å°†è¦ä¸Šé”&quot;); [lock lock]; NSLog(@&quot;1 å·²ä¸Šé”ï¼Œè®¿é—®èµ„æº&quot;); name = @&quot;å“‡å“ˆå“ˆ&quot;; sleep(3); NSLog(@&quot;1 å°†è¦è§£é”&quot;); [lock unlock]; NSLog(@&quot;1 å·²è§£é”&quot;); }]; [queue addOperationWithBlock:^{ sleep(1);//ä¿è¯æ­¤çº¿ç¨‹åé¢çš„æ–¹æ³•åè°ƒç”¨ NSLog(@&quot;2 å°†è¦ä¸Šé”&quot;); [lock lock]; NSLog(@&quot;2 å·²ä¸Šé”ï¼Œè®¿é—®èµ„æº&quot;); name = @&quot;åº·å¸ˆå‚…&quot;; sleep(2); NSLog(@&quot;2 å°†è¦è§£é”&quot;); [lock unlock]; NSLog(@&quot;2 å·²è§£é”&quot;); }];} â€‹ æ‰“å°ç»“æœå¦‚ä¸‹ 123456782017-04-24 23:06:59.831694 test[1300:102434] 1 å°†è¦ä¸Šé”2017-04-24 23:06:59.831718 test[1300:102434] 1 å·²ä¸Šé”ï¼Œè®¿é—®èµ„æº2017-04-24 23:07:00.835992 test[1300:102435] 2 å°†è¦ä¸Šé”2017-04-24 23:07:02.836242 test[1300:102434] 1 å°†è¦è§£é”2017-04-24 23:07:02.836385 test[1300:102434] 1 å·²è§£é”2017-04-24 23:07:02.836443 test[1300:102435] 2 å·²ä¸Šé”ï¼Œè®¿é—®èµ„æº2017-04-24 23:07:04.841407 test[1300:102435] 2 å°†è¦è§£é”2017-04-24 23:07:04.841528 test[1300:102435] 2 å·²è§£é” æŸ¥çœ‹æ§åˆ¶å°çš„æ‰“å°è¾“å‡ºå¾ˆæ˜æ˜¾çš„çœ‹åˆ°äº†ï¼Œåœ¨çº¿ç¨‹ä¸€è®¿é—®nameæ—¶ï¼ŒåŠ é”ä¹‹åï¼Œçº¿ç¨‹2ä¸€ç›´åœ¨ç­‰å¾…ï¼Œç›´åˆ°çº¿ç¨‹1é‡Šæ”¾é”ä¹‹åï¼Œçº¿ç¨‹2æ‰ä¼šå»è®¿é—®nameã€‚ @synchronizeâ€‹ æƒ³å¿…ä½†å‡¡æ˜¯å¼€å‘è¿‡ä¸€æ®µæ—¶é—´iosç¨‹åºçš„åŒå­¦ï¼Œä¸€å®šä¼šå¯¹è¿™ä¸ªå…³é”®å­—ä¸é™Œç”Ÿã€‚è¿™ä¸ªå…³é”®å­—çš„å­—é¢æ„æ€å°±æ˜¯â€œåŒæ­¥â€ã€‚é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å®ç°åŒæ­¥çš„å‘¢ï¼Ÿ â€‹ è¯¥ç‰¹æ€§å…è®¸ä¼ å…¥ä¸€ä¸ªNSObjectç±»å‹çš„å¯¹è±¡ï¼Œå¹¶æ‰§è¡Œä¸€ä¸ªblockï¼Œå½¢å¦‚ 123@syncronized(obj){ // do work} â€‹ ç½‘ä¸ŠæŸ¥è¯¢èµ„æ–™è·å¾—ï¼Œè¿™ä¸ªç‰¹æ€§å…¶å®æ˜¯å¯¹objc_sync_enter()äºobjc_sync_exit()çš„å°è£…ï¼Œå…¶å®é™…ä¸Šç­‰ä»·äº 12345@try{ objc_sync_enter(obj); }@finally{ objc_sync_exit(obj); } â€‹ å‡½æ•°objc_sync_enter()å†…éƒ¨å®é™…è¿›è¡Œçš„æ“ä½œï¼Œæ˜¯å¯¹ä¼ å…¥çš„å¯¹è±¡ï¼Œåˆ†é…é€’å½’é”ï¼Œå¹¶å­˜åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒè¿™ç¯‡blog,åœ¨è¿™é‡Œæˆ‘å°±ä¸å±•å¼€è®¨è®ºäº†ã€‚ä¸è¿‡ä¸‹é¢è¿˜æ˜¯ä¸¾ä¸ªç®€å•ä¾‹å­æ¥è¯´æ˜ä¸‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œè¿™é‡Œæœ‰ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„å°±æ˜¯ï¼Œ**å½“ä¼ å…¥çš„å¯¹è±¡ä¸ºnilæ—¶ï¼Œå°†ä¼šä»ä»£ç ä¸­ç§»èµ°çº¿ç¨‹å®‰å…¨** 1234567891011121314151617181920212223- (void)testSynchronized{ __block NSString *source = @&quot;èµ„æº&quot;; dispatch_queue_t global = dispatch_get_global_queue(0, 0); dispatch_async(global, ^{ @synchronized (source) { NSLog(@&quot;1 å°†è¦æ‰§è¡Œ&quot;); sleep(3); NSLog(@&quot;1 æ‰§è¡Œå®Œæ¯•&quot;); } }); dispatch_async(global, ^{ sleep(1);//åªæ˜¯ä¸ºäº†è®©è¿™ä¸ªçº¿ç¨‹åè°ƒç”¨ @synchronized (source) { NSLog(@&quot;2 å°†è¦æ‰§è¡Œ&quot;); sleep(1); NSLog(@&quot;2 æ‰§è¡Œå®Œæ¯•&quot;); } }); } â€‹ æ‰“å°ç»“æœå¦‚ä¸‹ 12342017-04-24 23:43:01.933835 test[1589:154385] 1 å°†è¦æ‰§è¡Œ2017-04-24 23:43:04.938447 test[1589:154385] 1 æ‰§è¡Œå®Œæ¯•2017-04-24 23:43:04.938782 test[1589:154386] 2 å°†è¦æ‰§è¡Œ2017-04-24 23:43:05.942177 test[1589:154386] 2 æ‰§è¡Œå®Œæ¯• ä¿¡å·é‡â€‹ GCDçš„ä¿¡å·é‡æœºåˆ¶ï¼Œé€šè¿‡æ¶ˆè€—ä¿¡å·çš„æ–¹å¼ï¼Œæ§åˆ¶çº¿ç¨‹åŒæ­¥ 12345678910111213141516171819202122- (void)testSemaphore{ dispatch_queue_t global = dispatch_get_global_queue(0, 0); dispatch_semaphore_t semaphore = dispatch_semaphore_create(1); dispatch_async(global, ^{ dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); NSLog(@&quot;1 å°†è¦æ‰§è¡Œ&quot;); sleep(3); NSLog(@&quot;1 æ‰§è¡Œå®Œæ¯•&quot;); dispatch_semaphore_signal(semaphore); }); dispatch_async(global, ^{ dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); NSLog(@&quot;2 å°†è¦æ‰§è¡Œ&quot;); sleep(3); NSLog(@&quot;2 æ‰§è¡Œå®Œæ¯•&quot;); dispatch_semaphore_signal(semaphore); });} ***æ‰“å°ç»“æœå¦‚ä¸‹*** 12342017-04-26 22:32:17.563019 test[914:142382] 1 å°†è¦æ‰§è¡Œ2017-04-26 22:32:20.568142 test[914:142382] 1 æ‰§è¡Œå®Œæ¯•2017-04-26 22:32:20.568336 test[914:142383] 2 å°†è¦æ‰§è¡Œ2017-04-26 22:32:23.573598 test[914:142383] 2 æ‰§è¡Œå®Œæ¯• NSConditionLockâ€‹ æ¡ä»¶é”ï¼Œå½“æ»¡è¶³æŸç§æ¡ä»¶æ—¶ï¼Œæ‰ä¼šå°è¯•è·å–é”ï¼Œåˆ©ç”¨è¯¥ç‰¹æ€§ï¼Œå¯ä»¥äººä¸ºå¹²é¢„çº¿ç¨‹æ‰§è¡Œçš„ä¾èµ–é¡ºåºï¼Œå‚è§å¦‚ä¸‹ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738- (void)testConditionLock{ int condition = 1; // å½“æ»¡è¶³æ¡ä»¶æ—¶ï¼Œå¦‚æœé”ç©ºé—²ï¼Œå¯ä»¥è·å–åˆ°é” NSConditionLock *conditionLock = [[NSConditionLock alloc]initWithCondition:condition]; dispatch_queue_t global = dispatch_get_global_queue(0, 0); dispatch_async(global, ^{ BOOL islocked = [conditionLock tryLockWhenCondition:1]; NSLog(@&quot;çº¿ç¨‹1 è¦æ‰§è¡Œ&quot;); sleep(2); NSLog(@&quot;çº¿ç¨‹1 æ‰§è¡Œå®Œæ¯•&quot;); if (islocked) { [conditionLock unlockWithCondition:3]; } }); dispatch_async(global, ^{ BOOL isLocked = [conditionLock lockWhenCondition:2 beforeDate:[NSDate dateWithTimeIntervalSinceNow:10]]; NSLog(@&quot;çº¿ç¨‹2 è¦æ‰§è¡Œ&quot;); sleep(2); NSLog(@&quot;çº¿ç¨‹2 æ‰§è¡Œå®Œæ¯•&quot;); if (isLocked) { [conditionLock unlockWithCondition:1]; } }); dispatch_async(global, ^{ BOOL isLocked = [conditionLock tryLockWhenCondition:3]; NSLog(@&quot;çº¿ç¨‹3 è¦æ‰§è¡Œ&quot;); sleep(3); NSLog(@&quot;çº¿ç¨‹3 æ‰§è¡Œå®Œæ¯•&quot;); if (isLocked) { NSLog(@&quot;åŠ é”äº†&quot;); [conditionLock unlockWithCondition:10]; } }); } â€‹ æ‰“å°ç»“æœå¦‚ä¸‹ 1234562017-04-26 23:11:56.343532 test[1092:199052] çº¿ç¨‹1 è¦æ‰§è¡Œ2017-04-26 23:11:56.343546 test[1092:199054] çº¿ç¨‹3 è¦æ‰§è¡Œ2017-04-26 23:11:58.348745 test[1092:199052] çº¿ç¨‹1 æ‰§è¡Œå®Œæ¯•2017-04-26 23:11:59.348618 test[1092:199054] çº¿ç¨‹3 æ‰§è¡Œå®Œæ¯•2017-04-26 23:12:06.348449 test[1092:199053] çº¿ç¨‹2 è¦æ‰§è¡Œ2017-04-26 23:12:08.353647 test[1092:199053] çº¿ç¨‹2 æ‰§è¡Œå®Œæ¯• dispatch_barrier_async()ä¸dispatch_barrier_sync()â€‹ GCDæä¾›äº†çº¿ç¨‹é¡ºåºæ§åˆ¶çš„ä¸€ä¸ªå‡½æ•°ï¼Œå‡è®¾æœ‰5ä¸ªä»»åŠ¡è¦æ‰§è¡Œï¼Œéœ€è¦å‰ä¿©ä¸ªå¹¶å‘æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆä¹‹åæ‰§è¡Œç¬¬ä¸‰ä¸ªä»»åŠ¡ï¼Œç­‰ç¬¬ä¸‰ä¸ªæ‰§è¡Œå®Œæˆæ‰å¯ä»¥æ‰§è¡Œç¬¬å››ä¸ªå’Œç¬¬äº”ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨dispath_barrier_async()å‡½æ•°ï¼Œå…·ä½“dispatch_barrier_asynä¸dispatch_barrier_syncæœ‰ä»€ä¹ˆåŒºåˆ«çš„è¯ï¼Œç¨åå†è¯´ï¼Œè¯·çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ 12345678910111213141516171819202122232425262728- (void)testBarrierAsyncAndSync{ /// åˆ›å»ºä¸€ä¸ªå¹¶å‘æ‰§è¡Œçš„é˜Ÿåˆ— dispatch_queue_t global = dispatch_queue_create(&quot;com.demo.chengyan&quot;, DISPATCH_QUEUE_CONCURRENT); dispatch_async(global, ^{ NSLog(@&quot;ä»»åŠ¡1&quot;); }); dispatch_async(global, ^{ NSLog(@&quot;ä»»åŠ¡2&quot;); }); dispatch_barrier_async(global, ^{ sleep(3); NSLog(@&quot;ä»»åŠ¡3&quot;); }); NSLog(@&quot;---------------&quot;); dispatch_async(global, ^{ NSLog(@&quot;ä»»åŠ¡4&quot;); }); dispatch_async(global, ^{ NSLog(@&quot;ä»»åŠ¡5&quot;); });} â€‹ æ‰“å°ç»“æœå¦‚ä¸‹ 1234562017-04-26 23:43:08.653034 test[1214:243421] ---------------2017-04-26 23:43:08.653138 test[1214:243447] ä»»åŠ¡12017-04-26 23:43:08.653151 test[1214:243448] ä»»åŠ¡22017-04-26 23:43:11.654589 test[1214:243447] ä»»åŠ¡32017-04-26 23:43:11.654715 test[1214:243447] ä»»åŠ¡42017-04-26 23:43:11.654728 test[1214:243448] ä»»åŠ¡5 â€‹ å¯ä»¥çœ‹åˆ°ç”±äºæ˜¯é€šè¿‡asyncçš„æ–¹å¼æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„ï¼Œæ‰€ä»¥æ²¡æœ‰é˜»å¡ä¸»çº¿ç¨‹ï¼Œâ€”â€”â€”â€”â€”â€“è¢«æœ€å…ˆæ‰§è¡Œäº†ã€‚åŒæ—¶æ³¨æ„åˆ°åœ¨ä»»åŠ¡3ä¸­ï¼Œæ²‰ç¡äº†3ç§’ï¼Œè€Œä»»åŠ¡4å’Œ5éƒ½åœ¨ç­‰ä»»åŠ¡3æ‰§è¡Œå®Œä¹‹åï¼Œæ‰å¼€å§‹æ‰§è¡Œçš„ã€‚ â€‹ é‚£ä¹ˆæ¥ä¸‹æ¥å†çœ‹ä¸‹syncçš„æ–¹å¼æ‰§è¡Œbarrierä¼šæ€ä¹ˆæ ·ï¼Ÿ 12345678910111213141516171819202122232425262728- (void)testBarrierAsyncAndSync{ /// åˆ›å»ºä¸€ä¸ªå¹¶å‘æ‰§è¡Œçš„é˜Ÿåˆ— dispatch_queue_t global = dispatch_queue_create(&quot;com.demo.chengyan&quot;, DISPATCH_QUEUE_CONCURRENT); dispatch_async(global, ^{ NSLog(@&quot;ä»»åŠ¡1&quot;); }); dispatch_async(global, ^{ NSLog(@&quot;ä»»åŠ¡2&quot;); }); dispatch_barrier_sync(global, ^{ sleep(3); NSLog(@&quot;ä»»åŠ¡3&quot;); }); NSLog(@&quot;---------------&quot;); dispatch_async(global, ^{ NSLog(@&quot;ä»»åŠ¡4&quot;); }); dispatch_async(global, ^{ NSLog(@&quot;ä»»åŠ¡5&quot;); });} â€‹ æ‰“å°ç»“æœå¦‚ä¸‹ 1234562017-04-26 23:53:57.275541 test[1249:258152] ä»»åŠ¡12017-04-26 23:53:57.275542 test[1249:258154] ä»»åŠ¡22017-04-26 23:54:00.280724 test[1249:258129] ä»»åŠ¡32017-04-26 23:54:00.280832 test[1249:258129] ---------------2017-04-26 23:54:00.280944 test[1249:258154] ä»»åŠ¡42017-04-26 23:54:00.281000 test[1249:258152] ä»»åŠ¡5 â€‹ å¯ä»¥çœ‹åˆ°ç”±äºsyncçš„æ–¹å¼ï¼Œé˜»å¡äº†ä¸»çº¿ç¨‹çš„æ“ä½œï¼Œå¯¼è‡´ä¸»çº¿ç¨‹åé¢çš„æ‰“å°å¿…é¡»è¦ç­‰ä»»åŠ¡3å®Œæˆä¹‹åæ‰ä¼šæ‰§è¡Œã€‚æ‰€ä»¥å°½é‡ä¸è¦ç”¨è¿™ç§æ–¹å¼åœ¨ä¸»çº¿ç¨‹è°ƒç”¨ã€‚é˜²æ­¢å¡åˆ°ui GCDçš„ä¸²è¡Œé˜Ÿåˆ—å®é™…ä¸Šä¹Ÿæ˜¯å¯ä»¥èµ·åˆ°é”çš„ä½œç”¨ï¼ˆç•¥ï¼‰os_unfair_lockï¼ˆç³»ç»Ÿéå…¬å¹³é”ï¼‰â€‹ åœ¨IOS10ï¼ŒMacOS10.12ä¹‹åï¼Œè‹¹æœæ–°æä¾›çš„é”ï¼Œç”¨æ¥æ›¿ä»£OSSPinLock,æ ¹æ®å®˜æ–¹æ–‡æ¡£è¯´æ˜ï¼Œè¯¥é”è§£å†³äº†OSSPinLockçš„ä¼˜å…ˆçº§åè½¬é—®é¢˜ï¼Œä¸»è¦æ˜¯é€šè¿‡è¯¥é”ä¸Šæºå¸¦çš„å€¼ä»¥åŠå®ƒæŒæœ‰çº¿ç¨‹çš„æ‰€æœ‰æƒä¿¡æ¯ï¼Œç³»ç»Ÿå¯ä»¥ä»¥æ­¤åšå‡ºç›¸åº”çš„ç­–ç•¥ï¼Œæ¥è§£å†³ä¼˜å…ˆçº§åè½¬çš„é—®é¢˜ã€‚å°±åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ªéå…¬å¹³é”ã€‚ â€‹ ä½¿ç”¨æ­¤é”ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ unlockå’Œlockæ“ä½œå¿…é¡»å¾—åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œå¦‚æœåœ¨ä¸åŒçš„çº¿ç¨‹ä¸­è§£é”ï¼Œå°†ä¼šå¯¼è‡´çº¿ç¨‹ç›´æ¥crashã€‚ è¯¥é”å†³ä¸èƒ½é€šè¿‡sharedæˆ–è€…mutiplay_mapped memoryçš„æ–¹å¼ï¼Œåœ¨å¤šçº¿ç¨‹æˆ–è€…å¤šè¿›ç¨‹ä¸­è®¿é—®ã€‚å› ä¸ºè¯¥é”çš„å®ç°ï¼Œä¾èµ–äºè¯¥é”çš„å€¼å’Œæ‰€åœ¨çš„è¿›ç¨‹ã€‚ è¯¥é”ä¸»è¦æ˜¯ä¸ºäº†æ›¿ä»£åºŸå¼ƒçš„OSSPinLockï¼Œä½†æ˜¯å®ƒåœ¨äº‰å¤ºèµ„æºçš„æ—¶å€™ï¼Œä¸æ˜¯é è‡ªæ—‹ï¼Œè€Œæ˜¯åœ¨å†…æ ¸ä¸Šç­‰å¾…å”¤é†’ã€‚ Macç³»ç»Ÿå¼€å‘è¦åœ¨10.12ä¹‹ååªç”¨ï¼ŒiOSéœ€è¦åœ¨iOS10ä»¥åæ‰èƒ½ä½¿ç”¨ â€‹ æœ€åè¦è¯´æ˜çš„æ˜¯ï¼Œæ­¤é”å°±åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œæ˜¯éå…¬å¹³çš„ï¼Œå…·ä½“å•¥æ„æ€å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œè§£å¼€é”çš„æ¶ˆè´¹è€…ï¼Œå­˜åœ¨ä¸€ç§å¯èƒ½ç«‹å³åˆé‡æ–°è·å¾—äº†é”ï¼Œå¯¼è‡´é‚£äº›åœ¨ä¼‘çœ ä¸­ç­‰å¾…çš„ä¸èƒ½è¢«å”¤é†’ã€‚è¿™å¯èƒ½æ˜¯å¤„äºæ€§èƒ½çš„è€ƒè™‘ï¼Œä½†æ˜¯ç¡®å®æœ‰ä¸€ç§å¯èƒ½å¯¼è‡´ç­‰å¾…è€…å¤„äºé¥¥é¥¿çŠ¶æ€ã€‚ â€‹ ä¸‹é¢çš„ä»£ç ç®€è¦æ¼”ç¤ºä¸‹å¦‚ä½•ä½¿ç”¨è¯¥é” 12345678910111213141516171819202122232425#import &lt;os/lock.h&gt;- (void)testUnfairlock{ os_unfair_lock_t unfairlock = &amp;OS_UNFAIR_LOCK_INIT; dispatch_queue_t queue = dispatch_get_global_queue(0, 0); dispatch_async(queue, ^{ sleep(1); os_unfair_lock_lock(unfairlock); NSLog(@&quot;çº¿ç¨‹1 å°†è¦æ‰§è¡Œ&quot;); sleep(3); NSLog(@&quot;çº¿ç¨‹1 æ‰§è¡Œç»“æŸ&quot;); os_unfair_lock_unlock(unfairlock); }); dispatch_async(dispatch_get_main_queue(), ^{ os_unfair_lock_lock(unfairlock); NSLog(@&quot;çº¿ç¨‹2 å°†è¦æ‰§è¡Œ&quot;); sleep(2); NSLog(@&quot;çº¿ç¨‹2 æ‰§è¡Œç»“æŸ&quot;); os_unfair_lock_unlock(unfairlock); }); } â€‹ æ‰“å°ç»“æœå¦‚ä¸‹ 12342017-04-28 00:14:11.692782 test[892:121163] çº¿ç¨‹2 å°†è¦æ‰§è¡Œ2017-04-28 00:14:13.698007 test[892:121163] çº¿ç¨‹2 æ‰§è¡Œç»“æŸ2017-04-28 00:14:13.698230 test[892:121192] çº¿ç¨‹1 å°†è¦æ‰§è¡Œ2017-04-28 00:14:16.700588 test[892:121192] çº¿ç¨‹1 æ‰§è¡Œç»“æŸ pthread_mutex_tï¼ˆäº’æ–¥é”ï¼‰â€‹ äº’æ–¥é”å’Œè‡ªæ—‹é”çš„åŒºåˆ«ï¼Œä¸»è¦å°±åœ¨äºï¼Œå½“è·å–é”å¤±è´¥ä¹‹åï¼Œè‡ªæ—‹é”ä¼šä¸€ç›´è½®è¯¢ï¼Œè€Œäº’æ–¥é”ä¼šè½®è¯¢å¤§æ¦‚ä¸€ç§’ä¹‹åï¼Œè¿›å…¥ä¼‘çœ ï¼Œç­‰å¾…å”¤é†’ï¼Œæ­¤å¤–äº’æ–¥é”ï¼Œæ˜¯æœ‰é˜Ÿåˆ—æ¦‚å¿µçš„ï¼Œæœ‰ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œä¾æ¬¡å”¤é†’ç­‰å¾…è€…ã€‚ â€‹ äº’æ–¥é”å’ŒNSLockçš„åŒºåˆ«åˆ™åœ¨äºäº’æ–¥é”trylockè¿”å›æ­£ç¡®æ—¶è¿”å›0ï¼Œé”™è¯¯æ—¶è¿”å›é”™è¯¯å€¼ï¼Œè€ŒNSLockåˆ™åªä¼šè¿”å›NOå’ŒYESã€‚ â€‹ æ­¤å¤–äº’æ–¥é”ä¹Ÿæ˜¯æ€§èƒ½æ¯”è¾ƒé«˜çš„é”ã€‚ä½¿ç”¨æ–¹å¼çš„è¯ï¼Œå¦‚ä¸‹ 123456789101112131415161718192021222324252627- (void)testPthreadMutex{ static pthread_mutex_t plock; pthread_mutex_init(&amp;plock, NULL); dispatch_queue_t queue = dispatch_get_global_queue(0, 0); dispatch_async(queue, ^{ sleep(1); pthread_mutex_lock(&amp;plock); NSLog(@&quot;çº¿ç¨‹1 å°†è¦æ‰§è¡Œ&quot;); sleep(3); NSLog(@&quot;çº¿ç¨‹1 æ‰§è¡Œç»“æŸ&quot;); pthread_mutex_unlock(&amp;plock); }); dispatch_async(dispatch_get_main_queue(), ^{ int code = pthread_mutex_lock(&amp;plock); NSLog(@&quot;çº¿ç¨‹2 å°†è¦æ‰§è¡Œ,code = %d&quot;,code); sleep(2); NSLog(@&quot;çº¿ç¨‹2 æ‰§è¡Œç»“æŸ&quot;); pthread_mutex_unlock(&amp;plock); }); // pthread_mutex_destroy(&amp;plock); } â€‹ æ‰§è¡Œç»“æœå¦‚ä¸‹ 12342017-04-28 00:14:11.692782 test[892:121163] çº¿ç¨‹2 å°†è¦æ‰§è¡Œ2017-04-28 00:14:13.698007 test[892:121163] çº¿ç¨‹2 æ‰§è¡Œç»“æŸ2017-04-28 00:14:13.698230 test[892:121192] çº¿ç¨‹1 å°†è¦æ‰§è¡Œ2017-04-28 00:14:16.700588 test[892:121192] çº¿ç¨‹1 æ‰§è¡Œç»“æŸ NSRecursiveLock(é€’å½’é”)â€‹ æ­¤é”å’ŒNSLockçš„åŒºåˆ«ä¸»è¦åœ¨äºå†…éƒ¨å®ç°åŸç†çš„ä¸åŒï¼ŒNSLockå†…éƒ¨å°è£…çš„pthread_mutex_tç±»å‹ä¸ºPTHREAD_MUTEX_TIMED_NPï¼Œè€ŒNSRecursiveLockçš„ç±»å‹ä¸ºPTHREAD_MUTEX_RECURSIVE_NPï¼Œæ­¤å¤–è¿˜æœ‰PTHREAD_MUTEX_ERRORCHECK_NPï¼ˆæ£€é”™é”ï¼‰ã€PTHREAD_MUTEX_ADAPTIVE_NPï¼ˆé€‚åº”é”ï¼‰ã€‚ â€‹ é€’å½’é”ï¼Œå…è®¸åŒä¸€ä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªé”æˆåŠŸè·å¾—å¤šæ¬¡ï¼Œå¹¶é€šè¿‡å¤šæ¬¡unlockè§£é”ã€‚å¦‚æœæ˜¯ä¸åŒçº¿ç¨‹è¯·æ±‚ï¼Œåˆ™åœ¨åŠ é”çº¿ç¨‹è§£é”æ—¶é‡æ–°ç«äº‰ã€‚ â€‹ è¯¥é”çš„ä½¿ç”¨åœºæ™¯ä¸»è¦æ˜¯åœ¨é€’å½’å‡½æ•°å†…éƒ¨è°ƒç”¨ã€‚ â€‹ æŒ‰ç…§æƒ¯ä¾‹è¿˜æ˜¯çœ‹ä¸ªä»£ç æ¥è¯´æ˜ä¸‹å¦‚ä½•ä½¿ç”¨ã€‚ 123456789101112131415161718192021222324252627282930313233- (void)testRecursiveLock{ NSRecursiveLock *recursive = [[NSRecursiveLock alloc]init];// dispatch_queue_t queue = dispatch_get_global_queue(0, 0); dispatch_async(queue, ^{ [self getFactorial:10 cursive:recursive]; });}- (int)getFactorial:(int)n cursive:(NSRecursiveLock *)lock{ int result = 0; NSLog(@&quot;åŠ é”&quot;); [lock lock]; if (n &lt;= 0) { result = 1; }else{ result = [self getFactorial:n-1 cursive:lock] * n; } NSLog(@&quot;result =%d&quot;,result); [lock unlock]; NSLog(@&quot;è§£é”&quot;); return result;} â€‹ æ‰“å°ç»“æœå¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132332017-05-02 00:43:08.241134 test[1194:551965] åŠ é”2017-05-02 00:43:08.241902 test[1194:551965] åŠ é”2017-05-02 00:43:08.241920 test[1194:551965] åŠ é”2017-05-02 00:43:08.241934 test[1194:551965] åŠ é”2017-05-02 00:43:08.241942 test[1194:551965] åŠ é”2017-05-02 00:43:08.241950 test[1194:551965] åŠ é”2017-05-02 00:43:08.241957 test[1194:551965] åŠ é”2017-05-02 00:43:08.241974 test[1194:551965] åŠ é”2017-05-02 00:43:08.241991 test[1194:551965] åŠ é”2017-05-02 00:43:08.241998 test[1194:551965] åŠ é”2017-05-02 00:43:08.242005 test[1194:551965] åŠ é”2017-05-02 00:43:08.242023 test[1194:551965] result =12017-05-02 00:43:08.242030 test[1194:551965] è§£é”2017-05-02 00:43:08.242036 test[1194:551965] result =12017-05-02 00:43:08.242053 test[1194:551965] è§£é”2017-05-02 00:43:08.242095 test[1194:551965] result =22017-05-02 00:43:08.242110 test[1194:551965] è§£é”2017-05-02 00:43:08.242128 test[1194:551965] result =62017-05-02 00:43:08.242136 test[1194:551965] è§£é”2017-05-02 00:43:08.242143 test[1194:551965] result =242017-05-02 00:43:08.242151 test[1194:551965] è§£é”2017-05-02 00:43:08.242293 test[1194:551965] result =1202017-05-02 00:43:08.242309 test[1194:551965] è§£é”2017-05-02 00:43:08.242317 test[1194:551965] result =7202017-05-02 00:43:08.242324 test[1194:551965] è§£é”2017-05-02 00:43:08.242331 test[1194:551965] result =50402017-05-02 00:43:08.242338 test[1194:551965] è§£é”2017-05-02 00:43:08.242344 test[1194:551965] result =403202017-05-02 00:43:08.242351 test[1194:551965] è§£é”2017-05-02 00:43:08.242357 test[1194:551965] result =3628802017-05-02 00:43:08.242365 test[1194:551965] è§£é”2017-05-02 00:43:08.242371 test[1194:551965] result =36288002017-05-02 00:43:08.242378 test[1194:551965] è§£é” NSConditionâ€‹ NSCondition çš„å¯¹è±¡å®é™…ä¸Šä½œä¸ºä¸€ä¸ªé”å’Œä¸€ä¸ªçº¿ç¨‹æ£€æŸ¥å™¨ï¼šé”ä¸»è¦ä¸ºäº†å½“æ£€æµ‹æ¡ä»¶æ—¶ä¿æŠ¤æ•°æ®æºï¼Œæ‰§è¡Œæ¡ä»¶å¼•å‘çš„ä»»åŠ¡ï¼›çº¿ç¨‹æ£€æŸ¥å™¨ä¸»è¦æ˜¯æ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦ç»§ç»­è¿è¡Œçº¿ç¨‹ï¼Œå³çº¿ç¨‹æ˜¯å¦è¢«é˜»å¡ã€‚ â€‹ ä½¿ç”¨æ–¹å¼ä¸»è¦åŒ…æ‹¬ï¼Œlockï¼Œunlock, wait, signal,å››ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æŒ‡è·å–é”ã€æ”¾å¼€é”ã€ç­‰å¾…ä¿¡å·ã€å‘é€ä¿¡å·ã€‚åŒæ ·ç”¨ä¸€æ®µç¤ºä¾‹ä»£ç æ¥çœ‹ä¸‹å®ƒçš„ç”¨æ³• 1234567891011121314151617181920212223242526272829303132- (void)testCondition{ NSCondition *condition = [NSCondition new]; NSMutableArray *ops = [NSMutableArray array]; dispatch_queue_t queue = dispatch_get_global_queue(0, 0); dispatch_async(queue, ^{ [condition lock]; NSLog(@&quot;1 å°†è¦ä¸Šé”&quot;); while (ops.count == 0) { NSLog(@&quot;1 ç­‰å¾…&quot;); [condition wait]; } NSLog(@&quot;1 ç§»é™¤ç¬¬ä¸€ä¸ªå…ƒç´ &quot;); [ops removeObjectAtIndex:0]; NSLog(@&quot;1 å°†è¦è§£é”&quot;); [condition unlock]; }); dispatch_async(queue, ^{ NSLog(@&quot;2 å°†è¦ä¸Šé”&quot;); [condition lock]; NSLog(@&quot;2 ç”Ÿäº§ä¸€ä¸ªå¯¹è±¡&quot;); [ops addObject:[NSObject new]]; NSLog(@&quot;2 å‘é€ä¿¡å·&quot;); [condition signal]; NSLog(@&quot;2 å°†è¦è§£é”&quot;); [condition unlock]; });} â€‹ æ‰“å°ç»“æœå¦‚ä¸‹ 123456782017-05-02 01:04:28.327316 test[1240:582713] 2 å°†è¦ä¸Šé”2017-05-02 01:04:28.327329 test[1240:582712] 1 å°†è¦ä¸Šé”2017-05-02 01:04:28.328121 test[1240:582712] 1 ç­‰å¾…2017-05-02 01:04:28.328149 test[1240:582713] 2 ç”Ÿäº§ä¸€ä¸ªå¯¹è±¡2017-05-02 01:04:28.328166 test[1240:582713] 2 å‘é€ä¿¡å·2017-05-02 01:04:28.328182 test[1240:582713] 2 å°†è¦è§£é”2017-05-02 01:04:28.328233 test[1240:582712] 1 ç§»é™¤ç¬¬ä¸€ä¸ªå…ƒç´ 2017-05-02 01:04:28.328261 test[1240:582712] 1 å°†è¦è§£é” è‡³æ­¤ï¼Œiosé‡Œé¢çš„å¤§éƒ¨åˆ†åŒæ­¥æ–¹æ³•æˆ‘ä»¬å·²ç»åŸºæœ¬äº†è§£äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯åœ¨å®è·µä¸­é€‰æ‹©åˆé€‚çš„æ–¹æ³•è¿›è¡Œåº”ç”¨äº†ã€‚ é™„å½•â€‹ å¦‚æœæœ‰æƒ³æŸ¥çœ‹DEMOçš„åŒå­¦ï¼Œå¯ä»¥ç‚¹å‡»å®ƒæ¥ä¸‹è½½DEMOï¼ŒæŸ¥çœ‹ã€‚ å‚è€ƒèµ„æ–™ iOSå¼€å‘ä¸­çš„8ç§é” æ·±å…¥ç†è§£ioså¼€å‘ä¸­çš„é” ä¸å†å®‰å…¨çš„OSSPinLock Threading Programming Guide Linuxçº¿ç¨‹-äº’æ–¥é”pthread_mutex_t iOS NSConditionè¯¦è§£","link":"/2017/05/02/iOS%E5%BC%80%E5%8F%91%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6/"},{"title":"è¯‘ ioså¹¶å‘ç¼–ç¨‹æŒ‡å—","text":"å¹¶å‘ç¼–ç¨‹æŒ‡å— å¹¶å‘1 æ¦‚è¿°1.1 å¹¶å‘çš„æ¦‚å¿µå¹¶å‘å…¶å®æŒ‡çš„æ˜¯å¤šé¡¹ä»»åŠ¡åœ¨åŒä¸€æ—¶é—´è¿›è¡Œï¼Œéšç€å¤šæ ¸CPUçš„æ™®åŠä»¥åŠå‘ç°ä»»åŠ¡åªåœ¨æŸä¸€æ ¸ä¸Šä¸åœçš„å¢åŠ ï¼Œè½¯ä»¶å¼€å‘è€…éœ€è¦ä¸€ç§æ–¹å¼å……åˆ†çš„åˆ©ç”¨å¤šæ ¸ç³»ç»Ÿã€‚è™½ç„¶è¯¸å¦‚IOSã€MacOSå…¼å®¹å¤šé¡¹ç¨‹åºåŒæ—¶æ‰§è¡Œï¼Œä½†æ˜¯å¤§å¤šæ•°çš„ç¨‹åºè¿è¡Œåœ¨åå°ï¼Œå¹¶ä¸”æ‰§è¡Œä»»åŠ¡åªéœ€è¦å¾ˆçŸ­çš„CPUæ—¶é—´ã€‚è¿™æ˜¯å› ä¸ºå‰å°åº”ç”¨åŒæ—¶è·å–äº†ç”¨æˆ·çš„å…³æ³¨å¹¶ä¸”æ˜¯è®¾å¤‡å¤„äºå¿™çš„çŠ¶æ€ã€‚å¦‚æœä¸€ä¸ªç¨‹åºæœ‰å¾ˆå¤šçš„ä»»åŠ¡éœ€è¦å¤„ç†ï¼Œä½†æ˜¯åˆåªè·å¾—äº†å¾ˆå°‘çš„ç¢ç‰‡CPUæ—¶é—´ï¼Œé‚£äº›é¢å¤–çš„å¤„ç†èµ„æºå°†è¢«æµªè´¹ã€‚ åœ¨è¿‡å»ï¼Œåœ¨åº”ç”¨ä¸­å¼•å…¥å¹¶å‘è¦æ±‚åˆ›å»ºä¸€ä¸ªæˆ–è€…å¤šä¸ªé¢å¤–çš„çº¿ç¨‹ï¼Œé—æ†¾çš„æ˜¯ï¼Œç¼–å†™çº¿ç¨‹ä»£ç æ˜¯ä¸€é¡¹éå¸¸æœ‰æŒ‘æˆ˜æ€§çš„äº‹æƒ…ï¼Œçº¿ç¨‹æ˜¯ä¸€ç§â€˜ä½çº§â€™çš„å·¥å…·ï¼Œå¹¶ä¸”éœ€è¦æ‰‹åŠ¨å»ç®¡ç†ï¼Œè·å–å¤šå°‘ä¸ªçº¿ç¨‹æ˜¯æœ€ä¼˜çš„ï¼ŒåŠ¨æ€å–å†³äºå½“å‰çš„ç³»ç»Ÿä»¥åŠåº•å±‚ç¡¬ä»¶çš„æ”¯æŒã€‚å®ç°ä¸€ä¸ªå®Œç¾çš„çº¿ç¨‹è§£å†³æ–¹æ¡ˆï¼Œå˜çš„æå…¶å›°éš¾æˆ–è€…è¯´ä¸å¯èƒ½å®ç°ã€‚å¦å¤–ï¼Œé‡‡å–æ·»åŠ çº¿ç¨‹çš„æ–¹å¼å®ç°åŒæ­¥çš„æœºåˆ¶ï¼Œä¸ä»…ç»™è½¯ä»¶å¼€å‘å¸¦æ¥äº†å¤æ‚æ€§å’Œé£é™©æ€§ï¼Œè€Œä¸”ä¹Ÿå¹¶ä¸èƒ½ç¡®ä¿æå‡æ€§èƒ½ã€‚ OSXå’ŒiOSé‡‡å–äº†ä¸€ç§æ¯”ä¼ ç»Ÿçš„åŸºäºçº¿ç¨‹çš„ç³»ç»Ÿå’Œç¨‹åºï¼Œæ›´åŠ å¼‚æ­¥çš„æ–¹å¼å»æ‰§è¡Œå¹¶å‘ä»»åŠ¡ã€‚å¹¶ä¸æ˜¯ç›´æ¥å»åˆ›å»ºçº¿ç¨‹ï¼Œåº”ç”¨éœ€è¦åšçš„æ˜¯å®šä¹‰ä¸€äº›ç‰¹æ®Šçš„ä»»åŠ¡ï¼Œç„¶åè®©ç³»ç»Ÿå»æ‰§è¡Œå®ƒä»¬ï¼Œè®©æ“ä½œç³»ç»Ÿå»ç®¡ç†çº¿ç¨‹ï¼Œç¨‹åºè·å¾—äº†åŸç”Ÿçº¿ç¨‹æ›´å¼ºçš„ä¼¸ç¼©æ€§ï¼Œè€Œç¨‹åºå¼€å‘è€…ä¹Ÿè·å¾—äº†æ›´åŠ ç®€å•æ›´åŠ é«˜æ•ˆçš„ç¼–ç¨‹æ¨¡å‹ã€‚ æœ¬æ–‡æ¡£å°±æ˜¯æè¿°è¿™é¡¹æŠ€æœ¯å’ŒæŠ€è‰ºï¼Œä½ åº”è¯¥ä½¿ç”¨è¿™é¡¹æŠ€æœ¯æ¥å®ç°å¹¶å‘ã€‚è¿™é¡¹æŠ€æœ¯åŒæ—¶ä½¿ç”¨äºiOSå’ŒOSXã€‚ 1.2 æ–‡æ¡£çš„ç»„ç»‡æœ¬æ–‡æ¡£åŒ…æ‹¬ä»¥ä¸‹ç« èŠ‚1ã€å¹¶å‘å’Œç¨‹åºè®¾è®¡â€”â€”ä»‹ç»å¼‚æ­¥ç¨‹åºè®¾è®¡çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µå’Œå¼‚æ­¥çš„æ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡çš„æŠ€æœ¯2ã€æ“ä½œé˜Ÿåˆ—â€”â€”å±•ç¤ºæ€æ ·ç”¨OCå»ç»„è£…å’Œæ‰§è¡Œä¸€ä¸ªä»»åŠ¡3ã€åˆ†å‘é˜Ÿåˆ—â€”â€”å±•ç¤ºæ€æ ·åœ¨åŸºäºCçš„åº”ç”¨ç¨‹åºä¸­å»å¹¶å‘åœ°æ‰§è¡Œä»»åŠ¡4ã€èµ„æºåˆ†å‘â€”â€”å±•ç¤ºå¦‚ä½•å¼‚æ­¥çš„å¤„ç†ç³»ç»Ÿäº‹ä»¶5ã€ä»çº¿ç¨‹å˜æˆç”¨è¿ç§»åˆ°æ–°çš„æŠ€æœ¯â€”â€”æä¾›ä¸€äº›æŠ€æœ¯å¸®åŠ©ä»æ—§çš„çº¿ç¨‹å˜æˆè¿ç§»åˆ°æ–°çš„å˜æˆæŠ€æœ¯ æœ¬æ–‡å½“åŒæ—¶ä¹ŸåŒ…æ‹¬ä¸€äº›ç›¸å…³ç« èŠ‚çš„ä¸“ä¸šæœ¯è¯­çš„å®šä¹‰ 1.3 ä¸€äº›ä¸“ä¸šåè¯åœ¨å¼€å§‹è®¨è®ºå¹¶å‘ä¹‹å‰ï¼Œéå¸¸æœ‰å¿…è¦å»å®šä¹‰ä¸€äº›ç›¸å…³çš„ä¸“ä¸šåè¯æ¥é¿å…æ··æ·†ï¼Œä¸€äº›å¼€å‘UNIXæˆ–è€…æ—©å…ˆå¼€å‘OSXçš„ç¨‹åºå‘˜ï¼Œå¯èƒ½ä¼šå¯¹ä»»åŠ¡ï¼Œé˜Ÿåˆ—å¤„ç†ã€çº¿ç¨‹æœ‰ä¸€äº›æ–°çš„ä»»åŠ¡ï¼Œæœ¬æ–‡æ¡£å¯¹è¿™å‡ ä¸ªæ¦‚å¿µæœ‰å¦‚ä¸‹å®šä¹‰1ã€åœ¨æœ¬æ–‡ä¸­ï¼Œçº¿ç¨‹ä¸“æŒ‡ä¸€ä¸ªåˆ†ç¦»çš„æ”¯çº¿å»æ‰§è¡Œä¸€æ®µä»£ç ï¼Œè€Œåœ¨è€çš„OSXä¸­ç‰¹æŒ‡åŸºäºPOSIXçš„API 2ã€åœ¨æœ¬æ–‡ä¸­ï¼Œæ‰§è¡Œä¸“æŒ‡å¯æ‰§è¡Œçš„ä»»åŠ¡æ­£åœ¨æ‰§è¡Œä¸­ï¼Œå¯èƒ½åŒ…è£¹ç€å¤šä¸ªçº¿ç¨‹ã€‚3ã€åœ¨æœ¬æ–‡ä¸­ï¼Œä»»åŠ¡ä¸“æŒ‡ä¸€ä¸ªéœ€è¦è¢«æ‰§è¡Œçš„æŠ½è±¡å·¥ä½œ å…³äºå®Œæ•´çš„ç±»ä¼¼è¿™äº›æ¦‚å¿µçš„å®šä¹‰ï¼Œå‚è§è¯æ±‡å®šä¹‰ 1.4 å…¶ä»–æœ¬æ–‡æ¡£ä¸“æ³¨äºå¦‚ä½•åœ¨ä½ çš„ç¨‹åºä¸­å®ç°å¹¶å‘ç¼–ç¨‹ï¼Œè€Œä¸åŒ…æ‹¬å¦‚ä½•ä½¿ç”¨çº¿ç¨‹ï¼Œå¦‚æœä½ éœ€è¦æ›´å¤šçš„æœ‰å…³çº¿ç¨‹å¼€å‘çš„åªæ˜¯ï¼Œè¯·å»å‚è€ƒçº¿ç¨‹ç¼–ç¨‹æŒ‡å¯¼ 2 å¹¶å‘åŠç¨‹åºè®¾è®¡2.1 å¹¶å‘ç¼–ç¨‹å’Œç¨‹åºè®¾è®¡åœ¨ä»¥å‰çš„è®¡ç®—æœºè¿è¡Œçš„æ—¶å€™ï¼Œè®¡ç®—æœºå•ä½æ—¶é—´æœ€å¤§æ‰§è¡Œæ•°é‡çš„ä»»åŠ¡å–å†³äºCPUçš„æ—¶é’Ÿé€Ÿåº¦ï¼Œä½†æ˜¯éšç€æŠ€æœ¯çš„å‘å±•å’Œä¸­å¤®å¤„ç†å™¨è®¾è®¡çš„æ›´åŠ ç´§å‡‘ï¼Œçƒ­é‡å’Œç‰©ç†å› ç´ å¼€å§‹é™åˆ¶ä¸­å¤®å¤„ç†å™¨çš„æœ€å¤§æ—¶é’Ÿé€Ÿåº¦ï¼Œæ‰€ä»¥ï¼Œä¸»æ¿ä¾›åº”å•†ä¹Ÿåœ¨å¯»æ‰¾å…¶ä»–çš„æ–¹å¼å»æå‡ä»–ä»¬ä¸»æ¿çš„æ€»ä½“æ€§èƒ½ï¼Œä»–ä»¬å‘ç°çš„è§£å†³æ–¹æ¡ˆæ˜¯å¢åŠ ä¸»æ¿ä¸Šçš„å¤„ç†å™¨ä¸ªæ•°ï¼Œé€šè¿‡å¢åŠ å¤„ç†å™¨ä¸ªæ•°ï¼Œä¸€ä¸ªä¸»æ¿å¯ä»¥åœ¨å•ä½æ—¶é—´å†…æ‰§è¡Œæ›´å¤šçš„ä»»åŠ¡ï¼Œè€Œå¹¶ä¸éœ€è¦å»å¢åŠ CPUçš„æ—¶é’Ÿé€Ÿåº¦ï¼Œæˆ–æ˜¯æ”¹å˜ä¸»æ¿çš„å¤§å°æˆ–è€ƒè™‘çƒ­é‡å‚æ•°ï¼Œç°åœ¨å‰©ä¸‹çš„å”¯ä¸€é—®é¢˜å°±æ˜¯å¦‚ä½•å»å……åˆ†çš„åˆ©ç”¨è¿™äº›å¤šæ ¸ã€‚ ä¸ºäº†åˆ©ç”¨è¿™äº›å¤šæ ¸ï¼Œè®¡ç®—æœºéœ€è¦ç¨‹åºè®¾è®¡è€…èƒ½å¤Ÿå»åŒæ—¶æ‰§è¡Œå¤šé¡¹ä»»åŠ¡ï¼Œåœ¨å½“ä»£ï¼Œå¤šæ ¸æ“ä½œç³»ç»Ÿï¼Œå¦‚OSXæˆ–è€…IOSï¼Œå¯èƒ½æœ‰å‡ ç™¾æˆ–è€…æ›´å¤šçš„ç¨‹åºåœ¨åŒæ—¶è¿è¡Œï¼Œæ‰€ä»¥æ ¹æ®æ—¶åºå®‰æ’ç¨‹åºåœ¨ä¸åŒçš„ä¸­å¤®å¤„ç†å™¨ä¸Šå˜å¾—æˆä¸ºå¯èƒ½ï¼Œç„¶è€Œï¼Œå¤§å¤šæ•°çš„æ—¶å€™ï¼Œè¿™äº›ç¨‹åºè¦ä¹ˆæ˜¯ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ï¼Œè¦ä¹ˆæ˜¯é‚£äº›æ¶ˆè´¹å¾ˆå°å¤„ç†æ—¶é—´çš„åå°åº”ç”¨ç¨‹åºï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ï¼ŒçœŸæ­£éœ€è¦å¤šæ ¸å¼€å‘çš„æ˜¯ï¼Œç‹¬ç«‹çš„å‰å°è¿è¡Œçš„ç¨‹åºæ›´é«˜æ•ˆçš„è·å–æ›´å¤šæ ¸å¿ƒã€‚ ä¼ ç»Ÿçš„ä½¿åº”ç”¨è·å–å¤šæ ¸çš„æ–¹å¼æ˜¯åˆ›å»ºå¤šçº¿ç¨‹ï¼Œç„¶è€Œï¼Œéšç€å¤šæ ¸çš„å¢åŠ ï¼Œçº¿ç¨‹æ–¹æ¡ˆæœ‰ä¸€äº›é—®é¢˜ï¼Œæœ€å¤§çš„é—®é¢˜æ˜¯çº¿ç¨‹å¼€å‘çš„æ–¹å¼å¯¹å¤šæ ¸ç³»ç»Ÿä¸å…·å¤‡å¾ˆå¥½çš„ä¼¸ç¼©æ€§ï¼Œä½ ä¸èƒ½ä»…é åˆ›å»ºæ›´å¤šçš„è¡Œç¨‹å°±èƒ½ç¡®ä¿ç¨‹åºå’Œå¤„ç†å™¨è¿è¡Œè‰¯å¥½ï¼Œä½ éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œå¦‚ä½•é«˜æ•ˆçš„åˆ©ç”¨è¿™äº›ä¸­å¤®å¤„ç†å™¨ã€‚å¯¹äºç¨‹åºæ¥è®²ï¼Œå¦‚ä½•è®¡ç®—å®ƒè‡ªèº«æ˜¯ä¸€ä»¶æœ‰æŒ‘æˆ˜çš„äº‹æƒ…ï¼Œå°½ç®¡ä½ å¯ä»¥æ­£ç¡®çš„ç®¡ç†è¿™äº›çº¿ç¨‹ï¼Œç¨‹åºå»ç®¡ç†è¿™äº›çº¿ç¨‹ä¹Ÿä¾ç„¶æ˜¯ä¸€é¡¹æŒ‘æˆ˜ï¼Œå»ç¡®ä¿ä»–ä»¬é«˜æ•ˆè¿è¡Œã€ç¡®ä¿ä»–ä»¬ä¸è¢«åˆ«çš„çº¿ç¨‹å¹²æ‰°ã€‚ æ‰€ä»¥ï¼Œæ€»ç»“è¿™äº›é—®é¢˜ï¼Œç¨‹åºéœ€è¦ä¸€ç§æ–¹å¼å»å……åˆ†åº”ç”¨å¤šæ ¸ï¼Œå•ä¸ªç¨‹åºå¯ä¼¸ç¼©çš„æ‰§è¡Œå¤§é‡å·¥ä½œï¼Œè€Œä¸”è¿™ä¸ªè§£å†³æ–¹æ¡ˆéœ€è¦è¶³å¤Ÿç®€å•ï¼Œå»é¢å¯¹å•ä¸ªå¤„ç†å™¨ä»»åŠ¡çš„ä»»åŠ¡å¢é•¿ï¼Œå¥½æ¶ˆæ¯æ˜¯ï¼Œè‹¹æœå·²ç»æä¾›äº†è§£å†³æ–¹æ¡ˆå¯¹å¤„ç†æ‰€æœ‰è¿™äº›é—®é¢˜ï¼Œæœ¬ç« èŠ‚å…ˆç¹ä¸ºå¿«ï¼Œå»çœ‹çœ‹è¿™é¡¹æŠ€æœ¯çš„ç»„æˆä»¥åŠç‰›é€¼çš„è®¾è®¡ï¼Œä½ å¯ä»¥ä½¿ä½ çš„ä»£ç ä»ä¸­è·ç›Šã€‚ 2.2 ä»çº¿ç¨‹å¼€å‘ä¸­èµ°å‡ºæ¥å°½ç®¡çº¿ç¨‹å¼€å‘å·²ç»åº”ç”¨äº†å¤šå¹´ï¼Œè€Œä¸”å®ƒä»¬åœ¨æŸäº›åœ°æ–¹è¿˜å°†æœ‰ç”¨æ­¦ä¹‹åœ°ï¼Œä½†æ˜¯å®ƒä»¬å¹¶æ²¡æœ‰å¯ä¼¸ç¼©çš„è§£å†³å¤šæ ¸åœºæ™¯ï¼Œå¦‚æœä½ ä½¿ç”¨çº¿ç¨‹å¼€å‘ï¼Œé‚£ä¹ˆåˆ›å»ºä¸€ä¸ªå¯ä¼¸ç¼©çš„è§£å†³æ–¹æ¡ˆçš„éº»çƒ¦å°±è½åœ¨ä½ è‚©ä¸Šäº†ï¼Œå¼€å‘è€…ï¼Œä½ éœ€è¦å»åŠ¨æ€çš„æ ¹æ®ç³»ç»Ÿçš„å¤šæ ¸ä¸ªæ•°å»å†³å®šåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹ï¼Œæ­¤å¤–ï¼Œä½ çš„åº”ç”¨å°†èŠ±è´¹å¾ˆå¤šæ¶ˆè€—åœ¨åˆ›å»ºå’Œç®¡ç†è¿™äº›çº¿ç¨‹æœ¬èº«çš„æ¶ˆè€—ä¸Šã€‚ å–ä»£çº¿ç¨‹å¼€å‘ï¼ŒOSXå’ŒIOSä½¿ç”¨å¼‚æ­¥è®¾è®¡çš„æ–¹å¼è§£å†³å¹¶å‘é—®é¢˜ï¼Œå¼‚æ­¥æ–¹æ³•å·²ç»åœ¨æ“ä½œç³»ç»Ÿä¸­æä¾›äº†å¾ˆå¤šå¹´ï¼Œè€Œä¸”ä¸€èˆ¬éƒ½æ˜¯åº”ç”¨åœ¨åˆ›å»ºå¾ˆè€—æ—¶çš„ä»»åŠ¡ä¸Šï¼Œå¦‚ä»ç£ç›˜è¯»å–æ–‡ä»¶ã€‚å½“è°ƒç”¨çš„æ—¶å€™ï¼Œä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å¼€å§‹åœ¨åå°æ‰§è¡Œï¼Œå¹¶ç«‹å³è¿”å›åœ¨ä»»åŠ¡æ‰§è¡Œå®Œä¹‹å‰ã€‚é€šå¸¸ï¼Œè¿™é¡¹ä»»åŠ¡ä¼šè°ƒç”¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œå¼€å§‹è¿™é¡¹ä»»åŠ¡åœ¨è¯¥åå°çº¿ç¨‹ä¸Šï¼Œç„¶ååœ¨ä»»åŠ¡å®Œæˆçš„æ—¶å€™å‘é€ä¸€ä¸ªæ¶ˆæ¯ç»™è°ƒç”¨è€…ï¼ˆé€šå¸¸ä½¿ç”¨å›è°ƒçš„æ–¹å¼ï¼‰ã€‚åœ¨è¿‡å»ï¼Œå¦‚æœæ²¡æœ‰ä¸€ä¸ªä½ éœ€è¦çš„å¼‚æ­¥æ–¹æ³•ï¼Œä½ éœ€è¦è‡ªå·±å»å†™ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•è¿˜éœ€è¦åˆ›å»ºè‡ªå·±çš„çº¿ç¨‹ï¼Œä½†æ˜¯ç°åœ¨ï¼ŒOSXå’ŒiOSæä¾›æŠ€æœ¯ï¼Œä½ å¯ä»¥ä¸ç”¨è‡ªå·±å»ç®¡ç†çº¿ç¨‹å°±å¯ä»¥å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ã€‚ ä¸€ç§å¼€å¯å¼‚æ­¥ä»»åŠ¡çš„æŠ€æœ¯å« GCDï¼Œä¸€é¡¹å°†è¿‡å»éœ€è¦åœ¨ä½ ç¨‹åºä¸­è‡ªå·±å†™ç®¡ç†çº¿ç¨‹ä»£ç ç§»äº¤ç»™ç³»ç»Ÿå»ç®¡ç†ã€‚æ‰€æœ‰ä½ éœ€è¦åšçš„äº‹æƒ…ä»…ä»…æ˜¯åˆ›å»ºä»»åŠ¡ï¼Œç„¶åå°†ä»»åŠ¡æäº¤ç»™åˆé€‚çš„ç³»ç»Ÿçš„GCDé˜Ÿåˆ—ã€‚GCDå»åˆ›å»ºå’Œç®¡ç†è¿™äº›çº¿ç¨‹ï¼Œå› ä¸ºè¿™äº›çº¿ç¨‹å·²ç»æäº¤ç»™ç³»ç»Ÿå»ç®¡ç†ï¼ŒGCDæä¾›å…¨å¥—çš„ä»»åŠ¡ç®¡ç†å’Œæ‰§è¡Œï¼Œæ¯”ä¼ ç»Ÿçš„çº¿ç¨‹ç®¡ç†æ›´åŠ é«˜æ•ˆã€‚ æ“ä½œé˜Ÿåˆ—æ˜¯éå¸¸ç±»ä¼¼äºåˆ†å‘é˜Ÿåˆ—çš„ä¸€ç§OCå¯¹è±¡ç®¡ç†æ–¹å¼ï¼Œä½ å¯ä»¥å®šä¹‰ä½ æƒ³æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç„¶åæŠŠä»–ä»¬æ‰”åˆ°æ“ä½œé˜Ÿåˆ—ä¸­ï¼Œå½“æ‰§è¡Œè¿™äº›å®‰æ’å¥½çš„ä»»åŠ¡æ—¶ï¼Œç±»ä¼¼äºGCDï¼Œæ“ä½œé˜Ÿåˆ—ä¸ºä½ æ‰§è¡Œæ‰€æœ‰çš„ç®¡ç†ã€‚ç¡®ä¿åœ¨ç³»ç»Ÿé•¿æ‰§è¡Œçš„é«˜æ•ˆä¸”è¿…é€Ÿã€‚ ä¸‹é¢çš„æ®µè½æä¾›äº†æ›´å¤šçš„ä¿¡æ¯å…³äºæ“ä½œé˜Ÿåˆ—ã€åˆ†å‘é˜Ÿåˆ—ã€ä»¥åŠä¸€äº›ä½ å¯èƒ½åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ç”¨åˆ°çš„æŠ€æœ¯ 2.2.1 åˆ†å‘é˜Ÿåˆ—åˆ†å‘é˜Ÿåˆ—æ˜¯ä¸€å¥—Cçš„æœºåˆ¶ï¼Œä¸ºå¯æ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡ã€‚åˆ†å‘é˜Ÿåˆ—è¦ä¹ˆæ˜¯ä¸²è¡Œçš„è¦ä¹ˆæ˜¯å¹¶è¡Œçš„ï¼Œä½†æ˜¯é€šå¸¸éƒ½æ˜¯æŒ‰ç…§FIFOçš„æ–¹å¼å»è°ƒåº¦ä»»åŠ¡ï¼Œä¸€ä¸ªä¸²è¡Œçš„é˜Ÿåˆ—ï¼Œä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œåªæœ‰ç­‰å‰ä¸€ä¸ªä»»åŠ¡å®Œæˆä¹‹åï¼Œä¸‹ä¸ªä»»åŠ¡æ‰èƒ½å¼€å¯ã€‚ä½œä¸ºå¯¹æ¯”ï¼Œå¹¶è¡Œçš„é˜Ÿåˆ—å¯ä»¥åŒæ—¶å¼€å¯å°½å¯èƒ½å¤šçš„ä»»åŠ¡è€Œå¹¶ä¸éœ€è¦å‰é¢çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚ åˆ†å‘é˜Ÿåˆ—æœ‰ä¸‹é¢å‡ ä¸ªå¥½å¤„ 1ã€æä¾›äº†ç®€å•çš„ç›´è§‚çš„ç¼–ç¨‹æ¥å£ 2ã€æä¾›äº†è‡ªåŠ¨çš„å’Œå®Œå…¨çš„çº¿ç¨‹æ± ç®¡ç† 3ã€ä»»åŠ¡æ‰§è¡Œé€Ÿåº¦æå‡ 4ã€æ›´å¤šçš„å†…å­˜æ–¹é¢çš„ä¼˜åŒ– 5ã€ä»–ä»¬ä¸ä¼šå¢åŠ å†…æ ¸çš„è´Ÿè½½ 6ã€ä¸ä¼šå¯¼è‡´é˜Ÿåˆ—æ­»é” 7ã€ä¼¸ç¼©æ€§å¼ºï¼ˆå¯¹å¤šæ ¸ç³»ç»Ÿæ¥è®²ï¼‰ 8ã€ä¸²è¡Œé˜Ÿåˆ—æä¾›äº†æ¯”è¿‡å»çº¿ç¨‹åŒæ­¥æ›´ä¸ºä¼˜ç§€çš„ä¸€ç§é€‰æ‹© ä½ æä¾›ç»™åˆ†å‘é˜Ÿåˆ—çš„ä»»åŠ¡å¿…é¡»æ˜¯å°è£…å¥½çš„ä¸€ä¸ªæ–¹æ³•æˆ–è€…æ˜¯ä¸€ä¸ªBlockå¯¹è±¡ï¼ŒBlockæ˜¯ä¸€ç§å…·æœ‰Cè¯­è¨€ç‰¹æ€§çš„ï¼Œå¼€å§‹å¼•è¿›ä¸OSX 10.6,IOS 4.0çš„ä¸€ä¸ªæ–°ç‰¹æ€§ã€‚ä½†æ˜¯ç›¸æ¯”Cè¯­è¨€æœ‰ä¸€äº›åˆ«çš„å¥½å¤„ã€‚ä¸åŒäºåœ¨Blockçš„è¯­æ³•åŒºåŸŸå®šä¹‰Blockå¯¹è±¡ï¼Œä½ é€šå¸¸åœ¨åˆ«çš„æ–¹æ³•æˆ–è€…æ˜¯å‡½æ•°ä¸­å»å®šä¹‰ï¼Œè¿™æ ·å¯ä»¥å»æ•è·åˆ°åˆ«çš„æ–¹æ³•æˆ–è€…å‡½æ•°ä¸­çš„å˜é‡ï¼ŒBlockåŒæ ·å¯ä»¥ç§»åŠ¨åˆ°ä»–ä»¬çš„ä½œç”¨åŒºåŸŸä»¥å¤–ï¼Œæ‹·è´åˆ°å †ä¸Šï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨ä½ å°†ä»»åŠ¡æ·»åŠ åˆ°ä¸€ä¸ªåˆ†å‘é˜Ÿåˆ—ä¸Šçš„æ—¶å€™ï¼Œæ‰€æœ‰è¿™äº›è¯­æ³•ç‰¹æ€§ï¼Œä½¿å¾—é€šè¿‡æ·»åŠ å°‘é‡ä»£ç å°±å¯ä»¥è·å¾—éå¸¸å¥½çš„å®ç°ã€‚ åˆ†å‘é˜Ÿåˆ—æ˜¯GCDæŠ€æœ¯çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯Cè¿è¡Œæ—¶çš„ä¸€éƒ¨åˆ†ï¼Œè¦æƒ³è·å–æ›´å¤šçš„æœ‰å…³åˆ†å‘é˜Ÿåˆ—ç›¸å…³çš„ä¿¡æ¯ï¼Œè¯·å‚è§ åˆ†å‘é˜Ÿåˆ—ï¼Œè¦è·å–æ›´å¤šå…³äºBlockçš„ä¿¡æ¯å’Œä»–ä»¬çš„å¥½å¤„ï¼Œå‚è§Block ç¨‹åºç¼–ç¨‹è§‚ç‚¹ã€‚ 2.2.2 åˆ†å‘èµ„æºåˆ†å‘èµ„æºæ˜¯å¼‚æ­¥çš„å¤„ç†ç³»ç»Ÿåˆ†å‘èµ„æºçš„ä¸€ç§Cè¯­è¨€æœºåˆ¶ï¼Œåˆ†å‘èµ„æºå°è£…äº†ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„ç³»ç»Ÿäº‹ä»¶ï¼Œå¹¶å°†è¿™ä¸ªç‰¹æ®Šçš„ç³»ç»Ÿäº‹ä»¶æäº¤ç»™ä¸€ä¸ªç‰¹æ®Šçš„Blockå¯¹è±¡ï¼Œæˆ–è€…å‡½æ•°ï¼Œå½“ç³»ç»Ÿäº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨åˆ†å‘èµ„æºå»ç›‘æµ‹å¦‚ä¸‹ç‰¹æ®Šç³»ç»Ÿäº‹ä»¶ å®šæ—¶å™¨ ä¿¡å·äº‹ä»¶ æè¿°ç¬¦ç›¸å…³äº‹ä»¶ è¿›ç¨‹ç›¸å…³äº‹ä»¶ ç«¯å£åŒ¹é…ç›¸å…³äº‹ä»¶ è‡ªå®šä¹‰çš„äº‹ä»¶ï¼Œå¹¶ç”±ä½ æ¥è§¦å‘ åˆ†å‘èµ„æºä¹Ÿæ˜¯GCDæŠ€æœ¯çš„ä¸€éƒ¨åˆ†ï¼Œè¦è·å–æ›´å¤šæœ‰å…³åˆ†å‘èµ„æºç›¸å…³çš„ä¿¡æ¯ï¼Œå‚è§åˆ†å‘èµ„æº 2.2.3 æ“ä½œé˜Ÿåˆ—æ“ä½œé˜Ÿåˆ—æ˜¯cocoaç¯å¢ƒçš„ä¸€ç§å¹¶å‘é˜Ÿåˆ—ï¼Œç”±NSOperationQueueClass å®ç°ï¼Œæ“ä½œé˜Ÿåˆ—æ€»æ˜¯æŒ‰ç…§FIFOçš„æ–¹å¼å»æ‰§è¡Œä»»åŠ¡ï¼Œæ“ä½œé˜Ÿåˆ—è€ƒè™‘å…¶ä»–å› ç´ å»å½±å“æ‰§è¡Œé˜Ÿåˆ—çš„é¡ºåºï¼Œåœ¨è¿™äº›å› ç´ ä¸­ï¼Œä¼˜å…ˆè€ƒè™‘ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ˜¯å¦æ˜¯ä¾èµ–äºå…¶ä»–ä»»åŠ¡ï¼Œä½ å¯ä»¥ç»™è‡ªå·±çš„ä»»åŠ¡è®¾ç½®ä¾èµ–å…³ç³»ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªå¤æ‚çš„æ‰§è¡Œé¡ºåºå›¾ã€‚ ä»»åŠ¡æ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—ä¸­çš„ï¼Œå¿…é¡»æ˜¯NSOperationçš„å­ç±»ï¼Œä¸€ä¸ªæ“ä½œå¯¹è±¡æ˜¯ä¸€ä¸ªOCç±»å‹çš„å°è£…äº†ä½ è¦æ‰§è¡Œçš„æ•°æ®å’Œä»»åŠ¡çš„å¯¹è±¡ï¼Œç”±äºNSOperationæ˜¯ä¸€ä¸ªæŠ½è±¡åŸºç±»ï¼Œæ‰€ä»¥ä½ é€šå¸¸éœ€è¦å»è‡ªå®šä¹‰å­ç±»å»æ‰§è¡Œä½ çš„ä»»åŠ¡ï¼Œç„¶è€Œï¼ŒFoundation Frameworkå·²ç»æä¾›äº†ä¸€äº›ç›¸å…³çš„å­ç±»ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬å»æ‰§è¡Œä»»åŠ¡ã€‚ æ“ä½œçš„å¯¹è±¡äº§ç”ŸKVOé€šçŸ¥ï¼Œè¿™ä¸ªæ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå½“ç›‘è§†ä½ çš„ä»»åŠ¡è¿›åº¦çš„æ—¶å€™ï¼Œè™½ç„¶ä»»åŠ¡æ‰§è¡Œé€šå¸¸æ˜¯å¹¶å‘çš„ï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨ä¾èµ–æ˜¯çš„ä»»åŠ¡æœ‰åºã€‚ å…³äºæ›´å¤šæ“ä½œé˜Ÿåˆ—çš„ä¿¡æ¯ï¼Œå‚è§æ“ä½œé˜Ÿåˆ— 2.3 å¼‚æ­¥ç¼–ç¨‹æŠ€æœ¯åœ¨ä½ å¼€å§‹è€ƒè™‘é‡æ–°ç”¨å¹¶å‘ç¼–ç¨‹çš„æ–¹å¼é‡æ–°è®¾è®¡ç¨‹åºçš„æ—¶å€™ï¼Œä½ æœ€å¥½å…ˆé—®ä¸‹è‡ªå·±è¿™ä¹ˆåšæ˜¯å¦å¿…è¦ï¼Œå¹¶å‘å¯ä»¥æé«˜ä½ ä»£ç çš„å¯å“åº”æ€§ï¼Œå»ç¡®ä¿ä¸»çº¿ç¨‹èƒ½ç›¸åº”æ›´å¤šçš„ç”¨æˆ·äº‹ä»¶ï¼Œå®ƒåŒæ ·å¯ä»¥æé«˜ä½ ä»£ç çš„æ€§èƒ½ï¼Œé€šè¿‡ä¿ƒè¿›å¤šæ ¸å»æ‰§è¡Œæ›´å¤šçš„ä»»åŠ¡ï¼Œä½†æ˜¯å®ƒä¹ŸåŒæ—¶å¸¦æ¥äº†ä¸Šå±‚å¤æ‚æ€§ï¼Œä»è€Œä½¿ä½ çš„ä»£ç æ›´åŠ éš¾è°ƒè¯•ã€‚ ç”±äºå®ƒå¸¦æ¥äº†å¤æ‚æ€§ï¼Œå¹¶å‘å¹¶ä¸æ˜¯ä¸€ä¸ªåœ¨ä½ ç¨‹åºå¼€å‘¨æœŸä¸­è€ƒè™‘çš„ç‰¹æ€§ï¼Œå½“æŠŠå®ƒå«æ¥åˆ°åº”ç”¨ä¸­ã€‚åšå¯¹è¿™ä»¶äº‹éœ€è¦ä½ å¥½å¥½è€ƒè™‘ä½ ç¨‹åºæ‰§è¡Œçš„ä»»åŠ¡ä»¥åŠå‘è¿™äº›ä»»åŠ¡æäº¤çš„æ•°æ®ç»“æ„ã€‚å¦‚æœåšé”™çš„è¯ï¼Œä½ å¯èƒ½å‘ç°ä½ çš„ä»£ç è¿è¡Œç¼“æ…¢ï¼Œç”šè‡³è¿˜ä¸å¦‚ä»å‰ï¼Œå› æ­¤ï¼Œåœ¨ä½ å¼€å§‹ç¨‹åºè®¾è®¡çš„æ—¶å€™ï¼Œä½ å°±åº”è¯¥è€ƒè™‘ä½ è¦å®ç°çš„ç›®æ ‡å’Œé€šè¿‡ä½•ç§æ–¹å¼æ¥è¾¾åˆ°å®ƒã€‚ æ¯ä¸ªåº”ç”¨éƒ½åŒ…å«æœ‰ä¸åŒçš„è¦æ±‚å’Œä¸åŒçš„ä»»åŠ¡éœ€è¦å®ƒå»æ‰§è¡Œï¼Œè¿™ä¸å¯èƒ½é ä¸€ä¸ªæ–‡æ¡£å°±å‘Šè¯‰ä½ ï¼Œæ€ä¹ˆå»è®¾è®¡ä½ çš„ç¨‹åºå’Œç®¡ç†ä»»åŠ¡ï¼Œç„¶è€Œï¼Œä¸‹é¢å‡ æ®µå¯ä»¥ç»™ä½ æä¾›ä¸€äº›æŒ‡å¯¼ï¼Œå¸®åŠ©ä½ å»åœ¨ç¨‹åºè®¾è®¡çš„æ—¶å€™åšå‡ºå¥½çš„é€‰æ‹©ã€‚ 2.3.1 æ˜ç¡®ç¨‹åºæœŸæœ›çš„è¡¨ç°åœ¨ä½ å†³å®šæ˜¯å¦è¦å°†å¹¶å‘å¼•å¯¼åˆ°åº”ç”¨ä¸­çš„æ—¶å€™ï¼Œä½ åº”å½“å¼€å§‹æ€è€ƒä½ çš„åº”ç”¨ç¨‹åºæƒ³è¦è¾¾åˆ°çš„ä¸€ä¸ªä»€ä¹ˆè¡¨ç°ã€‚æ˜ç™½äº†åº”ç”¨è¦è¾¾åˆ°çš„è¡¨ç°ä¹‹åï¼Œä¼šç»™ä½ æ˜¯å¦ä½¿ç”¨å¹¶å‘æä¾›ä¸€ä¸ªå‚è€ƒã€‚åŒæ ·çš„ï¼Œä¹Ÿä¼šç»™ä½ ä¸€äº›å¼•å…¥å¹¶å‘ä¹‹åç¨‹åºèƒ½è·å–çš„æ€§èƒ½æ”¶ç›Šæ–¹é¢çš„å¯å‘ã€‚ é¦–å…ˆã€ä½ éœ€è¦åˆ—ä¸¾åº”ç”¨ç¨‹åºæ‰€è¦æ‰§è¡Œçš„ä»»åŠ¡å’Œæ•°æ®ç»“æ„ä¹‹é—´çš„å…³ç³»ã€‚å¼€å§‹ï¼Œä½ å¯èƒ½é€šè¿‡ç‚¹å‡»ä¸€ä¸ªèœå•æˆ–è€…ä¸€ä¸ªæŒ‰é’®å¼€å¯ä¸€ä¸ªä»»åŠ¡å¹¶æ‰§è¡Œï¼Œè¿™äº›ä»»åŠ¡å¯èƒ½æ˜¯ä¸€äº›ç¦»æ•£çš„ä»»åŠ¡ï¼Œå¹¶æœ‰æ˜ç¡®çš„å¼€å§‹å’Œç»“æŸç‚¹ã€‚ä½ è¿˜éœ€è¦åˆ—ä¸¾å‡ºåº”ç”¨ç¨‹åºå¯èƒ½æ‰§è¡Œçš„å…¶ä»–ç±»å‹çš„ä»»åŠ¡ï¼Œè€Œä¸ä»…ä»…æ˜¯ç”¨æˆ·è¡Œä¸ºç›¸å…³çš„ï¼Œæ¯”å¦‚è¯´åŸºäºæ—¶é—´çš„ä¸€äº›ä»»åŠ¡ åœ¨ä½ æœ‰äº†è‡ªå·±ä»»åŠ¡åˆ—è¡¨ä¹‹åï¼Œå¼€å§‹æŠŠä»»åŠ¡è¿›è¡Œæ›´åŠ çš„åˆ†ç»„é›†åˆï¼Œç¡®ä¿è¿™äº›ä»»åŠ¡èƒ½å¤ŸæˆåŠŸæ‰§è¡Œã€‚åœ¨è¿™ä¸ªå±‚é¢ï¼Œä½ ä¼˜å…ˆè€ƒè™‘çš„æ˜¯é‚£äº›æ•°æ®æˆ–å¯¹è±¡ä¿®æ”¹å¦‚ä½•å¯¹åº”ç”¨çŠ¶æ€è¿›è¡Œä¿®æ”¹çš„ã€‚ä½ åŒæ ·éœ€è¦è€ƒè™‘ä¸åŒä»»åŠ¡ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»ï¼Œä¾‹å¦‚ï¼šå¦‚æœä¸€ä¸ªä»»åŠ¡ç‰µæ¶‰åˆ°ä¸€ä¸ªæ•°ç»„ä¸­æ‰€æœ‰å¯¹è±¡çš„ä¿®æ”¹ï¼Œå¯¹äºå…¶ä¸­ä¸€ä¸ªæ•°æ®çš„ä¿®æ”¹ï¼Œä¼šå¯¹å…¶ä»–æ•°æ®äº§ç”Ÿä»»ä½•å½±å“ã€‚å¦‚æœä¸€ä¸ªæ•°æ®çš„ä¿®æ”¹ï¼Œç‹¬ç«‹äºå…¶ä»–çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨å¹¶å‘å»åšæå‡æ€§èƒ½ï¼Œåˆ›å»ºå¤šä¸ªä»»åŠ¡å»åšã€‚ 2.3.2 å•ä½å·¥ä½œçš„å¯æ‰§è¡Œå› å­åœ¨æ˜ç™½ä½ ç¨‹åºæ‰§è¡Œçš„ä»»åŠ¡ç±»å‹ä¹‹åï¼Œä½ åº”è¯¥æ˜ç™½åœ¨ä»€ä¹ˆåœ°æ–¹å»ä½¿ç”¨å¹¶å‘ä¼šæœ‰å¥½å¤„äº†ã€‚å¦‚æœåœ¨ä¸€ä¸ªä»»åŠ¡ä¸­æ”¹å˜ä¸€ä¸ªæˆ–è€…å¤šä¸ªçš„é¡ºåºï¼Œä¼šå½±å“åˆ°æ‰§è¡Œç»“æœã€‚ä½ åº”è¯¥è¿˜æ˜¯éœ€è¦è€ƒè™‘åˆ°ä½¿ç”¨ä¸²è¡Œçš„æ–¹å¼å»æ‰§è¡Œè¿™äº›ä»»åŠ¡ï¼Œå¦‚æœæ”¹å˜æ‰§è¡Œé¡ºåºä¹‹åï¼Œå¹¶ä¸ä¼šå½±å“åˆ°æ‰§è¡Œç»“æœï¼Œä½ å¯ä»¥è€ƒè™‘å°†è¿™äº›ä»»åŠ¡ç”¨å¹¶å‘çš„æ–¹å¼å»åšï¼Œåœ¨è¿™ä¿©ç§æƒ…å½¢ä¸‹ï¼Œä½ å®šä¹‰å¯æ‰§è¡Œçš„å•ä½å·¥ä½œï¼Œå¹¶è®©å®ƒä»¬æ‰§è¡Œï¼Œè¿™äº›å·¥ä½œå•å…ƒï¼Œå°±æˆä¸ºä½ å°è£…å¥½çš„Blockå¯¹è±¡æˆ–è€…æ“ä½œå¯¹è±¡æˆ–è€…åˆ†å‘é˜Ÿåˆ—ã€‚ å¯¹äºæ¯ä¸ªå•ç‹¬çš„å¯æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶ä¸éœ€è¦è¿‡å¤šçš„æ‹…å¿ƒä»»åŠ¡æ‰§è¡Œçš„æ•°é‡ï¼Œåœ¨æœ€åï¼Œåˆ†åˆ°çº¿ç¨‹ä¸­æ€»æ˜¯ä¼šæœ‰å¼€é”€ï¼Œä½†æ˜¯åˆ†å‘é˜Ÿåˆ—æˆ–è€…æ“ä½œé˜Ÿåˆ—ç›¸æ¯”ä¼ ç»Ÿçš„çº¿ç¨‹å¼€å‘è¿˜æ˜¯æœ‰å¾ˆå¤šä¼˜åŠ¿çš„ï¼Œå› æ­¤ï¼Œæ‰§è¡Œä¸€äº›å•å…ƒå·¥ä½œä½¿ç”¨æ“ä½œé˜Ÿåˆ—è¿˜æ˜¯è¦æ¯”ç›´æ¥æ“ä½œçº¿ç¨‹è¦å¥½å¾ˆå¤šï¼Œå½“ç„¶ï¼Œä½ å¸¸å¸¸åº”è¯¥ç¡®ä¿ä»»åŠ¡æ‰§è¡Œçš„æ€§èƒ½å’Œä½ å¼€å¯çš„ä»»åŠ¡æ°å¥½å¦‚ä½ æ‰€éœ€ï¼Œä½†æ˜¯ï¼Œä»»åŠ¡å¹¶ä¸æ˜¯è¶Šå°å°±è¶Šå¥½ã€‚ 2.3.3 åŒºåˆ†ä½ éœ€è¦ä»€ä¹ˆé˜Ÿåˆ—æ­¤æ—¶ï¼Œä½ çš„ä»»åŠ¡å·²ç»åˆ‡å‰²ä¸ºä¸€äº›å¯æ‰§è¡Œçš„å•å…ƒï¼Œå¹¶ä¸”å°è£…æˆäº†Blockå¯¹è±¡æˆ–è€…æ˜¯æ“ä½œå¯¹è±¡ï¼Œä½ éœ€è¦å»å®šä¹‰ä½ è¦æ‰§è¡Œçš„é˜Ÿåˆ—ä»¥æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚å¯¹ä¸€ä¸ªä»»åŠ¡æ¥è®²ï¼Œæµ‹è¯•è¿™äº›Blockæˆ–è€…æ˜¯æ“ä½œä»»åŠ¡ï¼Œèƒ½å¤Ÿåœ¨é˜Ÿåˆ—ä¸­æ‰§è¡Œæ­£ç¡®ã€‚ å¦‚æœä½ ä½¿ç”¨Blockå»å®ç°ä½ çš„ä»»åŠ¡,ä½ å¯ä»¥æ·»åŠ ä»»åŠ¡åˆ°ä¸²è¡Œæˆ–è€…å¹¶è¡Œçš„é˜Ÿåˆ—é‡Œï¼Œå¦‚æœå¯¹é¡ºåºæœ‰è¦æ±‚çš„è¯ï¼Œä½ åªèƒ½æ·»åŠ åˆ°ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ä¸­ï¼Œå¦‚æœæ²¡æœ‰è¦æ±‚ï¼Œæ ¹æ®ä½ çš„è¦æ±‚ï¼Œä½ å¯ä»¥æ·»åŠ çš„å¹¶è¡Œé˜Ÿåˆ—ä¸­ï¼Œæˆ–è€…æ·»åŠ åˆ°å¤šä¸ªé˜Ÿåˆ—ä¸­å»ã€‚ å¦‚æœä½ æ˜¯ç”¨æ“ä½œé˜Ÿåˆ—å»æ‰§è¡Œä»»åŠ¡ï¼Œé‚£ä¹ˆé€‰æ‹©çš„é˜Ÿåˆ—å¹¶ä¸å¯¹æ·»åŠ åˆ°é‡Œé¢çš„ä»»åŠ¡çš„é…ç½®æ„Ÿå…´è¶£ï¼Œå¦‚æœè¦ä¸²è¡Œå»æ‰§è¡Œä»»åŠ¡ï¼Œé‚£ä¹ˆä½ éœ€è¦ç»™ç›¸å…³çš„ä»»åŠ¡è®¾ç½®ä¾èµ–å…³ç³»ï¼Œä¾èµ–ä¼šé˜»æ­¢ä»»åŠ¡å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°å®ƒä¾èµ–çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚ 2.3.4 æå‡æ‰§è¡Œæ•ˆç‡çš„è´´å£«åœ¨æŠŠä»»åŠ¡åˆ†å‰²ä¸ºæ›´å°çš„ä»»åŠ¡å¹¶å°†ä»–ä»¬æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­åï¼Œè¿™é‡Œè¿˜æœ‰ä¸€äº›ä½¿ç”¨é˜Ÿåˆ—æå‡ç¨‹åºæ€§èƒ½çš„å°Tips å¦‚æœå†…å­˜è€ƒè™‘æ˜¯ä¸€ä¸ªå› ç´ çš„è¯ï¼Œé‚£ä¹ˆåœ¨ä»»åŠ¡é‡Œé¢ç›´æ¥è®¡ç®—ã€‚å¦‚æœä½ çš„åº”ç”¨å·²ç»å†…å­˜è­¦å‘Šäº†ï¼Œé‚£ä¹ˆåœ¨ä»»åŠ¡ä¸­ç›´æ¥è®¡ç®—ä¼šæ¯”ä»å†…å­˜ä¸­åŠ è½½è¦å¿«ä¸€äº›ã€‚è¿ç”¨åœ¨å¯„å­˜å™¨æˆ–è€…æ˜¯è¯¥æ ¸ä¸Šçš„å†…å­˜è®¡ç®—ï¼Œä¼šæ¯”ä»ä¸»å†…å­˜åŠ è½½è¦å¿«ä¸€äº›ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡æµ‹è¯•æ¥é€‰æ‹©å“ªç§æ–¹æ¡ˆä¼šå¥½ä¸€äº›ã€‚ å°†ä¸²è¡Œçš„ä»»åŠ¡ï¼Œå¯èƒ½çš„è¯æ”¹å˜ä¸ºå¹¶å‘ã€‚å¦‚æœä¸€ä¸ªä»»åŠ¡ç”±äºå…±äº«èµ„æºå¿…é¡»ä¸²è¡Œå»æ‰§è¡Œï¼Œå¯ä»¥è€ƒè™‘å°†å…±äº«èµ„æºç§»é™¤ä½¿å¾—å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œå¯ä»¥è€ƒè™‘æŠŠè¿™äº›èµ„æºç»™æ¯ä¸ªå®¢æˆ·éƒ½æ‹·è´ä¸€ä»½ã€‚ é¿å…ä½¿ç”¨é”ï¼Œæ“ä½œé˜Ÿåˆ—å’Œåˆ†å‘é˜Ÿåˆ—çš„æ”¯æŒåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¹¶ä¸éœ€è¦é”ã€‚åšä¸ºå–ä»£ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªä¸²è¡Œçš„é˜Ÿåˆ—æˆ–è€…ä½¿ç”¨ä¾èµ–å»ä¿è¯é¡ºåºæ­£ç¡®ã€‚ å¦‚æœå¯èƒ½çš„è¯ä¾èµ–ç³»ç»Ÿæ¡†æ¶ï¼Œæœ€å¥½çš„æ–¹å¼å»å®ç°å¹¶å‘å°±æ˜¯ä½¿ç”¨ç³»ç»Ÿæä¾›çš„æ¡†æ¶ï¼Œè®¸å¤šæ¡†æ¶ä½¿ç”¨çº¿ç¨‹æˆ–è€…å…¶ä»–æŠ€æœ¯æ¥å®ç°å¹¶å‘ï¼Œå½“å®šä¹‰ä½ çš„ä»»åŠ¡çš„æ—¶å€™ï¼Œçœ‹çœ‹ç³»ç»Ÿæ¡†æ¶ä¸­æ˜¯å¦å·²ç»æœ‰æ–¹æ³•æˆ–è€…å‡½æ•°èƒ½å¤Ÿå®ç°å¹¶å‘ï¼Œä½¿ç”¨ç³»ç»Ÿæ¥å£ä¼šæå‡ä½ çš„æ•ˆç‡ï¼Œè€Œä¸”å¸®ä½ åšåˆ°æ›´å¤šçš„å¹¶å‘å¯èƒ½æ€§ã€‚ 2.4 æ€§èƒ½ç›¸å…³æ“ä½œé˜Ÿåˆ—ã€åˆ†å‘é˜Ÿåˆ—ã€èµ„æºåˆ†å‘æä¾›äº†ä¸€ç§æ‰§è¡Œå¹¶å‘æ›´åŠ å®¹æ˜“çš„æ–¹å¼ã€‚ä½†æ˜¯è¿™äº›æŠ€æœ¯å¹¶ä¸ä¿è¯æå‡ç¨‹åºçš„æ€§èƒ½å’Œå¯å“åº”æ€§ã€‚å…·ä½“æ¥è®²ï¼Œæ ¹æ®ä½ çš„éœ€è¦åŒæ—¶å…¼é¡¾æ€§èƒ½æå‡å’Œä¸è¦å½±å“åˆ°å…¶ä»–èµ„æºä»ç„¶æ˜¯ä½ è‡ªå·±éœ€è¦è¡¡é‡çš„ä¸€ä»¶äº‹ã€‚ä¸¾ä¸ªä¾‹å­æ¥è®²ï¼Œå°½ç®¡ä½ åˆ›å»ºäº†10000ä¸ªä»»åŠ¡å¹¶æŠŠä»–ä»¬éƒ½æäº¤åˆ°æ“ä½œé˜Ÿåˆ—ä¸­ï¼Œè¿™ä¹ˆå¹²çš„è¯ï¼Œè‚¯å®šä¼šå¯¼è‡´ä½ çš„ç¨‹åºåˆ†é…æ½œåœ¨çš„å¤§é‡å†…å­˜ï¼Œè¿™ä¸ªä¼šå¯¼è‡´å¢åŠ è°ƒåº¦å’Œå‡å°‘æ€§èƒ½ã€‚ å¼•å…¥å¹¶å‘åˆ°ä½ çš„ç¨‹åºä¸­å‰â€“æ˜¯ä½¿ç”¨é˜Ÿåˆ—è¿˜æ˜¯çº¿ç¨‹ï¼Œä½ éœ€è¦æ ¹æ®ç¨‹åºå½“å‰çš„æ€§èƒ½æ¥è®¾ç½®ä¸€ä¸ªå‚è€ƒçš„æ ‡å‡†ã€‚åœ¨å¼•å…¥å¹¶å‘ä¹‹åï¼Œä¹ŸåŒæ ·éœ€è¦åšä¸ªåˆ—è¡¨å¯¹æ€§èƒ½æ–¹é¢çš„æ”¹å˜è¿›è¡Œæ¯”è¾ƒï¼Œæ¥ç¡®ä¿ç¨‹åºæ˜¯çœŸçš„æ€§èƒ½æå‡äº†ï¼Œå¦‚æœå¼•å…¥å¹¶å‘å¹¶ä¸èƒ½ç»™æ€§èƒ½å¸¦æ¥å¤§çš„æå‡ï¼Œä½ åº”è¯¥è€ƒè™‘å…¶ä»–çš„æ€§èƒ½å·¥å…·æ¥æ£€æµ‹æ½œåœ¨çš„åŸå› ã€‚ å…³äºæ€§èƒ½çš„ä»‹ç»å’Œå¯ç”¨çš„æ€§èƒ½å·¥å…·ï¼Œå‚è§æ€§èƒ½æ¦‚è§ˆã€‚ 2.5 å¹¶å‘å’Œå…¶ä»–æŠ€æœ¯å°†ä½ çš„ä»£ç åˆ†è§£ä¸ºæ¨¡å—ä»»åŠ¡æ˜¯ä¸€ç§æœ€å¥½çš„æå‡åº”ç”¨å¹¶å‘çš„æ–¹å¼ï¼Œä½†æ˜¯è¿™ç§è®¾è®¡æ–¹å¼å¹¶ä¸æ˜¯å¯¹æ¯ä¸ªåº”ç”¨æ¯ä¸ªæƒ…å†µéƒ½å¾ˆé€‚åˆï¼Œå–å†³äºä½ æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨å…¶ä»–çš„é€‰æ‹©æ¥æå‡ç¨‹åºçš„æ•´ä½“å¹¶å‘ï¼Œä¸‹é¢çš„ä¿©å°èŠ‚æä¾›äº†å…¶ä»–çš„å¹¶å‘æŠ€æœ¯ä¾›ä½ å‚è€ƒ 2.5.1 OpenGLå’Œå¹¶å‘åœ¨OSXä¸­ï¼ŒOpenGCæŠ€æœ¯æ˜¯å›¾å½¢è®¡ç®—æ–¹ä¾¿æœ€åŸºç¡€å’Œæ ¸å¿ƒçš„æŠ€æœ¯ï¼ŒOpenGLæ˜¯éå¸¸æ£’çš„è®¡ç®—å¤§æ•°æ®é›†åˆçš„ä¸€ç§æŠ€æœ¯ï¼Œä¸¾ä¸ªä¾‹å­æ¥è®²ï¼Œä½ å¯èƒ½ä½¿ç”¨OpenGLæŠ€æœ¯æ¥ç»™å›¾ç‰‡åšåƒç´ çº§åˆ«çš„æ»¤é•œï¼Œæˆ–è€…ç”¨å®ƒæ¥è®¡ç®—å¤æ‚çš„æ•°å­¦è®¡ç®—ã€‚æ¢è€Œè¨€ä¹‹ï¼ŒOpenGLå¯ä»¥ç”¨æ¥è®¡ç®—å¤§é‡æ•°æ®é›†åˆæ˜¯å¹¶è¡Œçš„ã€‚ å°½ç®¡OpenGLåœ¨å¤§é‡æ•°æ®å¹¶è¡Œæ‰§è¡Œæ–¹é¢æœ‰ç€éå¸¸å¥½çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œä½†æ˜¯å®ƒå¹¶ä¸åˆé€‚æ‰§è¡Œè‡ªå®šä¹‰çš„è®¡ç®—ï¼Œåœ¨ä»»åŠ¡æäº¤ç»™GPUå¤„ç†ä¹‹å‰ï¼Œæœ‰å¤§é‡çš„å‡†å¤‡å·¥åšï¼Œè€Œä¸”è¦å°†æ•°æ®å’Œå…¶ä»–å¿…è¦çš„æ ¸å¿ƒæ“ä½œè½¬æ¢å›¾å½¢å¡ç‰‡ã€‚åŒæ ·çš„ï¼Œè¦æƒ³è·å–OpenGLçš„äº§ç”Ÿç»“æœä¹Ÿéœ€è¦å¶å¾ˆå¤šå…¶ä»–çš„åŠªåŠ›ã€‚å› æ­¤ï¼Œæ‰€æœ‰è·Ÿç³»ç»Ÿäº¤äº’ç›¸å…³çš„ä»»åŠ¡ä¸å»ºè®®æäº¤ç»™OpenGLå»æ‰§è¡Œï¼Œä¸¾ä¸ªä¾‹å­ï¼Œä½ ä¸åº”è¯¥ç”¨OpenGLå»è¿ç®—ä»æ–‡ä»¶ä¸­æˆ–è€…ç½‘ç»œæµä¸­æ‹¿åˆ°çš„æ•°æ®ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ï¼Œä½ è¦ç”¨OpenGLæ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¿…ç„¶æ˜¯è‡ªå·±å·²ç»æŒæœ‰çš„è¿™æ ·ç›¸å¯¹æ¥è®²ä¼ é€’ç»™GPUè¿ç®—æ›´åŠ ç‹¬ç«‹ã€‚ æ›´å¤šå…³äºOpenGLçš„åªæ˜¯ï¼Œå‚è§OpenGLå¼€å‘æŒ‡å¯¼ã€‚ 2.5.2 ä½•æ—¶ä½¿ç”¨çº¿ç¨‹å°½ç®¡æ“ä½œé˜Ÿåˆ—å’Œåˆ†å‘é˜Ÿåˆ—æ˜¯æ‰§è¡Œå¹¶å‘ä»»åŠ¡çš„æ›´ä¼˜é€‰æ‹©ï¼Œä½†æ˜¯å®ƒä»¬ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå–å†³äºä½ çš„åº”ç”¨ç¨‹åºï¼Œè¿™é‡Œä»ç„¶åä¸€äº›æƒ…å†µæ˜¯éœ€è¦åˆ›å»ºçº¿ç¨‹å»å¼€å‘çš„ï¼Œå¦‚æœä½ åˆ›å»ºäº†è‡ªå®šä¹‰çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆä½ è¦ç¡®ä¿å°½é‡å°‘çš„å¼€å¯çº¿ç¨‹ï¼Œå¹¶ä¸”ç¡®ä¿è¿™äº›çº¿ç¨‹åªæ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ï¼Œè€Œä¸å»å¹²åˆ«çš„äº‹æƒ…ã€‚ çº¿ç¨‹ä»ç„¶æ˜¯ä¸€ç§è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå½“æ‰§è¡Œå®æ—¶ä»»åŠ¡çš„æ—¶å€™ï¼Œåˆ†å‘é˜Ÿåˆ—ä¼šç¡®ä¿å°½å¿«çš„å»æ‰§è¡Œä»–ä»¬çš„ä»»åŠ¡ï¼Œä½†æ˜¯å¹¶ä¸èƒ½å®æ—¶çš„å»å¼€çº¿ç¨‹å»åšã€‚å¦‚æœä½ éœ€è¦å¯é¢„æµ‹çš„åå°ä»£ç æ‰§è¡Œï¼Œé‚£ä¹ˆçº¿ç¨‹ä»æ˜¯ä¸€ç§é€‰æ‹©ã€‚ ä½œä¸ºçº¿ç¨‹ç¼–ç¨‹ï¼Œä½ è¿˜æ˜¯éœ€è¦å»ä½¿ç”¨çº¿ç¨‹ï¼Œå½“å¿…é¡»å’Œå®Œå…¨å¿…è¦çš„æ—¶å€™ï¼Œå…³äºæ›´å¤šçº¿ç¨‹æ–¹é¢çš„çŸ¥è¯†ï¼Œå‚è§çº¿ç¨‹å¼€å‘æŒ‡å¯¼ã€‚ 3 æ“ä½œé˜Ÿåˆ—cocoaçš„æ“ä½œéƒ½æ˜¯åŸç”Ÿçš„å¯¹è±¡å°è£…çš„å¯æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ã€‚è¿™äº›æ“ä½œåŒæ—¶å¯æäº¤ç»™æ“ä½œé˜Ÿåˆ—å»æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥è‡ªå·±æ‰§è¡Œã€‚ç”±äºæ˜¯åŸºäºOCçš„æ¡†æ¶ï¼Œé‚£ä¹ˆæ“ä½œå¯åº”ç”¨åœ¨IOSå’ŒOSXä¸­ã€‚æœ¬ç« èŠ‚å°†ä»‹ç»å¦‚ä½•å»ä½¿ç”¨å’Œå®šä¹‰æ“ä½œã€‚ 3.1 å…³äºæ“ä½œå¯¹è±¡ä¸€ä¸ªæ“ä½œå¯¹è±¡æ˜¯ä¸€ä¸ªNSOperationç±»çš„å®ä¾‹ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥å°è£…ä½ è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚NSOperationç±»æœ¬èº«æ˜¯ä¸€ä¸ªæŠ½è±¡åŸºç±»ã€‚æ‰€ä»¥è¦æƒ³æ‰§è¡Œå¯ç”¨çš„ä»»åŠ¡ï¼Œå¿…é¡»å¾—ä½¿ç”¨å®ƒçš„å­ç±»ã€‚å°½ç®¡æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒè¿˜æ˜¯æä¾›äº†ä¸€äº›æœ‰ç”¨çš„åŸºæœ¬æ“ä½œï¼Œè€Œçœå»äº†ä½ åœ¨è‡ªå·±å®šä¹‰çš„å­ç±»ä¸­å»åšçš„éº»çƒ¦ã€‚æ­¤å¤–ï¼ŒFoundation æ¡†æ¶è¿˜æä¾›äº†ä¿©ä¸ªå…·ä½“çš„å­ç±»ï¼Œå¯ä»¥ç”¨å®ƒä»¬æ¥æ‰§è¡Œä½ çš„ä»»åŠ¡ï¼Œä¸‹è¡¨åˆ—å‡ºäº†è¿™ä¿©ä¸ªç±»ï¼Œè¿˜æœ‰å¦‚ä½•ä½¿ç”¨å®ƒä»¬çš„ä»‹ç»ã€‚ NSInvocationOperation ï¼šè¿™æ˜¯ä¸€ä¸ªåŸºäºä½ çš„ç±»å’Œè¦æ‰§è¡Œçš„Seletorçš„ç±»ï¼Œä½ å¯ä»¥åœ¨å·²ç»å®šä¹‰è¿‡è¿™ä¸ªä»»åŠ¡çš„åœ°æ–¹å»è°ƒç”¨å®ƒï¼Œç„¶åæ‰§è¡Œå¼‚æ­¥æ“ä½œã€‚ç”±äºå®ƒå¹¶ä¸è¦å¼ºåˆ¶ä½ å»åšç»§æ‰¿ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨è¯¥ç±»å»å®ç°ä¸€ä¸ªæ›´åŠ åŠ¨æ€çš„é£æ ¼ã€‚ NSBlockOperationï¼šè¿™æ˜¯ä¸€ä¸ªæ‰§è¡Œblockå°è£…ä»»åŠ¡çš„æ“ä½œç±»ï¼Œå› ä¸ºå®ƒå¯ä»¥æ‰§è¡Œå¤šä¸ªblockã€‚blockä»»åŠ¡æ‰§è¡Œä»»åŠ¡ä½¿ç”¨äº†ç»„çš„è¯­æ³•ï¼Œå½“æ‰€æœ‰çš„ç›¸å…³çš„blockæ‰§è¡Œå®Œä¹‹åï¼Œè¿™ä¸ªblockæ“ä½œæ‰è¢«ä»»åŠ¡æ˜¯æ‰§è¡Œå®Œæˆ NSOperationï¼šè¿™æ˜¯å®šä¹‰å…¶ä»–æ“ä½œä»»åŠ¡çš„åŸºç±»ï¼Œç»§æ‰¿å®ƒç»™ä½ è‡ªå®šä¹‰æ“ä½œç±»å¸¦æ¥äº†å®Œæˆçš„å¹¶å‘æ§åˆ¶ä»¥åŠå®ç°ã€‚åŒ…å«å¯ä»¥å®Œå…¨æ§åˆ¶ä»»åŠ¡çš„æ‰§è¡Œèƒ½åŠ›å’Œæ‰§è¡ŒçŠ¶æ€ã€‚ æ‰€æœ‰ä¸Šè¿°çš„æ“ä½œå¯¹è±¡éƒ½åŒ…å«ä»¥ä¸‹æ ¸å¿ƒçš„ç‰¹æ€§ æ”¯æŒå»ºç«‹å›¾å½¢åŒ–çš„ä»»åŠ¡é—´ç›¸äº’ä¾èµ–ï¼Œè¿™äº›ä¾èµ–å°†ä¼šé˜»æ­¢ä»»åŠ¡å¼€å§‹ï¼Œç›´åˆ°å®ƒä¾èµ–çš„ä»»åŠ¡å®Œæˆä¹‹åã€‚ æ”¯æŒå¯é€‰çš„å®Œæˆå›è°ƒblockã€‚æŒ‡çš„æ˜¯å½“æ‰€æœ‰çš„æ‰§è¡Œä»»åŠ¡ç»“æŸä¹‹åçš„å›è°ƒæ–¹æ³•ã€‚ æ”¯æŒæ£€æµ‹ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ï¼ˆä½¿ç”¨KVOï¼‰ æ”¯æŒå¯¹æ“ä½œé¡ºåºè¿›è¡Œè°ƒæ•´ï¼Œå¹¶å½±å“ä»–ä»¬çš„æ‰§è¡Œé¡ºåºã€‚ æ”¯æŒå–æ¶ˆè¯­ä¹‰ï¼Œä¹Ÿå³å…è®¸ä½ åŠè·¯å¯¹ä»»åŠ¡æ‰§è¡Œç»ˆæ­¢æ“ä½œã€‚ æ“ä½œå¯¹è±¡æ˜¯è®¾è®¡æ¥å¸®åŠ©ä½ æå‡ç¨‹åºçš„å¹¶å‘æ°´å¹³ï¼Œæ“ä½œä¹Ÿæ˜¯ä¸€ç§ä¸é”™çš„ç»„ç»‡å’ŒåŒ…è£…ä½ çš„åº”ç”¨ä¸ºå‡ ä¸ªç‹¬ç«‹çš„åˆ†æ”¯çš„ä¸€ç§æ‰‹æ®µï¼Œä½œä¸ºå–ä»£æäº¤ä¸€äº›ä»»åŠ¡ç»™ä¸»çº¿ç¨‹çš„å¼€å‘æ–¹å¼ï¼Œå¯ä»¥å°†ä»»åŠ¡åˆ†å‰²ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªä¸åŒçš„æ“ä½œï¼Œç„¶åæäº¤ç»™é˜Ÿåˆ—ï¼Œä½¿ç›¸å…³çš„å·¥ä½œå¯ä»¥åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸­å»å¹¶å‘çš„æ‰§è¡Œã€‚ 3.2 åŒæ—¶VSéåŒæ—¶æ“ä½œå°½ç®¡ï¼Œä½ é€šå¸¸å°†ä»»åŠ¡æ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—ä¸­ï¼Œä½†æ˜¯åšè¿™ä¸ªå¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚ä½ ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨å®ƒçš„startæ–¹æ³•å»å¼€å§‹ä¸€ä¸ªæ“ä½œã€‚ä½†æ˜¯æ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œå¹¶ä¸èƒ½ä¿è¯ä½ çš„æ“ä½œåŒæ­¥çš„è¿è¡Œåœ¨ä½ å½“å‰ä»£ç æ‰€åœ¨çš„çº¿ç¨‹ä¸­ã€‚é‚£ä¹ˆNSOperationç±»çš„è¿™ä¸ªisConcurrentæ–¹æ³•ä¼šå‘ŠçŸ¥ä½ ï¼Œå½“å‰è¿è¡Œçš„æ“ä½œæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„åœ¨ä½ è°ƒç”¨Startæ–¹æ³•çš„çº¿ç¨‹ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›NOï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ“ä½œæ˜¯åœ¨å½“å‰è°ƒç”¨çš„çº¿ç¨‹ä¸­åŒæ­¥å»æ‰§è¡Œçš„ã€‚ å¦‚æœä½ æƒ³å»å®ç°ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œçš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è°ƒåº¦ä»»åŠ¡çš„çº¿ç¨‹å’Œä»»åŠ¡æ‰§è¡Œçš„çº¿ç¨‹æ˜¯å¼‚æ­¥çš„ã€‚ä½ éœ€è¦å†™é¢å¤–çš„ä»£ç å»å¼‚æ­¥çš„å¼€å¯å®ƒã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œè°ƒç”¨ä¸€ä¸ªç³»ç»Ÿçš„å¼‚æ­¥æ–¹æ³•ï¼Œå»æ‰§è¡Œå…¶ä»–çš„äº‹æƒ…ä»¥ä¿è¯startå‡½æ•°çš„è°ƒç”¨æ—¶å¼‚æ­¥å»æ‰§è¡Œã€‚ å¤§å¤šæ•°çš„å¼€å‘å¹¶ä¸éœ€è¦å»å®ç°ä¸€ä¸ªå¹¶å‘æ“ä½œå¯¹è±¡ï¼Œå¦‚æœä½ æ€»æ˜¯å°†ä½ çš„æ“ä½œå»æ·»åŠ åˆ°ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—ä¸­ï¼Œä½ å¹¶ä¸éœ€è¦å®ç°è¿™äº›å¹¶å‘æ“ä½œï¼Œå½“ä½ æ·»åŠ ä¸€ä¸ªæ“ä½œå¯¹è±¡åˆ°æ“ä½œé˜Ÿåˆ—ä¸­çš„æ—¶å€™ï¼Œæ“ä½œé˜Ÿåˆ—è‡ªå·±å°±ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œä½ çš„æ“ä½œï¼Œå› æ­¤ï¼Œå°†ä¸€ä¸ªå¹¶ä¸æ˜¯å¼‚æ­¥çš„ä»»åŠ¡æ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—ä¸­å»ï¼Œç»“æœè¿˜æ˜¯ä¼šä»¥å¼‚æ­¥çš„æ–¹å¼å»æ‰§è¡Œä»£ç ï¼Œå»å®šä¹‰ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡è¿™ç§è´¹åŠ›ä¸è®¨å¥½çš„å·¥ä½œï¼Œä¹Ÿåªæ˜¯ä½ å°±æ˜¯æƒ³åˆ›å»ºå¼‚æ­¥æ‰§è¡Œä»»åŠ¡ï¼Œè€Œä¸æ˜¯å°†å®ƒæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å»çš„æ—¶å€™æ‰æœ‰å¿…è¦ã€‚ å…³äºæ›´å¤šæœ‰å…³å¼‚æ­¥ä»»åŠ¡çš„ä¿¡æ¯ï¼Œå‚è§è®¾ç½®ä»»åŠ¡å»å¼‚æ­¥æ‰§è¡Œã€‚ 3.3 åˆ›å»ºä¸€ä¸ªNSInocationOperationå¯¹è±¡NSInvocationOperationæ˜¯NSOperationçš„å…·ä½“å­ç±»ï¼Œå½“å®ƒè¿è¡Œçš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œå®ƒçš„selectoré‡Œé¢ï¼ŒæŒ‡æ´¾ç»™å®ƒçš„ä»»åŠ¡ã€‚ä½¿ç”¨è¯¥ç±»æ—¶ï¼Œåº”è¯¥é¿å…å°†å¤§é‡çš„è‡ªå®šä¹‰çš„æ“ä½œç»™æ¯ä¸ªä»»åŠ¡ã€‚å°¤å…¶æ˜¯å½“ä½ éœ€è¦æ”¹å˜ä¸€ä¸ªå·²ç»å­˜åœ¨çš„åº”ç”¨ç¨‹åºå’Œè¿™äº›å¯¹è±¡å·²ç»å­˜åœ¨ä»»åŠ¡ï¼Œè¿˜æœ‰å¾ˆå¤šå¿…å¤‡è¦æ‰§è¡Œçš„ä»»åŠ¡æ—¶ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥æ”¹å˜ä¾èµ–ç¯å¢ƒçš„æ—¶å€™ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªInvocationå¯¹è±¡æ¥æ‰§è¡Œä¸€ä¸ªé€‰æ‹©å™¨ï¼Œè¿™ä¸ªé€‰æ‹©å™¨æ˜¯åŸºäºè·å–ç”¨æˆ·çš„è¾“å…¥ä¿¡æ¯åŠ¨æ€çš„é€‰æ‹©ã€‚ åˆ›å»ºä¸€ä¸ªInvocationæ“ä½œçš„æ­¥éª¤æ˜¯å¾ˆç®€å•çš„ï¼Œä½ å¯ä»¥åˆ›å»ºå¹¶å®ä¾‹åŒ–ä¸€ä¸ªè¯¥å¯¹è±¡ï¼Œç„¶åä¼ é€’éœ€è¦çš„å¯¹è±¡å’Œselectorå»æ‰§è¡ŒæŒ‡å®šçš„ä»£ç ï¼Œä¸‹é¢æä¾›äº†ä¿©ä¸ªæ–¹æ³•å»ä¸¾ä¾‹è¯´æ˜è¿™ä¸ªæ“ä½œæ­¥éª¤ï¼ŒtaskWithDataï¼šæ–¹æ³•åˆ›å»ºä¸€ä¸ªæ“ä½œå¯¹è±¡ï¼Œç„¶åé€šè¿‡å¦å¤–ä¸€ä¸ªæ–¹æ³•å»æ‰§è¡Œä»»åŠ¡ã€‚ 123456789101112@implementation MyCustomClass - (NSOperation*)taskWithData:(id)data { NSInvocationOperation* theOp = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(myTaskMethod:) object:data]; return theOp; } // This is the method that does the actual work of the task. - (void)myTaskMethod:(id)data { // Perform the task. } @end 3.4 åˆ›å»ºä¸€ä¸ªNSBlockOperationå¯¹è±¡NSBlockOperationæ˜¯NSOperationçš„å…·ä½“å­ç±»ï¼Œä½œä¸ºä¸€ä¸ªæˆ–è€…å¤šä¸ªBlockå¯¹è±¡çš„å°è£…å™¨ï¼Œè¿™ä¸ªç±»æä¾›äº†å¯¹è±¡å±‚é¢çš„å°è£…ï¼Œè€Œä¸”å®ƒå·²ç»ä½¿ç”¨äº†æ“ä½œåˆ†å‘é˜Ÿåˆ—ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦åˆ›å»ºåˆ†å‘é˜Ÿåˆ—ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„è¯¸å¦‚æ“ä½œä»»åŠ¡çš„ä¾èµ–ã€KVOé€šçŸ¥æˆ–è€…å…¶ä»–ç‰¹æ€§ï¼Œè€Œè¿™äº›ç‰¹æ€§æ˜¯åˆ†å‘é˜Ÿåˆ—æ‰€æ²¡æœ‰çš„ã€‚ å½“ä½ åˆ›å»ºä¸€ä¸ªblockæ“ä½œçš„æ—¶å€™ï¼Œåœ¨åˆ›å»ºä»–çš„æ—¶å€™ï¼Œä½ è‡³å°‘å·²ç»æ·»åŠ äº†ä¸€ä¸ªblockï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ä¹‹åå†æ·»åŠ æ›´å¤šçš„blockè¿›å»ã€‚å½“æ‰§è¡ŒNSBlockOperationå¯¹è±¡çš„æ—¶é—´æ¥ä¸´çš„æ—¶å€™ï¼Œè¯¥å¯¹è±¡ä¼šå°†å®ƒçš„æ‰€æœ‰blockéƒ½æäº¤ç»™é»˜è®¤ä¼˜å…ˆçº§çš„å¼‚æ­¥åˆ†å‘é˜Ÿåˆ—ï¼Œç„¶åè¿™ä¸ªå¯¹è±¡ç­‰å¾…å®ƒçš„blockå…¨éƒ¨æ‰§è¡Œå®Œï¼Œä¹‹åä¼šæŠŠè‡ªå·±æ ‡è®°ä¸ºisfinishã€‚å› æ­¤ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªBlockæ“ä½œå»ç›‘å¬ä¸€ç»„ä»»åŠ¡çš„å®Œæˆï¼Œéå¸¸åƒç”¨ä¸€ä¸ªçº¿ç¨‹å»ç®¡ç†å¤šä¸ªçº¿ç¨‹çš„ç»“æœã€‚è€Œä¸åŒä¹‹å¤„åœ¨äºblockæ“ä½œè‡ªå·±è¿è¡Œåœ¨ä¸€ä¸ªåˆ†ç¦»çš„çº¿ç¨‹ï¼Œè€Œä½ çš„ç¨‹åºå¯ä»¥å¹²å…¶ä»–çš„æ´»å„¿ï¼Œåœ¨è¿™ä¸ªblockç­‰å¾…å®ƒçš„ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹å‰ã€‚ ä¸‹é¢çš„ä»£ç ä»‹ç»äº†å¦‚ä½•å»åˆ›å»ºä¸€ä¸ªBlockOperationï¼Œè¿™ä¸ªBlockæ²¡å¸¦å‚æ•°ä¸”æ²¡æœ‰è¿”å›ä»€ä¹ˆæœ‰æ„ä¹‰çš„ç»“æœ NSBlockOperation* theOp = [NSBlockOperation blockOperationWithBlock: ^{ NSLog(@â€Beginning operation.\\nâ€); // Do some work. }]; å½“åˆ›å»ºä¸€ä¸ªblockæ“ä½œä¹‹åï¼Œä½ å¯ä»¥æ·»åŠ æ›´å¤šçš„blockç»™å®ƒï¼Œé€šè¿‡ addExecutionBlockï¼šæ–¹æ³•ï¼Œå¦‚æœä½ æƒ³è®©æ·»åŠ çš„ä»»åŠ¡çº¿æ€§å»æ‰§è¡Œï¼Œé‚£ä¹ˆä½ å¿…é¡»ç›´æ¥å°†å®ƒæäº¤ç»™æŒ‡å®šçš„ä¸²è¡Œé˜Ÿåˆ—ä¸­å»ã€‚ 3.5 å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„æ“ä½œå¦‚æœä¸€ä¸ªBlockæ“ä½œå¯¹è±¡æˆ–è€…Invocationæ“ä½œå¯¹è±¡æ²¡æ³•å®Œå…¨æ»¡è¶³ä½ çš„éœ€æ±‚çš„æ—¶å€™ï¼Œä½ å¯ä»¥è€ƒè™‘è‡ªå·±å®šä¹‰ä¸ªç»§æ‰¿è‡ªNSOperationçš„æ“ä½œå¯¹è±¡ï¼ŒNSOperationå¯¹è±¡æä¾›äº†ä¸€ç³»åˆ—çš„ç»§æ‰¿ç‚¹ç»™æ‰€æœ‰çš„æ“ä½œå¯¹è±¡ï¼Œè¿™ä¸ªç±»å·²ç»å®ç°äº†å¤§é‡çš„åŸºç¡€çš„å‡½æ•°æˆ–æ–¹æ³•ï¼Œæ»¡è¶³é‚£äº›ä¾èµ–æˆ–è€…KVOçš„æ“ä½œï¼Œç„¶è€Œï¼Œè¿˜æ˜¯æœ‰ä¸€äº›åœ°æ–¹éœ€è¦ä½ è‡ªå·±çš„è‡ªå®šä¹‰å®ç°ç¡®ä¿ä½ çš„æ“ä½œå¯¹è±¡èƒ½å¤Ÿæ­£ç¡®çš„æ‰§è¡Œï¼Œå…·ä½“çš„å·¥ä½œé‡çš„å¤§å°å–å†³äºä½ è¦è‡ªå®šä¹‰çš„æ˜¯ä¸€ä¸ªåŒæ­¥æ“ä½œå¯¹è±¡è¿˜æ˜¯å¼‚æ­¥æ“ä½œå¯¹è±¡ã€‚ å®šä¹‰ä¸ªåŒæ­¥æ“ä½œå¯¹è±¡è¦æ¯”å®šä¹‰ä¸€ä¸ªå¼‚æ­¥æ“ä½œå¯¹è±¡ç®€å•çš„å¤šï¼Œå¯¹äºä¸€ä¸ªåŒæ­¥æ“ä½œå¯¹è±¡æ¥è®²ï¼Œæ‰€æœ‰ä½ è¦åšçš„å·¥ä½œå°±æ˜¯å®ç°mainæ‰§è¡Œå‡½æ•°å’Œå“åº”å–æ¶ˆæ“ä½œäº‹ä»¶ã€‚çˆ¶ç±»å·²ç»å¸®ä½ åšäº†æ‰€æœ‰å…¶ä»–è¯¥åšçš„å·¥ä½œï¼Œè€Œå¯¹äºä¸€ä¸ªå¼‚æ­¥æ“ä½œå¯¹è±¡æ¥å°†ï¼Œä½ éœ€è¦æ›¿æ¢ä¸€äº›çˆ¶ç±»å·²ç»åšè¿‡çš„å·¥ä½œï¼Œåœ¨ä½ è‡ªå·±å®šä¹‰çš„æ“ä½œå¯¹è±¡ä¸Šã€‚ä¸‹é¢çš„ä¿©å°èŠ‚å°†ä»‹ç»å¦‚ä½•å»å®ç°è¿™ä¿©ç§ä¸åŒçš„æ“ä½œå¯¹è±¡ã€‚ 3.5.1 æ‰§è¡Œmainä»»åŠ¡è‡³å°‘ä¸€ä¸ªæ“ä½œå¯¹è±¡éœ€è¦å®ç°ä¸‹é¢çš„å‡½æ•° ä¸€ä¸ªè‡ªå®šä¹‰çš„åˆå§‹åŒ–å‡½æ•° main ä½ éœ€è¦è‡ªå®šä¹‰ä¸ªåˆå§‹åŒ–å‡½æ•°å»åˆå§‹åŒ–ä¸€ä¸ªæ“ä½œå¯¹è±¡ï¼Œä»¥åŠä¸€ä¸ªè‡ªå®šä¹‰çš„mainå‡½æ•°å»æ‰§è¡Œä»»åŠ¡ï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦æ‰§è¡Œå…¶ä»–çš„å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º è‡ªå®šä¹‰å‡½æ•°ä¾›ä½ çš„mainå‡½æ•°å»è°ƒç”¨ å±æ€§æ–¹æ³•å»è®¿é—®æ•°æ® å®ç°NSCodingåè®®å»å›ºåŒ–ä¸€ä¸ªæ“ä½œå¯¹è±¡ ä¸‹é¢çš„æ¨¡æ¿ï¼Œå±•ç¤ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„æ“ä½œå¯¹è±¡ï¼Œä¸‹é¢çš„ä»£ç å¹¶ä¸å±•ç¤ºå¦‚ä½•å»å®ç°å–æ¶ˆæ–¹æ³•ï¼Œä½†æ˜¯ä¹Ÿå®ç°äº†ä½ é€šå¸¸è¦å®ç°çš„æ–¹æ³•ï¼Œå…·ä½“æ€ä¹ˆå–æ¶ˆä»»åŠ¡ï¼Œå‚è§å–æ¶ˆä»»åŠ¡ä»‹ç»ï¼Œä¸‹é¢çš„åˆå§‹åŒ–å‡½æ•°åˆå§‹åŒ–äº†ä¸€ä¸ªå¯¹è±¡ï¼Œæºå¸¦ä¸€ä¸ªæ•°æ®å‚æ•°å¹¶æŠŠå®ƒå­˜åˆ°äº†ç±»å†…éƒ¨æ–¹ä¾¿ä»¥åè®¿é—®ï¼Œmainå‡½æ•°å°†ä¼šæ˜¾å¼çš„å»æ“ä½œè¿™ä¸ªå¯¹è±¡ï¼Œåœ¨ä½ çš„åº”ç”¨å°†ç»“æœè¿”å›ç»™ä½ ä¹‹å‰ã€‚ 123456789101112131415161718192021@interface MyNonConcurrentOperation : NSOperation@property id (strong) myData; -(id)initWithData:(id)data;@end @implementation MyNonConcurrentOperation - (id)initWithData:(id)data { if(self = [super init]) myData = data; return self; }-(void)main { @try { // Do some work on myData and report the results. } @catch(...) { // Do not rethrow exceptions. } } @end æ›´å¤šçš„ç»†èŠ‚å‚è§NSOperationSample 3.5.2 å“åº”å–æ¶ˆäº‹ä»¶å½“ä¸€ä¸ªæ“ä½œå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œå®ƒå°†æŒç»­æ‰§è¡Œä»»åŠ¡ç›´åˆ°ç»“æŸæˆ–è€…ä»»åŠ¡è¢«æ˜¾å¼çš„å–æ¶ˆæ‰ï¼Œå–æ¶ˆæ“ä½œå¯èƒ½å‘ç”Ÿåœ¨ä»»ä½•æ—¶å€™ï¼Œç”šè‡³æ˜¯æ“ä½œå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œå°½ç®¡NSOperationå¯¹è±¡æä¾›äº†ä¸€ä¸ªæ–¹å¼ä¾›å­ç±»å»ä½¿ç”¨ï¼ŒæŒ‡å‡ºå–æ¶ˆäº‹ä»¶æ˜¯å®Œå…¨å¿…è¦çš„ã€‚å¦‚æœä¸€ä¸ªæ“ä½œå®Œå…¨ç»“æŸäº†ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥æä¾›ä¸€ä¸ªæ–¹å¼å»æ¸…ç†ä¹‹å‰åˆ†é…çš„èµ„æºç­‰ç­‰ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªæ“ä½œå¯¹è±¡éœ€è¦å»æ£€æµ‹æ˜¯å¦å·²ç»å–æ¶ˆäº†ï¼Œç„¶åå°±å¯ä»¥ä¼˜é›…çš„ç»“æŸä»»åŠ¡ã€‚ æ“ä½œå¯¹è±¡æ”¯æŒå–æ¶ˆæ“ä½œï¼Œä½ åº”è¯¥åšçš„äº‹æƒ…å°±æ˜¯é¢‘ç¹çš„å»æ£€æŸ¥æ˜¯å¦ä»»åŠ¡å·²ç»è¢«å–æ¶ˆäº†ï¼Œæ”¯æŒå–æ¶ˆæ˜¯éå¸¸é‡è¦çš„ï¼Œå¯¹äºä½ è‡ªå®šä¹‰çš„ä»»åŠ¡å’Œç³»ç»Ÿç»™çš„é‚£ä¿©ä¸ªå­ç±»æ“ä½œå¯¹è±¡æ¥è¯´ï¼ŒisCancelæ–¹æ³•æ˜¯éå¸¸è½»é‡çº§çš„ï¼Œå¯ä»¥é¢‘ç¹å»è®¿é—®è€Œä¸ä¼šé€ æˆå†…å­˜æ–¹é¢çš„ç©ºæ‰°ï¼Œå½“è®¾è®¡ä¸€ä¸ªæ“ä½œå¯¹è±¡çš„æ—¶å€™ï¼Œä½ å¯ä»¥åœ¨å¦‚ä¸‹å‡ ä¸ªåœ°æ–¹å»è®¿é—®iscancel 1ã€åœ¨ä½ å¼€å§‹æ‰§è¡Œä»»åŠ¡ä¹‹å‰ 2ã€åœ¨å¼€å¯ä¸€ä¸ªloopä¹‹å‰ï¼Œæˆ–è€…æ˜¯æ›´åŠ é¢‘ç¹çš„åœ¨æ¯ä¸ªå¾ªç¯ä¹‹å‰ 3ã€åœ¨ä½ çš„æ¯ä¸ªå¯èƒ½å¯¼è‡´ä»»åŠ¡é€€å‡ºçš„åœ°æ–¹ ä¸‹é¢çš„ä»£ç ä»‹ç»äº†åœ¨mainå‡½æ•°ä¸­å¦‚ä½•å»è°ƒç”¨cancelï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œiscancelåœ¨æ¯æ¬¡while loopå‰éƒ½ä¼šè°ƒç”¨ï¼Œä½¿å¾—ä»»åŠ¡å¯ä»¥å¿«é€Ÿçš„é€€å‡ºï¼Œä¸”è·å–äº†ä¸€ä¸ªå®šæœŸçš„é—´éš”ã€‚ 12345- (void)main { @try { BOOL isDone = NO; while (![self isCancelled] &amp;&amp; !isDone) { // Do some work and set isDone to YES when finished } } @catch(...) { // Do not rethrow exceptions. } } å°½ç®¡ä¸Šé¢çš„ä»£ç ï¼Œå¹¶ä¸åŒ…å«æ¸…ç†æ•°æ®çš„å·¥ä½œï¼Œä½†æ˜¯ä½ è‡ªå·±çš„ä»£ç è¿˜æ˜¯è¦ä¿è¯èµ„æºè¢«åŠæ—¶çš„é‡Šæ”¾ã€‚ 3.5.3 å®šä¹‰ä¸€ä¸ªå¯å¹¶å‘æ‰§è¡Œçš„æ“ä½œä¸€ä¸ªæ“ä½œå¯¹è±¡é»˜è®¤æƒ…å†µæ˜¯æŒ‰ç…§åŒæ­¥çš„æ–¹å¼å»æ‰§è¡Œä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–ä»¬æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ä¹Ÿå°±æ˜¯startè°ƒç”¨çš„çº¿ç¨‹ã€‚å› ä¸ºæ“ä½œé˜Ÿåˆ—ä¼šå¯¹æ“ä½œä»»åŠ¡æä¾›å¼€å¯çš„çº¿ç¨‹ï¼Œå› æ­¤ï¼Œå¤§å¤šæ•°çš„ä»»åŠ¡å°±ä¼šå¼‚æ­¥è¿è¡Œï¼Œç„¶è€Œï¼Œå¦‚æœä½ è®¡åˆ’æ‰‹åŠ¨å»æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œè€Œä¸”è¿˜å¸Œæœ›è¿™ä¸ªä»»åŠ¡å¼‚æ­¥çš„å»è¿è¡Œï¼Œä½ å¿…é¡»å¾—é‡‡å–ä¸€äº›æ‰‹æ®µæ¥ä¿è¯èƒ½å¤Ÿè¿™ä¹ˆå¹²ï¼Œä½ éœ€è¦æŠŠä½ çš„æ“ä½œå¯¹è±¡å®šä¹‰ä¸ºä¸€ä¸ªå¯å¹¶å‘æ‰§è¡Œçš„æ“ä½œå¯¹è±¡ã€‚ä¸‹é¢åˆ—å‡ºæ¥çš„å‡½æ•°å°±æ˜¯ä½ éœ€è¦é‡å†™çš„å¹¶å‘æ“ä½œã€‚ startï¼šï¼ˆå¿…é¡»é‡å†™ï¼‰æ‰€æœ‰çš„è‡ªå®šä¹‰å¹¶å‘æ“ä½œå¿…é¡»é‡å†™è¿™ä¸ªå‡½æ•°ï¼Œä»è€Œæ›¿æ¢ä¹‹å‰è¿™ä¸ªå‡½æ•°çš„é»˜è®¤å®ç°ã€‚è¦æ‰‹åŠ¨çš„æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œä½ å°±å¯ä»¥è°ƒç”¨startå‡½æ•°ï¼Œå› æ­¤ä»ï¼Œä½ å¯¹è¯¥æ–¹æ³•çš„å®ç°å°±æ˜¯è‡ªå®šä¹‰æ“ä½œå¯¹è±¡çš„å¼€å¯ä»»åŠ¡çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä½ è¦æäº¤ä½ çš„ä»»åŠ¡åˆ°çº¿ç¨‹ä¸­å»æ‰§è¡Œçš„èŠ‚ç‚¹ï¼Œä½ çš„å®ç°åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸åº”è¯¥å»è°ƒç”¨super startã€‚ mainï¼šï¼ˆå¯é€‰çš„ï¼‰è¿™ä¸ªå‡½æ•°é€šå¸¸ç”¨æ¥å®ç°ä¸æ“ä½œå¯¹è±¡ç›¸å…³çš„ä»»åŠ¡ã€‚è™½ç„¶ä½ å¯ä»¥æŠŠæ‰§è¡Œä»»åŠ¡çš„ä»»åŠ¡æ”¾åˆ°startä¸­å»æ‰§è¡Œï¼Œåˆ©ç”¨mianæ–¹æ³•å»æ‰§è¡Œä»»åŠ¡ä¼šå¯¹ä½ çš„ä»»åŠ¡å¼€å§‹å’Œæ¸…ç†å·¥ä½œæœ‰å¥½å¤„ã€‚ isExecutingï¼šï¼ˆå¿…é¡»çš„ï¼‰ isFinishï¼šï¼ˆå¿…é¡»ï¼‰ å¹¶å‘æ“ä½œéå¸¸æœ‰å¿…è¦å‘ä½¿ç”¨å®ƒçš„å®¢æˆ·æŠ¥å‘Šé…ç½®ç¯å¢ƒå’Œæ‰§è¡ŒçŠ¶æ€ï¼Œå› æ­¤ä¸€ä¸ªå¹¶å‘æ“ä½œå¿…é¡»å¾—åŒ…å«æ‰§è¡Œçš„çŠ¶æ€ä¿¡æ¯åŒ…æ‹¬ä½•æ—¶å¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼Œä½•æ—¶ç»“æŸä»»åŠ¡ï¼Œå¦‚æœè¦æŠ¥å‘ŠçŠ¶æ€ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨è¿™äº›æ–¹æ³•ã€‚ å½“åˆ«çš„çº¿ç¨‹åœ¨åŒæ—¶è°ƒç”¨ä¸Šè¿°æ–¹æ³•çš„æ—¶å€™ï¼Œä½ å¿…é¡»å¾—ä¿è¯è¿™äº›æ–¹æ³•æ˜¯å®‰å…¨çš„ã€‚åŒæ—¶ï¼Œä½ ä¹Ÿå¿…é¡»å¾—å®ç°KVOé€šçŸ¥ï¼Œä»¥æŠ¥å‘Šè¿™äº›çŠ¶æ€ã€‚ isConcurrentï¼šï¼ˆå¿…é¡»ï¼‰åŒºåˆ†ä¸€ä¸ªæ“ä½œæ˜¯å¦æ˜¯å¹¶å‘æ“ä½œï¼Œé‡å†™è¯¥æ–¹æ³•ï¼Œå¹¶è¿”å›YES æœ¬å°èŠ‚çš„å‰©ä½™éƒ¨åˆ†å°†å±•ç¤ºä¸€ä¸ªMyOperationClassçš„ä¾‹å­ï¼Œè¿™ä¸ªç±»åˆ—ä¸¾äº†å®ç°ä¸€ä¸ªå¹¶å‘æ“ä½œçš„åŸºæœ¬å‡½æ•°ï¼ŒMyOperation ç±»å°†åœ¨å®ƒè‡ªå·±å¼€å¯çš„çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ­£åœ¨çš„æ‰§è¡Œä»»åŠ¡å°†ä¸æ“ä½œç±»æ˜¯ä¸ç›¸å¹²çš„ï¼Œä¸‹é¢ä¾‹å­å°†çš„å‡ ç‚¹ï¼Œå°±æ˜¯ä½ åœ¨å®šä¹‰ä¸€ä¸ªå¹¶å‘æ“ä½œæ—¶éœ€è¦æä¾›çš„ä¸€äº›åŸºç¡€å‡½æ•°ã€‚ ä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†éƒ¨åˆ†MyOperationçš„æ¥å£å’Œå®ç°å‡½æ•°ï¼Œè¿™äº›å®ç°åŒ…æ‹¬isConcurrentã€isExecutingï¼ŒisFinishï¼Œç­‰å‡½æ•°ã€‚å…¶ä¸­isConcurrentå‡½æ•°éå¸¸ç®€å•ï¼Œåªéœ€è¦è¿”å›YESå»æŒ‡æ˜æœ¬æ“ä½œæ˜¯ä¸€ä¸ªå¹¶å‘æ“ä½œå°±å¯ä»¥äº†ï¼ŒisExecuting å’Œ isFinished ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œè¿”å›åœ¨ç±»ä¸­å­˜å‚¨çš„æˆå‘˜å˜é‡çš„å€¼å°±å¯ä»¥äº†ã€‚ 1234567891011121314151617181920@interface MyOperation : NSOperation { BOOL executing; BOOL finished; }- (void)completeOperation;@end @implementation MyOperation - (id)init { self = [super init]; if (self) { executing = NO; finished = NO; } return self; }- (BOOL)isConcurrent { return YES; } - (BOOL)isExecuting { return executing; } - (BOOL)isFinished { return finished; } @end ä¸‹é¢çš„æ–¹æ³•å±•ç¤ºäº†MyOperationçš„ startå‡½æ•°ï¼Œä¸‹é¢çš„å®ç°æ˜¯ä¸€ä¸ªstartå‡½æ•°ï¼Œæ‰§è¡Œä»»åŠ¡è‡³å°‘è¦å®ç°çš„å†…å®¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œstartå‡½æ•°ç®€å•çš„å¼€å¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œç„¶åè®©è¿™ä¸ªçº¿ç¨‹å»è°ƒç”¨mainå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°åŒæ ·è¦æ›´æ–°executingæˆå‘˜å˜é‡ï¼Œè€Œä¸”è¦å¯¹isExecutingå…³é”®è·¯å¾„äº§ç”ŸKVOé€šçŸ¥ï¼Œå½“è¿™äº›å·¥ä½œå®Œæˆä¹‹åï¼Œå°±ä¼šç¦»å¼€å‡½æ•°ï¼Œå¹¶å»åˆ°æ–°çš„çº¿ç¨‹ä¸­å»æ‰§è¡Œä»»åŠ¡ã€‚ 12345678- (void)start { // Always check for cancellation before launching the task. if ([self isCancelled]) { // Must move the operation to the finished state if it is canceled. [self willChangeValueForKey:@&quot;isFinished&quot;]; finished = YES; [self didChangeValueForKey:@&quot;isFinished&quot;]; return; }// If the operation is not canceled, begin executing the task. [self willChangeValueForKey:@&quot;isExecuting&quot;]; [NSThread detachNewThreadSelector:@selector(main) toTarget:self withObject:nil]; executing = YES; [self didChangeValueForKey:@&quot;isExecuting&quot;]; } ä¸‹é¢å±•ç¤ºäº†MyOperationå‰©ä¸‹çš„å®ç°ï¼Œåœ¨ä¸Šé¢çš„ä»£ç å·²ç»çŸ¥é“ mainå‡½æ•°å°†ä½œä¸ºæ–°çš„çº¿ç¨‹å¼€å¯ä»»åŠ¡çš„èŠ‚ç‚¹ï¼Œå®ƒå°†æ‰§è¡Œæ“ä½œå¯¹è±¡å¸¦æ¥çš„ä»»åŠ¡ï¼Œå¹¶ä¸”è¦æ‰§è¡ŒcompleteOperationå‡½æ•°æ¥è¯´æ˜ä»»åŠ¡å·²ç»ç»“æŸï¼Œcompleteoperationå‡½æ•°å°†å¯¹isExecutingå’ŒisFinishedå…³é”®è·¯å¾„å‘é€KVOé€šçŸ¥ï¼Œæ¥ååº”æ“ä½œå¯¹è±¡çš„çŠ¶æ€å·²ç»æ”¹å˜ã€‚ 1234567891011121314151617- (void)main { @try { // Do the main work of the operation here. [self completeOperation]; } @catch(...) { // Do not rethrow exceptions. }} - (void)completeOperation { [self willChangeValueForKey:@&quot;isFinished&quot;]; [self willChangeValueForKey:@&quot;isExecuting&quot;]; executing = NO; finished = YES; [self didChangeValueForKey:@&quot;isExecuting&quot;]; [self didChangeValueForKey:@&quot;isFinished&quot;]; } å°½ç®¡æ˜¯æ“ä½œå¯¹è±¡è¢«å–æ¶ˆæ‰äº†ï¼Œä½ ä¹Ÿåº”è¯¥å‘é€KVOé€šçŸ¥ï¼Œæ¥é€šçŸ¥ä½ çš„ä»»åŠ¡å·²ç»å®Œæˆï¼Œå½“ä¸€ä¸ªæ“ä½œå¯¹è±¡çš„æ‰§è¡Œæ—¶ä¾èµ–å…¶ä»–æ“ä½œå¯¹è±¡çš„æ—¶å€™ï¼Œå®ƒå°†æ£€æµ‹isFinishedçŠ¶æ€ï¼Œåªæœ‰å½“å®ƒä¾èµ–çš„æ‰€æœ‰isfinishedçŠ¶æ€éƒ½å˜ä¸ºYESçš„æ—¶å€™ï¼Œå¦‚æœæ— æ³•å‘é€isFinshedé€šçŸ¥å°†ä¼šé˜»æ­¢å…¶ä»–ä¾èµ–ä»–çš„æ“ä½œå¯¹è±¡çš„æ‰§è¡Œã€‚ 3.5.4 ç»´æŠ¤KVOçš„å…¼å®¹NSOperationç±»æ˜¯æœä»ä¸‹åˆ—å…³é”®å­—çš„KVO isCanceled isConcurrent isExecuting isFinished isReady dependencies queuePriority completeBlock å¦‚æœä½ é‡å†™äº†startå‡½æ•°ï¼Œå’Œè‡ªå®šä¹‰äº†ä¸€äº›å…¶ä»–æ¯”è¾ƒé‡è¦çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯å•å•é‡å†™mainå‡½æ•°ï¼Œä½ å¿…é¡»ä¿è¯è‡ªå®šä¹‰çš„å¯¹è±¡èƒ½å¤Ÿå“åº”KVOï¼Œå½“é‡å†™startå‡½æ•°ï¼Œå…¶ä¸­ä½ æœ€éœ€è¦å…³æ³¨çš„å°±æ˜¯isExecutingå’ŒisFInishedï¼Œè¿™é‡Œæœ‰å¤§é‡çš„æ–¹æ³•ä¼šå—åˆ°è¿™ä¿©ä¸ªå‡½æ•°çš„å½±å“ã€‚ å¦‚æœä½ æƒ³å®ç°æ”¯æŒä¾èµ–å…³ç³»ï¼Œä»¥å¯¹å…¶ä»–ä¸€äº›æ“ä½œå¯¹è±¡çš„æ—¶å€™ï¼Œä½ ä¹Ÿå¯ä»¥é‡å†™isReadyå‡½æ•°ï¼Œå¹¶å¼ºåˆ¶è¿”å›NOï¼Œç›´åˆ°ä½ è‡ªå®šä¹‰çš„ä¾èµ–å…³ç³»æ»¡è¶³ã€‚ï¼ˆå¦‚æœä½ ä»ç„¶æƒ³æ”¯æŒç³»ç»Ÿæä¾›çš„ä¾èµ–å…³ç³»çš„æ—¶å€™ï¼Œè¯·ä¿è¯è°ƒç”¨superçš„å‡½æ•°ï¼‰å½“ä½ æ“ä½œå¯¹è±¡çš„isReadyçŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œè¯·å‘é€KVOé€šçŸ¥å»æŠ¥å‘Šè¿™ä¸ªçŠ¶æ€ï¼Œä¸è¿‡å¹¸è¿çš„æ˜¯ï¼Œé™¤éä½ å»é‡å†™addDependencyå’ŒremoveDependency:ï¼Œä½ å¹¶ä¸éœ€è¦æ‹…å¿ƒKVOé€šçŸ¥çš„å‘é€ã€‚ è™½ç„¶ä½ å¯ä»¥å‘é€å…¶ä»–å…³é”®å­—çš„KVOé€šçŸ¥ï¼Œä½†æ˜¯é€šå¸¸ä½ å¹¶ä¸éœ€è¦è¿™ä¹ˆåšï¼Œå¦‚æœä½ æƒ³å–æ¶ˆä¸€ä¸ªä»»åŠ¡ï¼Œä½ å¯ä»¥ç®€å•çš„è°ƒç”¨cancelå‡½æ•°å°±å¥½äº†ã€‚åŒæ ·çš„ï¼Œä½ ä¹Ÿä¸éœ€è¦å»ä¿®æ”¹é˜Ÿåˆ—çš„ä¼˜å…ˆçº§åœ¨æ“ä½œå¯¹è±¡ä¸Šï¼Œæœ€åï¼Œé™¤éä½ çš„æ“ä½œå¯¹è±¡æ”¯æŒåŠ¨æ€çš„ä¿®æ”¹isConcurrentï¼Œä½ ä¹Ÿä¸éœ€è¦å‘é€KVOé€šçŸ¥ç»™isConcurrentå…³é”®è·¯å¾„ã€‚ å¦‚æœè¦çŸ¥é“æ›´å¤šå…³äºKVOçš„æ“ä½œï¼Œè¯·å‚è§KVOç¼–ç¨‹æŒ‡å¯¼ã€‚ 3.6 è‡ªå®šä¹‰ä¸€ä¸ªæ“ä½œå¯¹è±¡çš„æ‰§è¡Œè¡Œä¸ºåœ¨æ·»åŠ ä¸€ä¸ªæ“ä½œå¯¹è±¡åˆ°æ“ä½œé˜Ÿåˆ—é‡Œé¢ä¹‹å‰ï¼Œéœ€è¦å°†ä¸€ä¸ªæ“ä½œå¯¹è±¡è®¾ç½®å¥½ï¼Œè¿™äº›å¯¹æ“ä½œå¯¹è±¡è®¾ç½®çš„ä¿¡æ¯å°†ä¼šå¯¹æ‰€æœ‰çš„æ“ä½œå¯¹è±¡æœ‰æ•ˆï¼Œä¸ä»…æ˜¯è‡ªå®šä¹‰çš„æ“ä½œå¯¹è±¡ï¼Œè¿˜åŒ…æ‹¬ç³»ç»Ÿå®šä¹‰çš„é‚£ä¿©ä¸ªæ“ä½œå¯¹è±¡ã€‚ 3.6.1 è®¾ç½®ä¾èµ–å…³ç³»ä¾èµ–æ˜¯ä¸€ç§é™åˆ¶æ“ä½œå¯¹è±¡æ‰§è¡Œé¡ºåºçš„ä¸€ç§æ‰‹æ®µï¼Œä¸€ä¸ªæ“ä½œå¯¹è±¡çš„æ‰§è¡Œï¼Œå¿…é¡»å¾—åœ¨å®ƒä¾èµ–çš„æ‰€æœ‰å¯¹è±¡æ‰§è¡Œå®Œæˆä¹‹åæ‰èƒ½è¿›è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥åˆ›å»ºç®€å•çš„ä¸€å¯¹ä¸€çš„æˆ–è€…æ˜¯è´Ÿè´£çš„ä¾èµ–å…³ç³»æ ‘ã€‚ åœ¨ä¿©ä¸ªæ“ä½œå¯¹è±¡ä¹‹é—´åˆ›å»ºä¾èµ–å…³ç³»ï¼Œä½ å¯ä»¥ä½¿ç”¨addDependencyï¼šæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨ä½ ä¼ çš„ç›®æ ‡å¯¹è±¡å’Œè‡ªå·±ä¹‹é—´åˆ›å»ºä¸€ä¸ªä¾èµ–å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ç›®æ ‡å¯¹è±¡æ²¡æœ‰æ‰§è¡Œå®Œæˆä¹‹å‰ï¼Œä½ çš„è¿™ä¸ªå¯¹è±¡æ˜¯ä¸ä¼šæ‰§è¡Œçš„ã€‚ä¾èµ–è¿˜ä¸ä»…ä»…é™åˆ¶åœ¨ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—ä¸­ï¼Œå› ä¸ºæ˜¯æ“ä½œå¯¹è±¡ç®¡ç†ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥åœ¨ä¸åŒçš„æ“ä½œé˜Ÿåˆ—ä¹‹ä¸­ï¼Œä¾èµ–ä¹Ÿæ˜¯å¯ä»¥èµ·åˆ°ä½œç”¨çš„ã€‚ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µæ˜¯ä¸å…è®¸çš„ï¼Œé‚£å°±æ˜¯è®¾ç½®ä¾èµ–ç¯ï¼Œè¿™æ˜¯ä¸€ç§è¯­æ³•é”™è¯¯ï¼Œä¼šå¯¼è‡´ä»»åŠ¡æ°¸è¿œå¾—ä¸åˆ°æ‰§è¡Œã€‚ å½“æ“ä½œå¯¹è±¡æ‰€ä¾èµ–çš„æ‰€æœ‰æ“ä½œå¯¹è±¡éƒ½æ‰§è¡Œå®Œæˆä¹‹åï¼Œæ“ä½œå¯¹è±¡å°±å˜æˆreadyçŠ¶æ€ï¼Œå‡†å¤‡æ‰§è¡Œã€‚ï¼ˆå¦‚æœæ˜¯ä½ è‡ªå·±å®šä¹‰çš„æ“ä½œå¯¹è±¡ ï¼Œå¹¶è‡ªå®šä¹‰äº†isReadyå‡½æ•°ï¼Œé‚£ä¹ˆå‡†å¤‡çŠ¶æ€å°±å’Œä½ è®¾ç½®çš„æ¡ä»¶æœ‰å…³ç³»äº†ï¼‰å¦‚æœä¸€ä¸ªæ“ä½œå¯¹è±¡æ˜¯åœ¨æ“ä½œé˜Ÿåˆ—ä¸­ï¼Œé‚£ä¹ˆisReadyçŠ¶æ€çš„æ“ä½œå¯¹è±¡åœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«æ‰§è¡Œï¼Œå¦‚æœä½ è®¡åˆ’æ‰‹åŠ¨å»æ‰§è¡Œä¸€ä¸ªæ“ä½œå¯¹è±¡çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥è°ƒç”¨ä»–çš„startæ–¹æ³•ã€‚ é‡è¦:ä½ åº”å½“åœ¨å°†æ“ä½œå¯¹è±¡æäº¤åˆ°æ“ä½œé˜Ÿåˆ—ä¹‹å‰å°±å»è®¾ç½®ä¾èµ–å…³ç³»ï¼Œå¦‚æœåœ¨ä¹‹åå»è®¾ç½®ä¾èµ–ï¼Œä¹Ÿè®¸å°†ä¸ä¼šé˜»æ­¢è¯¥ä»»åŠ¡çš„æ‰§è¡Œã€‚ ä¾èµ–åŸºäºçš„æ˜¯æ“ä½œå¯¹è±¡é—´åœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½å‘ç”Ÿå˜åŒ–çš„KVOé€šçŸ¥ï¼Œå¦‚æœä½ è‡ªå®šä¹‰äº†æ“ä½œå¯¹è±¡çš„è¯ï¼Œä½ éœ€è¦è‡ªå·±å»å‘é€KVOé€šçŸ¥ï¼Œä»¥é˜²å‡ºç°ä¾èµ–æ–¹é¢çš„é—®é¢˜ã€‚å…³äºæ›´å¤šKVOçš„ä¿¡æ¯ï¼Œå‚è€ƒç»´æŠ¤KVOå…¼å®¹ï¼Œå…³äºæ›´å¤šè®¾ç½®ä¾èµ–çš„ä¿¡æ¯ï¼Œå‚è€ƒNSOperation ç±» 3.6.2 æ”¹å˜æ“ä½œå¯¹è±¡çš„æ‰§è¡Œä¼˜å…ˆçº§å¯¹äºæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œå¯¹è±¡ï¼Œæ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œï¼Œé¦–å…ˆæ˜¯å—æ“ä½œå¯¹è±¡çš„isReadyçŠ¶æ€æ§åˆ¶ï¼Œå…¶æ¬¡æ˜¯ä»–ä»¬çš„ä¼˜å…ˆçº§ï¼Œæ˜¯å¦å‡†å¤‡å¥½æ‰§è¡Œï¼Œæ˜¯ç”±æ“ä½œå¯¹è±¡çš„ä¾èµ–å¯¹è±¡æ˜¯å¦æ‰§è¡Œå®Œæ¥é™åˆ¶çš„ï¼Œä½†æ˜¯è¿™ä¸ªä¼˜å…ˆçº§æ˜¯æ“ä½œå¯¹è±¡çš„ä¸€ä¸ªå±æ€§å€¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ–°åˆ›å»ºçš„æ“ä½œå¯¹è±¡éƒ½æ˜¯æ™®é€šä¼˜å…ˆçº§ï¼Œä½†æ˜¯ä½ å¯ä»¥å¢åŠ æˆ–è€…æ˜¯å‡å°‘æ“ä½œå¯¹è±¡çš„ä¼˜å…ˆçº§ï¼Œé€šè¿‡setQueuePriorityæ–¹æ³• ä¼˜å…ˆçº§åªå¯¹åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ“ä½œå¯¹è±¡èµ·ä½œç”¨ï¼Œå¦‚æœä½ çš„åº”ç”¨æœ‰å¤šä¸ªæ“ä½œé˜Ÿåˆ—ï¼Œä¸åŒé˜Ÿåˆ—ä¸­çš„æ“ä½œå¯¹è±¡çš„ä¼˜å…ˆçº§æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸åŒé˜Ÿåˆ—é‡Œé¢ï¼Œå­˜åœ¨ä½ä¼˜å…ˆçº§çš„æ“ä½œæ¯”é«˜ä¼˜å…ˆçº§çš„æ“ä½œå…ˆæ‰§è¡Œã€‚ ä¼˜å…ˆçº§å¹¶ä¸æ˜¯ä¾èµ–çš„æ›¿ä»£ï¼Œä¼˜å…ˆçº§å†³å®šçš„æ˜¯é‚£äº›åœ¨é˜Ÿåˆ—ä¸­å·²ç»æ˜¯å‡†å¤‡çŠ¶æ€çš„æ“ä½œå¯¹è±¡çš„æ‰§è¡Œé¡ºåºï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªé˜Ÿåˆ—ä¸­åŒæ—¶æœ‰é«˜ä¼˜å…ˆçº§å’Œä½ä¼˜å…ˆçº§çš„æ“ä½œå¯¹è±¡å‡†å¤‡å¥½äº†ï¼Œé‚£ä¹ˆæ“ä½œé˜Ÿåˆ—å…ˆæ‰§è¡Œé«˜ä¼˜å…ˆçº§çš„æ“ä½œå¯¹è±¡ï¼Œç„¶è€Œï¼Œå¦‚æœé«˜ä¼˜å…ˆçº§çš„æ²¡æœ‰å‡†å¤‡å¥½ï¼Œä½†æ˜¯ä½ä¼˜å…ˆçº§çš„å‡†å¤‡å¥½äº†ï¼Œé‚£ä¹ˆå°†å…ˆæ‰§è¡Œä½ä¼˜å…ˆçº§çš„ï¼Œå¦‚æœä½ æƒ³é˜»æ­¢ä¸€ä¸ªæ“ä½œä»»åŠ¡åœ¨å¦å¤–ä¸€ä¸ªæ“ä½œå¯¹è±¡æ‰§è¡Œå®Œä¹‹åå†æ‰§è¡Œï¼Œä½ éœ€è¦ä½¿ç”¨ä¾èµ–å…³ç³»å» åš 3.6.3 æ”¹å˜ä¾é™„çº¿ç¨‹çš„ä¼˜å…ˆçº§åœ¨OSX 10.6åŠä»¥åï¼Œè®¾ç½®ä¸€ä¸ªæ“ä½œå¯¹è±¡æ‰€åœ¨çš„çº¿ç¨‹çš„ä¼˜å…ˆçº§æˆä¸ºå¯èƒ½ï¼Œç³»ç»Ÿçš„çº¿ç¨‹ç­–ç•¥æ˜¯ä¾é å†…æ ¸å»ç®¡ç†ï¼Œä½†æ˜¯é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹å°†è·å¾—æ›´é«˜çš„æ‰§è¡Œæœºä¼šï¼Œå¯¹ä¸€ä¸ªæ“ä½œå¯¹è±¡ï¼Œä½ å¯ä»¥æ˜¾å¼çš„æŒ‡å®šå®ƒçš„çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œé€šè¿‡è®¾ç½®ä¸€ä¸ªæµ®ç‚¹å‹çš„æ•°å€¼ï¼Œ0-1.0ä¹‹å‰ã€‚0æ˜¯ä¼˜å…ˆçº§æœ€ä½ã€1æ˜¯ä¼˜å…ˆçº§æœ€é«˜ã€‚å¦‚æœä¸æ˜¾å¼è®¾ç½®çš„è¯ï¼Œç³»ç»Ÿé»˜è®¤çš„çº¿ç¨‹ä¼˜å…ˆçº§æ˜¯0.5. è¦è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§çš„è¯ï¼Œä½ éœ€è¦åœ¨è®²æ“ä½œå¯¹è±¡æ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—ä¹‹å‰ï¼Œè°ƒç”¨setThreadPriorityå‡½æ•°ã€‚å½“å®ƒçš„æ‰§è¡Œæ—¶é—´åˆ°æ¥çš„æ—¶å€™ï¼Œé»˜è®¤çš„startå‡½æ•°å°±ä¼šè®¾ç½®ä½ ä¹‹å‰æŒ‡å®šçš„çº¿ç¨‹ä¼˜å…ˆçº§æ¥ä¿®æ”¹ä¼˜å…ˆçº§ã€‚è¿™ä¸ªä¼˜å…ˆçº§åªåœ¨ä½ æ‰§è¡Œçš„mainå‡½æ•°æ‰§è¡Œè¿‡ç¨‹ç”¨æœ‰æ•ˆã€‚æ‰€æœ‰çš„å…¶ä»–ä»£ç åŒ…æ‹¬ä½ çš„å®Œæˆå›è°ƒï¼Œä»ç„¶æ˜¯è¿è¡Œåœ¨é»˜è®¤çš„ä¼˜å…ˆçº§ä¸‹çš„ã€‚å¦‚æœä½ è‡ªå®šä¹‰äº†ä¸€ä¸ªå¹¶å‘çš„æ“ä½œï¼Œé‚£ä¹ˆä½ éœ€è¦é‡å†™startå‡½æ•°ï¼Œå¹¶æ‰‹åŠ¨å»ä¿®æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚ 3.6.4 è®¾ç½®ä¸€ä¸ªå®Œæˆåçš„å›è°ƒblockåœ¨OSX 10.6åŠä»¥åï¼Œä¸€ä¸ªæ“ä½œå¯¹è±¡å¯ä»¥åœ¨å®ƒçš„æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åå»æ‰§è¡Œä¸€ä¸ªå®Œæˆçš„blockï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ªå®Œæˆçš„blockæ‰§è¡Œä»»ä½•ä¸mainå‡½æ•°æ‰§è¡Œçš„ä»»åŠ¡é‡Œé¢ä¸ç›¸å…³çš„çš„blockã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯èƒ½éœ€è¦å‘Šè¯‰å®¢æˆ·è¿™ä¸ªæ“ä½œå¯¹è±¡çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆäº†ï¼Œä¸€ä¸ªå¹¶å‘çš„æ“ä½œå¯¹è±¡å¯èƒ½ä¼šä½¿ç”¨è¿™ä¸ªblockå»æ‰§è¡Œå®ƒæœ€åçš„KVOé€šçŸ¥ è¦è®¾ç½®ä¸€ä¸ªå®Œæˆblockï¼Œä½ å¯ä»¥ä½¿ç”¨setCompleteBlockï¼šå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸éœ€è¦ä¼ ä»»ä½•å‚æ•°ï¼Œä¹Ÿæ²¡æœ‰è¿”å›å€¼ã€‚ 3.7 å…³äºå®ç°ä¸€ä¸ªæ“ä½œå¯¹è±¡çš„ä¸€äº›Tipså°½ç®¡ä¸€ä¸ªæ“ä½œå¯¹è±¡å¯èƒ½éå¸¸å®¹æ˜“å»å®ç°ï¼Œä½†æ˜¯æœ‰ä¸€äº›äº‹æƒ…åœ¨ä½ è‡ªå®šä¹‰çš„æ“ä½œå¯¹è±¡ä¸Šè¿˜æ˜¯è¦æ³¨æ„ä¸€ä¸‹ï¼Œä¸‹é¢çš„å°æ®µæè¿°äº†è¿™ä¹ˆå‡ ä¸ªæ–¹é¢ã€‚ 3.7.1 ç®¡ç†æ“ä½œå¯¹è±¡çš„å†…å­˜ä¸‹é¢çš„å°æ®µï¼Œæè¿°äº†å‡ ä¸ªåœ¨æ“ä½œå¯¹è±¡ä¸­ç®¡ç†å†…å­˜çš„å…³é”®å…ƒç´ ï¼Œå…³äºæ›´å¤šçš„OCçš„å†…å­˜ç®¡ç†ï¼Œå‚è§å†…å­˜ç®¡ç†å¼€å‘æŒ‡å¯¼ã€‚ 3.7.1.1 é¿å…ä¾é çº¿ç¨‹å­˜å‚¨æ•°æ®å°½ç®¡å¤§å¤šæ˜¯çš„æ“ä½œéƒ½æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œåœ¨åŒæ­¥æ“ä½œå¯¹è±¡ä¸­ï¼Œè¿™ä¸ªçº¿ç¨‹é€šå¸¸æ˜¯ç”±æ“ä½œé˜Ÿåˆ—åˆ†é…ç»™å®ƒçš„ï¼Œå¦‚æœä¸€ä¸ªæ“ä½œé˜Ÿåˆ—å°†çº¿ç¨‹åˆ†é…ç»™æ“ä½œå¯¹è±¡ï¼Œé‚£ä¹ˆä½ éœ€è¦çŸ¥é“è¿™ä¸ªçº¿ç¨‹å®ƒæ˜¯å±äºæ“ä½œé˜Ÿåˆ—çš„ï¼Œä½ ä¸åº”è¯¥å’Œä½ çš„æ“ä½œå¯¹è±¡æœ‰ä»»ä½•ç“œè‘›ï¼Œå°¤å…¶æ˜¯ï¼Œä½ ä¸åº”è¯¥æœ‰ä»»ä½•æ•°æ®ç›¸å…³çš„åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­ï¼Œè€Œè¿™äº›æ•°æ®å¹¶ä¸æ˜¯ä½ åˆ›å»ºå’Œç®¡ç†çš„æ•°æ®ï¼Œå› ä¸ºçº¿ç¨‹çš„ç”Ÿå­˜å’Œæ­»äº¡æ˜¯æœ‰æ“ä½œé˜Ÿåˆ—æˆ–è€…ç³»ç»Ÿæ¥æ§åˆ¶çš„ï¼Œå› æ­¤åœ¨çº¿ç¨‹é—´æ•°æ®ä¼ é€’é€šè¿‡çº¿ç¨‹æ¥ä¼ é€’å°†æ˜¯ä¸å¯é ï¼Œä¹Ÿæ˜¯å®¹æ˜“å¤±è´¥çš„ã€‚ åœ¨æ“ä½œé˜Ÿåˆ—ä¸Šï¼Œæ²¡æœ‰ä»»ä½•çš„ç†ç”±å¯ä»¥ä½¿ç”¨çº¿ç¨‹å­˜å‚¨æ•°æ®ï¼Œå½“ä½ åˆå§‹åŒ–ä¸€ä¸ªæ“ä½œå¯¹è±¡ï¼Œä½ åº”è¯¥æä¾›ç»™å®ƒæ‰€æœ‰æ‰§è¡Œä»»åŠ¡éœ€è¦çš„æ•°æ®å»åšè¿™ä»¶äº‹ï¼Œå› æ­¤ï¼Œæ“ä½œå¯¹è±¡è¦æä¾›æ‰€æœ‰æ•°æ®ï¼Œæ‰€æœ‰æ¥çš„ã€å»çš„æ•°æ®éƒ½åº”è¯¥å­˜åœ¨æ“ä½œå¯¹è±¡ä¸Šï¼ŒçŸ¥é“ä»»åŠ¡ç»“æŸæˆ–è€…åº”ç”¨ä¸åœ¨éœ€è¦å®ƒã€‚ 3.7.1.2 å¦‚æœéœ€è¦çš„è¯ä¿æŒæ“ä½œå¯¹è±¡çš„å¼•ç”¨å› ä¸ºæ“ä½œå¯¹è±¡æ˜¯å¼‚æ­¥è¿è¡Œçš„ï¼Œä½ ä¸åº”è¯¥è®¤ä¸ºä½ å¯ä»¥åˆ›å»ºæˆ–è€…å¿˜è®°ä»–ä»¬ï¼Œå®ƒä»¬ä¹Ÿåªæ˜¯å¯¹è±¡è€Œå·²ï¼Œä¹Ÿéœ€è¦ä½ å»ç®¡ç†ä»–ä»¬ï¼Œå°¤å…¶æ˜¯ä½ éœ€è¦åœ¨å®ƒå®Œæˆä¹‹åè·å–æ•°æ®çš„æƒ…å†µä¸‹ã€‚ ä½ éœ€è¦ä¿æŒå¯¹æ“ä½œå¯¹è±¡çš„å¼•ç”¨ï¼Œä¸»è¦è¿˜æœ‰å¯èƒ½ä½ å†æ²¡æœ‰æœºä¼šè·å–è¿™ä¸ªæ“ä½œå¯¹è±¡çš„å¼•ç”¨çš„æœºä¼šäº†ï¼Œæ“ä½œå¯¹è±¡æ˜¯æ‰§è¡Œå¾ˆå¿«çš„ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ“ä½œä»»åŠ¡ä¸€æ—¦æ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—ä¸­ï¼Œå°±ä¼šè¢«æ‰§è¡Œï¼Œå½“ä½ çš„ä»£ç è·å–åˆ°ä»æ“ä½œé˜Ÿåˆ—ä¸­æ‹¿åˆ°çš„æ“ä½œå¯¹è±¡çš„æ—¶å€™ï¼Œå¾ˆå¯èƒ½ï¼Œè¿™ä¸ªæ“ä½œå¯¹è±¡å·²ç»ç»“æŸäº†ï¼Œå¹¶ä»æ“ä½œé˜Ÿåˆ—ç§»é™¤äº†ï¼Œé‡Šæ”¾äº†ã€‚ 3.7.2 å¤„ç†é”™è¯¯å’Œå¼‚å¸¸ç”±äºæ“ä½œå¯¹è±¡åœ¨ä½ çš„åº”ç”¨é‡Œé¢æ˜¯å®Œå…¨ç‹¬ç«‹çš„å®ä¾‹ï¼Œå› æ­¤æœ‰å¿…è¦å»å¤„ç†é‚£äº›å¼‚å¸¸å’Œé”™è¯¯ï¼Œåœ¨OSX 10.6åŠä»¥åï¼Œé»˜è®¤çš„startçš„å‡½æ•°ä¸åœ¨æä¾›æ•è·å¼‚å¸¸ã€‚ä½ è‡ªå·±çš„ä»£ç éœ€è¦å»ç›´æ¥çš„æ•è·å’Œå¤„ç†å¼‚å¸¸ï¼Œå¦‚æœéœ€è¦ä¹Ÿè¦æ£€æµ‹é”™è¯¯ä»£ç å¹¶é€šçŸ¥ç»™åº”ç”¨ç¨‹åºï¼Œå¦‚æœä½ æ›¿æ¢äº†startå‡½æ•°ï¼Œé‚£ä¹ˆä½ çš„ä»£ç éœ€è¦åœ¨ç¨‹åºç¦»å¼€åº•å±‚çº¿ç¨‹ä¹‹å‰å°±å»å¤„ç†è¿™äº›å¼‚å¸¸ã€‚ ä½ å¯èƒ½å¤„ç†çš„é”™è¯¯å¯èƒ½æœ‰ä¸€ä¸‹å‡ ç§æƒ…å†µ æ£€æµ‹UNIX errno ç±»å‹çš„é”™è¯¯ æ£€æµ‹æ˜¾å¼çš„ç”±ä»£ç è¿”å›çš„é”™è¯¯ æ•è·æ¥è‡ªä½ è‡ªå·±çš„ä»£ç å’Œç³»ç»Ÿæ¡†æ¶å¸¦æ¥çš„å¼‚å¸¸ å½“ä¸€ä¸ªæ“ä½œå¯¹è±¡æ²¡æœ‰å‡†å¤‡å¥½ï¼Œstartæ–¹æ³•å°±å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ å½“ä¸€ä¸ªæ“ä½œå·²ç»åœ¨æ‰§è¡Œæˆ–è€…æ‰§è¡Œå®Œæˆäº†ï¼Œæˆ–å–æ¶ˆäº†ï¼Œstartå‡½æ•°è¢«å†æ¬¡è°ƒç”¨çš„ã€‚ å½“æ·»åŠ ä¸€ä¸ªblockä»»åŠ¡ï¼Œä½†æ˜¯å®ƒå·²ç»è¢«æ‰§è¡Œæˆ–è€…å®Œæˆçš„ã€‚ å½“ä½ å‡†å¤‡ä»NSInvocationOperationå¯¹è±¡è·å–æ•°æ®ï¼Œä½†æ˜¯å®ƒå·²ç»è¢«å–æ¶ˆçš„æƒ…å†µã€‚ å¦‚æœä½ è‡ªå®šä¹‰çš„ä»£ç é‡åˆ°å¼‚å¸¸æˆ–è€…é”™è¯¯ï¼Œä½ éœ€è¦æä¾›æ“ä½œæ­¥éª¤ç»™ä½ çš„åº”ç”¨å»å¤„ç†ï¼ŒOperationå¯¹è±¡ä¸ä¼šæ˜¾å¼çš„æŠŠé”™è¯¯ä»£ç æˆ–è€…å¼‚å¸¸ä¼ é€’ç»™ä½ åº”ç”¨çš„å…¶ä»–åœ°æ–¹ï¼Œå› æ­¤ï¼Œå¦‚æœå¯¹äºåº”ç”¨ç¨‹åºæ˜¯æ¯”è¾ƒé‡è¦çš„ä¿¡æ¯ï¼Œä½ éœ€è¦æä¾›ç›¸å…³å¿…è¦çš„ä»£ç å»å¤„ç†è¿™äº›é”™è¯¯ã€‚ 3.8 å†³å®šæ“ä½œå¯¹è±¡åˆé€‚çš„æ•°é‡ï¼Œä¸è¦å¤ªå¤šï¼Œä¹Ÿä¸è¦å¤ªå°‘è™½ç„¶å¯ä»¥ç»™ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—ä¸­ï¼Œæ·»åŠ å¤§é‡çš„æ“ä½œå¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¹ˆåšï¼Œå¾€å¾€å¹¶ä¸å¤ªå¥½ï¼Œåƒå…¶ä»–å¯¹è±¡ä¸€æ ·ï¼Œåˆ›å»ºNSOperationå¯¹è±¡ä¹Ÿæ˜¯éœ€è¦æ¶ˆè€—å†…å­˜ï¼Œå¹¶ä¸”ä»–ä»¬çš„æ‰§è¡Œä¹Ÿæ˜¯éœ€è¦å¼€é”€çš„ã€‚å¦‚æœä½ çš„æ¯ä¸ªä»»åŠ¡éƒ½æ˜¯å¾ˆå°çš„ï¼Œè€Œä½ åˆåˆ›å»ºäº†æˆåƒä¸Šä¸‡ä¸ªï¼Œä½ ä¼šå‘ç°ä½ ä¼šæ¶ˆè€—æ›´å¤šçš„æ—¶é—´åœ¨åˆ†å‘æ“ä½œå¯¹è±¡ä¸Šï¼Œè€Œä¸æ˜¯åœ¨æ‰§è¡ŒçœŸæ­£çš„ä»»åŠ¡ï¼Œè€Œå¦‚æœä½ çš„è®¾å¤‡å·²ç»å†…å­˜ä¸è¶³æ—¶ï¼Œä½ ä¼šå‘ç°æˆåƒä¸Šä¸‡çš„ä»»åŠ¡ä¼šä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚ é«˜æ•ˆçš„åº”ç”¨æ“ä½œå¯¹è±¡çš„å…³é”®åœ¨äºï¼Œåœ¨å……åˆ†åˆ©ç”¨è®¾å¤‡å’Œæ‰§è¡Œä¸€å®šæ•°é‡çš„æ“ä½œä»»åŠ¡ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹ï¼Œå°è¯•å»æ‰¾åˆ°ä½ çš„è®¾å¤‡æ‰§è¡Œä»»åŠ¡çš„ä¸€ä¸ªçœŸæ­£çš„æ•°é‡å€¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ çš„åº”ç”¨åˆ›å»ºäº†100ä¸ªæ“ä½œå¯¹è±¡å»å¤„ç†100ä¸ªä¸åŒçš„å€¼ï¼Œé‚£ä¹ˆä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨10ä¸ªæ“ä½œå¯¹è±¡ï¼Œå»å¤„ç†10ä¸ªå€¼å»ä»£æ›¿ã€‚ åŒæ—¶ï¼Œä½ ä¹Ÿéœ€è¦é¿å…ä¸€æ¬¡æ€§çš„ç»™æ“ä½œé˜Ÿåˆ—ä¸­æ·»åŠ å¤§é‡çš„ä»»åŠ¡ï¼Œä¹Ÿè¦é¿å…ä¸åœçš„ç»™æ“ä½œé˜Ÿåˆ—ä»¥æ¯”å®ƒå¤„ç†é€Ÿåº¦æ›´å¿«çš„æ·»åŠ æ›´å¤šçš„ä»»åŠ¡ï¼Œç›¸æ¯”äºä¸€æ¬¡æ³›å“„å¼çš„æ·»åŠ ä»»åŠ¡ï¼Œä¸å¦‚æ‰¹é‡å¼çš„å»æ·»åŠ ï¼Œç„¶ååˆ©ç”¨å®Œæˆblockå›è°ƒå»æ‰§è¡Œä¸‹ä¸€æ‰¹æ¬¡çš„ä»»åŠ¡ã€‚è¿™æ ·å¯ä»¥é¿å…å†…å­˜è¿‡å¤šçš„æ¶ˆè€—ã€‚ å½“ç„¶ï¼Œåˆ›å»ºæ“ä½œå¯¹è±¡çš„æ•°é‡ã€ä»¥åŠæ²¡ä¸ªæ“ä½œå¯¹è±¡éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡é‡ï¼Œæ˜¯ç”±ä½ çš„ç¨‹åºåŠ¨æ€å»ç®¡ç†çš„ã€‚ä½ åº”è¯¥æ˜¯ç”¨æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œä¾‹å¦‚Instrumentså»æ‰¾åˆ°æ€§èƒ½å¤„ç†å’Œé€Ÿåº¦çš„å¹³è¡¡ç‚¹ï¼Œå…³äºInstruments å’Œå…¶ä»–æ€§èƒ½å·¥å…·çš„æ›´å¤šä¿¡æ¯ï¼Œå‚è§æ€§èƒ½ã€‚ 3.9 æ“ä½œå¯¹è±¡çš„æ‰§è¡Œæœ€åï¼Œä½ çš„åº”ç”¨éœ€è¦æ‰§è¡Œè¿™äº›æ“ä½œå¯¹è±¡ä»¥çœŸæ­£çš„å¤„ç†ä»»åŠ¡ï¼Œåœ¨è¿™ä¸€å°èŠ‚ï¼Œä½ å°†å­¦åˆ°å°±åƒä½ ç†Ÿç»ƒçš„æ‰§è¡Œä½ çš„æ“ä½œä¸€æ ·ï¼Œå»æ‰§è¡Œè¿™äº›æ“ä½œã€‚ 3.9.1 æ·»åŠ æ“ä½œå¯¹è±¡åˆ°æ“ä½œé˜Ÿåˆ—ä¸­åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæœ€å®¹æ˜“çš„æ‰§è¡Œæ“ä½œçš„æ–¹å¼æ˜¯ä½¿ç”¨æ“ä½œé˜Ÿåˆ—ï¼Œå³NSOperationQueueç±»çš„å®ä¾‹ï¼Œä½ çš„åº”ç”¨æœ‰è´£ä»»å»åˆ›å»ºå’Œç»´æŠ¤è¿™äº›æ“ä½œé˜Ÿåˆ—ã€‚ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥æœ‰ä»»æ„æ•°é‡çš„æ“ä½œé˜Ÿåˆ—ï¼Œä½†æ˜¯å®é™…ä¸Šåœ¨åŒä¸€æ—¶é—´æœ‰å¤šå°‘ä¸ªæ“ä½œä¼šè¢«æ‰§è¡Œè¿˜æ˜¯æœ‰é™åˆ¶çš„ï¼Œè¢«ç³»ç»Ÿè°ƒç”¨çš„æ“ä½œé˜Ÿåˆ—ä¼šæ ¹æ®å¯åˆ©ç”¨çš„CPUå’Œç³»ç»Ÿçš„è½½å…¥é‡æ¥è¿›è¡Œé™åˆ¶å•ä½æ—¶é—´æ‰§è¡Œçš„æ“ä½œå¯¹è±¡ï¼Œå› æ­¤ï¼Œåˆ›å»ºæ›´å¤šçš„æ“ä½œé˜Ÿåˆ—å¹¶ä¸æ„å‘³ç€å¯ä»¥æ‰§è¡Œæ›´å¤šçš„æ“ä½œå¯¹è±¡ å°±æƒ³åˆ›å»ºå…¶ä»–çš„å¯¹è±¡ä¸€æ ·ï¼Œåœ¨ä½ çš„åº”ç”¨ä¸­åˆ›å»ºæ“ä½œé˜Ÿåˆ— 1NSOperationQueue* aQueue = [[NSOperationQueue alloc] init]; æ·»åŠ ä¸€ä¸ªæ“ä½œå¯¹è±¡åˆ°æ“ä½œé˜Ÿåˆ—ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨addOperationæ–¹æ³•ï¼Œåœ¨OSX 10.6ä»¥åï¼Œä½ è¿˜å¯ä»¥æ·»åŠ æ“ä½œå¯¹è±¡ç»„ï¼Œé€šè¿‡ 1addOperationsï¼šwaitUntilFinishedï¼š æ–¹æ³•ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥æ·»åŠ bloclå¯¹åƒåˆ°æ“ä½œé˜Ÿåˆ—ä¸­ï¼ˆè€Œä¸éœ€è¦ä¸ä¸€ä¸ªæ“ä½œå¯¹è±¡å…³è”ï¼‰ï¼Œé€šè¿‡ 1addOperationWithBlockï¼š æ–¹æ³•ï¼Œä¸Šé¢çš„è¿™äº›æ–¹æ³•ï¼Œé˜Ÿåˆ—éƒ½ä¼šå…¥ä¸€ä¸ªæ“ä½œå¯¹è±¡å¹¶é€šçŸ¥é˜Ÿåˆ—å»æ‰§è¡Œä»–ä»¬ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ“ä½œå¯¹è±¡å°†ä¼šè¢«å¾ˆå¿«æ‰§è¡Œï¼Œä½†æ˜¯æœ‰æ—¶å€™ï¼Œæ“ä½œé˜Ÿåˆ—ä¹Ÿå¯èƒ½å»¶è¿Ÿæ‰§è¡Œæ“ä½œå¯¹è±¡ï¼Œå¤§æ¦‚æœ‰è¿™ä¹ˆå‡ ä¸ªåŸå› ï¼Œæœ€æ™®éçš„å°±æ˜¯ï¼Œæ“ä½œå¯¹è±¡é—´å¯èƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯æ“ä½œé˜Ÿåˆ—è‡ªå·±å¯èƒ½è¢«æŒ‚èµ·ï¼Œæˆ–è€…æ˜¯æ“ä½œé˜Ÿåˆ—æ‰§è¡Œæ“ä½œä»»åŠ¡çš„æ•°é‡è¾¾åˆ°äº†ä¸Šé™ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†æœ€åŸºç¡€çš„æ·»åŠ æ“ä½œåˆ°æ“ä½œé˜Ÿåˆ—çš„è¯­æ³• 1234[aQueue addOperation:anOp]; // Add a single operation [aQueue addOperations:anArrayOfOps waitUntilFinished:NO]; // Add multiple operations [aQueue addOperationWithBlock:^{ /* Do something. */ }]; é‡è¦ åƒä¸‡ä¸è¦åœ¨ä¸€ä¸ªæ“ä½œå¯¹è±¡è¿›å…¥æ“ä½œé˜Ÿåˆ—ä¹‹åå†å»ä¿®æ”¹å®ƒï¼Œå› ä¸ºå½“æ“ä½œåœ¨æ“ä½œé˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œçš„æ—¶å€™ï¼Œå®ƒå¯èƒ½åœ¨ä»»ä½•æ—¶å€™å»æ‰§è¡Œä»»åŠ¡ï¼Œæ”¹å˜å®ƒçš„ä¾èµ–å’Œæ•°æ®ï¼Œå¯èƒ½ä¼šèµ·åˆ°åçš„ä½œç”¨ã€‚å¦‚æœä½ æƒ³çŸ¥é“ä¸€ä¸ªæ“ä½œå¯¹è±¡çš„çŠ¶æ€ï¼Œè¯·ä½¿ç”¨æ“ä½œå¯¹è±¡çš„å±æ€§ å»è·å–ã€‚ 3.9.2 æ‰‹åŠ¨æ‰§è¡Œæ“ä½œå¯¹è±¡å°½ç®¡æ“ä½œé˜Ÿåˆ—å¯¹äºè¿è¡Œæ“ä½œå¯¹è±¡å·²ç»å¾ˆæ–¹ä¾¿äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€ç§å¯èƒ½ä¸ä½¿ç”¨æ“ä½œé˜Ÿåˆ—å»æ‰§è¡Œä¸€ä¸ªæ“ä½œå¯¹è±¡ï¼Œå¦‚æœä½ é€‰æ‹©æ‰‹åŠ¨å»æ‰§è¡Œæ“ä½œå¯¹è±¡ï¼Œé‚£ä¹ˆæœ‰ä¸€äº›æ³¨æ„äº‹é¡¹ï¼Œæœ€ä¸»è¦çš„æ˜¯ï¼Œæ“ä½œå¯¹è±¡å¿…é¡»å¾—æ˜¯readyï¼Œè€Œä¸”ä½ éœ€è¦ç”¨startå‡½æ•°å»å¯åŠ¨å®ƒã€‚ ä¸€ä¸ªæ“ä½œå¯¹è±¡å¦‚æœä¸æ˜¯readyçŠ¶æ€çš„è¯ä¸åº”è¯¥å»æ‰§è¡Œï¼ŒisReadyå‡½æ•°è¢«Operationå¯¹è±¡çš„ä¾èµ–å…³ç³»å°è£…åˆ°äº†ä¸Šå±‚ï¼Œåªæœ‰å½“å®ƒçš„ä¾èµ–å…³ç³»éƒ½æ¸…é™¤çš„æ—¶å€™ï¼Œä¸€ä¸ªæ“ä½œæ‰èƒ½å¤Ÿè¢«æ‰§è¡Œã€ å½“æ‰§è¡Œä¸€ä¸ªæ“ä½œå¯¹è±¡ï¼Œåº”è¯¥å»ä½¿ç”¨startå‡½æ•°å»åšã€‚ç”¨è¿™ä¸ªå‡½æ•°è€Œä¸æ˜¯ç”¨mainï¼Œæ˜¯å› ä¸ºstartå‡½æ•°ä¼šåœ¨æ‰§è¡Œä¹‹å‰æ‰§è¡Œä¸€ä¸ªå®‰å…¨æ£€æŸ¥ï¼Œå°¤å…¶æ˜¯ï¼Œé»˜è®¤çš„startå‡½æ•°è¿˜ä¼šäº§ç”ŸKVOé€šçŸ¥ï¼Œä»¥ä¿è¯ä¾èµ–å…³ç³»èƒ½å¤Ÿæ­£ç¡®è¿›è¡Œï¼Œè¿™ä¸ªå‡½æ•°åŒæ—¶ä¹Ÿé¿å…å½“ä½ çš„æ“ä½œå¯¹è±¡è¢«å–æ¶ˆçš„æ—¶å€™ï¼Œå†å»æ‰§è¡Œï¼Œä»¥åŠå½“æ“ä½œå¯¹è±¡æ²¡æœ‰å‡†å¤‡å¥½çš„æ—¶å€™å°±å»è°ƒç”¨å¯¼è‡´çš„å¼‚å¸¸æŠ›å‡º ã€‚ å¦‚æœä½ çš„ç¨‹åºå®šä¹‰äº†å¹¶å‘çš„æ“ä½œå¯¹è±¡ï¼Œä½ åŒæ—¶éœ€è¦åœ¨å¯åŠ¨ä»»åŠ¡ä¹‹å‰è€ƒè™‘isConcurrentã€‚å½“è¿™ä¸ªæ–¹æ³•è¿”å›NOçš„æ—¶å€™ï¼Œä½ å°±å¯ä»¥è€ƒè™‘æ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­åŒæ­¥çš„æ‰§è¡Œè¿˜æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å­çº¿ç¨‹ã€‚ç„¶è€Œï¼Œè¿™äº›æ–¹æ³•çš„æ£€æµ‹å®Œå…¨å–å†³äºä½ ã€‚ ä¸‹é¢å±•ç¤ºäº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ï¼Œæ‰‹åŠ¨å¼€å¯å¹¶å‘æ“ä½œå¯¹è±¡çš„ä¸€ä¸ªä¾‹å­ã€‚å¦‚æœè¿™ä¸ªå‡½æ•°è¿”å›NOï¼Œä½ å¯ä»¥å¯åŠ¨ä¸€ä¸ªtimerï¼Œåœ¨ä¹‹åå†å»è°ƒç”¨å®ƒã€‚ç„¶åç›´åˆ°å®ƒè¿”å›YESä¹‹åï¼Œå–æ¶ˆæ‰Timerã€‚å› ä¸ºè¿™ç§æƒ…å†µå¯èƒ½åœ¨æ“ä½œå¯¹è±¡è¢«å–æ¶ˆçš„æ—¶å€™å‘ç”Ÿã€‚ 1234567891011121314151617181920- (BOOL)performOperation:(NSOperation*)anOp { BOOL ranIt = NO; if ([anOp isReady] &amp;&amp; ![anOp isCancelled]) { if (![anOp isConcurrent]) [anOp start]; else [NSThread detachNewThreadSelector:@selector(start) toTarget:anOp withObject:nil]; ranIt = YES; }else if ([anOp isCancelled]){ // If it was canceled before it was started, // move the operation to the finished state. [self willChangeValueForKey:@&quot;isFinished&quot;]; [self willChangeValueForKey:@&quot;isExecuting&quot;]; executing = NO; finished = YES; [self didChangeValueForKey:@&quot;isExecuting&quot;]; [self didChangeValueForKey:@&quot;isFinished&quot;]; // Set ranIt to YES to prevent the operation from // being passed to this method again in the future. ranIt = YES; } return ranIt; } 3.9.3 å–æ¶ˆæ“ä½œå¯¹è±¡å½“å°†æ“ä½œå¯¹è±¡æ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—é‡Œé¢çš„æ—¶å€™ï¼Œä¸€ä¸ªæ“ä½œå¯¹è±¡çš„ç®¡ç†å°±äº¤ç»™äº†æ“ä½œé˜Ÿåˆ—ï¼Œä¹Ÿä¸èƒ½è¢«ç§»é™¤äº†ï¼Œå”¯ä¸€ä½¿æ“ä½œå¯¹è±¡å‡ºåˆ—çš„æ–¹æ³•å°±æ˜¯è°ƒç”¨å®ƒçš„cancelå‡½æ•°ï¼Œä½ ä¹Ÿå¯ä»¥å–æ¶ˆæ‰€æœ‰çš„æ“ä½œå¯¹è±¡ï¼Œé€šè¿‡è°ƒç”¨æ“ä½œé˜Ÿåˆ—çš„cancelAllOperations ä½ å¯ä»¥åœ¨ç¡®ä¿ä½ ä¸åœ¨éœ€è¦æ“ä½œå¯¹è±¡çš„æ—¶å€™å–æ¶ˆæ‰å®ƒã€‚å‘å‡ºä¸€ä¸ªcancelå‘½ä»¤ï¼Œä¼šå°†æ“ä½œå¯¹è±¡çš„å…³é”®è·¯å¾„å˜ä¸ºcanceledçŠ¶æ€ï¼Œè¿™å°†é˜»æ­¢ä»»åŠ¡ç»§ç»­æ‰§è¡Œï¼Œç”±äºcanceledçš„æ“ä½œå¯¹è±¡ä¹Ÿè®¤ä¸ºæ˜¯å®Œæˆçš„ï¼Œé‚£ä¹ˆä¾èµ–å®ƒçš„æ“ä½œå¯¹è±¡å°±å¯ä»¥ç§»é™¤ä¾èµ–å…³ç³»ã€‚ç„¶è€Œï¼Œæ›´å¤šæƒ…å†µä¸‹ï¼Œæ›´å¸¸ç”¨çš„æ˜¯å–æ¶ˆæ‰€æœ‰æ“ä½œç‹¬äº«ï¼Œåœ¨æŸäº›é‡è¦çš„æ—¶å€™ï¼Œæ¯”å¦‚åº”ç”¨é€€å‡ºã€æˆ–è€…ç”¨æˆ·å‘å‡ºäº†å–æ¶ˆæŒ‡ä»¤ï¼Œè¿™æ¯”ä¸€ä¸ªä¸ªå–æ¶ˆè¦å¥½å¾ˆå¤šã€‚ 3.9.4 ç­‰å¾…æ“ä½œå¯¹è±¡çš„å®Œæˆä¸ºäº†è·å–æœ€ä½³çš„æ€§èƒ½ï¼Œä½ åº”è¯¥å°½å¯èƒ½çš„è®©æ“ä½œå¯¹è±¡å¹¶å‘æ‰§è¡Œï¼Œè®©ç³»ç»Ÿå»å¹²æ›´å¤šçš„äº‹æƒ…ï¼Œåœ¨ä½ æ‰§è¡Œæ“ä½œå¯¹è±¡ä»»åŠ¡çš„æ—¶å€™ï¼Œå¦‚æœåˆ›å»ºä¸€ä¸ªæ“ä½œå¯¹è±¡çš„æ—¶å€™ï¼ŒåŒæ—¶å¸Œæœ›è·å¾—äº†æ“ä½œå¯¹è±¡çš„ç»“æœï¼Œä½ å¯ä»¥ä½¿ç”¨waitUntilFinishedï¼šæ–¹æ³•æ¥é˜»å¡ä»£ç ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°è¿™ä¸ªæ“ä½œå¯¹è±¡æ‰§è¡Œå®Œæˆã€‚é€šå¸¸æ¥è®²ï¼Œè¿™æ˜¯æœ€å¥½çš„æ–¹å¼å»é¿å…ä½ èƒ½å¸®åˆ°å®ƒçš„æ—¶å€™ï¼Œé˜»å¡å½“å‰çº¿ç¨‹ä¹Ÿè®¸æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ³•ã€‚ä½†è¿™ä¹Ÿå¸¦æ¥äº†æ›´å¤šçš„åŒæ­¥æ€§ï¼Œè€Œé™åˆ¶äº†æ•´ä½“çš„å¯å¹¶å‘æ€§ã€‚ ä½ ç»ä¸å…è®¸åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä½ æœ€å¥½åœ¨å­çº¿ç¨‹æˆ–è€…å…¶ä»–çš„çº¿ç¨‹æ“ä½œä¸­è¿™ä¹ˆåšï¼Œé˜»å¡ä¸»çº¿ç¨‹å°†ä¼šé™ä½ç¨‹åºçš„å¯å“åº”æ€§ã€‚ é™¤äº†ç­‰å¾…ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼Œä½ å¯ä»¥ç­‰å¾…ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—æ‰€æœ‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œé€šè¿‡è°ƒç”¨waitUntilAllOperationsAreFinishedï¼Œå½“ä½ ç­‰å¾…ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—ä»»åŠ¡å®Œæˆçš„æ—¶å€™ï¼Œé¿å…åœ¨åˆ«çš„çº¿ç¨‹ä¸­æ·»åŠ ä»»åŠ¡ç»™å®ƒï¼Œä»¥é˜²å»¶é•¿ç­‰å¾…æ—¶é—´ã€‚ 3.9.5 æŒ‚èµ·å’Œæ¢å¤æ“ä½œé˜Ÿåˆ—å¦‚æœä½ æƒ³ä¸­é€”ç»ˆæ­¢ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—çš„è¯ï¼Œä½ å¯ä»¥æŒ‚èµ·ç›¸åº”çš„æ“ä½œé˜Ÿåˆ—ï¼Œä½¿ç”¨setSuspendedæ–¹æ³•ï¼ŒæŒ‚èµ·ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—å¹¶ä¸ä¼šå¯¼è‡´æ­£åœ¨æ‰§è¡Œçš„æ“ä½œä»»åŠ¡ç»ˆæ­¢ã€‚å®ƒåªæ˜¯ä¼šé˜»æ­¢åˆ«çš„æ“ä½œå¯¹è±¡ï¼ˆæ“ä½œé˜Ÿåˆ—ä¸­çš„ï¼‰ä¸å»æ‰§è¡Œï¼Œä½ å¯èƒ½ä¼šåœ¨ç”¨æˆ·æƒ³æš‚åœä»»åŠ¡çš„æ—¶å€™æŒ‚èµ·æ‰€æœ‰æ“ä½œï¼Œå› ä¸ºç”¨æˆ·è¿˜æœŸæœ›åœ¨æŸä¸ªæ—¶å€™æ¢å¤è¿™äº›ä»»åŠ¡ã€‚","link":"/2016/08/27/%5B%E8%AF%91%5D%20ios%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97/"},{"title":"iOSæ¥å…¥fastlaneç®€æ˜“ç‰ˆæ•™ç¨‹","text":"fastlane æ˜¯ä»€ä¹ˆï¼Ÿä¸€å¥—ä½¿ç”¨Rubyå†™çš„è‡ªåŠ¨åŒ–å·¥å…·é›†ï¼Œæ—¨åœ¨ç®€åŒ–Androidå’ŒiOSçš„éƒ¨ç½²è¿‡ç¨‹ï¼Œè‡ªåŠ¨åŒ–ä½ çš„å·¥ä½œæµã€‚å®ƒå¯ä»¥ç®€åŒ–ä¸€äº›ä¹å‘³ã€å•è°ƒã€é‡å¤çš„å·¥ä½œï¼Œåƒæˆªå›¾ã€ä»£ç ç­¾åä»¥åŠå‘å¸ƒApp fastlane å¯ä»¥å¹²ä»€ä¹ˆ æ’ä»¶ åŠŸèƒ½ gym æ˜¯fastlaneæä¾›çš„æ‰“åŒ…å·¥å…·ã€‚ snapshot ç”Ÿæˆå¤šä¸ªè®¾å¤‡çš„æˆªå›¾æ–‡ä»¶ frameit å¯¹æˆªå›¾åŠ ä¸€å±‚ç‰©ç†è¾¹æ¡† increment_build_number è‡ªå¢build number ç„¶åä¸ä¹‹å¯¹åº”çš„get_build_numberã€‚Version numberåŒç†ã€‚ certï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ä»£ç ç­¾åè¯ä¹¦ sighï¼š ç”Ÿæˆä¸€ä¸ªprovisioning profileå¹¶ä¿å­˜æ‰“å½“å‰æ–‡ä»¶ pemï¼š ç¡®ä¿å½“å‰çš„æ¨é€è¯ä¹¦æ˜¯æ´»è·ƒçš„ï¼Œå¦‚æœæ²¡æœ‰ä¼šå¸®ä½ ç”Ÿæˆä¸€ä¸ªæ–°çš„ matchï¼š åœ¨å›¢é˜Ÿä¸­åŒæ­¥è¯ä¹¦å’Œæè¿°æ–‡ä»¶ã€‚(è¿™æ˜¯ä¸€ç§å…¨æ–°çš„ç®¡ç†è¯ä¹¦çš„æ–¹å¼) testflightï¼š ä¸Šä¼ ipaåˆ°testflight deliverï¼š ä¸Šä¼ ipaåˆ°AppStore fastlane å®‰è£…æŒ‡å—gem å®‰è£…fastlane 1sudo gem install fastlane æ–°é¡¹ç›®å®‰è£…fastlane1fastlane init fastlaneæ‰“åŒ…æ‰“åŒ…éœ€è¦æ¡ä»¶ æ¡ä»¶ åç§° æ˜¯å¦å¿…é¡» å·¥ç¨‹å DailyClock æ˜¯ åŒ…å æ‰“å¡ æ˜¯ æ‰“åŒ…ç¯å¢ƒ Debug æ˜¯ teamID M99LZTCK8N æ˜¯ provisioningProfiles {â€œcom.chengyan.DailyClockâ€ =&gt; â€œDailyClockAppStoreâ€} æ˜¯ ä»¥ä¸‹æ˜¯ä¸Šä¼ è’²å…¬è‹±éœ€è¦çš„å‚æ•° è’²å…¬è‹±çš„appid **** å¦ è’²å…¬è‹±çš„userkey ** å¦ ä»¥ä¸‹æ˜¯ä¸Šä¼ appstoreéœ€è¦å‡†å¤‡çš„å‚æ•° ç”¨æˆ·å xxxxxx@xx.com æ˜¯ å¯†ç  xxxxx æ˜¯ FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD xxxx æ˜¯ FASTLANE_SESSION xxx æ˜¯ å¯èƒ½é‡åˆ°çš„é—®é¢˜ æ€ä¹ˆè·å– FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORDï¼Ÿè®¿é—®è‹¹æœè´¦å·ç®¡ç†æ·»åŠ appä¸“ç”¨çš„å¯†ç  æ€ä¹ˆè·å–FASTLANE_SESSIONï¼Ÿå‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼šfastlane spaceauth -u yourappleid command timed out after 10 seconds on try 1 of 4åŸå› ï¼š å¾ˆå¤§å¯èƒ½æ˜¯æœºå™¨ä¸ç»™åŠ›äº†ï¼Œä½¿xcodebuild -showBuildSettings ? -workspace ./XX.xcworkspace -scheme XX -configuration Releaseå‘½ä»¤æ‰§è¡Œè¶…æ—¶è§£å†³æ–¹æ³•: åœ¨Fastfileçš„ before_allæ–¹æ³•ä¸­ï¼Œæ·»åŠ  : 12ENV[&quot;FASTLANE_XCODEBUILD_SETTINGS_TIMEOUT&quot;] = &quot;120&quot;ENV[&quot;FASTLANE_XCODEBUILD_SETTINGS_RETRIES&quot;] = &quot;4&quot; ä¸€äº›èŒƒä¾‹ èŒƒä¾‹ä¸€ã€æ‰“åŒ…appå¹¶ä¸Šä¼ åˆ°è’²å…¬è‹±å¹³å° 123456789101112131415161718192021222324252627 desc &quot;Description of what the lane does&quot; lane :dk doipa_dir = &quot;fastlane_build/&quot;ipa_name = &quot;æ‰“å¡&quot;+Time.new.strftime('%Y-%m-%d_%H:%M')archive_path = &quot;./build/ipa/tem/archive/DailyClock.xcarchive&quot;increment_build_number(xcodeproj:&quot;DailyClock.xcodeproj&quot;)build_app(workspace:&quot;DailyClock.xcworkspace&quot;,scheme:&quot;DailyClock&quot;,configuration:&quot;Debug&quot;,clean: true,output_directory:ipa_dir,archive_path:archive_path,export_options:{method:&quot;development&quot;, destination: &quot;export&quot;, stripSwiftSymbols: true, teamID: &quot;M99LZTCK8N&quot;, uploadBitcode: false, uploadSymbols: true, provisioningProfiles: {&quot;com.chengyan.DailyClock&quot; =&gt; &quot;DailyClockDev&quot;}}) # å‘å¸ƒåˆ°è’²å…¬è‹±å¹³å° pgyer(api_key:&quot;æ›¿æ¢ä¸ºä½ çš„è’²å…¬è‹±å¹³å°çš„appkey&quot;,user_key:&quot;æ›¿æ¢ä¸ºä½ è‡ªå·±çš„userkey&quot;) end èŒƒä¾‹äºŒã€æ‰“åŒ…appä¸Šä¼ åˆ°appstore 123456789101112131415161718192021222324252627282930313233desc &quot;app store&quot; lane:release do ENV[&quot;FASTLANE_USER&quot;] = &quot;your appleid&quot; ENV[&quot;FASTLANE_PASSWORD&quot;] = &quot;password&quot; ENV[&quot;FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD&quot;] = &quot;yourpasssword&quot; ENV[&quot;FASTLANE_SESSION&quot;] = '''yoursession''' ipa_dir = &quot;fastlane_build/&quot; ipa_name = &quot;æµ‹ä¸€æµ‹&quot;+Time.new.strftime('%Y-%m-%d_%H:%M') archive_path = &quot;./build/ipa/tem/archive/xxx.xcarchive&quot; increment_build_number(xcodeproj:&quot;xxx.xcodeproj&quot;) build_app(workspace:&quot;xxx.xcworkspace&quot;, scheme:&quot;xxx&quot;, configuration:&quot;Release&quot;, clean: true, output_directory:ipa_dir, archive_path:archive_path, export_options:{ method:&quot;app-store&quot;, destination: &quot;export&quot;, stripSwiftSymbols: true, teamID: &quot;xxx&quot;, uploadBitcode: false, uploadSymbols: true, provisioningProfiles: {&quot;xxxx&quot;} } ) upload_to_testflight( ipa: ipa_dir+'/grh.ipa', skip_waiting_for_build_processing: true )end æˆåŠŸæˆªå›¾ å‘½ä»¤æ‰§è¡Œ12fastlane release # æ‰“åŒ…å¹¶å‘å¸ƒappstorefastlane dk #æ‰“åŒ…å¹¶å‘å¸ƒåˆ°è’²å…¬è‹± æ›´å¤šç»“åˆalfredæ•ˆç‡ç¥å™¨ï¼Œæ‰“åŒ…å°†æ›´é¦™ã€‚æœ€ç»ˆæ•ˆæœçœŸé¦™ï¼ï¼ï¼","link":"/2022/07/28/iOS%E6%8E%A5%E5%85%A5fastlane%E7%AE%80%E6%98%93%E7%89%88%E6%95%99%E7%A8%8B/"},{"title":"iOSé…ç½®ç»Ÿä¸€æ¨é€è¯ä¹¦Token Authenticatioæ–¹å¼","text":"èƒŒæ™¯ ç”±äºå¼€å‘è€…è´¦å·ä¸‹é¢é…ç½®çš„appè¶Šæ¥è¶Šå¤šï¼Œå¯¹äºæ¨é€è¯ä¹¦çš„é…ç½®æœ‰äº†æ–°çš„è¦æ±‚ï¼Œè¯ä¹¦å°½å¯èƒ½åªéœ€è¦é…ç½®ä¸€æ¬¡å°±å¯ä»¥ã€‚ æ–¹æ¡ˆAppleæä¾›äº†ä¸€ç§æ–°çš„æ–¹æ¡ˆï¼Œåœ¨å¼€å‘è€…ç½‘ç«™ä¸Šï¼Œå¯ä»¥åˆ›å»ºkeysï¼Œæå…‰æ¨é€ç›®å‰ä¹Ÿå·²ç»å¯¹è¿™ç§æ–¹å¼è¿›è¡Œäº†æ”¯æŒï¼Œåˆ›å»ºå¥½çš„keyï¼Œä¿å­˜åˆ°æœ¬åœ°ä¼šæ˜¯ä¸€ä¸ªp8ç±»å‹çš„æ–‡ä»¶ï¼Œåˆ›å»ºæµç¨‹å¦‚ä¸‹123 ç¬¬ä¸€æ­¥: ç‚¹å‡»keyç›˜è¾¹çš„â€œ+â€å·æŒ‰é’® å›¾ä¸€ ç¬¬äºŒæ­¥ï¼šç„¶åå‹¾é€‰apple push notification service å›¾äºŒ ç¬¬ä¸‰æ­¥ï¼šè¾“å…¥è¦åˆ›å»ºçš„keysåç§°ï¼Œç„¶åç‚¹å‡»å³ä¾§çš„regiestæŒ‰é’® å›¾ä¸‰ ç¬¬å››éƒ¨ï¼šç™»å…¥æå…‰å¹³å°ï¼Œç„¶åé€‰ä¸­åˆšæ‰ç”Ÿæˆçš„P8æ–‡ä»¶ï¼Œä¹‹åï¼ŒæŒ¨ä¸ªå¡«å…¥å¯¹åº”çš„ä¿¡æ¯ å›¾å›› å¤‡æ³¨ æå…‰æ¨é€ç½‘ç«™ appleé…ç½®åœ°å€","link":"/2022/07/26/iOS%E9%85%8D%E7%BD%AE%E7%BB%9F%E4%B8%80%E6%8E%A8%E9%80%81%E8%AF%81%E4%B9%A6Token-Authenticatio%E6%96%B9%E5%BC%8F/"},{"title":"iosåº•å±‚åŸç†ï¼šOCå¯¹è±¡","text":"ä¸€ã€OCå¯¹è±¡çš„æœ¬è´¨ocçš„å¯¹è±¡å å¤šå¤§å†…å­˜ç©ºé—´ï¼Ÿ ç­”æ¡ˆæ˜¯16ä¸ªå­—èŠ‚ï¼Œä¸ºä»€ä¹ˆæ˜¯16ä¸ªï¼Œä¸€ä¸ªocå¯¹è±¡å†…éƒ¨åªå­˜æ”¾äº†ä¸€ä¸ªisaæŒ‡é’ˆï¼Œè€Œåœ¨64ä½ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªæŒ‡é’ˆå æ®çš„ç©ºé—´æ˜¯8å­—èŠ‚ï¼Œä½†æ˜¯ä¸ºäº†å­—èŠ‚å¯¹é½ï¼Œæœ€å°çš„å†…å­˜ç©ºé—´åˆ†é…ä¸º16ä¸ªå­—èŠ‚ã€‚ ocçš„å¯¹è±¡ï¼Œæ˜¯ç”±ç±»åˆ›å»ºçš„ï¼Œç±»åœ¨océ‡Œé¢æ˜¯Classï¼Œé‚£ä¹ˆClassçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿå®é™…ä¸Šclassæ˜¯ç”±cçš„ç»“æ„ä½“æ„æˆçš„ã€‚**å‚é˜…runtimeä¸­çš„objc.hæ–‡ä»¶å¯çŸ¥,**å…·ä½“å®ç°å¦‚ä¸‹ 12345678910111213141516struct objc_class { Class _Nonnull isa OBJC_ISA_AVAILABILITY;#if !__OBJC2__ Class _Nullable super_class OBJC2_UNAVAILABLE; const char * _Nonnull name OBJC2_UNAVAILABLE; long version OBJC2_UNAVAILABLE; long info OBJC2_UNAVAILABLE; long instance_size OBJC2_UNAVAILABLE; struct objc_ivar_list * _Nullable ivars OBJC2_UNAVAILABLE; struct objc_method_list * _Nullable * _Nullable methodLists OBJC2_UNAVAILABLE; struct objc_cache * _Nonnull cache OBJC2_UNAVAILABLE; struct objc_protocol_list * _Nullable protocols OBJC2_UNAVAILABLE;#endif} OBJC2_UNAVAILABLE; æ¯ä¸€ä¸ªocå¯¹è±¡é‡Œé¢éƒ½æœ‰ä¸€ä¸ªisaæŒ‡é’ˆã€‚å¦‚ä¸‹ 123 struct objc_object { Class _Nonnull isa OBJC_ISA_AVAILABILITY;}; äºŒã€å¯¹è±¡çš„æˆå‘˜å˜é‡ocå¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œæ–¹æ³•ï¼Œåè®®ç»Ÿç»Ÿéƒ½æ˜¯å­˜æ”¾åœ¨classé‡Œé¢ã€‚åœ¨ä¸Šé¢çš„objc_classç»“æ„ä½“ä¸­ï¼Œå¾ˆæ˜æ˜¾å¯ä»¥çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚ ä¸‰ã€ä¹Ÿæ¥èŠèŠisaä¸Šä¸€å¼ å¤§ç¥å›¾ è®°ä½ä¸€ç‚¹ï¼š å¯¹è±¡çš„isaæŒ‡å‘çš„æ˜¯ï¼šç”±è°åˆ›å»ºçš„å½“å‰å¯¹è±¡ã€‚ NSObjectç±»çš„superclass ä¸ºnil NSObjectå…ƒç±»çš„isaæŒ‡å‘çš„æ˜¯å®ƒè‡ªå·± å‚è€ƒæ–‡ç« iosåº•å±‚åŸç†æ¢ç©¶","link":"/2019/10/10/ios%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%EF%BC%9AOC%E5%AF%B9%E8%B1%A1/"},{"title":"xcodeè‡ªåŠ¨æ‰“åŒ…å®è·µ","text":"1ã€é—®é¢˜èƒŒæ™¯å…¬å¸æ˜¯å®¶å°å…¬å¸ï¼Œæ²¡æœ‰æˆç†Ÿçš„æ‰“åŒ…ç³»ç»Ÿï¼Œå¼€å‘å®Œappä¹‹åï¼Œå¾€å¾€éœ€è¦å¼€å‘äººå‘˜ç”¨xcodeæ‰“åŒ…ï¼Œå¯¼å‡ºipaæ–‡ä»¶ï¼Œç„¶åæ‰‹åŠ¨ä¸Šä¼ åˆ°è’²å…¬è‹±ç½‘ç«™ï¼Œç„¶åæŠŠä¸‹è½½äºŒç»´ç å‘é€ç»™æµ‹è¯•/è€æ¿ã€‚è¿™é‡Œé¢æœ‰é—®é¢˜ å ç”¨å¼€å‘äººå‘˜çš„æ—¶é—´å’Œè®¾å¤‡ã€‚ ä¸èƒ½ä¿è¯æ¯å¤©éƒ½æœ‰å¯ç”¨çš„æµ‹è¯•åŒ…ï¼Œä¾èµ–å¼€å‘äººå‘˜æ‰“åŒ…ã€‚ é‡å¤å·¥ä½œ,æ¯å¤©éƒ½è¦åšï¼Œæ•ˆç‡ä½ä¸‹ã€‚ 2 ã€è§£å†³æ–¹æ¡ˆå¯ä»¥åˆ©ç”¨è„šæœ¬å¯¹xcodeè¿›è¡Œæ‰“åŒ…ï¼Œç„¶åå‘å¸ƒä¸Šä¼ åˆ°ç›¸åº”çš„å¹³å°ã€‚ è¿™é‡Œé¢ï¼Œæ ¸å¿ƒçš„åŠŸèƒ½æ˜¯xcodebuildï¼Œåˆ©ç”¨è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥å¯¹å·¥ç¨‹è¿›è¡Œæ‰“åŒ…ï¼Œå¯¼å‡ºã€‚æµç¨‹å›¾å¦‚ä¸‹ 3 ã€è„šæœ¬æ–‡ä»¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119#!/bin/shsource /etc/profile SECONDS=0now=$(date +&quot;%Y%m%d-%H:%M&quot;)setting_path=&quot;/Users/chengyan/Desktop/setting.plist&quot; # é¡¹ç›®åç§°project_name=$(/usr/libexec/PlistBuddy -c &quot;print project_name&quot; ${setting_path})echo $project_name# é¡¹ç›®è·¯å¾„project_path=$(/usr/libexec/PlistBuddy -c &quot;print project_path&quot; ${setting_path})echo $project_pathif [ -d &quot;${project_path}/${project_name}.xcworkspace&quot; ];then # workspace_path=&quot;${project_path}/${project_name}.xcworkspace&quot; workspace_path=&quot;${project_path}/${project_name}.xcworkspace&quot; echo $workspace_pathelse workspace_path=&quot;${project_path}/${project_name}.xcodeproj&quot; echo $workspace_pathfi# schemeåç§°scheme_name=$(/usr/libexec/PlistBuddy -c &quot;print scheme_name&quot; ${setting_path})# é¡¹ç›®ç‰ˆæœ¬version=$(/usr/libexec/PlistBuddy -c &quot;print version&quot; ${setting_path})# å¼€å‘è€…è´¦å·dev_account=$(/usr/libexec/PlistBuddy -c &quot;print dev_account&quot; ${setting_path})# å¼€å‘è€…å¯†ç dev_password=$(/usr/libexec/PlistBuddy -c &quot;print dev_password&quot; ${setting_path})# é…ç½®æ‰“åŒ…æ–¹å¼configration=$(/usr/libexec/PlistBuddy -c &quot;print configration&quot; ${setting_path})# å‘å¸ƒåœ°å€ PGY è’²å…¬è‹± è‹¹æœå•†åº— AppStoreupload_address=$(/usr/libexec/PlistBuddy -c &quot;print upload_address&quot; ${setting_path})# ipaåŒ…åç§°:é¡¹ç›®åç§°+ç‰ˆæœ¬å·+æ‰“åŒ…ç±»å‹ipa_name=$(/usr/libexec/PlistBuddy -c &quot;print ipa_name&quot; ${setting_path})# ipaåŒ…è·¯å¾„ipa_path2=$(/usr/libexec/PlistBuddy -c &quot;print ipa_path&quot; ${setting_path})/${now}ipa_path=&quot;${ipa_path2}-V${version}-${upload_address}&quot;# ç¼–è¯‘buildè·¯å¾„archive_path=&quot;${ipa_path}/${project_name}.xcarchive&quot;echo ${archive_path}# ä¸Šä¼ åˆ°è’²å…¬è‹±è®¾ç½®user_key=$(/usr/libexec/PlistBuddy -c &quot;print user_key&quot; ${setting_path})api_key=$(/usr/libexec/PlistBuddy -c &quot;print api_key&quot; ${setting_path})password=$(/usr/libexec/PlistBuddy -c &quot;print password&quot; ${setting_path})# æ‰“åŒ…æ–¹å¼é…ç½®if [ ${upload_address} == 'AppStore' ]; then configration=&quot;Release&quot; plist_path=${project_path}/exportAppStore.plistelif [ ${upload_address} == 'PGY' ]; then if [ ${configration} == 'Release' ]; then plist_path=&quot;/Users/chengyan/Desktop/exportAdHot.plist&quot; else plist_path=exportDevelopment.plist fifiecho &quot;=======================æ­£åœ¨æ¸…ç†å·¥ç¨‹=================&quot;xcodebuild clean -configuration ${configration} \\-workspace ${workspace_path} \\-scheme ${scheme_name} \\-quiet || exitecho 'æ¸…ç†å®Œæˆ--------ã€‹ã€‹æ­£åœ¨ç¼–è¯‘å·¥ç¨‹:'${configration}#é€šè¿‡wordspaceæ–¹å¼æ‰“åŒ…if [ -d &quot;${project_path}/${project_name}.xcworkspace&quot; ]; then xcodebuild archive -workspace ${workspace_path} -scheme ${scheme_name} \\ -configuration ${configration} \\ -archivePath ${archive_path} -quiet || exitelse xcodebuild archive -project ${project_path} - scheme ${scheme_name}\\ -configuration ${configration} \\ -archivePath ${archive_path} -quiet || exitfi# æ£€æŸ¥ä¸‹æ˜¯å¦æ„å»ºæˆåŠŸif [ -d &quot;$archive_path&quot; ]; then echo '========é¡¹ç›®æ„å»ºæˆåŠŸ========'else echo '========é¡¹ç›®æ„å»ºå¤±è´¥========' exit 1fiecho 'ç¼–è¯‘å®Œæˆ---ã€‹ã€‹---å¼€å§‹ipaæ‰“åŒ…'xcodebuild -exportArchive -archivePath ${archive_path} \\-configuration ${configration} \\-exportPath ${ipa_path} \\-exportOptionsPlist ${plist_path} \\-quiet || exit# æ£€æŸ¥ä¸‹æ˜¯å¦å¯¼å‡ºipaåŒ…æˆåŠŸif [ -e &quot;${ipa_path}/${ipa_name}.ipa&quot; ]; then echo '========ipa æ‰“åŒ…æˆåŠŸ==========' open $ipa_pathelse echo '=========ipa æ‰“åŒ…å¤±è´¥=========' exit 1fiecho '==========å‡†å¤‡å‘å¸ƒipaåŒ…========='if [ ${upload_address} == &quot;AppStore&quot; ]; then echo 'å‡†å¤‡å‘å¸ƒåŒ…åˆ°appstore'else echo 'å‘å¸ƒåŒ…åˆ°è’²å…¬è‹±å¹³å°' curl -F &quot;file=@${ipa_path}/${ipa_name}.ipa&quot; \\ -F &quot;uKey=${user_key}&quot; -F &quot;_api_key=${api_key}&quot; \\ -F &quot;password=${password}&quot; \\ https://www.pgyer.com/apiv1/app/upload if [ $? == 0 ]; then echo '=====æäº¤è’²å…¬è‹±æˆåŠŸ' else echo '=====æäº¤è’²å…¬è‹±å¤±è´¥' fifi# è¾“å‡ºè€—æ—¶echo &quot;æ‰§è¡Œæ—¶é—´:${SECONDS}ç§’&quot;exit 0 4ã€å…·ä½“æµç¨‹4.1ã€ åœ¨è„šæœ¬çš„åŒçº§ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªsetting.jsonï¼ˆåå­—ä¸ä¸€å®šå«è¿™ä¸ªï¼Œå¯ä»¥è‡ªå·±éšä¾¿èµ·ï¼‰æ–‡ä»¶è¿™ä¸ªæ–‡ä»¶ä¸»è¦ç”¨æ¥é…ç½®è„šæœ¬æ‰§è¡Œçš„ç¯å¢ƒã€ä¸Šä¼ çš„å¹³å°ã€æ‰“å®ŒåŒ…å­˜æ”¾ipaåŒ…çš„è·¯å¾„ï¼Œå¦‚æœæ˜¯å¾€appstoreä¸Šä¼ çš„è¯ï¼Œè¿˜éœ€è¦å¼€å‘è€…çš„è´¦å·ï¼Œå¯†ç ç­‰ä¿¡æ¯ã€‚ æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼Œ 1234567891011121314151617181920212223242526272829303132&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;&lt;plist version=&quot;1.0&quot;&gt;&lt;dict&gt; &lt;key&gt;project_name&lt;/key&gt; &lt;string&gt;é¡¹ç›®åç§°&lt;/string&gt; &lt;key&gt;project_path&lt;/key&gt; &lt;string&gt;/Users/chengyan/Desktop/å·¥ç¨‹æ–‡ä»¶ç›®å½•&lt;/string&gt; &lt;key&gt;scheme_name&lt;/key&gt; &lt;string&gt;å·¥ç¨‹&lt;/string&gt; &lt;key&gt;version&lt;/key&gt; &lt;string&gt;1.6.5&lt;/string&gt; &lt;key&gt;upload_address&lt;/key&gt; &lt;string&gt;PGY&lt;/string&gt; &lt;key&gt;configration&lt;/key&gt; &lt;string&gt;Release&lt;/string&gt; &lt;key&gt;ipa_name&lt;/key&gt; &lt;string&gt;ipaåŒ…çš„åç§°&lt;/string&gt; &lt;key&gt;ipa_path&lt;/key&gt; &lt;string&gt;ipaåŒ…å­˜æ”¾çš„åœ°å€&lt;/string&gt; &lt;key&gt;user_key&lt;/key&gt; &lt;string&gt;è’²å…¬è‹±å¹³å°userkey&lt;/string&gt; &lt;key&gt;api_key&lt;/key&gt; &lt;string&gt;è’²å…¬è‹±å¹³å°apikey&lt;/string&gt; &lt;key&gt;dev_account&lt;/key&gt; &lt;string&gt;è‹¹æœè´¦å·&lt;/string&gt; &lt;key&gt;dev_password&lt;/key&gt; &lt;string&gt;è‹¹æœè´¦å·å¯†ç &lt;/string&gt; &lt;key&gt;password&lt;/key&gt; &lt;string&gt;&lt;/string&gt;&lt;/dict&gt;&lt;/plist&gt; 4.2ã€ å¯¼å‡ºipaé…ç½®æ–‡ä»¶xcodebuildå¯¼å‡ºipaåŒ…ï¼Œæ ¸å¿ƒå‘½ä»¤ 12345xcodebuild -exportArchive -archivePath ${archive_path} \\-configuration ${configration} \\-exportPath ${ipa_path} \\-exportOptionsPlist ${plist_path} \\-quiet || exit å¯¼å‡ºipadåŒ…çš„æ—¶å€™ï¼Œéœ€è¦ä¸€ä¸ªExportOption.plistæ–‡ä»¶ï¼Œå¯¹åº”çš„å‚æ•°ä¸ºï¼šexportOptionsPlistï¼Œè¿™ä¸ªæ–‡ä»¶ç”¨æ¥å¯¹å¯¼å‡ºçš„åŒ…è¿›è¡Œç­¾åï¼Œé…ç½®æ˜¯å¦è¦æ”¯æŒbitcodeç­‰ä¿¡æ¯ã€‚ å¦‚ä½•è·å–è¿™ä¸ªæ–‡ä»¶ï¼Ÿç”¨xcodeæ‰“ä¸€æ¬¡åŒ…ï¼Œä¹‹ååœ¨å¯¼å‡ºçš„æ–‡ä»¶å¤¹ä¸‹å°±ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶ã€‚æ–‡ä»¶æˆªå›¾å¦‚ä¸‹ï¼š æœ‰äº†ä¸Šé¢çš„ä¸¤ä¸ªæ–‡ä»¶ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡è¿è¡Œè„šæœ¬è¿›è¡Œæ‰“åŒ…ï¼Œç„¶åæŠŠåŒ…ä¸Šä¼ åˆ°è’²å…¬è‹±/è‹¹æœå•†åº—äº† 5ã€ å®šæ—¶æ‰“åŒ…å®ç°DailyBuildåˆ©ç”¨launchdå‘½ä»¤è¡Œå·¥å…·ï¼Œå®šæ—¶æ‰§è¡Œè„šæœ¬ã€‚ 5.1ã€ åˆ›å»ºä¸€ä¸ªâ€com.runSh.plistâ€jsonæ–‡ä»¶ï¼Œç”¨æ¥é…ç½®å¯åŠ¨ä»»åŠ¡ï¼Œå¤§è‡´å¦‚ä¸‹å›¾ 12345678910111213141516171819202122232425262728293031323334&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;&lt;plist version=&quot;1.0&quot;&gt;&lt;dict&gt; &lt;key&gt;Label&lt;/key&gt; &lt;string&gt;com.suoyi.service&lt;/string&gt; &lt;key&gt;ProgramArguments&lt;/key&gt; &lt;array&gt; &lt;string&gt;/Users/chengyan/Desktop/autoIpa.sh&lt;/string&gt; &lt;/array&gt; &lt;key&gt;StartCalendarInterval&lt;/key&gt; &lt;array&gt; &lt;dict&gt; &lt;key&gt;Hour&lt;/key&gt; &lt;integer&gt;21&lt;/integer&gt; &lt;key&gt;Minute&lt;/key&gt; &lt;integer&gt;15&lt;/integer&gt; &lt;/dict&gt; &lt;dict&gt; &lt;key&gt;Hour&lt;/key&gt; &lt;integer&gt;14&lt;/integer&gt; &lt;key&gt;Minute&lt;/key&gt; &lt;integer&gt;1&lt;/integer&gt; &lt;/dict&gt; &lt;/array&gt; &lt;key&gt;RunAtLoad&lt;/key&gt; &lt;true/&gt; &lt;key&gt;StandardErrorPath&lt;/key&gt; &lt;string&gt;/Users/chengyan/Desktop/TEST.err&lt;/string&gt; &lt;key&gt;StandardOutPath&lt;/key&gt; &lt;string&gt;/Users/chengyan/Desktop/TEST.out&lt;/string&gt;&lt;/dict&gt;&lt;/plist&gt; 5.2ã€launchd å‘½ä»¤,ä¸»è¦ç”¨çš„å°±æ˜¯loadå’Œunloadå‘½ä»¤1234567âœ ~ launchctl list // è·å–æ‰€æœ‰å®šæ—¶ä»»åŠ¡âœ Desktop launchctl load com.suoyi.plist // åŠ è½½ä»»åŠ¡âœ Desktop launchctl list | grep com.suoyi.service // æŸ¥è¯¢å½“å‰ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€53241 0 com.suoyi.serviceâœ Desktop launchctl start com.suoyi.service // å¼€å¯ä»»åŠ¡âœ Desktop launchctl stop com.suoyi.service // åœæ­¢ä»»åŠ¡âœ Desktop launchctl unload com.suoyi.plist // å¸è½½ä»»åŠ¡ 5.3ã€æ³¨æ„äº‹é¡¹ï¼šéœ€è¦å°†è„šæœ¬æ–‡ä»¶çš„æƒé™ä¿®æ”¹ä¸º777ã€‚ä¿®æ”¹å‘½ä»¤å¦‚ä¸‹1chmod 777 yourScrpt.sh 6ã€è¸©è¿‡çš„å‘1å·å‘ï¼š è„šæœ¬æ–‡ä»¶ä¸èƒ½æ”¾åˆ°ä¸­æ–‡æ–‡ä»¶å¤¹ä¸‹æˆ‘ç”¨çš„æ˜¯sublime2ä½œä¸ºè„šæœ¬å¼€å‘å·¥å…·ï¼Œå°†è„šæœ¬æ–‡ä»¶æ”¾åœ¨äº†æˆ‘è‡ªå·±å»ºçš„ä¸€ä¸ªâ€œè„šæœ¬â€æ–‡ä»¶å¤¹ä¸‹ï¼Œç»“æœç¼–è¯‘çš„æ—¶å€™ï¼Œä¸€ç›´æŠ¥é”™ã€‚å°†è„šæœ¬æ”¾åˆ°/Desktopä¹‹åï¼Œæ­¤é—®é¢˜è§£å†³ 2å·å‘ï¼šè·¯å¾„ä¸€å®šè¦ä½¿ç”¨ç»å¯¹è·¯å¾„å¦‚æœæ‰‹åŠ¨æ‰§è¡Œè„šæœ¬çš„è¯ï¼Œä½¿ç”¨ç›¸å¯¹è·¯åŠ²ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯åˆ©ç”¨launchctlçš„æ–¹å¼å¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼Œé‚£ä¹ˆç›¸å¯¹è·¯å¾„æ‰§è¡Œå°±ä¼šæŠ¥è·¯å¾„æ‰¾ä¸åˆ°çš„é”™è¯¯ 3å·å‘ï¼šè„šæœ¬æ–‡ä»¶ä¸èƒ½æ”¾åˆ°â€.xcodeprojâ€ç›®å½•æ›¾ç»è¯¯ä»¥ä¸ºæ˜¯podæ–‡ä»¶å‡ºé”™äº†ï¼ŒæŠŠé”…æ‘”ç»™cocoapodsï¼ˆæ­£å¥½è¿™æ®µæ—¶é—´å‡çº§äº†cocoapod 1.8.1ï¼‰åæ¥å‘ç°æ ¹æœ¬ä¸æ˜¯ï¼Œæ˜¯å› ä¸ºæ”¾åˆ°â€œ.xcodeprojâ€è¿™ä¸ªç›®å½•ä¸‹ï¼Œxcodeæ‰“åŒ…çš„æ—¶å€™ï¼Œä¼šæŠ¥å¥‡å¥‡æ€ªæ€ªçš„é”™è¯¯ã€‚å°†è„šæœ¬æ–‡ä»¶æŒªèµ°ä¹‹åï¼Œé—®é¢˜è§£å†³ 4å·å‘ï¼šä¸ºä»€ä¹ˆä½¿ç”¨launchdè€Œä¸æ˜¯crontabè¿™ä¸¤éƒ½æ˜¯æ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„ï¼Œä¸€å¼€å§‹æˆ‘ä½¿ç”¨çš„æ˜¯crontabï¼Œç”¨è¿™ä¸ªçš„æ—¶å€™ï¼Œæ‰è¿›äº†å‘ä¸­å‘ã€‚ 4.1å·å‘ï¼šcrontabæ‰§è¡Œè„šæœ¬éœ€è¦é…ç½®ç¯å¢ƒå˜é‡12* * * * * /bin/sh test.sh âŒ* * * * * ./etc/profile; /bin/sh test.sh âœ… 4.2å·å‘ï¼šcrontabæ— æ³•å¯¹launched.keychainè§£é” è·å–ä¸åˆ°æ‰“åŒ…è¯ä¹¦ç”±äºè¿™ä¸¤é—®é¢˜ï¼Œæ”¾å¼ƒcrontabï¼Œè€Œä½¿ç”¨launchd 5å·å‘ï¼šshä»£ç ä¸ç†Ÿæ‚‰ï¼Œifåˆ¤æ–­ æ²¡åŠ ç©ºæ ¼ï¼Œç¼©è¿›ç­‰","link":"/2019/09/29/xcode%E8%87%AA%E5%8A%A8%E6%89%93%E5%8C%85%E5%AE%9E%E8%B7%B5/"},{"title":"ã€ŠCoreDataã€‹ç³»åˆ—ï¼ˆä¸€ï¼‰","text":"ã€Šé¢˜å¤–ç¯‡ã€‹ å­¦ä¹ è¿™ä¸ªä¸œè¥¿è´µåœ¨æ—¥ç§¯æœˆç´¯ï¼Œè€Œä¸”äº‹æƒ…å¾€å¾€è¯´èµ·æ¥å®¹æ˜“ï¼Œåšèµ·æ¥éš¾ï¼Œæˆ‘æ˜¯ä¸€ä¸ªèµ„æ·±dotaç©å®¶ï¼Œä»dota1åˆ°dota2ï¼Œä»å¤§å­¦åˆ°å·¥ä½œï¼Œä»2008å¹´åˆ°2015å¹´ã€‚ä¸€ç›´çœ‹2009çš„è§†é¢‘ï¼Œç»å¸¸åæ§½09è§†é¢‘æ›´æ–°é€Ÿåº¦æ…¢ï¼Œä½†æ˜¯ç»†ç»†æƒ³æƒ³ï¼Œ09èƒ½ä¿æŒä¼˜é…·æ›´æ–°401ï¼ˆæœ€è¿‘æŸ¥çœ‹ï¼‰æœŸè§†é¢‘ã€‚åˆæœ‰å¤šå°‘äººèƒ½åšçš„åˆ°ã€‚æ•…è€Œæœ€è¿‘ä¸‹äº†ä¸€ä¸ªå†³å®šï¼Œæ¯å‘¨äº”åŠ¡å¿…æ›´æ–°ä¸€ç¯‡æŠ€æœ¯åšå®¢ï¼Œå°±çœ‹çœ‹è‡ªå·±èƒ½åšæŒå¤šä¹…ã€‚ ã€Šæ­£æ–‡ã€‹1 æ¦‚è¿°æœ¬ç³»åˆ—ç ”ç©¶è®¨è®ºçš„æ˜¯iOSå¼€å‘ä¸­çš„ä¸€ç§æ•°æ®æŒä¹…åŒ–æŠ€æœ¯ï¼coredataã€‚coredataã€sqliteã€fmdbçš„ä¼˜ç¼ºç‚¹ä¸æ˜¯æˆ‘è¦è®¨è®ºçš„é‡ç‚¹ è¿™ä¸ªç³»åˆ—çš„blogä¸»è¦ä¼šç ”ç©¶è®¨è®ºä»¥ä¸‹å‡ ç‚¹ 1.å¿«é€Ÿæ­å»ºcoredataç¯å¢ƒï¼Œä¸»è¦æ˜¯è¿æ¥æ•°æ®åº“ã€åˆ›å»ºæ•°æ®åº“æ‰˜ç®¡å¯¹è±¡æ¨¡å‹ï¼ˆNSManagerObjectï¼‰ã€å¦‚ä½•ä¿å­˜æ•°æ®ã€æŸ¥è¯¢æ•°æ®ï¼Ÿ 2.coredataå‡çº§ä»¥åŠæ•°æ®è¿ç§»çš„ä¸‰ç§æ–¹å¼ã€‚ 3.coredataä¸viewcontrollerçš„ç»“åˆï¼Œé€šè¿‡NSFetchedResultControllerä½¿ç”¨coredataæ•°æ®ã€‚ 4.å¯¼å…¥é»˜è®¤æ•°æ®å’Œå‰åå°contextã€‚ 5.å…³ç³» 2 ç¯å¢ƒæ­å»º 2.1 å¯¼å…¥ã€ŠCoreDataã€‹çš„frameworké»˜è®¤è¯»è€…çŸ¥é“å¦‚ä½•åˆ›å»ºä¸€ä¸ªç©ºç™½çš„é¡¹ç›®ï¼Œå»ºç«‹å¥½ç©ºç™½é¡¹ç›®ä¹‹åï¼Œæœç´¢coredataæŒ‰å›¾2-1æ“ä½œï¼Œç‚¹å‡»æ·»åŠ å®Œæˆframeworkçš„å¼•å…¥ã€‚ 2.2 åˆ›å»ºModelå®Œæˆä¸Šè¿°ç¬¬ä¸€æ­¥ï¼Œæ„å‘³ç€æˆ‘ä»¬å·²ç»å¯ä»¥ä½¿ç”¨CoreDataæä¾›çš„æ¥å£APIäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•ä½¿ç”¨çš„äº‹å„¿äº†ã€‚åˆ›å»ºä¸€ä¸ªCoreDataæ–‡ä»¶å¤¹ï¼Œä¸“é—¨ç”¨æ¥æ”¾CoreDataå¼•æ“ï¼Œåˆ›å»ºå¥½æ–‡ä»¶å¤¹åï¼Œå³é”®ç‚¹å‡»é€‰æ‹©newfileï¼Œç„¶åæŒ‰ç…§å›¾2-2æ‰€ç¤ºåˆ›å»ºæ•°æ®åº“æ¨¡å‹æ–‡ä»¶ï¼Œå¹¶å°†å…¶å‘½åä¸ºModel,ç„¶åç‚¹å‡»Model,æ·»åŠ Entityï¼ˆè¡¨\\Classï¼‰,æ·»åŠ Attributeï¼ˆå­—æ®µ\\å±æ€§ï¼‰ï¼Œåˆ°è¿™ä¸€éƒ¨ï¼ŒåŸºæœ¬ä¸Šå°±æŠŠModelï¼Œåˆ›å»ºå‡ºæ¥äº†ã€‚å¹¶ä¸”é‡Œé¢æœ‰äº†æ•°æ®æ¨¡å‹ç»“æ„ï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œè¿æ¥æ•°æ®åº“ï¼Œæ ¹æ®æ¨¡å‹åˆ›å»ºæ‰˜ç®¡å¯¹è±¡äº† 2.3 ä»£ç è¿æ¥æ•°æ®åº“å¥½å•¦ï¼Œå‰é¢åªæ˜¯å¼€èƒƒèœï¼ŒçœŸæ­£çš„å¤§é¤é©¬ä¸Šå°±è¦æ¥äº†ï¼Œåœ¨åƒå¤§é¤å‰ï¼Œæœ‰ä¸€äº›åç§°éœ€è¦è¯´æ˜ä¸‹ 1.NSManagedObjectContext - æ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡ï¼Œç”¨æ¥å¹²å˜›çš„å‘¢ï¼Ÿæœ›æ–‡ç”Ÿæ„ï¼Œç”¨æ¥ç®¡ç†æ‰˜ç®¡å¯¹è±¡çš„ï¼Œè´Ÿè´£ä»æ•°æ®åº“ä¸­è·å–å¯¹è±¡ã€ä¿å­˜å¯¹è±¡ã€åˆ é™¤å¯¹è±¡ç­‰ç­‰æ“ä½œã€‚2.NSManagedObjectModel - å¯¹è±¡æ¨¡å‹ï¼Œ æ ¹æ®æˆ‘ä»¬ä¸Šé¢åˆ›å»ºçš„æ•°æ®æ¨¡å‹ï¼Œåˆ›å»ºå‡ºæ‰˜ç®¡å¯¹è±¡æ¨¡å‹ï¼Œï¼ˆç±»ä¼¼äºåŠ å·¥å‚çš„æ¦‚å¿µï¼Œèƒ½å¤Ÿç”¨æ¥ç”Ÿäº§å¯¹è±¡çš„æ¨¡å­ï¼‰3.NSPersistentStoreCoordinator - æŒä¹…åŒ–å­˜å‚¨åè°ƒå™¨ï¼ŒåŒ…å«æ•°æ®åº“çš„åç§°ã€å­˜å‚¨æ•°æ®ç±»å‹ï¼ˆSqliteã€Xmlã€å†…å­˜ï¼‰ã€ä½ç½®ç­‰ä¿¡æ¯4.NSPersistentStore - æŒä¹…åŒ–å­˜å‚¨åŒº å¦å¤–å†é™„ä¸€å¼ å›¾æ¥è¯´æ˜è¿™å‡ è€…çš„ä¾èµ–å…³ç³» ç”±äºCoreDataç®¡ç†æ•°æ®çš„è¿‡ç¨‹è¾ƒä¸ºé€šç”¨ï¼Œä¸ªäººè§‰çš„è¿˜æ˜¯å°è£…æˆä¸€ä¸ªç®¡ç†å¯¹è±¡è¾ƒå¥½ï¼Œæ–¹ä¾¿ä»¥åä»£ç å¤ç”¨ï¼Œè¿™é‡Œåˆ›å»ºä¸€ä¸ªCoreDataHelperçš„ç±»ï¼Œä¸“é—¨ç”¨æ¥ç®¡ç†æ•°æ®å¯¹è±¡ï¼Œè¯¥ç±»çš„å¤´æ–‡ä»¶å¦‚ä¸‹ 1234567891011#import &lt;Foundation/Foundation.h&gt; #import &lt;CoreData/CoreData.h&gt; @interface CoreDataHelper : NSObject @property (nonatomic, strong) NSManagedObjectContext *context;//æ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡ @property (nonatomic, strong) NSManagedObjectModel *model;//æ‰˜ç®¡å¯¹è±¡æ¨¡å‹ @property (nonatomic, strong) NSPersistentStoreCoordinator *coordinate;//æŒä¹…åŒ–å­˜å‚¨åè°ƒå™¨ @property (nonatomic, strong) NSPersistentStore *store;//æŒä¹…åŒ–å­˜å‚¨åŒº - (id)init; //åˆå§‹åŒ– - (void)loadStore; //åŠ è½½cordite - (void)setupCoreData; //è®¾ç½®corditeç›¸å…³ä¿¡æ¯ - (void)saveContext; //ä¿å­˜context CoreDataHelpçš„å®ç°æ–‡ä»¶å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124#import &quot;CoreDataHelper.h&quot; static NSString *storeFileName = @&quot;demo.sqlite&quot;; //æµ‹è¯•æ•°æ®åº“ @implementation CoreDataHelper #pragma mark - PATHS - (NSString *)applicationDocumentDirectory { if (debug) { NSLog(@&quot;Running %@ '%@'&quot;,[self class],NSStringFromSelector(_cmd)); } NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES); return [paths lastObject]; } - (NSURL *)applicationStoreDirectory { if (debug) { NSLog(@&quot;Running %@ '%@'&quot;,[self class],NSStringFromSelector(_cmd)); } NSURL *url = [[NSURL fileURLWithPath:[self applicationDocumentDirectory]] URLByAppendingPathComponent:@&quot;stores&quot;]; if (![[NSFileManager defaultManager]fileExistsAtPath:[url path]]) { NSError *error = nil; BOOL success = [[NSFileManager defaultManager]createDirectoryAtURL:url withIntermediateDirectories:YES attributes:nil error:&amp;error]; if (success) { if (debug) { NSLog(@&quot;success create directory!&quot;); } }else{ NSLog(@&quot;failed create directory!&quot;); } } return url; } - (NSURL *)storeUrl { NSURL *storeUrl = [[self applicationStoreDirectory]URLByAppendingPathComponent:storeFileName]; NSLog(@&quot;storeurl = %@&quot;,storeUrl); return storeUrl; } #pragma mark - SETUP - (id)init { if (self) { _model = [NSManagedObjectModel mergedModelFromBundles:nil]; _coordinate = [[NSPersistentStoreCoordinator alloc]initWithManagedObjectModel:_model]; _context = [[NSManagedObjectContext alloc]initWithConcurrencyType:NSMainQueueConcurrencyType]; [_context setMergePolicy:NSMergeByPropertyObjectTrumpMergePolicy]; [_context setPersistentStoreCoordinator:_coordinate]; _importContext = [[NSManagedObjectContext alloc]initWithConcurrencyType:NSPrivateQueueConcurrencyType]; [_importContext performBlock:^{ [_importContext setPersistentStoreCoordinator:_coordinate]; [_importContext setMergePolicy:NSMergeByPropertyObjectTrumpMergePolicy]; [_importContext setUndoManager:nil]; }]; } return self; } - (void)loadStore { if (debug) { NSLog(@&quot;Running %@ ,'%@'&quot;,[self class], NSStringFromSelector(_cmd)); } if (_store) { return; } NSError *error; //NSMigratePersistentStoresAutomaticallyOption coreDataå°è¯•å°†ä½ç‰ˆæœ¬çš„æ•°æ®æ¨¡å‹å‘é«˜ç‰ˆæœ¬è¿›è¡Œè¿ç§» //NSInferMappingModelAutomaticallyOption coredataä¼šè‡ªåŠ¨åˆ›å»ºè¿ç§»æ¨¡å‹ï¼Œä¼šå»è‡ªåŠ¨å°è¯• NSDictionary *option = @{NSMigratePersistentStoresAutomaticallyOption:@(YES), NSInferMappingModelAutomaticallyOption:@(YES), NSSQLitePragmasOption:@{@&quot;journal_mode&quot;:@&quot;DELETE&quot;}}; _store = [_coordinate addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:[self storeUrl] options:option error:&amp;error]; if (!_store) { if (debug) { NSLog(@&quot;failed load store,error = %@&quot;,error); abort(); } } else/**/{ NSLog(@&quot;successfully add store : %@&quot;,_store); } } - (void)setupCoreData { [self loadStore]; } - (void)saveContext { if ([_context hasChanges]) { NSError *error = nil; if ([_context save:&amp;error]) { NSLog(@&quot;context save successfully&quot;); }else{ NSLog(@&quot;failed save %@&quot;,error); } }else{ NSLog(@&quot;skipped context save , there is no changes&quot;); } } @end 2.4 æœ€åé™„ä¸ŠæŸ¥è¯¢å’Œä¿å­˜æ•°æ®åº“çš„ä»£ç åœ¨AppDelegate.mæ–‡ä»¶é‡Œå†™ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥åˆå§‹åŒ–CoreDataæ•°æ®åº“ 123456789101112- (CoreDataHelper *)cdh { if (!_cdh) { static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^{ _cdh = [CoreDataHelper new]; }); [_cdh setupCoreData]; } return _cdh; } ä¸‹é¢æ˜¯æ’å…¥æ•°æ®ï¼ŒæŸ¥è¯¢ã€ä¿å­˜æ•°æ®çš„æ–¹æ³• 12345678910111213141516171819- (void)demo { Item *bananer = [NSEntityDescription insertNewObjectForEntityForName:@&quot;Item&quot; inManagedObjectContext:[[self cdh] context]]; bananer.unit = kg; bananer.name = @&quot;bananer&quot;; Item *oranger = [NSEntityDescription insertNewObjectForEntityForName:@&quot;Item&quot; inManagedObjectContext:[[self cdh] context]]; oranger.unit = kg; oranger.name = @&quot;Oranger&quot;; NSFetchRequest *request = [NSFetchRequest fetchRequestWithEntityName:@&quot;Item&quot;]; NSArray *result = [[[self cdh]context] executeFetchRequest:request error:nil]; for (Item *item in result) { if (debug) { NSLog(@&quot;item.name = %@&quot;,item.name); } } [[self cdh]saveContext]; } 2.5 å°ç»“ç»è¿‡è¿™ä¹ˆä¸€ç•ªä¸‹æ¥ï¼Œç»ˆäºå°†CoreDataæŠ€æœ¯åº”ç”¨åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­äº†ï¼Œæˆ‘ä»¬ç°åœ¨èƒ½åšåˆ°ï¼ŒæŠŠæ•°æ®æ’å…¥åˆ°æ•°æ®åº“ã€ä¹Ÿèƒ½ä»æ•°æ®åº“ä¸­è¯»å–å‡ºæ•°æ®æ¥ï¼Œä¹Ÿèƒ½ä¿å­˜æ•°æ®ã€‚ä½†æ˜¯è¦æ³¨æ„è¿™æ‰æ˜¯åˆšåˆšå¼€å§‹ï¼Œæ¥ä¸‹æ¥è¿˜æœ‰æ›´å¤šçš„coredataé—®é¢˜ç­‰ç€æˆ‘ä»¬ï¼Œæ¯”æ–¹è¯´ä¸‹èŠ‚è¦ä»‹ç»çš„æ•°æ®è¿ç§»é—®é¢˜ã€‚","link":"/2016/08/27/%E3%80%8ACoreData%E3%80%8B%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89/"},{"title":"ã€ŠCoreDataã€‹ç³»åˆ—ï¼ˆäºŒï¼‰","text":"CoreDataæ•°æ®è¿ç§»ä»¥åŠç‰ˆæœ¬å‡çº§ 1 æ¦‚è¿° ä¸ºä»€ä¹ˆè¦æœ‰æ•°æ®è¿ç§»ï¼Ÿç”±äºCoreDataå¯è§†åŒ–çš„ç‰¹æ®Šæ€§ï¼Œé‚£ä¹ˆå½“æ•°æ®æ¨¡å‹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç›¸åº”çš„sqliteæ•°æ®åº“çš„è¡¨ç”±äºä¸çŸ¥é“modelå‘ç”Ÿäº†å˜åŒ–ï¼Œè¡¨ç»“æ„å¿…é¡»ç›¸åº”çš„åšå‡ºè°ƒæ•´ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¨‹åºCrashï¼ŒCoreDataçš„è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡åˆ›å»ºæ–°çš„sqliteè¡¨ï¼Œç„¶åå°†æ—§çš„æ•°æ®è¿ç§»åˆ°æ–°è¡¨ä¸Šå¾—æ–¹æ¡ˆæ¥å¤„ç†ã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‰ç§æ•°æ®è¿ç§»çš„æ–¹å¼ï¼Œå¹¶è¯¦ç»†è¯´æ˜ä¸‰ç§è¿ç§»æ–¹å¼çš„åº”ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚ 1.è½»é‡çº§çš„æ•°æ®è¿ç§»æ–¹å¼2.é»˜è®¤çš„è¿ç§»æ–¹å¼3.ä½¿ç”¨è¿ç§»ç®¡ç†å™¨ 1.1 è½»é‡çº§çš„æ•°æ®è¿ç§»æ–¹å¼ è½»é‡çº§çš„æ•°æ®è¿ç§»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸éœ€è¦ç¨‹åºå‘˜åšå¾ˆå¤šäº‹æƒ…å°±å¯ä»¥å®Œæˆæ•°æ®çš„è¿ç§»ï¼Œæ˜¯ç”±ç³»ç»Ÿé»˜è®¤è¿›è¡Œçš„æ•°æ®è¿ç§»ã€‚é‚£ä¹ˆå¦‚ä½•è¿›è¡Œè½»é‡çº§çš„æ•°æ®è¿ç§»å‘¢ï¼Œå½“modelçš„è¡¨å­—æ®µå‘ç”Ÿå˜åŒ–ï¼Œä¸”åº”ç”¨ç¨‹åºå·²ç»å‘å¸ƒè¿‡ç‰ˆæœ¬æ—¶ï¼Œæ­¤æ—¶åƒä¸‡ä¸èƒ½å•å•ä¿®æ”¹åŸmodelæ¥è¾¾åˆ°ä¿®æ”¹modelçš„ç›®çš„ï¼Œå¦‚æœè¿™æ ·åšçš„è¯ï¼Œç¨‹åºä¼šcrashã€‚æ­£ç¡®çš„åšæ³•æ˜¯ï¼Œ 1.æ–°å»ºä¸€ä¸ªmodelï¼Œå¹¶å°†modelå‘½åä¸ºmodel2ï¼Œå¹¶å°†model2è®¾ç½®ä¸ºå½“å‰modelã€‚2.ä¿®æ”¹NSPersistentStoreCoordinatoråŠ è½½ç¼“å­˜åŒºçš„é…ç½®ã€‚å…·ä½“å¦‚ä¸‹ 123456789NSDictionary *option = @{NSMigratePersistentStoresAutomaticallyOption:@(YES), NSInferMappingModelAutomaticallyOption:@(YES), }; _store = [_coordinate addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:[self storeUrl] options:option error:&amp;error]; tipsï¼šä½¿ç”¨iCloudå¼€å‘ç¨‹åºçš„appï¼Œåªèƒ½ä½¿ç”¨è¿™ç§è¿ç§»æ–¹å¼ã€‚ 1.2 é»˜è®¤çš„è¿ç§»æ–¹å¼ æ­£å¸¸æƒ…å†µä¸‹ï¼Œä½¿ç”¨è½»é‡çº§çš„æ•°æ®è¿ç§»å·²ç»è¶³å¤Ÿäº†ï¼Œä½†æ˜¯å¦‚æœç”±äºå¼€å‘éœ€è¦ï¼Œéœ€è¦å°†æŸä¸ªEntityä¸‹é¢çš„æŸä¸ªAttributeè¿ç§»åˆ°æ–°çš„Entityä¸‹çš„æŸä¸ªAttributeï¼Œé‚£ä¹ˆè½»é‡çº§çš„è¿ç§»æ–¹å¼å°±ä¸èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨é»˜è®¤çš„è¿ç§»æ–¹å¼æ¥è¿›è¡Œæ•°æ®è¿ç§»ã€‚è¿™é‡Œä»¥ä¸€ä¸ªä¾‹å­ä»£ç æ¥è¯¦ç»†é˜è¿°å¦‚ä½•è¿›è¡Œé»˜è®¤çš„è¿ç§» ç°åœ¨è¦å°†Model2é‡Œé¢çš„Measurementä¸‹é¢çš„nameè¿ç§»åˆ°Accounté‡Œé¢çš„ä¸‹é¢çš„xyzå±æ€§ä¸‹ã€‚1.æ ¹æ®model2æ¥åˆ›å»ºä¸€ä¸ªæ–°modelï¼Œå¹¶å‘½åä¸ºmodel3ï¼Œç„¶åå°†model3è®¾ç½®ä¸ºcurrentmodelã€‚2.æ·»åŠ æ–°çš„entityï¼Œå¹¶å‘½åä¸ºAccountï¼Œæ·»åŠ attribute xyzã€‚3.åˆ é™¤model2é‡Œé¢çš„Measurementï¼Œæ ¹æ®model3åˆ›å»ºNSManagerObectçš„å­ç±»Accountã€‚4.ä»¥model2ä¸ºsoureModelï¼Œmodel3ä¸ºdestinationModelæ·»åŠ ä¸€ä¸ªMappingModel5.æŒ‰ç…§ä¸‹å›¾æ‰€ç¤ºè®¾ç½®æ˜ å°„modelå³å¯6.æœ€åè®°å¾—å°†NSInferMappingModelAutomaticallyOptionè®¾ç½®ä¸ºYesï¼ˆcoredataä¼šä¼˜å…ˆè¯»å–æ˜ å°„modelï¼Œå¦‚æœæ²¡æœ‰å°±ä¼šè‡ªå·±æ¨æ–­ï¼‰ï¼Œè‡³æ­¤ï¼Œé»˜è®¤çš„è¿ç§»æ–¹å¼å°±ç®—æ˜¯æå®šäº†ã€‚ 1.3 è¿ç§»ç®¡ç†å™¨ ç®€å•æ¦‚è¿°ä¸‹ä½•ä¸ºè¿ç§»ç®¡ç†å™¨ï¼Œè¿ç§»ç®¡ç†å™¨ï¼Œå°±æ˜¯ä¸å†ä½¿ç”¨ç³»ç»Ÿçš„NSPersistentCoordinatorè¿›è¡Œæ•°æ®è¿ç§»ï¼Œè€Œæ˜¯ä½¿ç”¨NSMigrationManagerè¿›è¡Œæ•°æ®ç¼“å­˜åŒºçš„è¿ç§»ã€‚å¹¶é…åˆä¸€ä¸ªæ•°æ®è¿ç§»è§†å›¾æ§åˆ¶å™¨æä¾›ä¼˜é›…çš„è¿ç§»ç­‰å¾…ç•Œé¢ã€‚ç­‰å¾…ç•Œé¢å¦‚ä¸‹ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆä¸‘å‘¢ï¼Œå“ˆå“ˆã€‚é‚£ä¹ˆä½¿ç”¨è¿ç§»ç®¡ç†å™¨çš„å¥½å¤„åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¯ä»¥å®ç°æ›´åŠ ç²¾ç»†åŒ–çš„æ•°æ®æ“ä½œï¼Œæ­¤å¤–è¿˜èƒ½å‘ç”¨æˆ·æŠ¥å‘Šè¿ç§»è¿›åº¦ã€‚æœ‰è¿™ä¿©ç‚¹ï¼Œè¿˜ä¸å¤Ÿæˆ‘ä»¬å»ç ”ç©¶ä¸‹å®ƒä¹ˆ?Letâ€™s go! å‡†å¤‡å·¥ä½œ ä½•æ—¶å¯ç”¨è¿ç§»ç®¡ç†å™¨ï¼Œå³è¿ç§»çš„æ—¶æœºï¼Ÿ è¿ç§»å·¥ä½œå¦‚ä½•è¿›è¡Œï¼Ÿ è¿ç§»å®Œæˆå¦‚ä½•å–„åï¼Ÿ ä¸‹é¢å¯¹ä¸Šé¢çš„é—®é¢˜ä¸€ä¸€æ¥åšè§£ç­”è¿ç§»çš„æ—¶æœºï¼Œè¿ç§»å·¥ä½œéœ€è¦åœ¨è½½å…¥æ•°æ®åº“çš„æ—¶å€™è¿›è¡Œï¼Œå³ä¸ŠèŠ‚æ‰€è®²çš„ loadStoreï¼šçš„æ—¶å€™è¿›è¡Œï¼Œä½†æ˜¯å‘¢ï¼Ÿè¿˜éœ€è¦åšä¸€äº›åˆ¤æ–­å·¥ä½œã€‚å…·ä½“ä»£ç å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839- (void)loadStore { if (debug) { NSLog(@&quot;Running %@ ,'%@'&quot;,[self class], NSStringFromSelector(_cmd)); } if (_store) { return; } BOOL useMigrateManager = MigrationMode; if (useMigrateManager &amp;&amp; [self isMigrationNecessaryForStore:[self storeUrl]]) { [self performBackgroundManagedMigrationForStore:[self storeUrl]]; }else{ NSError *error; //NSMigratePersistentStoresAutomaticallyOption coreDataå°è¯•å°†ä½ç‰ˆæœ¬çš„æ•°æ®æ¨¡å‹å‘é«˜ç‰ˆæœ¬è¿›è¡Œè¿ç§» //NSInferMappingModelAutomaticallyOption coredataä¼šè‡ªåŠ¨åˆ›å»ºè¿ç§»æ¨¡å‹ï¼Œä¼šå»è‡ªåŠ¨å°è¯• NSDictionary *option = @{NSMigratePersistentStoresAutomaticallyOption:@(YES), NSInferMappingModelAutomaticallyOption:@(YES), NSSQLitePragmasOption:@{@&quot;journal_mode&quot;:@&quot;DELETE&quot;}}; _store = [_coordinate addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:[self storeUrl] options:option error:&amp;error]; if (!_store) { if (debug) { NSLog(@&quot;failed load store,error = %@&quot;,error); abort(); } } else/**/{ NSLog(@&quot;successfully add store : %@&quot;,_store); } } } å…¶ä¸­æœ‰å¼€å…³ï¼Œç”¨æ¥æ§åˆ¶æ˜¯å¦ä½¿ç”¨è¿ç§»ç®¡ç†å™¨ï¼Œä»¥åŠç³»ç»Ÿæ˜¯å¦éœ€è¦è¿›è¡Œè¿ç§»çš„åˆ¤æ–­ã€‚ç³»ç»Ÿæ˜¯å¦éœ€è¦è¿ç§»çš„åˆ¤æ–­ä»£ç å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031- (BOOL)isMigrationNecessaryForStore:(NSURL *)storeUrl { if (debug) { NSLog(@&quot;Running %@ '%@'&quot;,[self class],NSStringFromSelector(_cmd)); } //æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨è®¤ä¸ºæ˜¯ç”¨æˆ·è®¾å¤‡ä¸Šå¹¶æ²¡æœ‰æŒä¹…åŒ–å­˜å‚¨åŒºï¼Œè‡ªç„¶ä¸éœ€è¦è¿ç§» if (![[NSFileManager defaultManager]fileExistsAtPath:[self storeUrl].path isDirectory:nil]) { if (debug) { NSLog(@&quot;Skipped Migration, source database missing&quot;); } return NO; } NSError *error = nil; NSDictionary *sourceMetaData = [NSPersistentStoreCoordinator metadataForPersistentStoreOfType:NSSQLiteStoreType URL:storeUrl error:&amp;error]; NSManagedObjectModel *destinationModel = _coordinate.managedObjectModel; //æ¯”è¾ƒå½“å‰å¯¹è±¡æ¨¡å‹æ˜¯å¦ä¸ç”¨æˆ·ä¹‹å‰å®‰è£…çš„åº”ç”¨æŒä¹…åŒ–å­˜å‚¨åŒºæ˜¯å¦å…¼å®¹ã€‚å¦‚æœå…¼å®¹ï¼Œä¸éœ€è¦è¿ç§» if ([destinationModel isConfiguration:nil compatibleWithStoreMetadata:sourceMetaData]) { if (debug) { NSLog(@&quot;Skipped Migration, source database is already compatible&quot;); return NO; } } //æ‰€æœ‰æƒ…å†µéƒ½å°è¯•äº†ï¼Œå‘ç°è¿˜æ˜¯éœ€è¦è¿›è¡Œæ•°æ®è¿ç§» return YES; } è¿ç§»å·¥ä½œå¦‚ä½•è¿›è¡Œï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œè¿ç§»å·¥ä½œæ˜¯ä¸€é¡¹æ¯”è¾ƒè€—æ—¶é—´çš„å·¥ä½œï¼Œå°¤å…¶æ˜¯åœ¨æ•°æ®åº“æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆè‚¯å®šä¸èƒ½æ”¾åœ¨å‰å°è¿›è¡Œ,å¿…é¡»æ”¾åœ¨åå°è¿›è¡Œï¼Œå‰å°å±•ç¤ºåŠ è½½è¿›åº¦ï¼Œä»£ç å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152- (void)performBackgroundManagedMigrationForStore:(NSURL *)store { if (debug) { NSLog(@&quot;Running %@ '%@'&quot;,[self class],NSStringFromSelector(_cmd)); } UIStoryboard *sb = [UIStoryboard storyboardWithName:@&quot;Main&quot; bundle:nil]; self.migrationVC = [sb instantiateViewControllerWithIdentifier:@&quot;migration&quot;]; UIApplication *app = [UIApplication sharedApplication]; UINavigationController *navigationCtl = (UINavigationController *)[app keyWindow].rootViewController; [navigationCtl presentViewController:self.migrationVC animated:YES completion:nil]; dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, 0), ^{ BOOL done = [self migrateStore:[self storeUrl]]; if (done) { dispatch_async(dispatch_get_main_queue(), ^{ NSError *error = nil; NSDictionary *configuration = @{NSMigratePersistentStoresAutomaticallyOption:@(YES), NSInferMappingModelAutomaticallyOption:@(YES), NSSQLitePragmasOption:@{@&quot;journal_mode&quot;:@&quot;DELETE&quot;}}; _store = [_coordinate addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:[self storeUrl] options:configuration error:&amp;error]; if (_store) { if (debug) { NSLog(@&quot;success create store&quot;); } }else { if (debug) { NSLog(@&quot;failed, error = %@&quot;,error); } abort(); } [self.migrationVC dismissViewControllerAnimated:YES completion:nil]; self.migrationVC = nil; }); } }); } æ¥ä¸‹æ¥æ˜¯ï¼ŒçœŸæ­£çš„è¿ç§»è¿‡ç¨‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859- (BOOL)migrateStore:(NSURL *)store { if (debug) { NSLog(@&quot;Running %@ '%@'&quot;,[self class],NSStringFromSelector(_cmd)); } NSDictionary *sourceMeta = [NSPersistentStoreCoordinator metadataForPersistentStoreOfType:NSSQLiteStoreType URL:store error:nil]; NSManagedObjectModel *sourceModel = [NSManagedObjectModel mergedModelFromBundles:nil forStoreMetadata:sourceMeta]; NSManagedObjectModel *destinationModel = _model; NSMappingModel *mappingModel = [NSMappingModel mappingModelFromBundles:nil forSourceModel:sourceModel destinationModel:destinationModel]; if (mappingModel) { NSError *error = nil; NSMigrationManager *migrationManager = [[NSMigrationManager alloc]initWithSourceModel:sourceModel destinationModel:destinationModel]; [migrationManager addObserver:self forKeyPath:@&quot;migrationProgress&quot; options:NSKeyValueObservingOptionNew context:nil]; NSURL *destinationStore = [[self applicationStoreDirectory]URLByAppendingPathComponent:@&quot;temp.sqlite&quot;]; BOOL success = NO; success = [migrationManager migrateStoreFromURL:store type:NSSQLiteStoreType options:nil withMappingModel:mappingModel toDestinationURL:destinationStore destinationType:NSSQLiteStoreType destinationOptions:nil error:&amp;error]; if (success) { if (debug) { NSLog(@&quot;Migration Successfully!&quot;); } if ([self replaceStore:store withStore:destinationStore]) { [migrationManager removeObserver:self forKeyPath:@&quot;migrationProgress&quot; context:NULL]; [[NSNotificationCenter defaultCenter]postNotificationName:someThingChangedNotification object:nil]; } }else{ if (debug) { NSLog(@&quot;Migration Failed&quot;); } } }else{ if (debug) { NSLog(@&quot;Mapping model is NULL&quot;); } } return YES; } æœ€åé™„ä¸Šä¿©ä¸ªè¾…åŠ©æ–¹æ³•ï¼Œç”¨æ¥è§‚å¯Ÿè¿ç§»è¿‡ç¨‹å’Œæ›¿æ¢æ•°æ®åº“çš„ 1234567891011121314151617181920- (BOOL)replaceStore:(NSURL *)old withStore:(NSURL *)new { BOOL success = NO; NSError *error = nil; if ([[NSFileManager defaultManager]removeItemAtURL:old error:&amp;error]) { error = nil; if ([[NSFileManager defaultManager]moveItemAtURL:new toURL:old error:&amp;error]) { success = YES; }else { if (debug) { NSLog(@&quot;failed move new store to old&quot;); } } }else{ if (debug) { NSLog(@&quot;failed remove old store&quot;); } } return success; } 12345678910111213- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(voidvoid *)context { if ([keyPath isEqualToString:@&quot;migrationProgress&quot;]) { dispatch_async(dispatch_get_main_queue(), ^{ float progress = [[change objectForKey:NSKeyValueChangeNewKey]floatValue]; self.migrationVC.progressView.progress = progress; int percenttage = progress * 100; NSString *string = [NSString stringWithFormat:@&quot;Migration Progress %i%%&quot;,percenttage]; self.migrationVC.progressLabel.text = string; }); } } è‡³æ­¤ï¼Œä¸‰ç§æ•°æ®è¿ç§»çš„æ–¹å¼ï¼Œéƒ½å·²å™è¿°å®Œæ¯•ã€‚[2 å°ç»“]ï¼ˆ#1ï¼‰ä¸‰ç§è¿ç§»æ–¹å¼ï¼Œå„æœ‰å„çš„å¥½å¤„ï¼Œè½»é‡çº§çš„è¿ç§»å¯ä»¥é…å¥—icloudå®ç°äº‘ç«¯å­˜å‚¨ï¼Œé»˜è®¤çš„æ•°æ®è¿ç§»ï¼Œæ”¯æŒå°†å±æ€§çº§åˆ«çš„æ•°æ®è¿›è¡Œä»»æ„è¿ç§»ã€‚è¿ç§»ç®¡ç†å™¨ï¼Œå¯ä»¥ç®¡ç†æ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼Œå¹¶èƒ½å¤ŸæŠ¥å‘Šè¿ç§»è¿›åº¦ï¼Œæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåº”è¯¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚åˆç†é€‰æ‹©è¿ç§»æ–¹å¼ï¼Œä¸‹ä¸€å°èŠ‚ç»“åˆNSFetchedResultControllerè¿›è¡Œæ•°æ®çš„å®é™…åº”ç”¨ã€‚","link":"/2016/08/27/%E3%80%8ACoreData%E3%80%8B%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89/"},{"title":"ä½¿ç”¨é’‰é’‰æœºå™¨äººå°†ç¦…é“ä»»åŠ¡ï¼Œè‡ªåŠ¨å‘é€åˆ°é’‰é’‰ç¾¤ç»„","text":"ä¸€ã€ä¸ºä»€ä¹ˆè¦å¼€å‘è¿™æ ·ä¸€ä¸ªåŠŸèƒ½ï¼Ÿ ç¦…é“ï¼Œæ˜¯å…¬å¸ç”¨æ¥å¯¹é¡¹ç›®è¿›è¡Œç®¡ç†çš„è½¯ä»¶ï¼Œä¸»è¦æ˜¯ç”¨æ¥å¯¹é¡¹ç›®ä»»åŠ¡ã€äº§å“bugè¿›è¡Œè¿½è¸ªå’Œç®¡ç†.é’‰é’‰ï¼Œæ˜¯å…¬å¸æ‰€æœ‰å‘˜å·¥ç”¨æ¥å·¥ä½œæ²Ÿé€šçš„è½¯ä»¶ å°†ç¦…é“ä¸Šé¢ï¼Œæ¯ä¸ªå‘˜å·¥å·¥ä½œä»»åŠ¡çš„æƒ…å†µï¼Œè¿›è¡Œæ±‡æ€»å¹¶åŒæ­¥åˆ°é’‰é’‰ç¾¤ï¼Œæœ‰åŠ©äºé¡¹ç›®äººå‘˜åŠç®¡ç†äººå‘˜å¯¹é¡¹ç›®æ‰§è¡Œæƒ…å†µå¿«é€ŸåŠæ—¶çš„æŒæ¡ ä¸‹å›¾æ˜¯æœ€ç»ˆå®ç°çš„æ•ˆæœå›¾ï¼Œé’‰é’‰æœºå™¨äººå°†é¡¹ç›®ç»„æˆå‘˜ï¼Œä¸€å‘¨ä»»åŠ¡å®Œæˆæƒ…å†µï¼Œè¿›è¡Œæ±‡æ€»ã€‚æœªå®Œæˆçš„ä»»åŠ¡ç‚¹å‡»é“¾æ¥å¯ä¼ é€åˆ°ç¦…é“å¯¹åº”çš„ä»»åŠ¡é¡µé¢ï¼Œè¿›è¡Œå¿«é€Ÿå¤„ç† äºŒã€å®ç°åŸç† é’‰é’‰çš„webhookæœºåˆ¶ ç¦…é“çš„äºŒæ¬¡å¼€å‘API pythonè„šæœ¬ crontabå®šæ—¶å™¨ é’‰é’‰çš„webhookæœºåˆ¶é’‰é’‰çš„webhookï¼Œæ˜¯å¯ä»¥é€šè¿‡å‘ä¸€ä¸ªurlåœ°å€ï¼Œå‘é€æ¶ˆæ¯ï¼Œç„¶åé’‰é’‰è§£æä¹‹åï¼Œä¼šæ ¹æ®æ¶ˆæ¯ç±»å‹å±•ç¤ºä¸åŒçš„æ ·å¼å¡ç‰‡ï¼Œè€Œè¿™ä¸ªurlï¼Œå°±æ˜¯é€šå¸¸æˆ‘ä»¬è¯´çš„webhookï¼Œç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯â€œç½‘ç»œé’©å­çš„æ„æ€â€ æ·»åŠ ä¸€ä¸ªé’‰é’‰ç¾¤ç»„æœºå™¨äººï¼Œå¤§æ¦‚éœ€è¦ä»¥ä¸‹å››æ­¥ç¬¬ä¸€æ­¥ï¼š ç¾¤ç»„ä¸­è¿›å…¥ç¾¤è®¾ç½® ç¬¬äºŒæ­¥ï¼šç‚¹å‡»æ™ºèƒ½åŠ©æ‰‹ï¼Œè¿›å…¥æœºå™¨äººè®¾ç½®é¡µ ç¬¬ä¸‰æ­¥ï¼šå‹¾é€‰è‡ªå®šä¹‰æœºå™¨äººï¼Œå¹¶è¿›å…¥æœºå™¨äººè®¾ç½®é¡µ ç¬¬å››æ­¥:æœºå™¨äººæ·»åŠ è®¾ç½®é¡µ ç¦…é“çš„äºŒçº§å¼€å‘apiæƒ³è¦å®ç°æˆ‘ä»¬çš„æ•ˆæœï¼Œéœ€è¦æ‹¿åˆ°æ¯ä¸ªå‘˜å·¥çš„ä»»åŠ¡åˆ—è¡¨ï¼Œè€Œæ‹¿åˆ°ä»»åŠ¡åˆ—è¡¨ï¼Œéœ€è¦è·å–æ¯ä¸ªå‘˜å·¥çš„ç¼–å·ï¼Œç¦…é“é‡Œé¢æ˜¯ç”¨æˆ·åã€‚é€šè¿‡ç”¨æˆ·åè·å–è¯¥ç”¨æˆ·çš„æ‰€æœ‰ä»»åŠ¡åˆ—è¡¨ã€‚ é¦–å…ˆé‡åˆ°çš„é—®é¢˜æ˜¯ï¼Œç™»å½•é—®é¢˜ç¦…é“æ˜¯éœ€è¦è¿›è¡Œç™»å½•çš„ï¼Œç™»å½•æ˜¯è¦å»ºç«‹ä¼šè¯çš„ï¼Œè¿™é‡Œä½¿ç”¨çš„sessionè¿›è¡Œä¼šè¯ç®¡ç†,ä½†æ˜¯å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç™»å½•ç”¨æˆ·éƒ½å¯ä»¥éšæ„è·å–åˆ«äººçš„ä»»åŠ¡çŠ¶æ€ï¼Œè¿™é‡Œæ¶‰åŠåˆ°å¦å¤–ä¸€ä¸ªé—®é¢˜æƒé™é—®é¢˜æƒé™æ‰¾ç”°æ–°äº®ï¼Œå°†è´¦æˆ·æå‡ä¸ºâ€œadminå¼€å‘è€…â€ã€‚ è‡³æ­¤ç¦…é“apiçš„å¤§ä½“æµç¨‹å°±å‡ºæ¥äº†ï¼ è·å–ç¦…é“sid æ‹¿åˆ°sidä¸adminå¼€å‘è€…æƒé™çš„è´¦å·è¿›è¡Œç™»å½• è·å–éœ€è¦æ±‡æŠ¥ä»»åŠ¡çš„æˆå‘˜username æ ¹æ®usernameå»è·å–ä»»åŠ¡çŠ¶æ€ï¼Œä»»åŠ¡çŠ¶æ€åˆ†ä¸ºï¼šæœªå¼€å§‹ã€è¿›è¡Œä¸­ã€å·²å®Œæˆ pythonè„špythonè„šæœ¬ä¸»è¦æ˜¯å®ç°ï¼Œä¸Šè¿°æ‰€è¯´çš„ç¦…é“è·å–ä»»åŠ¡åˆ—è¡¨ï¼Œä»¥åŠå°†æ¶ˆæ¯å‘é€åˆ°webhookçš„é’‰é’‰æœºå™¨äººï¼Œä»£ç æ¯”è¾ƒå¤šï¼Œè¿™é‡Œè´´ä¸€éƒ¨åˆ†æ ¸å¿ƒä»£ç ï¼Œä¸»è¦æ˜¯ç¦…é“çš„ç™»å½•ä¸ä»»åŠ¡åˆ—è¡¨çš„è·å–ç¦…é“ç™»å½•ä¸ä»»åŠ¡åˆ—è¡¨è·å–æ ¸å¿ƒä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051class Zentao_cli(object): session = None # ç”¨äºå®ç°å•ä¾‹ç±»ï¼Œé¿å…å¤šæ¬¡ç”³è¯·sessionID sid = None def __init__(self, url, account, password, override=False): self.url = url self.account = account # è´¦å· self.password = password # å¯†ç  self.session_override = override # æ˜¯å¦è¦†ç›–åŸä¼šè¯ self.pages = { &quot;sid&quot;: &quot;/api-getsessionid.json&quot;, # è·å–sidçš„æ¥å£ &quot;login&quot;: &quot;/user-login.json?account={0}&amp;password={1}&amp;zentaosid={2}&quot;, # ç™»å½•çš„æ¥å£ &quot;get_story_list_by_projectID&quot;: &quot;/index.php?t=json&amp;m=story&amp;f=ajaxGetProjectStories&amp;projectID={0}&quot;, &quot;get_task_list_by_account&quot;: &quot;/task-ajaxGetUserTasks-{0}-1-{1}.json&quot;, # &quot;get_task_list_by_account&quot;: &quot;/user-view-chengyan.json&quot;, &quot;get_story_list_by_account&quot;: &quot;/index.php?&quot; } self.s = None self.sid = None def req(self, url): # è¯·æ±‚å¹¶è¿”å›ç»“æœ print(url) web = self.s.get(url) print(web.content) if web.status_code == 200: resp = json.loads(web.content) if resp.get(&quot;status&quot;) == &quot;success&quot;: return True, resp else: return False, resp def login(self): if self.s is None: if not self.session_override and Zentao_cli.session is not None: self.s = Zentao_cli.session self.sid = Zentao_cli.sid else: # æ–°å»ºä¼šè¯ self.s = requests.session() res, resp = self.req(self.url.rstrip(&quot;/&quot;) + self.pages[&quot;sid&quot;]) if res: print(&quot;è·å–sessionIDæˆåŠŸ&quot;) self.sid = json.loads(resp[&quot;data&quot;])[&quot;sessionID&quot;] Zentao_cli.sid = self.sid login_res, login_resp = self.req( self.url.rstrip(&quot;/&quot;) + self.pages[&quot;login&quot;].format(self.account, self.password, self.sid)) if login_res: print(&quot;ç™»å½•æˆåŠŸ&quot;) Zentao_cli.session = self.s crontabå®šæ—¶å™¨ä½œä¸ºä¸€ä¸ªæœºå™¨äººï¼Œè‚¯å®šæ˜¯éœ€è¦è‡ªå·±å»åšä¸€äº›äº‹æƒ…ï¼Œæˆ‘ä»¬è„šæœ¬å¼€å‘å®Œæˆä¹‹åï¼Œè‚¯å®šä¸èƒ½å†å»æµªè´¹æ—¶é—´å»æ‰‹åŠ¨æ“ä½œäº†ï¼Œé‚£ä¹ˆåœ¨macosæˆ–linuxç³»ç»Ÿé‡Œé¢ï¼Œéœ€è¦ç”¨åˆ°crontab å®šæ—¶å»æ‰§è¡Œæˆ‘ä»¬çš„è„šæœ¬ï¼Œæˆ‘è¿™é‡Œè®¾ç½®çš„æ—¶é—´æ˜¯æ¯å‘¨å…­çš„ä¸‹åˆ5.30åˆ†ï¼Œå»å®šæ—¶è·‘ä¸€ä¸‹è„šæœ¬ï¼Œç„¶åå°±ä¼šå‘æ¶ˆæ¯åˆ°é’‰é’‰ç¾¤äº†crontabçš„å†™æ³•æ¯”è¾ƒç®€å•ï¼Œä¸‹é¢æ˜¯æˆ‘è¿™æ¬¡ç”¨åˆ°çš„å†™æ³• 130 17 * * 6 /Users/chengyan/Desktop/quanqiuwa/zandaoPlugin/main.py&gt;&gt;/Users/chengyan/Desktop/quanqiuwa/zanDaoPlugin/zandaoPlugin.log 2&gt;&amp;1 ä¸‰ã€åç»­è®¡åˆ’ä¸æ”¹è¿› @æœªå®Œæˆä»»åŠ¡å°ä¼™ä¼´ç¾¤ç»„æ¶ˆæ¯å¤ªå¤šï¼Œå¯èƒ½ä¼šæœ‰å°ä¼™ä¼´å°†ç¾¤è®¾ç½®ä¸ºå‹¿æ‰°æ¨¡å¼ï¼Œé‚£ä¹ˆé’ˆå¯¹æ²¡æœ‰å®Œæˆä»»åŠ¡çš„å°ä¼™ä¼´ï¼Œå½“ç„¶å¾ˆå¤šæ—¶å€™ï¼Œå¹¶ä¸æ˜¯çœŸçš„æ²¡æœ‰å®Œæˆä»»åŠ¡ï¼Œè€Œæ˜¯å¿˜äº†ä¿®æ”¹ç¦…é“ä»»åŠ¡çš„çŠ¶æ€ï¼Œè€ƒè™‘æ·»åŠ ä¸€ä¸ªåŠŸèƒ½æ˜¯ï¼šæœ‰æœªå®Œæˆä»»åŠ¡çš„å°ä¼™ä¼´ï¼Œä¼šå»ä¸»åŠ¨çš„@ä¸€ä¸‹ ç¦…é“bugæœªè§£å†³æƒ…å†µæ±‡æ€»ç¦…é“è¿˜æ”¯æŒï¼Œè·å–æœªå®Œæˆbugçš„åˆ—è¡¨æ‹‰å»ï¼Œè¿™ä¸ªç›®å‰ä¸æ˜¯å¾ˆç´§æ€¥ï¼Œç­‰é¡¹ç›®ä¸å¿™çš„æ—¶å€™ï¼Œå¯ä»¥æèµ·æ¥ å››ã€å°ç»“åšè¿™ä¸ªåŠŸèƒ½çš„å‡ºå‘ç‚¹æ˜¯åˆ©ç”¨è‡ªå·±æ‰€æŒæ¡çš„çŸ¥è¯†åšä¸€äº›æ•ˆèƒ½æé«˜æ–¹é¢çš„äº‹æƒ…ï¼Œæ€»çš„æ¥è¯´è¿˜æ˜¯å¸Œæœ›åœ¨äººå·¥æ™ºèƒ½æ—¶ä»£ï¼Œå°†ä¸€äº›éäººå·¥çš„äº‹æƒ…ï¼Œè®©æœºå™¨å»åšï¼ŒèŠ‚çœäººåŠ›æˆæœ¬ï¼Œåç»­å¦‚æœæœ‰å¸Œæœ›å¸®åŠ©çš„å°ä¼™ä¼´ï¼Œå¯ä»¥éšæ—¶é’‰é’‰è”ç³»æˆ‘ï¼Œä¸€èµ·ä¸ºå…¬å¸çš„å‘å±•ã€å£®å¤§æ·»ç –åŠ ç“¦ã€‚","link":"/2020/12/15/%E4%BD%BF%E7%94%A8%E9%92%89%E9%92%89%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%B0%86%E7%A6%85%E9%81%93%E4%BB%BB%E5%8A%A1%EF%BC%8C%E8%87%AA%E5%8A%A8%E5%8F%91%E9%80%81%E5%88%B0%E9%92%89%E9%92%89%E7%BE%A4%E7%BB%84/"},{"title":"ä¿®æ”¹Macç³»ç»Ÿçš„å‘½ä»¤è¡Œé»˜è®¤å¯åŠ¨ä¸ºPython3","text":"é—®é¢˜macç³»ç»Ÿçš„é»˜è®¤pythonç¯å¢ƒä¸º2.7.10ï¼Œå½“å‰pythonçš„ä¸»æµåº“éƒ½å‡çº§åˆ°3.7ç‰ˆæœ¬äº†ã€‚å› æ­¤éœ€è¦å¯¹pythonè¿›è¡Œå‡çº§.å‡çº§æ–¹æ³•è¿™é‡Œä¸åœ¨ä»‹ç»ï¼Œå‚è€ƒè¿™é‡Œï¼Œ å½“å°†æœ¬æœºçš„pythonå‡çº§åˆ°3.7ä¹‹åï¼Œåœ¨macè‡ªå¸¦ç»ˆç«¯ï¼Œè¾“å…¥python -Vä¹‹åä¼šå‘ç°ç‰ˆæœ¬ä»ç„¶æ˜¯ä¹‹å‰çš„2.7.10 è§£å†³åŠæ³• æ‰“å¼€å‘½ä»¤è¡Œï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ 1âœ ~ open ~/.bash_profile åœ¨è¯¥æ–‡ä»¶çš„æœ€ä¸‹é¢ï¼Œæ·»åŠ å¦‚ä¸‹å‘½ä»¤ 12export PATH=${PATH}:/Library/Frameworks/Python.framework/Versions/3.7/binalias python=&quot;/Library/Frameworks/Python.framework/Versions/3.7/bin/python3.7&quot; æœ€åæ‰§è¡Œ 123âœ ~ source ~/.bash_profileâœ ~ python -VPython 3.7.4 ä½†æ˜¯è¿™ä¹ˆè§£å†³è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“é‡å¯å‘½ä»¤è¡Œä¹‹åï¼Œåˆä¼šå˜ä¸º2.7.10ç‰ˆæœ¬ã€‚æ¥ä¸‹æ¥éœ€è¦ç»§ç»­æ‰§è¡Œ 1open /etc/bashrc åœ¨è¯¥æ–‡ä»¶çš„æœ€åé¢æ·»åŠ å¦‚ä¸‹å‘½ä»¤source ~/.bash_profile 123456789101112# System-wide .bashrc file for interactive bash(1) shells.if [ -z &quot;$PS1&quot; ]; then returnfiPS1='\\h:\\W \\u\\$ '# Make bash check its window size after a process completesshopt -s checkwinsize[ -r &quot;/etc/bashrc_$TERM_PROGRAM&quot; ] &amp;&amp; . &quot;/etc/bashrc_$TERM_PROGRAM&quot;source ~/.bash_profile å¤§éƒ¨åˆ†æ—¶å€™ï¼Œé—®é¢˜åˆ°è¿™å°±è§£å†³äº†ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨äº†iTerm2,é‚£ä¹ˆè¿˜éœ€è¦æ‰“å¼€ 1open /etc/zshrc åœ¨è¯¥æ–‡ä»¶çš„æœ€åé¢æ·»åŠ source ~/.bash_profile 123456789# Correctly display UTF-8 with combining characters.if [ &quot;$TERM_PROGRAM&quot; = &quot;Apple_Terminal&quot; ]; then setopt combiningcharsfidisable log[ -r &quot;/etc/zshrc_$TERM_PROGRAM&quot; ] &amp;&amp; . &quot;/etc/zshrc_$TERM_PROGRAM&quot;source ~/.bash_profile é—®é¢˜è§£å†³!","link":"/2019/10/30/%E4%BF%AE%E6%94%B9Mac%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%BB%98%E8%AE%A4%E5%90%AF%E5%8A%A8%E4%B8%BAPython3/"},{"title":"å…³äºRuntimeçš„ä¸€äº›ç†è®ºå’Œå®è·µ","text":"å‰è¨€ç½‘ä¸Šè®²è§£Runtimeçš„æ•™ç¨‹éå¸¸ä¹‹å¤šï¼Œæœ‰äº›è®²çš„è¿˜ç®—ä¸é”™ï¼Œæœ‰äº›æ„Ÿè§‰å°±æ˜¯äººäº‘äº¦äº‘ï¼Œæ‰€ä»¥è¯»è€…å°±åº”è¯¥å¥½å¥½ç”„åˆ«ä¸‹å­¦ä¹ çš„èµ„æ–™ã€‚æˆ‘åœ¨æœ¬æ–‡çš„æœ€åï¼Œä¼šåˆ—å‡ºä¸€äº›æˆ‘è®¤ä¸ºè®²çš„ä¸é”™çš„å‚è€ƒèµ„æ–™ï¼Œä»¥ä¾›å‚è€ƒã€‚æ¥ä¸‹æ¥å°±è¿›å…¥æ­£æ–‡ æ­£æ–‡ç†è®ºéƒ¨åˆ†åŸºç¡€ä¸­çš„åŸºç¡€â€‹ å‡è®¾çœ‹å®˜æœ‰ä¸€å®šçš„æ•°æ®ç»“æ„çŸ¥è¯†ï¼ŒçŸ¥é“ä»€ä¹ˆå«ç»“æ„ä½“ï¼Œå› ä¸ºæ¥ä¸‹æ¥æˆ‘è¦è®²è¿°çš„è¿™ä¸ªä¸œè¥¿å°±æ˜¯ä»ç»“æ„ä½“å¼€å§‹çš„ã€‚å¦‚æœæœ‰ä¸æ‡‚çš„åŒå­¦è¯·èµ°è¿™é‡Œä¼ é€é—¨ â€‹ iOSä¸­Classçš„å®šä¹‰å¦‚ä¸‹ 1234567891011121314151617181920struct objc_class {//class çš„ç»“æ„ä½“ Class isa OBJC_ISA_AVAILABILITY;//classçš„isaæŒ‡å‘çš„æ˜¯å…ƒç±»ï¼Œå…ƒç±»çš„isaæŒ‡å‘çš„æ˜¯æ ¹å…ƒç±»ã€‚#if !__OBJC2__ Class super_class OBJC2_UNAVAILABLE;//çˆ¶ç±»æŒ‡é’ˆ const char *name OBJC2_UNAVAILABLE;//ç±»åç§° long version OBJC2_UNAVAILABLE;//ç±»ç‰ˆæœ¬ long info OBJC2_UNAVAILABLE;//ä¿¡æ¯ long instance_size OBJC2_UNAVAILABLE;//å®ä¾‹çš„å¤§å° struct objc_ivar_list *ivars OBJC2_UNAVAILABLE;//æˆå‘˜å˜é‡åˆ—è¡¨ struct objc_method_list **methodLists OBJC2_UNAVAILABLE;//æ–¹æ³•åˆ—è¡¨ struct objc_cache *cache OBJC2_UNAVAILABLE;//ç¼“å­˜æ–¹æ³• struct objc_protocol_list *protocols OBJC2_UNAVAILABLE;//åè®®åˆ—è¡¨#endif} OBJC2_UNAVAILABLE;typedef struct objc_class *Class;//æ­¤å¤„å®šä¹‰äº†ç»“æ„ä½“æŒ‡é’ˆClasstypedef struct objc_object { Class isa;} *id; //æ­¤å¤„å®šä¹‰äº†ç»“æ„ä½“æŒ‡é’ˆidï¼Œidå†…éƒ¨æœ‰ä¸€ä¸ªisa ClassæŒ‡é’ˆï¼ŒæŒ‡å‘å®ƒçš„ç±»ã€‚ â€‹ isaæŒ‡é’ˆæ˜¯å®ä¾‹æ–¹æ³•åœ¨è¿è¡Œæ—¶èƒ½å¤Ÿè¢«æ‰§è¡Œçš„å…³é”®ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿå°†ä¾é isaæŒ‡é’ˆæ‰¾åˆ°å®ä¾‹æ‰€åœ¨çš„ç±»ï¼Œè¿›è€Œæ‰¾åˆ°æ–¹æ³•åˆ—è¡¨å’Œç¼“å­˜æ–¹æ³•ï¼Œè¿›è¡Œæ¶ˆæ¯çš„å‘é€ã€‚å¦‚æœæ¶ˆæ¯å¾—ä¸åˆ°æ‰§è¡Œï¼Œå°†æ ¹æ®ç±»é‡Œé¢çš„super_classsæŒ‡é’ˆæ‰¾çˆ¶ç±»çš„å®ä¾‹æ–¹æ³•ã€‚ä½†æ˜¯å¦‚æœæ˜¯ç±»æ–¹æ³•æˆ–è€…è¯´æ˜¯+å·æ–¹æ³•è¿›è¡Œæ¶ˆæ¯å‘é€ï¼Œé‚£ä¹ˆå°†ä¼šè·å–ç±»é‡Œé¢çš„isaæŒ‡é’ˆè¿›è€Œæ‰¾åˆ°å…ƒç±»ï¼Œè·å–å…ƒç±»é‡Œé¢çš„æ–¹æ³•åˆ—è¡¨æˆ–ç¼“å­˜æ–¹æ³•è¿›è¡Œæ¶ˆæ¯å¤„ç†ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œé‚£ä¹ˆå°†å»å¯»æ‰¾å…ƒç±»é‡Œé¢çš„super_classæŒ‡é’ˆæ‰¾çˆ¶å…ƒç±»çš„ç±»æ–¹æ³•ã€‚ â€‹ ä¸‹é¢æ˜¯å“¥ä»¬ä»ç½‘ä¸Šæ‰¾çš„ä¸€å¼ isa å’Œsuper_classæŒ‡é’ˆçš„æŒ‡å‘å›¾ åŸºç¡€â€‹ æœ‰äº†åŸºç¡€ä¸­çš„åŸºç¡€ä¹‹åï¼Œæˆ‘ä»¬æ‰çŸ¥é“Objective-Cçš„æœ¬æºå…¶å®ä¹Ÿæ˜¯æ¥è‡ªäºCè¯­è¨€ï¼Œæ¥è‡ªäºç»“æ„ä½“ã€‚é‚£ä¹ˆæœ‰äº†è¿™äº›ä¹‹åï¼Œæ€ä¹ˆè®©OCçš„ç±»å’Œå¯¹è±¡åœ¨æˆ‘ä»¬çš„ç¨‹åºå†…éƒ¨è¿ä½œèµ·æ¥ï¼Œæ¥ä¸‹æ¥ï¼Œæœ‰ä¸ªæ–°çš„ä¸œè¥¿è¦ç™»åœºäº†ï¼Œé‚£å°±æ˜¯objc_msgSendï¼Œè¯·è®°ä½å®ƒï¼Œæ­£æ˜¯æœ‰äº†å®ƒobjective-cæ‰çœŸæ­£ç§°å¾—ä¸Šæ˜¯ä¸€é—¨é¢å‘è¿è¡Œæ—¶çš„è¯­è¨€ã€‚ â€‹ objc_msgSendå®è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªCå‡½æ•°ã€‚å…¶æ¬¡objc_msgSendçš„å‚æ•°ç±»å‹ç¬¬ä¸€ä¸ªå¿…é¡»æ˜¯idï¼Œç¬¬äºŒä¸ªæ˜¯SELï¼Œç¬¬ä¸‰ä¸ªæ˜¯va_listå‚æ•°åˆ—è¡¨ã€‚ä»cocoaçš„objc.hæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒçš„å®šä¹‰ã€‚ 1id objc_msgSend(id self, SEL op, ...)//è¿è¡Œæ—¶æ¶ˆæ¯å‘é€çš„å‡½æ•° â€‹ å½“ä½ ä»¥ä¸ºè¿™å°±æ˜¯è¿è¡Œæ—¶å‘é€æ¶ˆæ¯çš„å…¨éƒ¨æ—¶ï¼Œå¾ˆä¸å¹¸çš„å‘Šè¯‰ä½ ï¼Œè¿œè¿œæ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œobjc_msgSendè¿˜æœ‰ä¸€å¤§å¸®å…„å¼Ÿå§å¦¹ï¼Œå®ƒä»¬å¦‚ä¸‹ 12345id objc_msgSendSuper(struct objc_super *super, SEL op, ...)//super æŒ‡é’ˆè°ƒç”¨æ–¹æ³•çš„å‘é€çš„æ¶ˆæ¯void objc_msgSend_stret(id self, SEL op, ...)//å½“è¿”å›å€¼æ˜¯ç»“æ„ä½“æ—¶ï¼Œå‘é€æ­¤æ¶ˆæ¯void objc_msgSendSuper_stret(struct objc_super *super, SEL op, ...)//superæŒ‡é’ˆè°ƒç”¨ï¼Œè¿”å›å€¼æ˜¯ç»“æ„ä½“æ—¶ï¼Œå‘é€æ­¤æ¶ˆæ¯double objc_msgSend_fpret(id self, SEL op, ...)//è¿”å›å€¼ä¸ºfloatç±»å‹ï¼Œå‘é€æ­¤æ¶ˆæ¯(i386)long double objc_msgSend_fpret(id self, SEL op, ...)//è¿”å›å€¼ä¸ºä¸ºfloatç±»å‹ï¼Œå‘é€æ­¤æ¶ˆæ¯(x86_64) â€‹ å…¶å®ï¼Œè¿™äº›å¹¶ä¸é‡è¦ï¼Œåªè¦æŒæ¡objc_msgSendè¿™ä¸ªå°±å¯ä»¥äº†ï¼Œä¸Šé¢çš„è¿™äº›å…„å¼Ÿå§å¦¹åªéœ€è¦äº†è§£ä¸‹å°±è¡Œã€‚ æ¶ˆæ¯å‘é€â€‹ å½“[obj message]è°ƒç”¨æ—¶ï¼Œå°†ä¼šè¢«è½¬åŒ–ä¸º((void (*)(id,@sel(message))objc_msgSend)(id,@sel(message))ã€‚æ­¤æ¶ˆæ¯å°†èµ°å¦‚ä¸‹å‡ ä¸ªæµç¨‹ æ£€æŸ¥æ¥æ”¶çš„å¯¹è±¡æ˜¯å¦ä¸ºnilï¼Œå¦‚æœæ˜¯ï¼Œè°ƒç”¨nilå¤„ç†æ–¹æ¡ˆ åœ¨objc_objectç»“æ„ä½“ä¸­å«æœ‰cacheï¼Œé¦–å…ˆä¼šåœ¨Classçš„cacheä¸­æŸ¥æ‰¾IMP(å¦‚æœæ²¡æœ‰ç¼“å­˜åˆ™ä¼šåˆå§‹åŒ–ç¼“å­˜)ï¼Œå¦‚æœæ‰¾åˆ°å°±ä¼šè·³è½¬åˆ°å¯¹åº”çš„å‡½æ•°ä¸Šæ‰§è¡Œã€‚ å¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±åƒçˆ¶ç±»çš„ClassæŸ¥æ‰¾ï¼Œå¦‚æœè¿˜æ²¡æœ‰æ²¡æ‰¾åˆ°å°±ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°æ ¹ç±»ã€‚ å¦‚æœæ‰¾åˆ°æ ¹ç±»è¿˜æ˜¯æ²¡æœ‰å®ç°æ–¹æ¡ˆï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨_objc_msgForwardå‡½æ•°æŒ‡é’ˆæ›¿ä»£impï¼Œæœ€åæ¥æ‰§è¡Œè¿™ä¸ªimpï¼ˆåŠ¨æ€æ–¹æ³•å®ç°ï¼‰ã€‚ æ¶ˆæ¯è½¬å‘1234+ (BOOL)resolveInstanceMethod:(SEL)aSEL //åŠ¨æ€è§£ææ–¹æ³•ï¼Œç»™å¤„ç†ä¸äº†çš„selåŠ¨æ€åŠ IMPå®ç°- (id)forwardingTargetForSelector:(SEL)aSelector//æ²¡æœ‰æ–¹æ³•ï¼Ÿé‚£å°±çœ‹çœ‹è°èƒ½å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œè®©è°å»æ‰§è¡Œä¸‹- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector//è¿˜æ˜¯æ²¡è°èƒ½æ‰§è¡Œï¼Ÿé‚£å°±ç»™è¿™ä¸ªæ–¹æ³•é‡æ–°ç­¾å- (void)forwardInvocation:(NSInvocation *)anInvocation//é‡æ–°ç­¾åçš„æ–¹æ³•ï¼Œå¯ä»¥è¯•ç€è®©è½¬å‘ä¸‹ â€‹ ç†è®ºéƒ¨åˆ†åˆ°æ­¤å‘Šä¸€æ®µè½ï¼Œæ¥ä¸‹é‡Œç”¨å®è·µçš„æ–¹å¼ï¼Œæ¥æ·±å…¥çš„ç†è§£ä¸‹è¿™å¥—ä¸œè¥¿ å®è·µéƒ¨åˆ†è§£å½’æ¡£å¯¹è±¡æˆ‘ä»¬çŸ¥é“ocçš„å¯¹è±¡å¦‚æœç¡®è®¤äº†NSCodingåè®®çš„è¯ï¼Œå¯ä»¥å°†å¯¹è±¡å½’æ¡£ä¸ºNSDataï¼Œè¿›è€Œå­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿ä¸‹æ¬¡ä½¿ç”¨ï¼Œé€šå¸¸çš„åšæ³•æ˜¯å°†ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ä¸€ä¸ªä¸€ä¸ªçš„æŒ‰ç…§ç±»å‹è¿›è¡Œencodeï¼Œå¦‚intå‹çš„å˜é‡ï¼Œé‡‡ç”¨encodeInt:forKey,bool å‹çš„å˜é‡ï¼Œé‡‡ç”¨encodeBool:forKeyã€‚æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•ä¸ç®¡æ˜¯ä»»ä½•å¯¹è±¡éƒ½å¯ä»¥è¿›è¡Œå½’æ¡£ã€‚è€Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»è¾¨åˆ«å¯¹è±¡ç±»å‹ï¼Œè¿›è€Œè°ƒç”¨ç›¸åº”çš„å½’æ¡£æ–¹æ³•å‘¢ï¼Œruntimeçš„å­˜åœ¨å¯¹è§£å†³è¿™ç±»é—®é¢˜æä¾›äº†å¯èƒ½ã€‚ä¸‹é¢ä»¥å½’æ¡£ä¸€ä¸ªCYArchieveå¯¹è±¡ä¸ºä¾‹ï¼Œè¿›è¡Œé˜é‡Šã€‚ é¦–å…ˆç¬¬ä¸€æ­¥ï¼Œè·å–å½“å‰å¯¹è±¡çš„æˆå‘˜å˜é‡ä¸ªæ•°ã€‚ 12unsigned int count;Ivar *ivar = class_copyIvarList([self class], &amp;count); æ­¤å¤„è°ƒç”¨äº†ä¸€ä¸ªclass_copyIvarList()æ–¹æ³•ï¼ŒæŸ¥è¯¢runtimeï¼ŒçŸ¥é“è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å¦‚ä¸‹ 123// æ ¹æ®å·²çŸ¥çš„ç±»ï¼Œè·å–å®ƒçš„å˜é‡åˆ—è¡¨ï¼Œoutcountæ˜¯è¿™ä¸ªå˜é‡åˆ—è¡¨çš„é•¿åº¦ã€‚å¦‚æœä¸€ä¸ªç±»æ˜¯nilæˆ–è€…æ²¡æœ‰å˜é‡åˆ—è¡¨ï¼Œé‚£ä¹ˆå°†è¿”å›NULLï¼Œä¸”outCountå°†ä¸º0.æ³¨æ„è¯¥å¯¹è±¡ä½¿ç”¨å®Œä¹‹åï¼Œè®°å¾—å¿…é¡»è¦free()!!!OBJC_EXPORT Ivar *class_copyIvarList(Class cls, unsigned int *outCount) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0); è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¹‹åï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥è·å–åˆ°å½“å‰ç±»çš„æ‰€æœ‰å˜é‡ï¼Œå’Œå˜é‡ä¸ªæ•° ç¬¬äºŒæ­¥ï¼Œè§£æIvarï¼Œè·å–å˜é‡åç§° è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªIvarï¼Œè¿™æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼ŸæŸ¥çœ‹å…¶å®šä¹‰çŸ¥é“ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸é€æ˜çš„ç»“æ„ä½“æŒ‡é’ˆï¼Œå°è£…äº†å˜é‡ç±»å‹ã€‚Ã¸ 123456789101112/// An opaque type that represents an instance variable.typedef struct objc_ivar *Ivar;struct objc_ivar { char *ivar_name //å˜é‡åå­— OBJC2_UNAVAILABLE; char *ivar_type //å˜é‡ç±»å‹ OBJC2_UNAVAILABLE; int ivar_offset //å˜é‡åœ¨å¯¹è±¡ä¸­çš„åç§»é‡ OBJC2_UNAVAILABLE;#ifdef __LP64__ int space OBJC2_UNAVAILABLE;#endif} å®ƒæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå†æ¥æŸ¥æ‰¾èµ„æ–™ï¼Œè‹¹æœruntimeç°åœ¨å·²ç»å¼€æºï¼Œå¤§å¯å»å…¶æºç ä¸­æ‰¾ç­”æ¡ˆã€‚ ç¿»ç¿»ç¿»ï¼Œç¿»åˆ°runtimeçš„å®šä¹‰ä¸­ï¼Œæ‰¾åˆ°äº†å®ƒçš„ç”¨é€”ã€‚Ivaræœ‰å¾ˆå¤šç”¨é€”ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åˆ°çš„æœ‰ä¸‹é¢ä¿©ä¸ª 123456// æ ¹æ®è·å–åˆ°çš„Ivarç»“æ„ä½“ï¼Œè·å–å®ƒçš„åå­—OBJC_EXPORT const char *ivar_getName(Ivar v) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0);// æ ¹æ®è·å–åˆ°çš„Ivarç»“æ„ä½“ï¼Œè·å–å®ƒçš„ç±»å‹OBJC_EXPORT const char *ivar_getTypeEncoding(Ivar v) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0); è¿™ä¿©ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ‹¿åˆ°å½“å‰å˜é‡çš„åç§°å’Œå˜é‡çš„ç±»å‹ã€‚åç§°ï¼Œæˆ‘ä»¬çŸ¥é“æ˜¯å˜é‡çš„åç§°ã€‚å¦‚_name _titleï¼Œä¹‹ç±»çš„ï¼Œå¯æ˜¯ç±»å‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿˜æ˜¯å¾—é æŸ¥è‹¹æœèµ„æ–™ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†å®˜æ–¹å®šä¹‰ä¸‹å›¾æ˜¯éƒ¨åˆ†å®šä¹‰ ç¬¬ä¸‰æ­¥ï¼Œè¿›è¡Œå½’æ¡£ ç°åœ¨æœ‰äº†å˜é‡åç§°å’Œå˜é‡ç±»å‹ï¼Œæˆ‘ä»¬åŸºæœ¬å°±å¯ä»¥å¯¹å¯¹è±¡çš„å˜é‡è¿›è¡Œå½’æ¡£äº†ã€‚ å¤´æ–‡ä»¶å¦‚ä¸‹å®šä¹‰ 1234567@interface CYArchieve : NSObject@property (nonatomic, copy) NSString *userName;@property (nonatomic, assign) const void * token;@property (nonatomic, assign) int length;@property (nonatomic, strong) NSNumber *age;@property (nonatomic, assign) float height;@end å¯¹æ­¤å¯¹è±¡è¿›è¡Œå½’æ¡£ å…·ä½“ä»£ç å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354- (void)encodeWithCoder:(NSCoder *)aCoder{ unsigned int count; Ivar *ivar = class_copyIvarList([self class], &amp;count); for (unsigned int i = 0; i &lt; count; i++) { Ivar iva = ivar[i]; // æˆå‘˜å˜é‡å const void* name = ivar_getName(iva); NSString *ivarName = [NSString stringWithUTF8String:name]; ivarName = [ivarName substringFromIndex:1]; // è·å–getæ–¹æ³• SEL getter = NSSelectorFromString(ivarName); // èƒ½å“åº”getteræ–¹æ³• if ([self respondsToSelector:getter]) { const void *typeEncoding = ivar_getTypeEncoding(iva);//è·å–å˜é‡ç±»å‹ NSString *type = [NSString stringWithUTF8String:typeEncoding];//å°†cå­—ç¬¦ä¸²è½¬å˜ä¸ºocå­—ç¬¦ä¸² NSLog(@&quot;type = %@&quot;,type); // const void * if ([type isEqualToString:@&quot;r^v&quot;]) { const void * valueUTF8 = ((const void *(*)(id ,SEL))(void *)objc_msgSend)((id)self,getter); NSString *value = [NSString stringWithUTF8String:valueUTF8]; [aCoder encodeObject:value forKey:ivarName]; continue; } else if ([type isEqualToString:@&quot;f&quot;]){ float fvalue = ((float(*)(id,SEL))(void *)objc_msgSend)((id)self, getter); [aCoder encodeObject:@(fvalue) forKey:ivarName]; continue; } else if ([type isEqualToString:@&quot;i&quot;]){ int ivalue = ((int (*)(id, SEL))(void *)objc_msgSend)((id)self,getter); [aCoder encodeObject:@(ivalue) forKey:ivarName]; continue; } id obj = ((id(*)(id, SEL))(void *)objc_msgSend)((id)self,getter);//å¦‚æœæ˜¯OCç±»å‹çš„å¯¹è±¡ï¼Œè¿™ä¹ˆè·å– if (obj &amp;&amp; [obj respondsToSelector:@selector(encodeWithCoder:)]) {//åˆ¤æ–­æ˜¯å¦æœ‰è¿”å›å€¼ [aCoder encodeObject:obj forKey:ivarName];//ä¹‹åè¿›è¡Œç¼–ç  } /*//////////////////////////////////////////////////////////////////////////*/ /* å°†(void*)æŒ‡é’ˆå¼ºåˆ¶è½¬ä¸ºè¿”å›å€¼ä¸ºfloatç±»å‹ï¼Œå‚æ•°ä¸ºidï¼Œselçš„å‡½æ•°æŒ‡é’ˆã€‚ ((float(*)(id,SEL))(void *)objc_msgSend)((id)self, getter); */ /*//////////////////////////////////////////////////////////////////////////*/ } } free(ivar);} è§£æ¡£å’Œå½’æ¡£ç±»ä¼¼ï¼Œä»£ç å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162- (id)initWithCoder:(NSCoder *)aDecoder{ self = [super init]; if (self) { unsigned int count; Ivar *ivars = class_copyIvarList([self class], &amp;count); for (unsigned int i = 0; i &lt; count; i++) { Ivar ivar = ivars[i]; const void * ivarName = ivar_getName(ivar); NSString *ivarString = [NSString stringWithUTF8String:ivarName]; ivarString = [ivarString substringFromIndex:1]; NSString *setter = ivarString; if (![setter hasPrefix:@&quot;_&quot;]) { char firstLatter = [setter characterAtIndex:0]; NSString *firstLetterString = [NSString stringWithFormat:@&quot;%c&quot;,firstLatter]; setter = [setter substringFromIndex:1]; setter = [NSString stringWithFormat:@&quot;%@%@&quot;,[firstLetterString uppercaseString] ,setter]; } setter = [NSString stringWithFormat:@&quot;set%@:&quot;,setter]; SEL Sel = NSSelectorFromString(setter); if ([self respondsToSelector:Sel]) { const void *typeUTF8 = ivar_getTypeEncoding(ivar); NSString *type = [NSString stringWithUTF8String:typeUTF8]; if ([type isEqualToString:@&quot;r^v&quot;]) { NSString *value = [aDecoder decodeObjectForKey:ivarString]; if (value) { ((void (*)(id,SEL,const void *))(void *)objc_msgSend)((id)self,Sel,value.UTF8String); } continue; } else if ([type isEqualToString:@&quot;i&quot;]){ NSNumber *number = [aDecoder decodeObjectForKey:ivarString]; int num = [number intValue]; ((void(*)(id ,SEL,int))(void *)objc_msgSend)((id)self,Sel,num); continue; } else if ([type isEqualToString:@&quot;f&quot;]){ NSNumber *number = [aDecoder decodeObjectForKey:ivarString]; float flo = [number floatValue]; ((void(*)(id ,SEL,float))(void *)objc_msgSend)((id)self,Sel,flo); continue; } id obj = [aDecoder decodeObjectForKey:ivarString]; if (obj) { ((void(*)(id, SEL, id))(void *)objc_msgSend)((id)self,Sel,obj); } } } free(ivars); } return self;} æ¶ˆæ¯è½¬å‘è¿™ä¸€å°èŠ‚ï¼Œæˆ‘æ¥ç ”ç©¶ä¸‹runtimeé‡Œé¢çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼Œéƒ½çŸ¥é“ï¼Œobjc_msgsend()å‘é€ä¹‹åï¼Œå¦‚æœç›®æ ‡ä¸èƒ½æ‰§è¡Œç›¸åº”çš„SELï¼Œä¼šè¿›å…¥åˆ°å‰æ–‡æˆ‘ä»¬ä»‹ç»çš„é‚£å››ä¸ªæ–¹æ³•ä¸­ï¼Œå…·ä½“çš„å®è·µæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Œè¿™é‡Œæˆ‘å†™ä¸ªdemoæ¥æ¼”ç¤ºä¸‹ï¼Œä¸€æ–¹é¢æ˜¯è‡ªå·±å­¦ä¹ ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿåšä¸ªç¬”è®°ï¼Œæ–¹ä¾¿ä»¥åæŸ¥é˜…ã€‚ åŠ¨æ€æ·»åŠ æ–¹æ³• é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªCYStudentç±»ï¼Œç„¶ååœ¨å¤´æ–‡ä»¶å£°æ˜äº†ä¸€ä¸ªstudyæ–¹æ³• 12345@interface CYStudent : NSObject- (void)study;@end ä½†æ˜¯ï¼Œæˆ‘ä»¬åœ¨.mæ–‡ä»¶ä¸­ä¸å®ç°æ­¤æ–¹æ³•ï¼Œç”±æ­¤æ¥éªŒè¯ï¼Œæ˜¯å¦ä¼šè¿›å…¥æ¶ˆæ¯è½¬å‘æµç¨‹ï¼Œä¹‹ååœ¨.mæ–‡ä»¶ä¸­å®ç°resolveInstanceMethod:æ­¤æ–¹æ³•ï¼Œå¦‚ä¸‹ 1234567891011121314void play(id obj,SEL sel){ NSLog(@&quot;è¿™ä¸ªå­¦ç”Ÿä¸å­¦ä¹ ï¼ŒåªçŸ¥é“ç©è€ï¼&quot;);}@implementation CYStudent+ (BOOL)resolveInstanceMethod:(SEL)sel{ if([NSStringFromSelector(sel) isEqualToString:@&quot;study&quot;]){ return class_addMethod(self, sel, (IMP)play,&quot;v@:&quot;); } return [super resolveInstanceMethod:sel];}@end ç»å¦‚ä¸‹ä»£ç æµ‹è¯•ï¼Œå‘ç°ç¡®å®è¿›å…¥äº†playå‡½æ•°ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ 1234CYStudent *laosan = [CYStudent new];[laosan study];2017-06-08 22:21:34.997 RuntimeDemo[1381:190411] è¿™ä¸ªå­¦ç”Ÿä¸å­¦ä¹ ï¼ŒåªçŸ¥é“ç©è€ï¼ æ¶ˆæ¯è½¬å‘ è¿™é‡Œä»¥CYTeacherä¸ºä¾‹ï¼Œä¾ç„¶æ˜¯è®©CYTeacheræ‰§è¡Œstudyæ–¹æ³•ï¼Œä½†æ˜¯ä¸ç»™å…¶åŠ¨æ€è§£æçš„æœºä¼šï¼Œè®©å…¶å°†æ¶ˆæ¯å‘é€ç»™CYStudentï¼ŒCYStudentå°†ç»§ç»­åŠ¨æ€æ·»åŠ æ–¹æ³•çš„æµç¨‹ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ 123456789101112131415161718192021222324252627@interface CYTeacher : NSObject@end@implementation CYTeacher+ (BOOL)resolveInstanceMethod:(SEL)sel{ return NO;}- (id)forwardingTargetForSelector:(SEL)aSelector{ //å¦‚æœè½¬å‘çš„æ¶ˆæ¯æ˜¯playï¼Œè€å¸ˆæ‰§è¡Œä¸äº†ï¼Œé‚£å°±è®©å­¦ç”Ÿå¯¹è±¡æ‰§è¡Œä¸‹è¯•è¯• if ([NSStringFromSelector(aSelector) isEqualToString:@&quot;study&quot;]) { return [CYStudent new]; } return [super forwardingTargetForSelector:aSelector];}@end/*/////////////////////////////ä»¥ä¸‹ä¸ºæµ‹è¯•ä»£ç ///////////////////////////////*/ CYTeacher *teacher = [CYTeacher new]; [teacher performSelector:@selector(study) withObject:nil afterDelay:0]; /*/////////////////////////////ä»¥ä¸‹ä¸ºæ‰§è¡Œç»“æœ///////////////////////////////*/2017-06-08 22:31:23.541 RuntimeDemo[1457:215285] è¿™ä¸ªå­¦ç”Ÿä¸å­¦ä¹ ï¼ŒåªçŸ¥é“ç©è€ï¼ æ–¹æ³•ç­¾å æ¥ä¸‹æ¥ç ”ç©¶ä¸‹æ–¹æ³•ç­¾åå’Œæ–¹æ³•è°ƒç”¨çš„é—®é¢˜ï¼Œä»¥CYDoctorä¸ºä¾‹ï¼Œæ­¤å¤„è¿˜æ˜¯è®©CYDoctorå¯¹è±¡æ‰§è¡Œstudyæ–¹æ³•ï¼Œä½†æ˜¯ä¸å®ç°resolveInstanceMethod: å’ŒforwardingTargetForSelector:è¿™ä¿©ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯è®©å…¶è¿›å…¥æ–¹æ³•ç­¾åé‡Œé¢ï¼Œç”Ÿæˆä¸€ä¸ªæ–¹æ³•ç­¾åï¼Œä¹‹åå†æ‰§è¡ŒforwardInvocation:æ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯æˆ‘åšçš„æµ‹è¯•ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546@interface CYDoctor : NSObject@end@implementation CYDoctor+ (BOOL)resolveInstanceMethod:(SEL)sel{ return NO;}- (id)forwardingTargetForSelector:(SEL)aSelector{ return nil;}- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector{ if ([NSStringFromSelector(aSelector) isEqualToString:@&quot;study&quot;]) { return [NSMethodSignature signatureWithObjCTypes:&quot;v@:&quot;]; } return [super methodSignatureForSelector:aSelector];}- (void)forwardInvocation:(NSInvocation *)anInvocation{ [anInvocation setSelector:@selector(surgery:)]; [anInvocation setTarget:self]; [anInvocation invoke];}- (void)surgery:(id)sender{ NSLog(@&quot;sender : %@&quot;,sender); NSLog(@&quot;æ‰‹æœ¯ä¸­ï¼Œè¯·å‹¿æ‰“æ‰°!!!&quot;);}@end/*/////////////////////////////ä»¥ä¸‹ä¸ºæµ‹è¯•ä»£ç ///////////////////////////////*/ CYDoctor *doctor = [CYDoctor new]; [doctor performSelector:@selector(study) withObject:nil afterDelay:0]; /*/////////////////////////////ä»¥ä¸‹ä¸ºæ‰§è¡Œç»“æœ///////////////////////////////*/2017-06-08 22:45:39.442 RuntimeDemo[1544:239413] sender : (null)2017-06-08 22:45:39.442 RuntimeDemo[1544:239413] æ‰‹æœ¯ä¸­ï¼Œè¯·å‹¿æ‰“æ‰°!!! ç»è¿‡è¿™ä¸‰ä¸ªå°ä¾‹å­ï¼ŒåŸºæœ¬å¯¹objc_msgSend()çš„å‘é€æµç¨‹ææ¸…æ¥šäº†ï¼Œæ¥ä¸‹é‡Œå‡†å¤‡ç ”ç©¶ä¸‹MethodSwizzling MethodSwizzlingä»¥NSMutableArrayä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥æ›¿æ¢ç³»ç»Ÿçš„objectAtIndexï¼š,insertObject:AtIndex:,removeObjectAtIndex:ç­‰æ–¹æ³•ã€‚ é¦–å…ˆæˆ‘ä»¬ç»™NSobjectç±»æ·»åŠ ä¸€ä¸ªcategoryï¼Œç”¨æ¥ç»™ä»»ä½•ç±»è¿›è¡ŒmethodSwizzlingã€‚å¹¶æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥äº¤æ¢åŸæ–¹æ³•å’Œæ›¿æ¢æ–¹æ³•ã€‚ 12345678910111213141516171819202122232425262728#import &lt;objc/runtime.h&gt;@implementation NSObject (MethodSwizzling)+ (void)swizzlingOriginSelector:(SEL)originSel withSwizzledSelector:(SEL)swizzledSel{ Class class = [self class]; Method originMethod = class_getInstanceMethod(self, originSel); Method swizzledMethod = class_getInstanceMethod(self, swizzledSel); // ç»™ç³»ç»Ÿçš„æ–¹æ³•ï¼Œæ·»åŠ ä¸€ä¸ªswizzledSelçš„å®ç° BOOL didAddMethod = class_addMethod(class, originSel, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod)); // åŸå…ˆçš„æ–¹æ³•å¹¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥æ·»åŠ æˆåŠŸäº†ï¼Œé‚£ä¹ˆæ›¿æ¢swiizzledSelçš„å®ç°ä¸ºç³»ç»ŸåŸæ¥çš„å®ç° if (didAddMethod) { class_replaceMethod(class, swizzledSel, method_getImplementation(originMethod), method_getTypeEncoding(originMethod)); } else{ method_exchangeImplementations(originMethod, swizzledMethod); } } è¿™ä¹‹åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªNSMutableArrayçš„categoryï¼Œç”¨æ¥æ‰§è¡Œè¿è¡Œæ—¶æ–¹æ³•æ›¿æ¢ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687#import &quot;NSMutableArray+MethodSwizzling.h&quot;#import &lt;objc/runtime.h&gt;#import &quot;NSObject+MethodSwizzling.h&quot;@implementation NSMutableArray (MethodSwizzling)+ (void)load{ static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^{ [self swizzlingOriginSelector:@selector(removeObject:) withSwizzledSelector:@selector(cy_removeObject:)]; Class __NSArray_M = NSClassFromString(@&quot;__NSArrayM&quot;); [__NSArray_M swizzlingOriginSelector:@selector(objectAtIndex:) withSwizzledSelector:@selector(cy_objectAtIndex:)]; [__NSArray_M swizzlingOriginSelector:@selector(addObject:) withSwizzledSelector:@selector(cy_addObject:)]; [__NSArray_M swizzlingOriginSelector:@selector(insertObject:atIndex:) withSwizzledSelector:@selector(cy_insertObject:atIndex:)]; [__NSArray_M swizzlingOriginSelector:@selector(removeObjectAtIndex:) withSwizzledSelector:@selector(cy_removeObjectAtIndex:)]; });}- (id)cy_objectAtIndex:(NSInteger)index{ NSInteger count = [self count]; if (count == 0) { NSLog(@&quot;array is empty&quot;); return nil; } if (index &gt;= count) { NSLog(@&quot;index is bigger than count&quot;); return nil; } else{ return [self cy_objectAtIndex:index]; }}- (void)cy_removeObject:(id)objec{ if (objec == nil) { NSLog(@&quot;%s called,object is nil ,so return&quot;,__FUNCTION__); return; } [self cy_removeObject:objec];}- (void)cy_addObject:(id)object{ if (object == nil) { NSLog(@&quot;%s objc cannot be nil&quot;,__FUNCTION__); return; } [self cy_addObject:object];}- (void)cy_insertObject:(id)anObject atIndex:(NSUInteger)index{ if (anObject == nil) { NSLog(@&quot;%s objc cannot be nil&quot;,__FUNCTION__); return; } if (index &gt; self.count) { NSLog(@&quot;%s index %lu cannot bigger than self.count&quot;,__FUNCTION__, (unsigned long)index); return; } [self cy_insertObject:anObject atIndex:index]; }- (void)cy_removeObjectAtIndex:(NSUInteger)index{ if (index &gt;= self.count) { NSLog(@&quot;%s index %lu cannot bigger than self.count&quot;,__FUNCTION__, (unsigned long)index); } [self cy_removeObjectAtIndex:index];}@end æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªä¾‹å­ä»£ç ï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸‹æ›¿æ¢çš„æˆæœã€‚ 12345678910111213id nilobjc = nil;NSMutableArray *testArray = [NSMutableArray array];[testArray addObject:@&quot;&quot;];id obj = testArray[19];[testArray insertObject:nilobjc atIndex:0];[testArray removeObject:nilobjc];[testArray addObject:nilobjc];[testArray removeObjectAtIndex:0]; æ‰“å°ç»“æœä¸º 12342017-06-11 22:43:18.705 RuntimeDemo[38559:4195212] index is bigger than count2017-06-11 22:43:18.705 RuntimeDemo[38559:4195212] -[NSMutableArray(MethodSwizzling) cy_insertObject:atIndex:] objc cannot be nil2017-06-11 22:43:18.706 RuntimeDemo[38559:4195212] -[NSMutableArray(MethodSwizzling) cy_removeObject:] called,object is nil ,so return2017-06-11 22:43:18.706 RuntimeDemo[38559:4195212] -[NSMutableArray(MethodSwizzling) cy_addObject:] objc cannot be nil å°ç»“runtimeçš„å­¦ä¹ æ˜¯æŒç»­è¿›è¡Œäº†ï¼Œæˆ‘è¿™ç¯‡blogä¹Ÿä»…ä»…æ˜¯æŠ›ç –å¼•ç‰ï¼Œå¦‚ä½•çµæ´»çš„åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Runtimeæ‰æ˜¯æˆ‘ä»¬çœŸæ­£åº”è¯¥åšçš„ã€‚åˆ‡è®°ä¸å¯ä¸ºäº†ä½¿ç”¨æŸé¡¹æŠ€æœ¯ï¼Œç¡¬åˆšã€‚è¿™æ˜¯ä¸å¥½æ»´ã€‚ğŸ˜† å‚è€ƒèµ„æ–™1.Runtime å­¦ä¹ ç¬”è®°(ä¸€) 2.Runtime å­¦ä¹ ç¬”è®°(äºŒ) 3.ç†è§£ Objective-C Runtime 4.https://github.com/CoderJackyHuang","link":"/2017/05/23/%E5%85%B3%E4%BA%8ERuntime%E7%9A%84%E4%B8%80%E4%BA%9B%E7%90%86%E8%AE%BA%E5%92%8C%E5%AE%9E%E8%B7%B5/"},{"title":"å…³äºå¦‚ä½•å°†ç§äººPodåº“å‘å¸ƒåˆ°podåº“çš„å¿ƒå¾—","text":"å¼•å­å‘¨æœ«é—²æ¥æ— äº‹ï¼Œç¢ç£¨äº†ä¸‹å¦‚ä½•å°†gitä¸Šçš„ä»£ç åšæˆä¸€ä¸ªå¼€æºçš„åº“ï¼Œç„¶åä¾›è‡ªå·±å’Œåˆ«äººåœ¨å¼€å‘ä¸­ä½¿ç”¨ã€‚æ£é¼“äº†ä¸€ä¸ªå¤šå°æ—¶ç»ˆäºæ˜¯æˆåŠŸäº†,å¤§å®¶å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸‹è¾“å…¥ï¼Œpod search CYKit ï¼Œå°±ä¼šæœç´¢åˆ°æˆ‘è¿™ä¸ªå°demoäº†ã€‚ å‡†å¤‡å·¥ä½œ githubå‡†å¤‡å¼€æºçš„å·¥ç¨‹åœ°å€ï¼Œå¹¶ä¸”æœ‰Releaseçš„Tagã€‚å¦‚æˆ‘è‡ªå·±çš„å¼€æºåœ°å€ä¸ºï¼šhttps://github.com/TripleFireMan/CYKit.git,Tagä¸º0.1. æ³¨å†Œä¸€ä¸ªpod trunk çš„è´¦å·ï¼Œç”¨æ¥å°†è‡ªå·±çš„åº“pushåˆ°cocoaPodçš„master specä¸­ï¼Œè¿™æ ·æ‰ä¼šèƒ½è¢«åˆ«äººæœç´¢åˆ°ã€‚æ³¨å†Œæ–¹å¼ä¸º å‘½ä»¤è¡Œè¾“å…¥ pod trunk register ab36474XXX@126.com â€˜your user nameâ€™ â€“description=â€™device name or something otherâ€™ æ­£æ–‡ åœ¨å·¥ç¨‹ç›®å½•ä¸‹åˆ›å»ºPodspecæ–‡ä»¶ï¼Œcd åˆ°è¦åšæˆå¼€æºåº“çš„é¡¹ç›®æ ¹è·¯å¾„ä¸‹ï¼Œæ‰§è¡Œ pod spec create CYKitã€‚è¯¥å‘½ä»¤æ‰§è¡Œä¹‹åå°±ä¼šåœ¨å·¥ç¨‹ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªCYKit.podspecçš„æ–‡ä»¶ã€‚ ç¼–è¾‘Podspecæ–‡ä»¶ï¼Œåˆšç”Ÿæˆçš„Podspecæ–‡ä»¶å¾ˆå¤šä¿¡æ¯éƒ½æ˜¯æ²¡æœ‰çš„ï¼Œéœ€è¦æ‰‹åŠ¨å»ç¼–è¾‘ï¼Œæ‰“å¼€è¯¥æ–‡ä»¶ä¼šçœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ 123456789101112131415161718192021222324252627282930Pod::Spec.new do |s| # â€•â€•â€• Spec Metadata â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€• # # # These will help people to find your library, and whilst it # can feel like a chore to fill in it's definitely to your advantage. The # summary should be tweet-length, and the description more in depth. # s.name = &quot;CYKit&quot; s.version = &quot;0.1&quot; s.summary = &quot;something useful for daily development&quot; s.homepage = &quot;https://github.com/TripleFireMan&quot; # s.screenshots = &quot;www.example.com/screenshots_1.gif&quot;, &quot;www.example.com/screenshots_2.gif&quot; s.license = &quot;MIT&quot; s.author = { &quot;chengyan&quot; =&gt; &quot;ab364743113@126.com&quot; } s.platform = :ios, &quot;7.0&quot; s.source = { :git =&gt; &quot;https://github.com/TripleFireMan/CYKit.git&quot;, :tag =&gt; &quot;0.1&quot; } s.source_files = &quot;CYKit&quot;, &quot;CYKit/**/*.{h,m}&quot; #s.resources = &quot;Resources/*.png&quot; s.framework = &quot;UIKit&quot; s.requires_arc = true # s.xcconfig = { &quot;HEADER_SEARCH_PATHS&quot; =&gt; &quot;$(SDKROOT)/usr/include/libxml2&quot; } # s.dependency &quot;JSONKit&quot;, &quot;~&gt; 1.4&quot;end æ ¡éªŒå½“å‰çš„podspecæ–‡ä»¶æ˜¯å¦å¯ç”¨ï¼Œåœ¨podæ–‡ä»¶çš„ç›®å½•ä¸‹ï¼Œæ‰§è¡Œæ­¤å‘½ä»¤ pod spec lint CYKit.podspec,å¦‚æœé€šè¿‡æ ¡éªŒï¼Œåˆ™ä¼šæœ‰ä¸‹é¢çš„æç¤º1234567localhost:CYKit chengyan$ pod spec lint CYKit.podspec -&gt; CYKit (0.1)Analyzed 1 podspec.CYKit.podspec passed validation åä¹‹å°±ä¼šæœ‰é”™è¯¯æç¤ºã€‚æœ‰é”™è¯¯å°±è§£å†³é”™è¯¯å¥½äº† å‘å¸ƒåˆ°cocoapodä»“åº“ï¼Œè¿˜æ˜¯åœ¨podspecæ‰€åœ¨çš„æ–‡ä»¶ä¸‹ï¼Œæ‰§è¡Œpod trunk push å‘½ä»¤ã€‚å‘å¸ƒæˆåŠŸçš„è¯å°±æœ‰ä¸‹é¢çš„æç¤ºäº†1234567891011121314151617181920212223242526272829localhost:CYKit chengyan$ pod trunk push[!] Found podspec `CYKit.podspec`Updating spec repo `master`CocoaPods 1.2.0 is available.To update use: `sudo gem install cocoapods`Until we reach version 1.0 the features of CocoaPods can and will change.We strongly recommend that you use the latest version at all times.For more information, see https://blog.cocoapods.org and the CHANGELOG for this version at https://github.com/CocoaPods/CocoaPods/releases/tag/1.2.0Validating podspec -&gt; CYKit (0.1.5)Updating spec repo `master`CocoaPods 1.2.0 is available.To update use: `sudo gem install cocoapods`Until we reach version 1.0 the features of CocoaPods can and will change.We strongly recommend that you use the latest version at all times.For more information, see https://blog.cocoapods.org and the CHANGELOG for this version at https://github.com/CocoaPods/CocoaPods/releases/tag/1.2.0 - Data URL: https://raw.githubusercontent.com/CocoaPods/Specs/279e29a1cb259157cb329f9bbc2470a167667ee3/Specs/8/a/e/CYKit/0.1.5/CYKit.podspec.json - Log messages: - February 19th, 04:07: Push for `CYKit 0.1.5' initiated. - February 19th, 04:07: Push for `CYKit 0.1.5' has been pushed (0.86529383 s). å°ç»“é€šè¿‡ä¸Šè¿°ç®€å•å‡ æ­¥æ“ä½œï¼Œæˆ‘ä»¬å°±å‘å¸ƒäº†ä¸€ä¸ªå¼€æºçš„cocoapodç‰ˆæœ¬äº†ï¼Œä»¥åæœ‰éœ€è¦å°±å¯ä»¥å¾€ä¸Šé¢æ·»åŠ ä»£ç äº†ï¼Œè§£å†³äº†é‡å¤é€ è½®å­çš„é—®é¢˜ã€‚","link":"/2017/02/19/%E5%85%B3%E4%BA%8E%E5%A6%82%E4%BD%95%E5%B0%86%E7%A7%81%E4%BA%BAPod%E5%BA%93%E5%8F%91%E5%B8%83%E5%88%B0pod%E5%BA%93%E7%9A%84%E5%BF%83%E5%BE%97/"},{"title":"å¦‚ä½•ä½¿ç”¨subline-text2-ä½œä¸ºmarkdownçš„ç¼–è¾‘å·¥å…·","text":"ä»Šå¹´8æœˆä»½çš„æ—¶å€™ï¼Œåœ¨äºŒä»£çš„å¸¦é¢†ä¸‹ï¼Œæ¥è§¦äº†Hexo+Githubæ­å»ºä¸ªäººçš„åšå®¢ç©ºé—´çš„æ–°å§¿åŠ¿ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šã€‚æˆ‘ä¸ªäººé€‰æ‹©äº†sublinetext2 ä½œä¸ºmarkdownçš„ç¼–è¾‘å·¥å…·ï¼Œå®æµ‹è¿˜å¯ä»¥ï¼Œé‡‡ç”¨sublineèƒ½å¤Ÿåšåˆ° åœ¨çº¿é¢„è§ˆ (é€šè¿‡å®‰è£…OmniMarkupPreviewerå®ç°) è¯­æ³•é«˜äº® (é€šè¿‡å®‰è£…MarkdownEditingå®ç°) å•çº¯çš„sublineè™½ç„¶ä¹Ÿå¯ä»¥æ‰“å¼€markdownæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç¼–è¾‘ï¼Œä½†æ˜¯æ•ˆæœå’Œä½“éªŒæ€»æ˜¯ä¸å¤ªå¥½ï¼Œæˆ‘ä»Šå¤©ä»‹ç»çš„è¿™ä¿©ä¸ªæ’ä»¶èƒ½å¤Ÿå¤§å¤§æé«˜ä¹¦å†™æ•ˆç‡å’Œæå‡ä¹¦å†™ä½“éªŒã€‚å…ˆé™„ä¿©å¼ å›¾ä½“éªŒä¸€ä¸‹æœ€ç»ˆçš„æ•ˆæœã€‚ åŸºæœ¬å¯ä»¥å®ç°ï¼Œåœ¨å†™çš„è¿‡ç¨‹ä¸­å°±å¯ä»¥çœ‹åˆ°æœ€ç»ˆæ˜¾ç¤ºåœ¨ç½‘é¡µä¸Šæ˜¯ä»€ä¹ˆæ•ˆæœã€‚ä¸ç”¨ç­‰å†™å®Œä¹‹åå†å»è°ƒæ•´å±•ç¤ºçš„ç•Œé¢ï¼Œè¿˜æ˜¯æŒºæ–¹ä¾¿çš„ã€‚ è¿™é‡Œæœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚ å°†OmniMarkupPreviewerï¼ŒMarkdownEditingä»githubä¸Šcloneåˆ°sublineçš„packagesä¸‹éœ€è¦é‡å¯ä¸‹sublineã€‚ å¦‚æœæ˜¯ä»£ç çš„è¯ï¼Œé«˜äº®éœ€è¦ä½¿```å°†ä»£ç åŒ…èµ·æ¥ ï¼Œå½¢å¦‚```objc è¿™é‡Œæ·»å†™éœ€è¦å†™çš„ä»£ç ``` åœ¨çº¿é¢„è§ˆåŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡åœ¨sublineå³é”®ç‚¹å‡»preview markdown on browserï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¿«æ·é”®command + Alt + O åœ¨çº¿é¢„è§ˆã€‚ å¥½ä¹…æ²¡æœ‰å†™ä¸œè¥¿äº†ï¼Œå†™äº†è¿™ä¹ˆç‚¹ä¸œè¥¿å±…ç„¶å†™äº†æ”¹ï¼Œæ”¹äº†å†™ï¼Œä»¥åè¿˜æ˜¯è¦å¸¸å†™å¸¸æ›´ï¼Œäº‰å–å›åˆ°æ¯å‘¨ä¸€æ›´çš„æ­£ç¡®è½¨é“ä¸Šæ¥ã€‚","link":"/2016/12/29/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8subline-text2-%E4%BD%9C%E4%B8%BAmarkdown%E7%9A%84%E7%BC%96%E8%BE%91%E5%B7%A5%E5%85%B7/"},{"title":"å¦‚ä½•åœ¨iOS9ç³»ç»Ÿä¸­ä½¿ç”¨Universal Link","text":"æ¦‚è¿°â€‹ åœ¨ios9ç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡ç±»ä¼¼æ‰“å¼€ç½‘é¡µçš„æ–¹å¼ï¼Œé€šè¿‡httpåè®®æ‰“å¼€appã€‚é€šè¿‡ä¸€ä¸ªå”¯ä¸€çš„ç½‘å€ï¼Œå¯ä»¥æŒ‡åˆ°appå†…éƒ¨çš„ä¸€ä¸ªç‰¹å®šçš„viewã€‚è€Œä¸ç”¨å†ä½¿ç”¨schemeã€‚è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœtwitterä½¿ç”¨äº†Universal Linkï¼Œå¦‚æœä½ ç‚¹å‡»äº†ä¸€ä¸ªtwitterçš„é“¾æ¥ã€‚ä½ çš„è®¾å¤‡ç›´æ¥æ‰“å¼€twitter appå†…ç›¸åº”çš„é¡µé¢ã€‚è€Œä¸æ˜¯æ‰“å¼€ä¸€ä¸ªæ™®é€šçš„ç½‘é¡µï¼Œç„¶åå†é€šè¿‡è¿™ä¸ªç½‘é¡µæ‰“å¼€twitterï¼Œè¿™ç§ä½“éªŒå°†æ˜¯éå¸¸å¹³æ»‘ï¼Œä¸”å¯¹ç”¨æˆ·æ¥è®²ï¼Œä¹ŸèŠ‚çœäº†å¾ˆå¤šä¸å¿…è¦çš„æ“ä½œã€‚ åŠŸèƒ½â€‹ ä½¿ç”¨Universal Link èƒ½è®©ä½ çš„Appåšåˆ°ï¼Œé€šè¿‡ç‚¹å‡»ä¸€ä¸ªç½‘å€ï¼Œæ‰“å¼€ä½ çš„appï¼Œå¹¶è·³è½¬åˆ°å¯¹åº”çš„é¡µé¢ã€‚ å‡†å¤‡å·¥ä½œâ€‹ å®ç°Universal link å¹¶ä¸éš¾ï¼Œä½†æ˜¯ä½ å¿…é¡»éµä»ä¸€äº›æ¡ä»¶ã€‚ä¸‹é¢æ˜¯éœ€è¦å‡†å¤‡çš„æ¸…å•ã€‚ åºå· æ¡ä»¶ e.g. 1 æ³¨å†ŒåŸŸå www.domian.com 2 å¯ä»¥SSLè®¿é—®ä½ çš„åŸŸå æ”¯æŒSSLæ–¹å¼è¿›è¡Œæ–‡ä»¶è®¿é—® 3 èƒ½å¤Ÿä¸Šä¼ ä¸€ä¸ªJsonæ–‡ä»¶åˆ°ä½ çš„åŸŸå apple-app-site-association 4 ç³»ç»Ÿç‰ˆæœ¬ ios9+ 5 å¼€å‘ç¯å¢ƒ Xcode7+ â€‹ å¦‚æœä½ å·²ç»å…·å¤‡äº†ä¸Šé¢æ‰€æœ‰çš„å…ˆå†³æ¡ä»¶ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥åªéœ€è¦3æ­¥å°±å¯ä»¥åœ¨IOS9ä¸Šçš„è®¾å¤‡å®ç°Universal linkã€‚ å…·ä½“æ­¥éª¤ æ·»åŠ åŸŸååˆ°Capabilities é¦–å…ˆéœ€è¦åœ¨xcodeçš„capabilityä¸‹é¢æ·»åŠ åŸŸåï¼Œä¸”å¿…é¡»å¾—æ˜¯applinks:çš„å‰ç¼€ï¼Œå¦‚æœæœ‰äºŒçº§åŸŸåï¼Œä¹Ÿä¸€å¹¶åŠ å…¥è¿›å»ï¼Œè¯¸å¦‚(www.domain.com,news.domain.com,etc)![img](å¦‚ä½•åœ¨iOS9ç³»ç»Ÿä¸­ä½¿ç”¨Universal-Link/apple_capabilities.png) è¿™å°†ä¼šä½¿ä½ çš„appè®¿é—®ä¸€ä¸ªç‰¹æ®Šçš„jsonæ–‡ä»¶**â€apple-app-site-associationâ€**,å½“ä½ é¦–æ¬¡è¿è¡Œappçš„æ—¶å€™ï¼Œå®ƒå°±ä¼šä»https://domain.com/apple-app-site-association ä¸‹è½½è¿™ä¸ªjsonæ–‡ä»¶ã€‚æ¥ä¸‹æ¥ï¼Œçœ‹æ­¥éª¤2æ¥å­¦ä¹ ä¸‹æ€ä¹ˆæ„é€ è¿™ä¸ªæ–‡ä»¶ã€‚ æ­¤å¤–ï¼Œè¿˜éœ€è¦åœ¨ç½‘ç«™ä¸Šé…ç½®appçš„æˆæƒï¼Œå…è®¸universal linkã€‚ç¼–è¾‘Associate Domainçš„æˆæƒä¸ºenable ä¸Šä¼ apple-app-site-assosiation æ–‡ä»¶ è¿™ä¸ªæ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼Œä¸”èƒ½é€šè¿‡SSLçš„æ–¹å¼ï¼Œé€šè¿‡getè¯·æ±‚è·å–åˆ°ã€‚ä½ å¯ä»¥æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œç„¶åå†™ä¸‹å¦‚ä¸‹çš„jsonæ ¼å¼ 1234567891011{ &quot;applinks&quot;: { &quot;apps&quot;: [], &quot;details&quot;: [ { &quot;appID&quot;: &quot;TBEJCS6FFP.com.domain.App&quot;, &quot;paths&quot;:[ &quot;*&quot; ] } ] }} åœ¨è¿™ä¸ªpath å­—æ®µä¸‹ï¼Œä½ å¯ä»¥æœ‰ä¸€ä¸ªåˆ—è¡¨ï¼Œè¿™ä¸ªåˆ—è¡¨æ˜¯appå…è®¸åå°„åˆ°çš„urlåœ°å€ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª*å·ï¼Œæ¥æ ‡ç¤ºä½ åªæ˜¯æƒ³æ‰“å¼€ä¸€ä¸ªappï¼Œè€Œä¸ç®¡å®ƒçš„å…·ä½“åœ°å€ã€‚ å¦å¤–ï¼Œä½ å¯èƒ½ä¼šå¥½å¥‡**â€TBEJCS6FFP.com.domain.Appâ€œ** è¿™ä¸ªå€¼æ˜¯ä»å“ªè·å–çš„ï¼Œé€šå¸¸æ¥è®²ï¼Œå®ƒå°±æ˜¯ä½ appçš„bundleidæ‰€åœ¨çš„teamedã€‚ä½ ä¹Ÿå¯ä»¥ç‚¹å‡»å®ƒæ¥æŸ¥è¯¢ä½ çš„teamid,ç„¶åbundleidå¯ä»¥åœ¨appçš„Generalä¸‹æŸ¥è¯¢åˆ°ã€‚ æœ€åï¼Œå¦‚æœä½ å¯ä»¥åœ¨ä½ çš„æ ¹åŸŸåä¸‹ï¼Œæ‰¾åˆ° https://domain.com/apple-app-site-associationï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥å¼€å§‹ä¸‹ä¸€æ­¥äº†ã€‚ åœ¨ä½ çš„appå†…éƒ¨å¦‚ä½•å¤„ç†universallink â€‹ ä¸ºäº†åœ¨appå†…éƒ¨æ”¯æŒuniversal linkï¼Œä½ éœ€è¦åœ¨appdelegateä¸­å®ç°ä»¥ä¸‹æ–¹æ³•ï¼Œapplication(_:continueUserActivity:restorationHandler:) ï¼Œå°½ç®¡è¿™ä¸ªæ–¹æ³•å¯èƒ½ä¼šå¤„ç†å¤šä¸ªäº‹ä»¶ï¼ˆå¦‚ Handoffï¼ŒSearchApiï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬åªå…³æ³¨æ¥è‡ªuniversal linkçš„äº‹ä»¶ã€‚ â€‹ å¦‚æœuserActivityç»™çš„å‚æ•°æ˜¯NSUserActivityTypeBrowsingWeb.è¿™å°±æ„å‘³ç€å®ƒæ˜¯æ¥è‡ªuniversal linkçš„å‚æ•°ï¼Œåœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œé¦–å…ˆä¿è¯å®ƒçš„webpageURLä¸ä¸ºç©ºï¼Œè¿™ä¸ªå±æ€§æŒ‡çš„å°±æ˜¯ç”¨æˆ·æ‰“å¼€çš„é“¾æ¥ã€‚é‚£ä¹ˆå®ƒæœ‰å¯èƒ½ä¸ºå¦‚ä¸‹çš„æ ¼å¼http://domain.com/path/to/thezoo â€‹ ä¸ºäº†ç¡®ä¿ä½ çš„appèƒ½å¤Ÿè½¬æ¢è¿™äº›URLï¼Œä½ éœ€è¦åšä»¥ä¸‹å‡ æ­¥ é€šè¿‡NSURLComponentsç±»è§£æwebpageURL hostä»¥åŠpathè·¯å¾„ã€‚ ç¡®ä¿ä½ èƒ½å¤Ÿè¯†åˆ«è¿™ä¸ªhost å°½é‡æŠŠpathçš„è·¯å¾„å¯¹åº”åˆ°ä½ çš„appé¡µé¢ä¸­ ç¡®ä¿pathå¯¹åº”çš„é¡µé¢èƒ½å¤Ÿå±•ç¤º å±•ç¤ºå¯¹åº”çš„é¡µé¢ç»™ç”¨æˆ· å¦‚æœä¸Šé¢çš„æ­¥éª¤å¤±è´¥äº†ï¼Œè‹¹æœå»ºè®®ä½ çš„appï¼Œä¼˜é›…çš„æ‰“å¼€safariå¯¹åº”çš„ç½‘å€ã€‚ å…¶ä»–å½“æ— æ³•å¾€æ ¹åŸŸåä¸‹æ”¾ç½®apple-app-site-associationæ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘åœ¨äºŒçº§åŸŸåä¸‹æ”¾ç½®ï¼ŒåŒæ—¶å°†äºŒçº§åŸŸåé‡å®šå‘åˆ°æ ¹åŸŸåã€‚é€šè¿‡è¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥å®ç°è‹¹æœå¯åŠ¨è®¾å¤‡çš„æ—¶å€™è·å–æ–‡ä»¶ã€‚ ä½¿ç”¨äºŒçº§åŸŸåé‡å®šå‘çš„æ—¶å€™ï¼Œè¦å¯¹apple-app-site-associationæ–‡ä»¶è¿›è¡ŒåŠ å¯†ã€‚ è€Œä¸”æ­¤æ–‡ä»¶çš„ç±»å‹åº”è¯¥æ˜¯application/pkcs7-mime å¸¸è§é”™è¯¯1234 ### Denying redirect 'https://www.domain.com/.well-known/apple-app-site-association' -&gt; 'http://err.taobao.com/error1.html'May 17 12:11:05 chengde-iPhone swcd(CoreUtils)[159] &lt;Notice&gt;: ### Rejecting URL 'https://www.domain.com/apple-app-site-association' for auth method 'NSURLAuthenticationMethodServerTrust': -6754/0xFFFFE59E kAuthenticationErr https://forums.developer.apple.com/thread/67882 http://stackoverflow.com/questions/34166173/apple-app-site-association-file-wont-download(è§£å†³æ–¹æ³•) https://gist.github.com/anhar/6d50c023f442fb2437e1#sign-the-apple-app-association-file-using-opensslï¼ˆæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éœ€è¦åšçš„äº‹ï¼‰ https://forum.ind.ie/t/ios-9-universal-links-apple-app-site-association-blues/986ï¼ˆä¸€äº›æ³¨æ„äº‹é¡¹ï¼‰ æ£€æµ‹å·¥å…·https://search.developer.apple.com/appsearch-validation-tool/ https://limitless-sierra-4673.herokuapp.com/ æ€»ç»“â€‹ æœ€åç”¨ä¸€å¼ å›¾æ¥æ€»ç»“ä¸‹è¿™ä¸ªæµç¨‹,æ­¤å¤–ä½ ä¹Ÿå¯ä»¥å‚è€ƒä¸‹è‹¹æœçš„æ–‡æ¡£ï¼Œä»¥å¤‡è‹¹æœæ›´æ–° â€‹","link":"/2017/06/01/%E5%A6%82%E4%BD%95%E5%9C%A8iOS9%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%BD%BF%E7%94%A8Universal-Link/"},{"title":"","text":"æŠ€æœ¯äº¤æµå¤§çº²äº¤æµèƒŒæ™¯å…¥èŒä¸€ä¸ªå¤šæœˆï¼Œé€šè¿‡é˜…è¯»å…¬å¸çš„æŠ€æœ¯èµ„æ–™ï¼Œç»“åˆè‡ªå·±å¤šå¹´çš„å¼€å‘ç»éªŒï¼Œåˆ†äº«ä¸€äº›å¥½çš„ï¼Œå¯¹é¡¹ç›®æœ‰ç›Šçš„æƒ³æ³•åŠè½åœ°æ–¹æ¡ˆï¼Œæ­¤å¤–å¯¹é¡¹ç›®çš„ç†è§£ï¼Œæä¸€äº›ä¸ªäººçš„çœ‹æ³•ï¼Œæœ‰ä»€ä¹ˆä¸è¶³/ä¸å¯¹çš„åœ°æ–¹ï¼Œå¸Œæœ›å„ä½åŒäº‹æŸ¥æ¼è¡¥ç¼º å…³äºè°ƒè¯•å·¥å…·DoraemonKit ç›®å‰åœ¨å»ºé¾™ç‰©æµç«¯ï¼Œæ¥å…¥äº†Dokitï¼Œæ­¤å¤–æ ¹æ® å®˜æ–¹æ–‡æ¡£è®¾è®¡äº†ä¸¤ä¸ªæ’ä»¶ï¼Œ ä¸€ä¸ªæ˜¯ç”¨æ¥åˆ‡æ¢æ­£å¼å’Œæµ‹è¯•ç¯å¢ƒï¼Œ ä¸€ä¸ªæ˜¯æ ¹æ®é¡µé¢classnameæ¥è·³è½¬å¯¹äºç©ºé¡µé¢ï¼ˆç”¨äºè°ƒè¯•UIï¼‰ æ¥å…¥è¯´æ˜:æ’ä»¶çš„æ¥å…¥ä¸»è¦åˆ†ä¸‹é¢å‡ æ­¥ï¼Œç¬¬ä¸€æ­¥ï¼š åˆ›å»ºä¸€ä¸ªæ’ä»¶Vcï¼Œç”¨æ¥æ‰¿è½½æ’ä»¶åŠŸèƒ½,å…·ä½“å¼€å‘åŠŸèƒ½ï¼Œç”¨æˆ·è‡ªå®šä¹‰ç¬¬äºŒæ­¥ï¼š å®ä¾‹åŒ–ä¸€ä¸ªæ’ä»¶ç±»ï¼Œå®ç°åè®®DoraemonPluginProtocol 1234// è¯¥ä»£ç†æ–¹æ³•æ˜¯ç‚¹å‡»æ’ä»¶æŒ‰é’®æ—¶ä¼šè§¦å‘- (void) pluginDidLoad{ /// å¦‚åˆ›å»ºé¡µé¢ï¼Œpushåˆ°å †æ ˆä¸­} ç¬¬ä¸‰æ­¥ï¼šå°†æ’ä»¶æŒ‚è½½åˆ°dokitçš„é¦–é¡µä¸Š 1[[DoraemonManager shareInstance] addPluginWithTitle:@&quot;ç¯å¢ƒåˆ‡æ¢&quot; icon:@&quot;doraemon_default&quot; desc:@&quot;ç”¨äºappå†…éƒ¨ç¯å¢ƒåˆ‡æ¢åŠŸèƒ½&quot; pluginName:@&quot;KCEnvPlugin&quot; atModule:@&quot;ä¸šåŠ¡ä¸“åŒº&quot;]; æ’ä»¶çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼Œæœ‰å…´è¶£çš„åŒäº‹å¯ä»¥å»çœ‹ä¸€ä¸‹ 1234567891011121314â””â”€â”€ KCLogistics â””â”€â”€ KCModules â””â”€â”€ KCDebugModule â””â”€â”€ Module â”œâ”€â”€ KCDebugModule.h â”œâ”€â”€ KCDebugModule.m â”œâ”€â”€ KCDebugVCJumpPlugin.h â”œâ”€â”€ KCDebugVCJumpPlugin.m â”œâ”€â”€ KCDebugVcJumpVC.h â”œâ”€â”€ KCDebugVcJumpVC.m â”œâ”€â”€ KCEnvChangeVC.h â”œâ”€â”€ KCEnvChangeVC.m â”œâ”€â”€ KCEnvPlugin.h â””â”€â”€ KCEnvPlugin.m å…³äºé¡¹ç›®ç»„ä»¶åŒ–ç»„ä»¶åŒ–çš„å¿…è¦æ€§ï¼Œé¡¹ç›®ç›®å‰åˆ†ä¸ºå¿«æˆç‰©æµã€å¿«æˆå¸æœºã€å»ºé¾™å¸æœºã€å»ºé¾™ç‰©æµã€æ™‹èƒ½ç‰©æµã€æ™‹èƒ½å¸æœºã€‚é¡¹ç›®çš„ç®¡ç†ä¸»è¦é åˆ›å»ºä¸åŒçš„ä»£ç ä»“ä»¥åŠåˆ†æ”¯æ¥ç®¡ç†ä»£ç ã€‚æˆ‘çš„æƒ³æ³•æ˜¯ç²’åº¦å¤§ä¸€ç‚¹ï¼Œç±»ä¼¼YYKitè¿™ç§ï¼Œå¼„ä¸€ä¸ªå…¨å®¶æ¡¶ï¼Œç„¶åå†…éƒ¨å¼„ä¸€äº›å­podåº“ï¼Œç„¶åé¡¹ç›®ç›´æ¥å¼•ç”¨è¿™ä¸ªå…¨å®¶æ¡¶ï¼Œå‡å°‘ä¸€äº›é‡å¤åŸºå»ºå·¥ä½œã€‚ä¸€äº›å‰ç½®æ¡ä»¶å¤§æ¦‚çš„æ­¥éª¤ï¼ŒæŒ‰ä»¥ä¸‹å‡ æ­¥è¿›è¡Œ æ­å»ºä¸€ä¸ªå…¬å¸å†…éƒ¨çš„ç§æœ‰podæº âœ… é¡¹ç›®è¿›è¡Œæ¢³ç†ï¼Œæ‹†åˆ†è§£è€¦åŸºå»ºç»„ä»¶åº“ âœ… æ‹‰åˆ†æ”¯ï¼Œé›†æˆç§æœ‰åº“ï¼Œåˆ é™¤æ—§æºç  âŒ æµ‹è¯•ï¼Œä¸Šçº¿** âŒçº¿ä¸Šç›‘æ§çº¿ä¸Šç›‘æ§çš„ä¸€ä¸ªæ€è·¯ï¼Œä¸»è¦æ˜¯å¯¹æ¥buglyã€é’‰é’‰ã€æœåŠ¡ç«¯ã€‚ç›®å‰æˆ‘ä»¬é¡¹ç›®é‡Œé¢å·²ç»æ¥å…¥äº†buglyç›‘æ§ï¼Œæ‰€ä»¥çº¿ä¸Šçš„ç›‘æ§ä¹Ÿå¯ä»¥åº”ç”¨buglyæä¾›çš„æ•°æ®å†…å®¹è¿›è¡Œhookï¼Œç„¶åéœ€è¦æœåŠ¡ç«¯æä¾›ä¸€ä¸ªæ¥å£ã€‚å°†buglyæ¯å¤©äº§ç”Ÿçš„æ•°æ®ï¼Œè¿›è¡Œä¸€ä¸ªå†å¤„ç†ï¼Œå°†æˆ‘ä»¬å…³æ³¨çš„æ•°æ®è¿›è¡Œä¸€ä¸ªæ±‡æ€»ã€‚ç”¨é’‰é’‰æœºå™¨äººå‘é€åˆ°å¯¹åº”çš„ç¾¤é‡Œã€‚ ### åŠ¨æ€åŒ– ç›®å‰çš„é¡¹ç›®ï¼Œè¿˜æ²¡æœ‰åŠ¨æ€åŒ–çš„èƒ½åŠ›ï¼Œè¿™æ–¹é¢æ˜¯å¦è€ƒè™‘æ¥å…¥RNæˆ–è€…å…¶ä»–åŠ¨æ€åŒ–èƒ½åŠ› å¦‚æœæ¥å…¥çš„è¯ï¼Œä¸ªäººå»ºè®®æ¥å…¥RNï¼Œä»Šå¹´RNåº•å±‚æ¶æ„æœ‰äº†ä¸€ä¸ªå¤§çš„å‡çº§ï¼Œä»ä¹‹å‰çš„JSCoreå¼•æ“å‡çº§Hermesï¼Œæ–°å¼•æ“æ¯”è€å¼•æ“é€šä¿¡æ€§èƒ½æœ‰äº†3å€çš„æå‡ï¼Œå¯åŠ¨æ€§èƒ½ä¹Ÿæœ‰2å€çš„æå‡ [RNæ–°æ¶æ„ä»‹ç»](https://time.geekbang.org/column/article/499434) å…³äºååŒå·¥ç¨‹ä»£ç ä¹¦å†™è§„èŒƒå¿«æˆiOSä»£ç è§„èŒƒ è§„èŒƒåç§° è¯´æ˜ ä¾‹å­ å‘½åè§„èŒƒ å¤§é©¼å³°è§„åˆ™ä¸å°é©¼å³°åŸåˆ™ NameTextField(å¤§é©¼å³°),nameTextField(å°é©¼å³°) é¡¹ç›®å‘½å å¤§é©¼å³° AoRiseProject Bundle Identifier å‘½å ååŸŸåå‘½å com.jianlongkuaicheng.driver ç±»å å¤§é©¼å³°å‘½åã€‚ä¸€èˆ¬æ˜¯ï¼šå‰ç¼€ + åŠŸèƒ½ + ç±»å‹ KC + Login + ViewController VCç»“æ„åˆ†åŒº ä»£ç ç»“æ„åˆ†åŒº å˜é‡å’Œæ–¹æ³• å°é©¼å³° - (void)addTrailerWithParams:(NSMutableDictionary *)params{} å¸¸é‡ å®ï¼šå¤§å†™KC + å¤§é©¼å³° å…¨å±€å¸¸é‡ï¼šå·¥ç¨‹å‰+ç¼€å…¨å¤§å†™ #define KCUserAgeKey @â€œuserAgeKeyâ€extern const NSString KC_USER_AGE_KEY å‚æ•°å å°é©¼å³°å‘½å - (instancetype)initWithFrame:(CGRect)frame myCarViewItemClickBlock:(myCarViewItemClickBlock)itemClick myCarViewSearchPlateBlock:(myCarViewSearchPlateBlock)searchPlate; èµ„æºæ–‡ä»¶è§„èŒƒ ç”¨é€”_æ¨¡å—å_é€»è¾‘åç§°ç”¨é€”_æ¨¡å—å_é¢œè‰²ç”¨é€”_é€»è¾‘åç§°ç”¨é€”_é¢œè‰² æ–‡ä»¶å¤¹å‘½å å®ä½“æ–‡ä»¶å¤¹,é¦–å­—æ¯è¦å¤§å†™ Modelï¼ŒViewï¼ŒControllerï¼ŒToolï¼ŒOtherï¼ŒService ç‰ˆæœ¬è§„èŒƒ é‡‡ç”¨A.B.C ä¸‰ä½æ•°å­—å‘½å æ³¨é‡Šè§„èŒƒ æ–¹æ³•æ³¨é‡Š æ–¹æ³•å¤–éƒ¨ç»Ÿä¸€ç”¨option + command + / ï¼Œæ–¹æ³•å†…éƒ¨ç»Ÿä¸€ç”¨//æ³¨é‡Š æ¨¡å‹æ³¨é‡Š ///æ³¨é‡Š åˆ†æ”¯è§„èŒƒ Mergeè§„èŒƒ ä¸¥æ ¼æ‰§è¡Œgitlabçš„merge requestç¦æ­¢featureä¹‹é—´è¿›è¡Œmergeæ“ä½œmergeé¡ºåºï¼šfeature-&gt;release-&gt;master-&gt;feature commitè§„èŒƒ åŸåˆ™ï¼šæ˜ç¡®æäº¤çš„ç‰ˆæœ¬/é¡¹ç›®/æ”¹åŠ¨ç‚¹[å“ªä¸ªé¡¹ç›®+å“ªä¸ªç‰ˆæœ¬?+æ¨¡å—?]-ADD/MOD/FIX/DELETEï¼šdesc è¯­æ³•æ£€æŸ¥cè¯­è¨€ç¼–ç¨‹è§„èŒƒæ£€æŸ¥clang,ä½¿ç”¨Xcodeå¼€å‘iOSè¯­æ³•æ£€æŸ¥çš„Clangæ’ä»¶ é“¾æ¥å™¨ï¼šç¬¦å·æ˜¯æ€ä¹ˆç»‘å®šåˆ°åœ°å€ä¸Šçš„ï¼Ÿ","link":"/2022/08/08/%E6%8A%80%E6%9C%AF%E4%BA%A4%E6%B5%81/"},{"title":"ç‚¹ç‚¹æ»´æ»´ï¼šHTTPSå’ŒHTTPçš„åŒºåˆ«","text":"ä»iOS9å¼€å§‹ï¼Œè‹¹æœå®˜æ–¹å¼€å§‹è¦æ±‚ï¼Œä¸Šçº¿çš„APPéœ€è¦å¯¹HTTPsåè®®è¿›è¡Œæ”¯æŒï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨é¡¹ç›®çš„plistæ–‡ä»¶ä¸­è®¾ç½®å±æ€§çš„æ–¹å¼ï¼Œæš‚æ—¶ç»•å¼€è¿™æ¡é™åˆ¶ï¼Œ ä½†æ˜¯æˆ‘ä¸ªäººè®¤ä¸ºè¿˜æ˜¯æœ‰å¿…è¦äº†è§£ä¸‹ï¼Œè‹¹æœä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ å…ˆç®€å•ç§‘æ™®ä¸‹HTTPä¸HTTPSåˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Œä»¥åŠå®ƒä»¬çš„åŒºåˆ«åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ HTPPSå’ŒHTTPçš„æ¦‚å¿µHTTPSï¼ˆå…¨ç§°ï¼šHypertext Transfer Protocol over Secure Socket Layerï¼‰ï¼Œæ˜¯ä»¥å®‰å…¨ä¸ºç›®æ ‡çš„HTTPé€šé“ï¼Œç®€å•è®²æ˜¯HTTPçš„å®‰å…¨ç‰ˆã€‚å³HTTPä¸‹åŠ å…¥SSLå±‚ï¼ŒHTTPSçš„å®‰å…¨åŸºç¡€æ˜¯SSLï¼Œå› æ­¤åŠ å¯†çš„è¯¦ç»†å†…å®¹å°±éœ€è¦SSLã€‚ å®ƒæ˜¯ä¸€ä¸ªURI schemeï¼ˆæŠ½è±¡æ ‡è¯†ç¬¦ä½“ç³»ï¼‰ï¼Œå¥æ³•ç±»åŒhttp:ä½“ç³»ã€‚ç”¨äºå®‰å…¨çš„HTTPæ•°æ®ä¼ è¾“ã€‚https:URLè¡¨æ˜å®ƒä½¿ç”¨äº†HTTPï¼Œä½†HTTPSå­˜åœ¨ä¸åŒäºHTTPçš„é»˜è®¤ç«¯å£åŠä¸€ä¸ªåŠ å¯†/èº«ä»½éªŒè¯å±‚ï¼ˆåœ¨HTTPä¸TCPä¹‹é—´ï¼‰ã€‚è¿™ä¸ªç³»ç»Ÿçš„æœ€åˆç ”å‘ç”±ç½‘æ™¯å…¬å¸è¿›è¡Œï¼Œæä¾›äº†èº«ä»½éªŒè¯ä¸åŠ å¯†é€šè®¯æ–¹æ³•ï¼Œç°åœ¨å®ƒè¢«å¹¿æ³›ç”¨äºä¸‡ç»´ç½‘ä¸Šå®‰å…¨æ•æ„Ÿçš„é€šè®¯ï¼Œä¾‹å¦‚äº¤æ˜“æ”¯ä»˜æ–¹é¢ã€‚ è¶…æ–‡æœ¬ä¼ è¾“åè®® (HTTP-Hypertext transfer protocol) æ˜¯ä¸€ç§è¯¦ç»†è§„å®šäº†æµè§ˆå™¨å’Œä¸‡ç»´ç½‘æœåŠ¡å™¨ä¹‹é—´äº’ç›¸é€šä¿¡çš„è§„åˆ™ï¼Œé€šè¿‡å› ç‰¹ç½‘ä¼ é€ä¸‡ç»´ç½‘æ–‡æ¡£çš„æ•°æ®ä¼ é€åè®®ã€‚ HTTPSå’ŒHTTPçš„åŒºåˆ«ï¼š1.HTTPSè®®éœ€è¦åˆ°CAç”³è¯·è¯ä¹¦ï¼Œä¸€èˆ¬å…è´¹è¯ä¹¦å¾ˆå°‘ï¼Œéœ€è¦äº¤è´¹ã€‚HTTPæ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä¸éœ€è¦è¯ä¹¦2.ç«¯å£å·ä¸åŒï¼ŒHTTPSç«¯å£å·æ˜¯443ï¼ŒHTTPç«¯å£å·æ˜¯803.HTTPSè¦è¿›è¡Œå¤šæ¬¡çš„èº«ä»½éªŒè¯ï¼Œ6/7çš„æ¡æ‰‹ä»¥è¾¾åˆ°æ•°æ®å®‰å…¨ï¼Œæ€§èƒ½æ¶ˆè€—è¾ƒå¤§ï¼Œä¹Ÿå³é€šä¿¡ä¹‹å‰éœ€è¦å…ˆç¡®è®¤èº«ä»½ï¼Œåªæœ‰èº«ä»½ç¡®è®¤æ‰ä¼šå‘é€ä¿¡æ¯ã€‚ çœ‹å®Œä¸Šé¢HTTPSå’ŒHTTPçš„ä¸åŒä¹‹åï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°å…¶å®äºŒè€…æœ€æ ¹æœ¬çš„åŒºåˆ«å°±æ˜¯åœ¨HTTPSæ¯”HTTPå¤šä½¿ç”¨çš„SSLå±‚ï¼Œé‚£SSLå±‚åˆæ˜¯ä»€ä¹ˆä¸œä¸œå‘¢ï¼Ÿä¸”çœ‹ä¸‹é¢è¿™å¼ å›¾å…¬å¼ï¼šHTTP+SSL/TLS+TCP = HTTPS é‚£ä¹ˆSSLã€TLSåˆæ˜¯ä»€ä¹ˆé¬¼å‘¢ï¼Ÿç®€å•çš„ç«‹å³SSLå°±æ˜¯å¯¹ä¼ è¾“çš„å†…å®¹é€šè¿‡æŸç§ç®—æ³•è¿›è¡ŒåŠ å¯†çš„ä¸€ç§åè®®ï¼Œé‚£TLSåˆæ˜¯ä»€ä¹ˆå‘¢ï¼ŸTLSå®é™…ä¸Šæ˜¯SSLçš„å‡çº§ç‰ˆï¼Œçœ‹ä¸‹ä¸‹é¢çš„æ¢ç®—å…¬å¼ï¼šSSL 2.0SSL 3.0TLS 1.0 (SSL 3.1)TLS 1.1 (SSL 3.1)TLS 1.2 (SSL 3.1) ç›®å‰ï¼Œåº”ç”¨æœ€å¹¿æ³›çš„æ˜¯TLS 1.0ï¼Œæ¥ä¸‹æ¥æ˜¯SSL 3.0ã€‚ä½†æ˜¯ï¼Œä¸»æµæµè§ˆå™¨éƒ½å·²ç»å®ç°äº†TLS 1.2çš„æ”¯æŒã€‚ é‚£ä¹ˆèº«ä¸ºç§»åŠ¨ç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œé¢å¯¹å¦‚æ­¤å¤§åŠ¿æ‰€è¶‹ï¼Œæˆ‘ä»¬èƒ½åšä»€ä¹ˆå‘¢ï¼Ÿæ–¹æ³•ä¸€ï¼šè¦æ±‚å…¬å¸çš„æœåŠ¡ç«¯è¿›è¡Œå‡çº§ï¼Œè‡³å°‘æ”¯æŒåˆ°è‹¹æœè¦æ±‚çš„TLS1.2æ–¹æ³•äºŒï¼šåœ¨info.plistä¸­è¿›è¡Œé…ç½®ï¼Œä½¿APPèƒ½å¤Ÿè®¿é—®ä¸æ”¯æŒHTTPSçš„æœåŠ¡å™¨ã€‚å¦‚æœè®©ä½ çš„APPèƒ½å¤Ÿè®¿é—®ä»»æ„çš„Hoståœ°å€é‚£ä¹ˆå¯ä»¥è¿™æ ·é…ç½®ï¼ˆè¿™æ˜¯æœ€çœäº‹ä¹Ÿæ˜¯æœ€ä¸å®‰å…¨çš„ï¼‰ 123NSAppTransportSecurity NSAllowsArbitraryLoads","link":"/2016/08/27/%E7%82%B9%E7%82%B9%E6%BB%B4%E6%BB%B4%EF%BC%9AHTTPS%E5%92%8CHTTP%E7%9A%84%E5%8C%BA%E5%88%AB/"},{"title":"ç‚¹ç‚¹æ»´æ»´ï¼šNSLogä¸€ç‚¹è¯´é“","text":"ä»Šå¤©çš„å°ç»“ä¸»è¦è®²è¿°åœ¨IOSå¼€å‘ä¸­å®ç°è‡ªå®šä¹‰çš„NSLogæ–¹æ³• 1 ä¸ºä»€ä¹ˆè¦å¯¹NSLogè¿›è¡Œé‡å®šä¹‰ï¼Ÿåœ¨å¼€å§‹è¿™ä¸ªçŸ¥è¯†ç‚¹çš„è®²è§£ä¹‹å‰ï¼Œé¦–å…ˆè¯´ä¸‹ï¼Œä¸ºä»€ä¹ˆè¦å¯¹NSLogå®è¿›è¡Œé‡å®šä¹‰ã€‚åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œç»å¸¸éœ€è¦å¯¹ç¨‹åºè¿›è¡Œè°ƒè¯•ã€‚ç”±äºè°ƒè¯•åˆ†å¸ƒåœ¨é¡¹ç›®çš„å„ç§åœ°æ–¹ï¼Œå½“é¡¹ç›®å‘å¸ƒæ—¶ï¼Œå¦‚æœå†å°†è°ƒè¯•ä¿¡æ¯å»æ‰ï¼Œæ˜¾ç¤ºä¼šæ¶ˆè€—å¾ˆå¤§çš„äººåŠ›ï¼Œç‰©åŠ›ã€‚å¹¸å¥½ï¼Œå¼ºå¤§çš„xcodeç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„åŠŸèƒ½ã€‚åœ¨é¡¹ç›®çš„Build Settingsä¸­ç»™Apple LLVM Preprocessingä¸­çš„ preprocessor macrosä¸‹é¢çš„Debugæ·»åŠ ä¸€ä¸ªè°ƒè¯•å®DEBUG=1,è®°ä½åœ¨Releaseä¸‹é¢ä¸è¦æ·»åŠ ä»»ä½•ä¸œè¥¿ï¼æ·»åŠ è¿™ä¸ªä¸œè¥¿çš„æ„æ€å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œåœ¨è°ƒè¯•é˜¶æ®µï¼Œé¡¹ç›®ä¸­è¿›è¡Œäº†ä¸€ä¸ªDEBUGçš„å®å®šä¹‰ï¼Œä½†æ˜¯Releaseé˜¶æ®µä¸å®šä¹‰ã€‚ 2 å¦‚ä½•å¯¹NSLogå®è¿›è¡Œå®šä¹‰äº†12345#ifdef DEBUG#define NSLog(args...) ExtendNSLog(__FILE__,__LINE__,__PRETTY_FUNCTION__,args);#else#define NSLog(x...)#endif ä¸‹é¢æ¥å¯¹ä¸Šè¿°å®è¿›è¡Œè§£é‡Šï¼Œå¦‚æœå®šä¹‰äº†DEBUGå®ï¼Œé‚£ä¹ˆå°±å¯¹NSLog(argsâ€¦)è¿›è¡Œé‡å®šä¹‰ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œå°†NSLog(argsâ€¦)è®¾ç½®ä¸ºç©ºï¼Œä¸åšä»»ä½•å¤„ç†ï¼Œ 3 å¦‚ä½•å¯¹å®šä¹‰çš„ä¿¡æ¯è¿›è¡Œè¾“å‡ºï¼Œå¹¶é™„å¸¦.æ–‡ä»¶åï¼Œæ‰“å°è¡Œæ•°ï¼Œæ–¹æ³•å.æ¥ä¸‹æ¥å¯¹ExtendNSLog()è¿›è¡Œè§£é‡Š12345678910111213141516171819202122 void ExtendNSLog(const char *file, int lineNumber, const char *functionName, NSString *format, ...){ // Type to hold information about variable arguments. va_list ap; // Initialize a variable argument list. va_start (ap, format); // NSLog only adds a newline to the end of the NSLog format if // one is not already there. // Here we are utilizing this feature of NSLog() if (![format hasSuffix: @&quot;\\n&quot;]) { format = [format stringByAppendingString: @&quot;\\n\\nâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯\\n\\n&quot;]; } NSString *body = [[NSString alloc] initWithFormat:format arguments:ap]; // End using variable argument list. va_end (ap); NSString *fileName = [[NSString stringWithUTF8String:file] lastPathComponent]; fprintf(stderr, &quot;[%s LINE:%d]%s:\\n%s&quot;, [fileName UTF8String],lineNumber, (functionName[0])=='-'?(&amp;functionName[1]):functionName, [body UTF8String]); } ä¸‹é¢æ¥å¯¹ä¸Šè¿°ä»£ç è¿›è¡Œè§£é‡Š è·å–å‚æ•°åˆ—è¡¨ç±» å¯åŠ¨å‚æ•°åˆ—è¡¨ç±»å’Œæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å…³è” è·å–æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å®é™…è¾“å‡ºæ–‡æœ¬ å…³é—­å‚æ•°åˆ—è¡¨ç±»å’Œæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å…³è” è°ƒç”¨Cå‡½æ•°fprintf(),å°†æ‰“å°ä¿¡æ¯è¾“å‡ºã€‚","link":"/2016/08/27/%E7%82%B9%E7%82%B9%E6%BB%B4%E6%BB%B4%EF%BC%9ANSLog%E4%B8%80%E7%82%B9%E8%AF%B4%E9%81%93/"},{"title":"ç‚¹ç‚¹æ»´æ»´ï¼šNSScannerçš„ç”¨æ³•å°ç»“","text":"NSScannerç±»æ˜¯ä¸€ä¸ªç±»ç°‡çš„æŠ½è±¡çˆ¶ç±»,è¯¥ç±»ç°‡ä¸ºä¸€ä¸ªä»NSStringå¯¹è±¡æ‰«æå€¼çš„å¯¹è±¡æä¾›äº†ç¨‹åºæ¥å£ã€‚ NSScannerå¯¹è±¡æŠŠNSString å¯¹è±¡çš„çš„å­—ç¬¦è§£é‡Šå’Œè½¬åŒ–æˆ numberå’Œstring ç±»å‹çš„å€¼ã€‚åœ¨åˆ›å»ºNSScannerå¯¹è±¡çš„æ—¶å€™ä¸ºå®ƒåˆ†é…å­—ç¬¦(string )ï¼Œå½“ä½ ä»NSScannerå¯¹è±¡è·å–å†…å®¹çš„æ—¶å€™ï¼Œå®ƒä¼šä»å¤´åˆ°å°¾éå†å­—ç¬¦ä¸²(string)ã€‚ç”±äºç±»ç°‡çš„å±æ€§ï¼Œ scannerå¯¹è±¡å¹¶ä¸æ˜¯ NSScannerç±»çš„å®ä¾‹ï¼Œè€Œæ˜¯å®ƒä¸€ä¸ªç§æœ‰å­ç±»çš„å®ä¾‹ã€‚å°½ç®¡scannerå¯¹è±¡çš„ç±»æ˜¯ç§æœ‰çš„ï¼Œä½†æ˜¯å®ƒçš„æ¥å£æ˜¯å…¬å¼€çš„ï¼ˆæŠ½è±¡çˆ¶ç±»å·²ç»å£°æ˜ï¼‰ã€‚ NSScanner çš„åŸå§‹æ–¹æ³•æ˜¯stringå’ŒConfiguring a Scanneræ–¹æ³•ä¸‹é¢åˆ—ä¸¾çš„æ‰€æœ‰çš„æ–¹æ³•ã€‚åœ¨ NSScanner å¯¹è±¡æ‰«æå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½®å±æ€§charactersToBeSkippedå¿½ç•¥æŸäº›å­—ç¬¦ã€‚åœ¨æ‰«æå­—ç¬¦ä¸²ä¹‹å‰ï¼Œé‚£äº›ä½äºå¿½ç•¥å­—ç¬¦é›†ä¸­çš„å­—ç¬¦å°†ä¼šè¢«è·³è¿‡ã€‚é»˜è®¤çš„å¿½ç•¥å­—ç¬¦æ˜¯ç©ºæ ¼å’Œå›è½¦å­—ç¬¦ã€‚å¯ä»¥é€šè¿‡[[scanner string] substringFromIndex:[scanner scanLocation]]è·å–æœªæ‰«æçš„å­—ç¬¦ä¸²ã€‚ åˆ›å»º Scannerå¯¹è±¡123+ scannerWithString:+ localizedScannerWithString:- initWithString: Designated Initializer scannerWithStringï¼Œè¿”å›å€¼æ˜¯ æ‰«æè¿‡aStringå­—ç¬¦ä¸²çš„NSScanner å¯¹è±¡ï¼Œè¯¥æ–¹æ³•é€šè¿‡è°ƒç”¨initWithStringè®¾ç½®æ‰«æå­—ç¬¦ä¸²;localizedScannerWithString,è¿”å›å€¼æ˜¯ é€šè¿‡ç”¨æˆ·é»˜è®¤çš„ localeæ–¹å¼æ‰«æå­—ç¬¦ä¸²çš„NSScanner å¯¹è±¡ï¼Œè¯¥æ–¹æ³•ä¹Ÿæ˜¯é€šè¿‡è°ƒç”¨initWithStringè®¾ç½®æ‰«æå­—ç¬¦ä¸²;initWithStringï¼Œè¿”å›å€¼æ˜¯NSScanner å¯¹è±¡ï¼Œè¯¥å¯¹è±¡é€šè¿‡æ‰«æaStringå®Œæˆåˆå§‹åŒ– è·å–Scannerå¯¹è±¡å­—ç¬¦ä¸²1string Property è®¾ç½®scannerå¯¹è±¡123456789scanLocation PropertycaseSensitive PropertycharactersToBeSkipped Propertylocale PropertyscanLocation,ä¸‹æ¬¡æ‰«æå¼€å§‹çš„ä½ç½®ï¼Œå¦‚æœè¯¥å€¼è¶…å‡ºäº†stringçš„åŒºåŸŸï¼Œå°†ä¼šå¼•èµ·NSRangeException,è¯¥å±æ€§åœ¨å‘ç”Ÿé”™è¯¯åé‡æ–°æ‰«ææ—¶éå¸¸æœ‰ç”¨ã€‚caseSensitiveï¼Œæ˜¯å¦åŒºåˆ†å­—ç¬¦ä¸²ä¸­å¤§å°å†™çš„æ ‡å¿—ã€‚é»˜è®¤ä¸ºNOï¼Œæ³¨æ„ï¼šè¯¥è®¾ç½®ä¸ä¼šåº”ç”¨åˆ°è¢«è·³è¿‡çš„å­—ç¬¦é›†ã€‚charactersToBeSkipped,åœ¨æ‰«ææ—¶è¢«è·³è¿‡çš„å­—ç¬¦é›†ï¼Œé»˜è®¤æ˜¯ç©ºç™½æ ¼å’Œå›è½¦é”®ã€‚è¢«è·³è¿‡çš„å­—ç¬¦é›†ä¼˜å…ˆäºæ‰«æçš„å­—ç¬¦é›†ï¼šä¾‹å¦‚ä¸€ä¸ªscannerè¢«è·³è¿‡çš„å­—ç¬¦é›†ä¸ºç©ºæ ¼ï¼Œé€šè¿‡scanInt:å»æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­çš„æ•´å‹æ•°æ—¶ï¼Œé¦–å…ˆåšçš„ä¸æ˜¯æ‰«æï¼Œè€Œæ˜¯è·³è¿‡ç©ºæ ¼ï¼Œç›´åˆ°æ‰¾åˆ°åè¿›åˆ¶æ•°æ®æˆ–è€…å…¶ä»–çš„å­—ç¬¦ã€‚åœ¨å­—ç¬¦è¢«æ‰«æçš„æ—¶å€™ï¼Œè·³è¿‡åŠŸèƒ½å°±å¤±æ•ˆäº†ã€‚å¦‚æœä½ æ‰«æçš„å­—ç¬¦å’Œè·³è¿‡çš„å­—ç¬¦æ˜¯ä¸€æ ·çš„ï¼Œç»“æœå°†æ˜¯æœªçŸ¥çš„ã€‚è¢«è·³è¿‡çš„å­—ç¬¦æ˜¯ä¸€ä¸ªå”¯ä¸€å€¼ï¼Œscannerä¸ä¼šå°†å¿½ç•¥å¤§å°å†™çš„åŠŸèƒ½åº”ç”¨äºå®ƒï¼Œä¹Ÿä¸ä¼šç”¨è¿™äº›å­—ç¬¦åšä¸€äº›ç»„åˆï¼Œå¦‚æœåœ¨æ‰«æå­—ç¬¦æ¢çš„æ—¶å€™ä½ æƒ³å¿½ç•¥å…¨éƒ¨çš„å…ƒéŸ³å­—ç¬¦ï¼Œå°±è¦è¿™ä¹ˆåšï¼ˆæ¯”å¦‚ï¼šå°†å­—ç¬¦é›†è®¾ç½®æˆâ€œAEIOUaeiouâ€};locale,scanner çš„localeå¯¹å®ƒä»å­—ç¬¦ä¸²ä¸­åŒºåˆ†æ•°å€¼äº§ç”Ÿå½±å“ï¼Œå®ƒé€šè¿‡localeçš„åè¿›åˆ¶åˆ†éš”ç¬¦åŒºåˆ†æµ®ç‚¹å‹æ•°æ®çš„æ•´æ•°å’Œå°æ•°éƒ¨åˆ†ã€‚ä¸€ä¸ªæ²¡æœ‰localeçš„scannerç”¨éå®šåŸŸå€¼ã€‚æ–°çš„scannerè‹¥æ²¡æœ‰è®¾ç½®localeï¼Œä½¿ç”¨é»˜è®¤localeã€‚ æ‰«æå­—ç¬¦ä¸²123456789101112131415161718192021222324252627282930- scanCharactersFromSet:intoString:- scanUpToCharactersFromSet:intoString:- scanDecimal:- scanDouble:- scanFloat:- scanHexDouble:- scanHexFloat:- scanHexInt:- scanHexLongLong:- scanInteger:- scanInt:- scanLongLong:- scanString:intoString:- scanUnsignedLongLong:- scanUpToString:intoString:atEnd PropertyscanCharactersFromSet:intoString:æ‰«æå­—ç¬¦ä¸²ä¸­å’ŒNSCharacterSetå­—ç¬¦é›†ä¸­åŒ¹é…çš„å­—ç¬¦ï¼Œæ˜¯æŒ‰å­—ç¬¦å•ä¸ªåŒ¹é…çš„ï¼Œä¾‹å¦‚ï¼ŒNSCharacterSetå­—ç¬¦é›†ä¸º@&quot;test123Dmo&quot;ï¼Œscannerå­—ç¬¦ä¸²ä¸º @&quot; 123test12Demotest&quot;ï¼Œé‚£ä¹ˆå­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„å­—ç¬¦éƒ½åœ¨å­—ç¬¦é›†ä¸­ï¼Œæ‰€ä»¥æŒ‡é’ˆæŒ‡å‘çš„åœ°å€å­˜å‚¨çš„å†…å®¹ä¸º&quot;123test12Demotest&quot;scanUpToCharactersFromSet:intoStringï¼šæ‰«æå­—ç¬¦ä¸²ç›´åˆ°é‡åˆ°NSCharacterSetå­—ç¬¦é›†çš„å­—ç¬¦æ—¶åœæ­¢ï¼ŒæŒ‡é’ˆæŒ‡å‘çš„åœ°å€å­˜å‚¨çš„å†…å®¹ä¸ºé‡åˆ°è·³è¿‡å­—ç¬¦é›†å­—ç¬¦ä¹‹å‰çš„å†…å®¹scanString:intoString:ä»å½“å‰çš„æ‰«æä½ç½®å¼€å§‹æ‰«æï¼Œåˆ¤æ–­æ‰«æå­—ç¬¦ä¸²æ˜¯å¦ä»å½“å‰ä½ç½®èƒ½æ‰«æåˆ°å’Œä¼ å…¥å­—ç¬¦ä¸²ç›¸åŒçš„ä¸€ä¸²å­—ç¬¦ï¼Œå¦‚æœèƒ½æ‰«æåˆ°å°±è¿”å›YES,æŒ‡é’ˆæŒ‡å‘çš„åœ°å€å­˜å‚¨çš„å°±æ˜¯è¿™æ®µå­—ç¬¦ä¸²çš„å†…å®¹ã€‚ä¾‹å¦‚scannerçš„stringå†…å®¹ä¸º123abc678,ä¼ å…¥çš„å­—ç¬¦ä¸²å†…å®¹ä¸ºabcï¼Œå¦‚æœå½“å‰çš„æ‰«æä½ç½®ä¸º0ï¼Œé‚£ä¹ˆæ‰«æä¸åˆ°ï¼Œä½†æ˜¯å¦‚æœå°†æ‰«æä½ç½®è®¾ç½®æˆ3ï¼Œå°±å¯ä»¥æ‰«æåˆ°äº†ã€‚scanUpToString:intoString:ä»å½“å‰çš„æ‰«æä½ç½®å¼€å§‹æ‰«æï¼Œæ‰«æåˆ°å’Œä¼ å…¥çš„å­—ç¬¦ä¸²ç›¸åŒå­—ç¬¦ä¸²æ—¶ï¼Œåœæ­¢ï¼ŒæŒ‡é’ˆæŒ‡å‘çš„åœ°å€å­˜å‚¨çš„æ˜¯é‡åˆ°ä¼ å…¥å­—ç¬¦ä¸²ä¹‹å‰çš„å†…å®¹ã€‚ä¾‹å¦‚scannerçš„stringå†…å®¹ä¸º123abc678,ä¼ å…¥çš„å­—ç¬¦ä¸²å†…å®¹ä¸ºabcï¼Œå­˜å‚¨çš„å†…å®¹ä¸º123scanDecimal:æ‰«æNSDecimalç±»å‹çš„å€¼ï¼Œæœ‰å…³NSDecimalç±»å‹çš„å€¼æ›´å¤šçš„ä¿¡æ¯å¯ä»¥æŸ¥çœ‹ï¼šNSDecimalNumberscanDouble :æ‰«æåŒç²¾åº¦æµ®ç‚¹å‹å­—ç¬¦ï¼Œæº¢å‡ºå’Œéæº¢å‡ºéƒ½è¢«è®¤ä¸ºåˆæ³•çš„æµ®ç‚¹å‹æ•°æ®ã€‚åœ¨æº¢å‡ºçš„æƒ…å†µä¸‹scannerå°†ä¼šè·³è¿‡æ‰€æœ‰çš„æ•°å­—ï¼Œæ‰€ä»¥æ–°çš„æ‰«æä½ç½®å°†ä¼šåœ¨æ•´ä¸ªæµ®ç‚¹å‹æ•°æ®çš„åé¢ã€‚doubleæŒ‡é’ˆæŒ‡å‘çš„åœ°å€å­˜å‚¨çš„æ•°æ®ä¸ºæ‰«æå‡ºçš„å€¼ï¼ŒåŒ…æ‹¬æº¢å‡ºæ—¶çš„HUGE_VALæˆ–è€… â€“HUGE_VALï¼Œå³æœªæº¢å‡ºæ—¶çš„0.0ã€‚scanFloatï¼šæ‰«æå•ç²¾åº¦æµ®ç‚¹å‹å­—ç¬¦ï¼Œå…·ä½“å†…å®¹åŒscanDoublescanHexDouble: æ‰«æåŒç²¾åº¦çš„åå…­è¿›åˆ¶ç±»å‹ï¼Œæº¢å‡ºå’Œéæº¢å‡ºéƒ½è¢«è®¤ä¸ºåˆæ³•çš„æµ®ç‚¹å‹æ•°æ®ã€‚åœ¨æº¢å‡ºçš„æƒ…å†µä¸‹scannerå°†ä¼šè·³è¿‡æ‰€æœ‰çš„æ•°å­—ï¼Œæ‰€ä»¥æ–°çš„æ‰«æä½ç½®å°†ä¼šåœ¨æ•´ä¸ªæµ®ç‚¹å‹æ•°æ®çš„åé¢ã€‚doubleæŒ‡é’ˆæŒ‡å‘çš„åœ°å€å­˜å‚¨çš„æ•°æ®ä¸ºæ‰«æå‡ºçš„å€¼ï¼ŒåŒ…æ‹¬æº¢å‡ºæ—¶çš„HUGE_VALæˆ–è€… â€“HUGE_VALï¼Œå³æœªæº¢å‡ºæ—¶çš„0.0ã€‚æ•°æ®æ¥æ”¶æ—¶å¯¹åº”çš„æ ¼å¼ä¸º %a æˆ–%A ï¼ŒåŒç²¾åº¦åå…­è¿›åˆ¶å­—ç¬¦å‰é¢ä¸€å®šè¦åŠ  0xæˆ–è€… 0Xã€‚scanHexInt æ‰«æåå…­è¿›åˆ¶æ— ç¬¦æ•´å‹ï¼Œunsigned intæŒ‡é’ˆæŒ‡å‘çš„åœ°å€å€¼ä¸º æ‰«æåˆ°çš„å€¼ï¼ŒåŒ…å«æº¢å‡ºæ—¶çš„UINT_MAXã€‚scanHexLongLong åŒscanHexDoublescanInt æ‰«ææ•´å‹ï¼Œæº¢å‡ºä¹Ÿè¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„æ•´å‹ï¼Œint æŒ‡é’ˆæŒ‡å‘çš„åœ°å€çš„å€¼ä¸ºæ‰«æåˆ°çš„å€¼ï¼ŒåŒ…å«æº¢å‡ºæ—¶çš„INT_MAXæˆ–INT_MINã€‚scanInteger åŒscanIntscanLongLong æ‰«æLongLong å‹ï¼Œæº¢å‡ºä¹Ÿè¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„æ•´å‹ï¼ŒLongLongæŒ‡é’ˆæŒ‡å‘çš„åœ°å€çš„å€¼ä¸ºæ‰«æåˆ°çš„å€¼ï¼ŒåŒ…å«æº¢å‡ºæ—¶çš„LLONG_MAX æˆ– LLONG_MINã€‚ å¦‚ä½•ä½¿ç”¨åœºæ™¯1ï¼šè·å–URLä¸­çš„è¯·æ±‚keyå’Œvalueã€‚æˆ‘ä»¬çŸ¥é“åœ¨iOSä¸­ï¼Œç³»ç»Ÿå°è£…çš„URLä¼šæœ‰ä¸€ä¸ªå±æ€§å«åšQueryï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæ­£ç¡®çš„URLä¼šæœ‰ç±»ä¼¼çš„æ ¼å¼@â€https://wwww.baidu.com/home.php?name=cheng&amp;age=19&amp;nickname=hehe&quot; å…¶ä¸­ï¼Ÿåé¢çš„å°±æ˜¯URLçš„Queryï¼Œé‚£ä¹ˆå¦‚ä½•åˆ†åˆ«è·å–keyå’Œvalueå‘¢ï¼Ÿ 123456789101112131415161718192021void scannerStringDemo(){ NSURL *url = [NSURL URLWithString:@&quot;https://wwww.baidu.com/home.php?name=cheng&amp;age=19&amp;nickname=hehe&quot;]; NSScanner *scanner = [[NSScanner alloc]initWithString:url.query]; NSCharacterSet *delimiterSet = [NSCharacterSet characterSetWithCharactersInString:@&quot;&amp;&quot;]; NSMutableDictionary *paris = [@{} mutableCopy]; while (![scanner isAtEnd]) { NSString *pairString = nil; [scanner scanUpToCharactersFromSet:delimiterSet intoString:&amp;pairString]; [scanner scanCharactersFromSet:delimiterSet intoString:NULL]; NSRange range = [pairString rangeOfString:@&quot;=&quot;]; if (range.location != NSNotFound) { NSString *key = [pairString substringToIndex:range.location]; NSString *value = [pairString substringFromIndex:range.location + range.length]; [paris setObject:key forKey:@&quot;key&quot;]; [paris setObject:value forKey:@&quot;value&quot;]; } }} åœºæ™¯2ï¼šåˆ¤æ–­å½“å‰çš„å­—ç¬¦ä¸²æ˜¯å¦æ˜¯ä¸€ä¸ªçº¯æ•°å­—12345- (BOOL)isPureInt:(NSString*)string{ NSScanner* scan = [NSScanner scannerWithString:string]; int val; return[scan scanInt:&amp;val] &amp;&amp; [scan isAtEnd];} åœºæ™¯3ï¼šåˆ¤æ–­TextFieldè¾“å…¥çš„å­—ç¬¦ä¸²æ˜¯ä¸æ˜¯éœ€è¦çš„æ ¼å¼ï¼Œè¿™é‡Œè¦æ±‚æ˜¯æœ€å¤šä¸‰ä½å°æ•°çš„æ•°å­—12345678910111213141516171819202122232425262728293031323334353637383940414243+(BOOL)isValidAboutInputText:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string decimalNumber:(NSInteger)number{ NSScanner *scanner = [NSScanner scannerWithString:string]; NSCharacterSet *numbers; NSRange pointRange = [textField.text rangeOfString:@&quot;.&quot;]; if ( (pointRange.length &gt; 0) &amp;&amp; (pointRange.location &lt; range.location || pointRange.location &gt; range.location + range.length) ){ numbers = [NSCharacterSet characterSetWithCharactersInString:@&quot;0123456789&quot;]; }else{ numbers = [NSCharacterSet characterSetWithCharactersInString:@&quot;0123456789.&quot;]; } if ( [textField.text isEqualToString:@&quot;&quot;] &amp;&amp; [string isEqualToString:@&quot;.&quot;] ){ return NO; } short remain = number; //ä¿ç•™ numberä½å°æ•° NSString *tempStr = [textField.text stringByAppendingString:string]; NSUInteger strlen = [tempStr length]; if(pointRange.length &gt; 0 &amp;&amp; pointRange.location &gt; 0){ //åˆ¤æ–­è¾“å…¥æ¡†å†…æ˜¯å¦å«æœ‰â€œ.â€ã€‚ if([string isEqualToString:@&quot;.&quot;]){ //å½“è¾“å…¥æ¡†å†…å·²ç»å«æœ‰â€œ.â€æ—¶ï¼Œå¦‚æœå†è¾“å…¥â€œ.â€åˆ™è¢«è§†ä¸ºæ— æ•ˆã€‚ return NO; } if(strlen &gt; 0 &amp;&amp; (strlen - pointRange.location) &gt; remain+1){ //å½“è¾“å…¥æ¡†å†…å·²ç»å«æœ‰â€œ.â€ï¼Œå½“å­—ç¬¦ä¸²é•¿åº¦å‡å»å°æ•°ç‚¹å‰é¢çš„å­—ç¬¦ä¸²é•¿åº¦å¤§äºéœ€è¦è¦ä¿ç•™çš„å°æ•°ç‚¹ä½æ•°ï¼Œåˆ™è§†å½“æ¬¡è¾“å…¥æ— æ•ˆã€‚ return NO; } } NSRange zeroRange = [textField.text rangeOfString:@&quot;0&quot;]; if(zeroRange.length == 1 &amp;&amp; zeroRange.location == 0){ //åˆ¤æ–­è¾“å…¥æ¡†ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦ä¸ºâ€œ0â€ if(![string isEqualToString:@&quot;0&quot;] &amp;&amp; ![string isEqualToString:@&quot;.&quot;] &amp;&amp; [textField.text length] == 1){ //å½“è¾“å…¥æ¡†åªæœ‰ä¸€ä¸ªå­—ç¬¦å¹¶ä¸”å­—ç¬¦ä¸ºâ€œ0â€æ—¶ï¼Œå†è¾“å…¥ä¸ä¸ºâ€œ0â€æˆ–è€…â€œ.â€çš„å­—ç¬¦æ—¶ï¼Œåˆ™å°†æ­¤è¾“å…¥æ›¿æ¢è¾“å…¥æ¡†çš„è¿™å”¯ä¸€å­—ç¬¦ã€‚ textField.text = string; return NO; }else{ if(pointRange.length == 0 &amp;&amp; pointRange.location &gt; 0){ //å½“è¾“å…¥æ¡†ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºâ€œ0â€æ—¶ï¼Œå¹¶ä¸”æ²¡æœ‰â€œ.â€å­—ç¬¦æ—¶ï¼Œå¦‚æœå½“æ­¤è¾“å…¥çš„å­—ç¬¦ä¸ºâ€œ0â€ï¼Œåˆ™è§†å½“æ­¤è¾“å…¥æ— æ•ˆã€‚ if([string isEqualToString:@&quot;0&quot;]){ return NO; } } } } NSString *buffer; if ( ![scanner scanCharactersFromSet:numbers intoString:&amp;buffer] &amp;&amp; ([string length] != 0) ){ return NO; }else{ return YES; }} æ³¨æ„äº‹é¡¹1[scanner scanCharactersFromSet:delimiterSet intoString:NULL];å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè·³è¿‡ä¸éœ€è¦çš„å­—ç¬¦ã€‚ ç›®å‰èƒ½æƒ³åˆ°çš„ç”¨æ³•å°±è¿™äº›ï¼Œå¦‚æœæœ‰æ›´å¤šçš„ç”¨æ³•ï¼Œä»¥åæ…¢æ…¢è¡¥å……ï¼","link":"/2016/08/27/%E7%82%B9%E7%82%B9%E6%BB%B4%E6%BB%B4%EF%BC%9ANSScanner%E7%9A%84%E7%94%A8%E6%B3%95%E5%B0%8F%E7%BB%93/"},{"title":"ç‚¹ç‚¹æ»´æ»´ï¼šä¸€ä¸ªå®¹æ˜“è¢«å¿½è§†çš„æ•°ç»„å’Œå­—å…¸çš„æ–¹æ³•","text":"ä»Šå¤©æ¥è®¨è®ºä¸‹å¹³æ—¶å¤§å®¶ç†Ÿæ‚‰çš„æ•°ç»„/å­—å…¸ï¼Œä½†æ˜¯å®¹æ˜“å¿½ç•¥çš„æ•°ç»„/å­—å…¸çš„valueForKeyPathæ–¹æ³•å¯èƒ½å¤§å®¶å¯¹- (id)valueForKeyPath:(NSString *)keyPathæ–¹æ³•ä¸æ˜¯å¾ˆäº†è§£ã€‚å…¶å®è¿™ä¸ªæ–¹æ³•éå¸¸çš„å¼ºå¤§ï¼Œä¸¾ä¸ªä¾‹å­: 12NSArray *array = @[@&quot;name&quot;, @&quot;w&quot;, @&quot;aa&quot;, @&quot;jimsa&quot;];NSLog(@&quot;%@&quot;, [array valueForKeyPath:@&quot;uppercaseString&quot;]); è¾“å‡º( NAME, W, AA, JIMSA) ç›¸å½“äºæ•°ç»„ä¸­çš„æ¯ä¸ªæˆå‘˜æ‰§è¡Œäº†uppercaseStringæ–¹æ³•ï¼Œç„¶åæŠŠè¿”å›çš„å¯¹è±¡ç»„æˆä¸€ä¸ªæ–°æ•°ç»„è¿”å›ã€‚æ—¢ç„¶å¯ä»¥ç”¨uppercaseStringæ–¹æ³•ï¼Œé‚£ä¹ˆNSStringçš„å…¶ä»–æ–¹æ³•ä¹Ÿå¯ä»¥ï¼Œæ¯”å¦‚ 1[array valueForKeyPath:@&quot;length&quot;]; è¿”å›æ¯ä¸ªå­—ç¬¦ä¸²é•¿åº¦çš„ç»„æˆçš„æ•°ç»„ã€‚åªè¦ä½ èƒ½æƒ³åˆ°çš„æˆå‘˜å®ä¾‹æ–¹æ³•éƒ½å¯ä»¥è¿™ä¹ˆç”¨ã€‚å¦‚æœä½ è§‰å¾—è¿™ä¸ªæ–¹æ³•å°±è¿™ä¹ˆç‚¹åŠŸèƒ½ï¼Œé‚£å°±é”™äº†ã€‚è¿˜æ˜¯ä¸¾å…·ä½“çš„ä¾‹å­å¯¹NSNumberæ•°ç»„å¿«é€Ÿè®¡ç®—æ•°ç»„æ±‚å’Œã€å¹³å‡æ•°ã€æœ€å¤§å€¼ã€æœ€å°å€¼ 12345NSArray *array = @[@1, @2, @3, @4, @10]; NSNumber *sum = [array valueForKeyPath:@&quot;@sum.self&quot;]; NSNumber *avg = [array valueForKeyPath:@&quot;@avg.self&quot;]; NSNumber *max = [array valueForKeyPath:@&quot;@max.self&quot;]; NSNumber *min = [array valueForKeyPath:@&quot;@min.self&quot;]; æˆ–è€…æŒ‡å®šè¾“å‡ºç±»å‹ 12NSArray *array = @[@&quot;name&quot;, @&quot;w&quot;, @&quot;aa&quot;, @&quot;jimsa&quot;, @&quot;aa&quot;]; NSLog(@&quot;%@&quot;, [array valueForKeyPath:@&quot;@distinctUnionOfObjects.self&quot;]); æ‰“å°(name,w,jimsa,aa) å¯¹NSDictionaryæ•°ç»„å¿«é€Ÿæ‰¾å‡ºç›¸åº”keyå¯¹çš„å€¼ 12345NSArray *array = @[@{@&quot;name&quot; : @&quot;cookeee&quot;,@&quot;code&quot; : @1}, @{@&quot;name&quot;: @&quot;jim&quot;,@&quot;code&quot; : @2}, @{@&quot;name&quot;: @&quot;jim&quot;,@&quot;code&quot; : @1}, @{@&quot;name&quot;: @&quot;jbos&quot;,@&quot;code&quot; : @1}];NSLog(@&quot;%@&quot;, [array valueForKeyPath:@&quot;name&quot;]); ç›´æ¥å¾—åˆ°å­—å…¸ä¸­namekeyå¯¹åº”çš„å€¼ç»„æˆçš„æ•°ç»„ï¼Œæ˜¾ç„¶æ¯”å¾ªç¯å–å€¼å†åŠ å…¥åˆ°æ–°æ•°ç»„ä¸­æ–¹ä¾¿å¿«æ·( cookeee, jim, jim, jbos) åŒæ ·å¯ä»¥åµŒå¥—ä½¿ç”¨ï¼Œå…ˆå‰”é™¤nameå¯¹åº”å€¼çš„é‡å¤æ•°æ®å†å–å€¼ 12345NSArray *array = @[@{@&quot;name&quot; : @&quot;cookeee&quot;,@&quot;code&quot; : @1}, @{@&quot;name&quot;: @&quot;jim&quot;,@&quot;code&quot; : @2}, @{@&quot;name&quot;: @&quot;jim&quot;,@&quot;code&quot; : @1}, @{@&quot;name&quot;: @&quot;jbos&quot;,@&quot;code&quot; : @1}]; NSLog(@&quot;%@&quot;, [array valueForKeyPath:@&quot;@distinctUnionOfObjects.name&quot;]); æ‰“å°(cookeee,jim,jbos)","link":"/2016/08/27/%E7%82%B9%E7%82%B9%E6%BB%B4%E6%BB%B4%EF%BC%9A%E4%B8%80%E4%B8%AA%E5%AE%B9%E6%98%93%E8%A2%AB%E5%BF%BD%E8%A7%86%E7%9A%84%E6%95%B0%E7%BB%84%E5%92%8C%E5%AD%97%E5%85%B8%E7%9A%84%E6%96%B9%E6%B3%95/"},{"title":"ç‚¹ç‚¹æ»´æ»´ï¼šå…³äºva_list","text":"æƒ³å¿…åœ¨iOSè¿™è¡Œæ··è¿‡ä¸€æ®µæ—¶é—´çš„äººçœ‹åˆ°ä¸‹é¢çš„ä»£ç éƒ½ä¼šå¾ˆç†Ÿæ‚‰ æˆ‘ä»¬ä»Šå¤©è¦è®¨è®ºçš„å°±æ˜¯è¿™ä¸ªæ–¹æ³•æœ€åè¾¹çš„å¯å˜å‚æ•°åˆ—è¡¨çš„ä½¿ç”¨ã€‚è¿™ä¸ªæ–¹æ³•å†…éƒ¨åˆ°åº•æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿä»¥åŠè¿™æ ·æä¾›å‡½æ•°è°ƒç”¨çš„å¥½å¤„åˆæœ‰å“ªäº›å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ…¢æ…¢ç ”ç©¶ä¸‹ 1.é¦–å…ˆï¼Œè‹¹æœè¿™ä¹ˆåšï¼Œè‚¯å®šæ˜¯æœ‰å®ƒè¿™ä¹ˆè®¾è®¡çš„åŸå› ã€‚ç›¸æ¯”äºæœ€åä¸€ä¸ªå‚æ•°æ¢ä¸ºæ•°ç»„ï¼Œå¯å˜å‚æ•°åˆ—è¡¨çš„å½¢å¼æ›´åŠ ç›´è§‚ï¼Œå¯è¯»æ€§å¼ºï¼æ­¤å¤–ï¼Œç›¸å¯¹äºåªèƒ½ä¼ é€’ä¸€ä¸ªå‚æ•°çš„æ–¹æ³•ï¼Œå¯å˜å‚æ•°åˆ—è¡¨å‚æ•°åˆæä¾›äº†æ‰©å±•æ€§ï¼ŒåŸºäºæ­¤ï¼Œå¾ˆæœ‰å¿…è¦å»ç ”ç©¶ä¸‹å¯å˜å‚æ•°åˆ—è¡¨çš„ä½¿ç”¨äº†ã€‚2.å…¶æ¬¡ï¼ŒiOSå®ç°å¯å˜å‚æ•°åˆ—è¡¨çš„å…³é”®ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå…³é”®åœ¨äºva_listã€‚va_listæ˜¯Cè¯­è¨€æä¾›çš„å¤„ç†å¯å˜å‚æ•°çš„ä¸€ç§æ–¹æ³•ã€‚å…·ä½“çš„æ³¨æ„äº‹é¡¹å¦‚ä¸‹ 1.é¦–å…ˆåœ¨å‡½æ•°é‡Œé¢å®šä¹‰va_listçš„å˜é‡ï¼Œè¿™ä¸ªå˜é‡æ˜¯æŒ‡å‘å‚æ•°çš„æŒ‡é’ˆã€‚2.ç„¶åç”¨va_startåˆå§‹åŒ–åˆšå®šä¹‰çš„va_listå˜é‡ã€‚3.ç„¶åç”¨va_argè¿”å›å¯å˜çš„å‚æ•°ï¼Œva_argçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¿”å›çš„å‚æ•°ç±»å‹ï¼Œä¾‹å¦‚va_arg(args,NSString *)ï¼Œva_argæ¯è°ƒç”¨ä¸€æ¬¡å°±ä¼šæŒ‡å‘ä¸‹ä¸ªå‚æ•°çš„åœ°å€ï¼Œç›´åˆ°å†ä¹Ÿæ²¡æœ‰è·å–åˆ°å‚æ•°ä¸ºæ­¢ã€‚4.æœ€åç”¨va_endå®ç»“æŸå¯å˜å‚æ•°çš„è·å–ã€‚ ä¸‹é¢ï¼Œç”¨ä¸€ä¸ªdemoæ¥å…·ä½“æ¼”ç¤ºä¸‹å¦‚æœä½¿ç”¨å¯å˜å‚æ•°åˆ—è¡¨å£°æ˜ã€å®šä¹‰å‡½æ•° Tips 1.å‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œæœ€åä¸€ä¸ªå‚æ•°åé¢ä¸€å®šè¦åŠ nilï¼Œæˆ‘ä»¬ä¹Ÿåœ¨å‡½æ•°å£°æ˜çš„å®šä¹‰ç”¨ç¼–è¯‘å™¨å»åšäº†å±æ€§å£°æ˜ï¼Œè¦æ±‚æœ€åä¸€ä¸ªå‚æ•°ä¼ é€’nilè¿›å»ï¼Œå¦åˆ™ä¼šcrashã€‚2.å‡½æ•°ä¼ é€’çš„å‚æ•°ç±»å‹è¦æ±‚æ˜¯ç›¸åŒæ•°æ®ç±»å‹ï¼Œè¦ä¼ å­—ç¬¦ä¸²éƒ½ä¼ å­—ç¬¦ä¸²ï¼Œè¦ä¼ æ•°å­—éƒ½ä¼ æ•°å­—ï¼Œå¦åˆ™ä¹Ÿä¼šæœ‰é—®é¢˜ã€‚ä»Šå¤©ä¸»è¦å°±å¯¹è¿™ä¸ªè¿›è¡Œä¸€ä¸ªå°å°çš„æ€»ç»“ï¼Œæ€»ç»“è¿™ä¸ªé¢˜æä¼šåšå¤šå°‘æœŸï¼Œç›®å‰æˆ‘ä¸ªäººä¹Ÿä¸çŸ¥é“ï¼Œç­‰å“ªå¤©æ€»ç»“çš„å·®ä¸å¤šäº†ï¼Œä¹Ÿè®¸å°±åœä¸‹æ¥äº†å§ã€‚å˜¿å˜¿ï¼","link":"/2016/08/27/%E7%82%B9%E7%82%B9%E6%BB%B4%E6%BB%B4%EF%BC%9A%E5%85%B3%E4%BA%8Eva-list/"}],"tags":[{"name":"Hexo","slug":"Hexo","link":"/tags/Hexo/"},{"name":"python","slug":"python","link":"/tags/python/"},{"name":"ReactNative","slug":"ReactNative","link":"/tags/ReactNative/"},{"name":"RN","slug":"RN","link":"/tags/RN/"},{"name":"ä¸‰æ–¹åº“ç ”ç©¶","slug":"ä¸‰æ–¹åº“ç ”ç©¶","link":"/tags/%E4%B8%89%E6%96%B9%E5%BA%93%E7%A0%94%E7%A9%B6/"},{"name":"å·¥å…·","slug":"å·¥å…·","link":"/tags/%E5%B7%A5%E5%85%B7/"},{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","link":"/tags/%E7%BF%BB%E8%AF%91/"},{"name":"iOS","slug":"iOS","link":"/tags/iOS/"},{"name":"coredataå­¦ä¹ ","slug":"coredataå­¦ä¹ ","link":"/tags/coredata%E5%AD%A6%E4%B9%A0/"},{"name":"ç‚¹ç‚¹æ»´æ»´","slug":"ç‚¹ç‚¹æ»´æ»´","link":"/tags/%E7%82%B9%E7%82%B9%E6%BB%B4%E6%BB%B4/"}],"categories":[{"name":"è½¬","slug":"è½¬","link":"/categories/%E8%BD%AC/"}],"pages":[{"title":"å…³äº","text":"è®°å½•å­¦ä¹ çš„ç‚¹ç‚¹æ»´æ»´","link":"/about/index.html"},{"title":"åˆ†ç±»","text":"","link":"/categories/index.html"},{"title":"æ ‡ç­¾","text":"","link":"/tags/index.html"}]}